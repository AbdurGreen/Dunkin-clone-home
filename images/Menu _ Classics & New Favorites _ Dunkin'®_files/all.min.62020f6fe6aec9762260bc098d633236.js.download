/**
 *  @fileoverview TextResizeDetector
 *
 *  Detects changes to font sizes when user changes browser settings
 *  <br>Fires a custom event with the following data:<br><br>
 * 	iBase  : base font size
 *	iDelta : difference in pixels from previous setting<br>
 *  	iSize  : size in pixel of text<br>
 *
 *  * @author Lawrence Carvalho carvalho@uk.yahoo-inc.com
 * @version 1.0
 */

/**
 * @constructor
 */
TextResizeDetector = (function () {
    var el = null;
    var iIntervalDelay = 200;
    var iInterval = null;
    var iCurrSize = -1;
    var iBase = -1;
    var aListeners = [];
    var createControlElement = function () {
        el = document.createElement('span');
        el.id = 'textResizeControl';
        el.innerHTML = '&nbsp;';
        el.style.position = 'absolute';
        el.style.left = '-9999px';
        var elC = document.getElementById(TextResizeDetector.TARGET_ELEMENT_ID);
        // insert before firstChild
        if (elC) elC.insertBefore(el, elC.firstChild);
        iBase = iCurrSize = TextResizeDetector.getSize();
    };

    function _stopDetector() {
        window.clearInterval(iInterval);
        iInterval = null;
    }
    function _startDetector() {
        if (!iInterval) {
            iInterval = window.setInterval('TextResizeDetector.detect()', iIntervalDelay);
        }
    }

    function _detect() {
        var iNewSize = TextResizeDetector.getSize();

        if (iNewSize !== iCurrSize) {
            for (var i = 0; i < aListeners.length; i++) {
                aListnr = aListeners[i];
                var oArgs = {
                    iBase: iBase,
                    iDelta: iCurrSize != -1 ? iNewSize - iCurrSize + 'px' : '0px',
                    iSize: (iCurrSize = iNewSize),
                };
                if (!aListnr.obj) {
                    aListnr.fn('textSizeChanged', [oArgs]);
                } else {
                    aListnr.fn.apply(aListnr.obj, ['textSizeChanged', [oArgs]]);
                }
            }
        }
        return iCurrSize;
    }
    var onAvailable = function () {
        if (!TextResizeDetector.onAvailableCount_i) {
            TextResizeDetector.onAvailableCount_i = 0;
        }

        if (document.getElementById(TextResizeDetector.TARGET_ELEMENT_ID)) {
            TextResizeDetector.init();
            if (TextResizeDetector.USER_INIT_FUNC) {
                TextResizeDetector.USER_INIT_FUNC();
            }
            TextResizeDetector.onAvailableCount_i = null;
        } else {
            if (TextResizeDetector.onAvailableCount_i < 600) {
                TextResizeDetector.onAvailableCount_i++;
                setTimeout(onAvailable, 200);
            }
        }
    };
    setTimeout(onAvailable, 500);

    return {
        /*
         * Initializes the detector
         *
         * @param {String} sId The id of the element in which to create the control element
         */
        init: function () {
            createControlElement();
            _startDetector();
        },
        /**
         * Adds listeners to the ontextsizechange event.
         * Returns the base font size
         *
         */
        addEventListener: function (fn, obj, bScope) {
            aListeners[aListeners.length] = {
                fn: fn,
                obj: obj,
            };
            return iBase;
        },
        /**
         * performs the detection and fires textSizeChanged event
         * @return the current font size
         * @type {integer}
         */
        detect: function () {
            return _detect();
        },
        /**
         * Returns the height of the control element
         *
         * @return the current height of control element
         * @type {integer}
         */
        getSize: function () {
            var iSize;
            return el.offsetHeight;
        },
        /**
         * Stops the detector
         */
        stopDetector: function () {
            return _stopDetector();
        },
        /*
         * Starts the detector
         */
        startDetector: function () {
            return _startDetector();
        },
    };
})();

TextResizeDetector.TARGET_ELEMENT_ID = 'doc';
TextResizeDetector.USER_INIT_FUNC = null;

/*!
 * SelectWoo 5.0.0
 * https://github.com/woocommerce/selectWoo
 *
 * Released under the MIT license
 * https://github.com/woocommerce/selectWoo/blob/master/LICENSE.md
 */
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], factory);
    } else if (typeof module === 'object' && module.exports) {
        // Node/CommonJS
        module.exports = function (root, jQuery) {
            if (jQuery === undefined) {
                // require('jQuery') returns a factory that requires window to
                // build a jQuery instance, we normalize how we use modules
                // that require this pattern but the window provided is a noop
                // if it's defined (how jquery works)
                if (typeof window !== 'undefined') {
                    jQuery = require('jquery');
                } else {
                    jQuery = require('jquery')(root);
                }
            }
            factory(jQuery);
            return jQuery;
        };
    } else {
        // Browser globals
        factory(jQuery);
    }
})(function (jQuery) {
    // This is needed so we can catch the AMD loader configuration and use it
    // The inner file should be wrapped (by `banner.start.js`) in a function that
    // returns the AMD loader references.
    var S2 = (function () {
        // Restore the Select2 AMD loader so it can be used
        // Needed mostly in the language files, where the loader is not inserted
        if (jQuery && jQuery.fn && jQuery.fn.select2 && jQuery.fn.select2.amd) {
            var S2 = jQuery.fn.select2.amd;
        }
        var S2;
        (function () {
            if (!S2 || !S2.requirejs) {
                if (!S2) {
                    S2 = {};
                } else {
                    require = S2;
                }
                /**
                 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
                 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
                 */
                //Going sloppy to avoid 'use strict' string cost, but strict practices should
                //be followed.
                /*global setTimeout: false */

                var requirejs, require, define;
                (function (undef) {
                    var main,
                        req,
                        makeMap,
                        handlers,
                        defined = {},
                        waiting = {},
                        config = {},
                        defining = {},
                        hasOwn = Object.prototype.hasOwnProperty,
                        aps = [].slice,
                        jsSuffixRegExp = /\.js$/;

                    function hasProp(obj, prop) {
                        return hasOwn.call(obj, prop);
                    }

                    /**
                     * Given a relative module name, like ./something, normalize it to
                     * a real name that can be mapped to a path.
                     * @param {String} name the relative name
                     * @param {String} baseName a real name that the name arg is relative
                     * to.
                     * @returns {String} normalized name
                     */
                    function normalize(name, baseName) {
                        var nameParts,
                            nameSegment,
                            mapValue,
                            foundMap,
                            lastIndex,
                            foundI,
                            foundStarMap,
                            starI,
                            i,
                            j,
                            part,
                            normalizedBaseParts,
                            baseParts = baseName && baseName.split('/'),
                            map = config.map,
                            starMap = (map && map['*']) || {};

                        //Adjust any relative paths.
                        if (name) {
                            name = name.split('/');
                            lastIndex = name.length - 1;

                            // If wanting node ID compatibility, strip .js from end
                            // of IDs. Have to do this here, and not in nameToUrl
                            // because node allows either .js or non .js to map
                            // to same file.
                            if (config.nodeIdCompat && jsSuffixRegExp.test(name[lastIndex])) {
                                name[lastIndex] = name[lastIndex].replace(jsSuffixRegExp, '');
                            }

                            // Starts with a '.' so need the baseName
                            if (name[0].charAt(0) === '.' && baseParts) {
                                //Convert baseName to array, and lop off the last part,
                                //so that . matches that 'directory' and not name of the baseName's
                                //module. For instance, baseName of 'one/two/three', maps to
                                //'one/two/three.js', but we want the directory, 'one/two' for
                                //this normalization.
                                normalizedBaseParts = baseParts.slice(0, baseParts.length - 1);
                                name = normalizedBaseParts.concat(name);
                            }

                            //start trimDots
                            for (i = 0; i < name.length; i++) {
                                part = name[i];
                                if (part === '.') {
                                    name.splice(i, 1);
                                    i -= 1;
                                } else if (part === '..') {
                                    // If at the start, or previous value is still ..,
                                    // keep them so that when converted to a path it may
                                    // still work when converted to a path, even though
                                    // as an ID it is less than ideal. In larger point
                                    // releases, may be better to just kick out an error.
                                    if (i === 0 || (i === 1 && name[2] === '..') || name[i - 1] === '..') {
                                        continue;
                                    } else if (i > 0) {
                                        name.splice(i - 1, 2);
                                        i -= 2;
                                    }
                                }
                            }
                            //end trimDots

                            name = name.join('/');
                        }

                        //Apply map config if available.
                        if ((baseParts || starMap) && map) {
                            nameParts = name.split('/');

                            for (i = nameParts.length; i > 0; i -= 1) {
                                nameSegment = nameParts.slice(0, i).join('/');

                                if (baseParts) {
                                    //Find the longest baseName segment match in the config.
                                    //So, do joins on the biggest to smallest lengths of baseParts.
                                    for (j = baseParts.length; j > 0; j -= 1) {
                                        mapValue = map[baseParts.slice(0, j).join('/')];

                                        //baseName segment has  config, find if it has one for
                                        //this name.
                                        if (mapValue) {
                                            mapValue = mapValue[nameSegment];
                                            if (mapValue) {
                                                //Match, update name to the new value.
                                                foundMap = mapValue;
                                                foundI = i;
                                                break;
                                            }
                                        }
                                    }
                                }

                                if (foundMap) {
                                    break;
                                }

                                //Check for a star map match, but just hold on to it,
                                //if there is a shorter segment match later in a matching
                                //config, then favor over this star map.
                                if (!foundStarMap && starMap && starMap[nameSegment]) {
                                    foundStarMap = starMap[nameSegment];
                                    starI = i;
                                }
                            }

                            if (!foundMap && foundStarMap) {
                                foundMap = foundStarMap;
                                foundI = starI;
                            }

                            if (foundMap) {
                                nameParts.splice(0, foundI, foundMap);
                                name = nameParts.join('/');
                            }
                        }

                        return name;
                    }

                    function makeRequire(relName, forceSync) {
                        return function () {
                            //A version of a require function that passes a moduleName
                            //value for items that may need to
                            //look up paths relative to the moduleName
                            var args = aps.call(arguments, 0);

                            //If first arg is not require('string'), and there is only
                            //one arg, it is the array form without a callback. Insert
                            //a null so that the following concat is correct.
                            if (typeof args[0] !== 'string' && args.length === 1) {
                                args.push(null);
                            }
                            return req.apply(undef, args.concat([relName, forceSync]));
                        };
                    }

                    function makeNormalize(relName) {
                        return function (name) {
                            return normalize(name, relName);
                        };
                    }

                    function makeLoad(depName) {
                        return function (value) {
                            defined[depName] = value;
                        };
                    }

                    function callDep(name) {
                        if (hasProp(waiting, name)) {
                            var args = waiting[name];
                            delete waiting[name];
                            defining[name] = true;
                            main.apply(undef, args);
                        }

                        if (!hasProp(defined, name) && !hasProp(defining, name)) {
                            throw new Error('No ' + name);
                        }
                        return defined[name];
                    }

                    //Turns a plugin!resource to [plugin, resource]
                    //with the plugin being undefined if the name
                    //did not have a plugin prefix.
                    function splitPrefix(name) {
                        var prefix,
                            index = name ? name.indexOf('!') : -1;
                        if (index > -1) {
                            prefix = name.substring(0, index);
                            name = name.substring(index + 1, name.length);
                        }
                        return [prefix, name];
                    }

                    //Creates a parts array for a relName where first part is plugin ID,
                    //second part is resource ID. Assumes relName has already been normalized.
                    function makeRelParts(relName) {
                        return relName ? splitPrefix(relName) : [];
                    }

                    /**
                     * Makes a name map, normalizing the name, and using a plugin
                     * for normalization if necessary. Grabs a ref to plugin
                     * too, as an optimization.
                     */
                    makeMap = function (name, relParts) {
                        var plugin,
                            parts = splitPrefix(name),
                            prefix = parts[0],
                            relResourceName = relParts[1];

                        name = parts[1];

                        if (prefix) {
                            prefix = normalize(prefix, relResourceName);
                            plugin = callDep(prefix);
                        }

                        //Normalize according
                        if (prefix) {
                            if (plugin && plugin.normalize) {
                                name = plugin.normalize(name, makeNormalize(relResourceName));
                            } else {
                                name = normalize(name, relResourceName);
                            }
                        } else {
                            name = normalize(name, relResourceName);
                            parts = splitPrefix(name);
                            prefix = parts[0];
                            name = parts[1];
                            if (prefix) {
                                plugin = callDep(prefix);
                            }
                        }

                        //Using ridiculous property names for space reasons
                        return {
                            f: prefix ? prefix + '!' + name : name, //fullName
                            n: name,
                            pr: prefix,
                            p: plugin,
                        };
                    };

                    function makeConfig(name) {
                        return function () {
                            return (config && config.config && config.config[name]) || {};
                        };
                    }

                    handlers = {
                        require: function (name) {
                            return makeRequire(name);
                        },
                        exports: function (name) {
                            var e = defined[name];
                            if (typeof e !== 'undefined') {
                                return e;
                            } else {
                                return (defined[name] = {});
                            }
                        },
                        module: function (name) {
                            return {
                                id: name,
                                uri: '',
                                exports: defined[name],
                                config: makeConfig(name),
                            };
                        },
                    };

                    main = function (name, deps, callback, relName) {
                        var cjsModule,
                            depName,
                            ret,
                            map,
                            i,
                            relParts,
                            args = [],
                            callbackType = typeof callback,
                            usingExports;

                        //Use name if no relName
                        relName = relName || name;
                        relParts = makeRelParts(relName);

                        //Call the callback to define the module, if necessary.
                        if (callbackType === 'undefined' || callbackType === 'function') {
                            //Pull out the defined dependencies and pass the ordered
                            //values to the callback.
                            //Default to [require, exports, module] if no deps
                            deps = !deps.length && callback.length ? ['require', 'exports', 'module'] : deps;
                            for (i = 0; i < deps.length; i += 1) {
                                map = makeMap(deps[i], relParts);
                                depName = map.f;

                                //Fast path CommonJS standard dependencies.
                                if (depName === 'require') {
                                    args[i] = handlers.require(name);
                                } else if (depName === 'exports') {
                                    //CommonJS module spec 1.1
                                    args[i] = handlers.exports(name);
                                    usingExports = true;
                                } else if (depName === 'module') {
                                    //CommonJS module spec 1.1
                                    cjsModule = args[i] = handlers.module(name);
                                } else if (hasProp(defined, depName) || hasProp(waiting, depName) || hasProp(defining, depName)) {
                                    args[i] = callDep(depName);
                                } else if (map.p) {
                                    map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});
                                    args[i] = defined[depName];
                                } else {
                                    throw new Error(name + ' missing ' + depName);
                                }
                            }

                            ret = callback ? callback.apply(defined[name], args) : undefined;

                            if (name) {
                                //If setting exports via "module" is in play,
                                //favor that over return value and exports. After that,
                                //favor a non-undefined return value over exports use.
                                if (cjsModule && cjsModule.exports !== undef && cjsModule.exports !== defined[name]) {
                                    defined[name] = cjsModule.exports;
                                } else if (ret !== undef || !usingExports) {
                                    //Use the return value from the function.
                                    defined[name] = ret;
                                }
                            }
                        } else if (name) {
                            //May just be an object definition for the module. Only
                            //worry about defining if have a module name.
                            defined[name] = callback;
                        }
                    };

                    requirejs = require = req = function (deps, callback, relName, forceSync, alt) {
                        if (typeof deps === 'string') {
                            if (handlers[deps]) {
                                //callback in this case is really relName
                                return handlers[deps](callback);
                            }
                            //Just return the module wanted. In this scenario, the
                            //deps arg is the module name, and second arg (if passed)
                            //is just the relName.
                            //Normalize module name, if it contains . or ..
                            return callDep(makeMap(deps, makeRelParts(callback)).f);
                        } else if (!deps.splice) {
                            //deps is a config object, not an array.
                            config = deps;
                            if (config.deps) {
                                req(config.deps, config.callback);
                            }
                            if (!callback) {
                                return;
                            }

                            if (callback.splice) {
                                //callback is an array, which means it is a dependency list.
                                //Adjust args if there are dependencies
                                deps = callback;
                                callback = relName;
                                relName = null;
                            } else {
                                deps = undef;
                            }
                        }

                        //Support require(['a'])
                        callback = callback || function () {};

                        //If relName is a function, it is an errback handler,
                        //so remove it.
                        if (typeof relName === 'function') {
                            relName = forceSync;
                            forceSync = alt;
                        }

                        //Simulate async callback;
                        if (forceSync) {
                            main(undef, deps, callback, relName);
                        } else {
                            //Using a non-zero value because of concern for what old browsers
                            //do, and latest browsers "upgrade" to 4 if lower value is used:
                            //http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:
                            //If want a value immediately, use require('id') instead -- something
                            //that works in almond on the global level, but not guaranteed and
                            //unlikely to work in other AMD implementations.
                            setTimeout(function () {
                                main(undef, deps, callback, relName);
                            }, 4);
                        }

                        return req;
                    };

                    /**
                     * Just drops the config on the floor, but returns req in case
                     * the config return value is used.
                     */
                    req.config = function (cfg) {
                        return req(cfg);
                    };

                    /**
                     * Expose module registry for debugging and tooling
                     */
                    requirejs._defined = defined;

                    define = function (name, deps, callback) {
                        if (typeof name !== 'string') {
                            throw new Error('See almond README: incorrect module build, no module name');
                        }

                        //This module may not have dependencies
                        if (!deps.splice) {
                            //deps is not an array, so probably means
                            //an object literal or factory function for
                            //the value. Adjust args.
                            callback = deps;
                            deps = [];
                        }

                        if (!hasProp(defined, name) && !hasProp(waiting, name)) {
                            waiting[name] = [name, deps, callback];
                        }
                    };

                    define.amd = {
                        jQuery: true,
                    };
                })();

                S2.requirejs = requirejs;
                S2.require = require;
                S2.define = define;
            }
        })();
        S2.define('almond', function () {});

        /* global jQuery:false, $:false */
        S2.define('jquery', [], function () {
            var _$ = jQuery || $;

            if (_$ == null && console && console.error) {
                console.error(
                    'Select2: An instance of jQuery or a jQuery-compatible library was not ' +
                        'found. Make sure that you are including jQuery before Select2 on your ' +
                        'web page.'
                );
            }

            return _$;
        });

        S2.define('select2/utils', ['jquery'], function ($) {
            var Utils = {};

            Utils.Extend = function (ChildClass, SuperClass) {
                var __hasProp = {}.hasOwnProperty;

                function BaseConstructor() {
                    this.constructor = ChildClass;
                }

                for (var key in SuperClass) {
                    if (__hasProp.call(SuperClass, key)) {
                        ChildClass[key] = SuperClass[key];
                    }
                }

                BaseConstructor.prototype = SuperClass.prototype;
                ChildClass.prototype = new BaseConstructor();
                ChildClass.__super__ = SuperClass.prototype;

                return ChildClass;
            };

            function getMethods(theClass) {
                var proto = theClass.prototype;

                var methods = [];

                for (var methodName in proto) {
                    var m = proto[methodName];

                    if (typeof m !== 'function') {
                        continue;
                    }

                    if (methodName === 'constructor') {
                        continue;
                    }

                    methods.push(methodName);
                }

                return methods;
            }

            Utils.Decorate = function (SuperClass, DecoratorClass) {
                var decoratedMethods = getMethods(DecoratorClass);
                var superMethods = getMethods(SuperClass);

                function DecoratedClass() {
                    var unshift = Array.prototype.unshift;

                    var argCount = DecoratorClass.prototype.constructor.length;

                    var calledConstructor = SuperClass.prototype.constructor;

                    if (argCount > 0) {
                        unshift.call(arguments, SuperClass.prototype.constructor);

                        calledConstructor = DecoratorClass.prototype.constructor;
                    }

                    calledConstructor.apply(this, arguments);
                }

                DecoratorClass.displayName = SuperClass.displayName;

                function ctr() {
                    this.constructor = DecoratedClass;
                }

                DecoratedClass.prototype = new ctr();

                for (var m = 0; m < superMethods.length; m++) {
                    var superMethod = superMethods[m];

                    DecoratedClass.prototype[superMethod] = SuperClass.prototype[superMethod];
                }

                var calledMethod = function (methodName) {
                    // Stub out the original method if it's not decorating an actual method
                    var originalMethod = function () {};

                    if (methodName in DecoratedClass.prototype) {
                        originalMethod = DecoratedClass.prototype[methodName];
                    }

                    var decoratedMethod = DecoratorClass.prototype[methodName];

                    return function () {
                        var unshift = Array.prototype.unshift;

                        unshift.call(arguments, originalMethod);

                        return decoratedMethod.apply(this, arguments);
                    };
                };

                for (var d = 0; d < decoratedMethods.length; d++) {
                    var decoratedMethod = decoratedMethods[d];

                    DecoratedClass.prototype[decoratedMethod] = calledMethod(decoratedMethod);
                }

                return DecoratedClass;
            };

            var Observable = function () {
                this.listeners = {};
            };

            Observable.prototype.on = function (event, callback) {
                this.listeners = this.listeners || {};

                if (event in this.listeners) {
                    this.listeners[event].push(callback);
                } else {
                    this.listeners[event] = [callback];
                }
            };

            Observable.prototype.trigger = function (event) {
                var slice = Array.prototype.slice;
                var params = slice.call(arguments, 1);

                this.listeners = this.listeners || {};

                // Params should always come in as an array
                if (params == null) {
                    params = [];
                }

                // If there are no arguments to the event, use a temporary object
                if (params.length === 0) {
                    params.push({});
                }

                // Set the `_type` of the first object to the event
                params[0]._type = event;

                if (event in this.listeners) {
                    this.invoke(this.listeners[event], slice.call(arguments, 1));
                }

                if ('*' in this.listeners) {
                    this.invoke(this.listeners['*'], arguments);
                }
            };

            Observable.prototype.invoke = function (listeners, params) {
                for (var i = 0, len = listeners.length; i < len; i++) {
                    listeners[i].apply(this, params);
                }
            };

            Utils.Observable = Observable;

            Utils.generateChars = function (length) {
                var chars = '';

                for (var i = 0; i < length; i++) {
                    var randomChar = Math.floor(Math.random() * 36);
                    chars += randomChar.toString(36);
                }

                return chars;
            };

            Utils.bind = function (func, context) {
                return function () {
                    func.apply(context, arguments);
                };
            };

            Utils._convertData = function (data) {
                for (var originalKey in data) {
                    var keys = originalKey.split('-');

                    var dataLevel = data;

                    if (keys.length === 1) {
                        continue;
                    }

                    for (var k = 0; k < keys.length; k++) {
                        var key = keys[k];

                        // Lowercase the first letter
                        // By default, dash-separated becomes camelCase
                        key = key.substring(0, 1).toLowerCase() + key.substring(1);

                        if (!(key in dataLevel)) {
                            dataLevel[key] = {};
                        }

                        if (k == keys.length - 1) {
                            dataLevel[key] = data[originalKey];
                        }

                        dataLevel = dataLevel[key];
                    }

                    delete data[originalKey];
                }

                return data;
            };

            Utils.hasScroll = function (index, el) {
                // Adapted from the function created by @ShadowScripter
                // and adapted by @BillBarry on the Stack Exchange Code Review website.
                // The original code can be found at
                // http://codereview.stackexchange.com/q/13338
                // and was designed to be used with the Sizzle selector engine.

                var $el = $(el);
                var overflowX = el.style.overflowX;
                var overflowY = el.style.overflowY;

                //Check both x and y declarations
                if (overflowX === overflowY && (overflowY === 'hidden' || overflowY === 'visible')) {
                    return false;
                }

                if (overflowX === 'scroll' || overflowY === 'scroll') {
                    return true;
                }

                return $el.innerHeight() < el.scrollHeight || $el.innerWidth() < el.scrollWidth;
            };

            Utils.escapeMarkup = function (markup) {
                var replaceMap = {
                    '\\': '&#92;',
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;',
                    '/': '&#47;',
                };

                // Do not try to escape the markup if it's not a string
                if (typeof markup !== 'string') {
                    return markup;
                }

                return String(markup).replace(/[&<>"'\/\\]/g, function (match) {
                    return replaceMap[match];
                });
            };

            // Append an array of jQuery nodes to a given element.
            Utils.appendMany = function ($element, $nodes) {
                // jQuery 1.7.x does not support $.fn.append() with an array
                // Fall back to a jQuery object collection using $.fn.add()
                if ($.fn.jquery.substr(0, 3) === '1.7') {
                    var $jqNodes = $();

                    $.map($nodes, function (node) {
                        $jqNodes = $jqNodes.add(node);
                    });

                    $nodes = $jqNodes;
                }

                $element.append($nodes);
            };

            return Utils;
        });

        S2.define('select2/results', ['jquery', './utils'], function ($, Utils) {
            function Results($element, options, dataAdapter) {
                this.$element = $element;
                this.data = dataAdapter;
                this.options = options;

                Results.__super__.constructor.call(this);
            }

            Utils.Extend(Results, Utils.Observable);

            Results.prototype.render = function () {
                var $results = $('<ul class="select2-results__options" role="listbox"></ul>');

                if (this.options.get('multiple')) {
                    $results.attr('aria-multiselectable', 'true');
                }

                this.$results = $results;

                return $results;
            };

            Results.prototype.clear = function () {
                this.$results.empty();
            };

            Results.prototype.displayMessage = function (params) {
                var escapeMarkup = this.options.get('escapeMarkup');

                this.clear();
                this.hideLoading();

                var $message = $('<li role="alert" aria-live="assertive"' + ' class="select2-results__option"></li>');

                var message = this.options.get('translations').get(params.message);

                $message.append(escapeMarkup(message(params.args)));

                $message[0].className += ' select2-results__message';

                this.$results.append($message);
            };

            Results.prototype.hideMessages = function () {
                this.$results.find('.select2-results__message').remove();
            };

            Results.prototype.append = function (data) {
                this.hideLoading();

                var $options = [];

                if (data.results == null || data.results.length === 0) {
                    if (this.$results.children().length === 0) {
                        this.trigger('results:message', {
                            message: 'noResults',
                        });
                    }

                    return;
                }

                data.results = this.sort(data.results);

                for (var d = 0; d < data.results.length; d++) {
                    var item = data.results[d];

                    var $option = this.option(item);

                    $options.push($option);
                }

                this.$results.append($options);
            };

            Results.prototype.position = function ($results, $dropdown) {
                var $resultsContainer = $dropdown.find('.select2-results');
                $resultsContainer.append($results);
            };

            Results.prototype.sort = function (data) {
                var sorter = this.options.get('sorter');

                return sorter(data);
            };

            Results.prototype.highlightFirstItem = function () {
                var $options = this.$results.find('.select2-results__option[data-selected]');

                var $selected = $options.filter('[data-selected=true]');

                // Check if there are any selected options
                if ($selected.length > 0) {
                    // If there are selected options, highlight the first
                    $selected.first().trigger('mouseenter');
                } else {
                    // If there are no selected options, highlight the first option
                    // in the dropdown
                    $options.first().trigger('mouseenter');
                }

                this.ensureHighlightVisible();
            };

            Results.prototype.setClasses = function () {
                var self = this;

                this.data.current(function (selected) {
                    var selectedIds = $.map(selected, function (s) {
                        return s.id.toString();
                    });

                    var $options = self.$results.find('.select2-results__option[data-selected]');

                    $options.each(function () {
                        var $option = $(this);

                        var item = $.data(this, 'data');

                        // id needs to be converted to a string when comparing
                        var id = '' + item.id;

                        if (
                            (item.element != null && item.element.selected) ||
                            (item.element == null && $.inArray(id, selectedIds) > -1)
                        ) {
                            $option.attr('data-selected', 'true');
                        } else {
                            $option.attr('data-selected', 'false');
                        }
                    });
                });
            };

            Results.prototype.showLoading = function (params) {
                this.hideLoading();

                var loadingMore = this.options.get('translations').get('searching');

                var loading = {
                    disabled: true,
                    loading: true,
                    text: loadingMore(params),
                };
                var $loading = this.option(loading);
                $loading.className += ' loading-results';

                this.$results.prepend($loading);
            };

            Results.prototype.hideLoading = function () {
                this.$results.find('.loading-results').remove();
            };

            Results.prototype.option = function (data) {
                var option = document.createElement('li');
                option.className = 'select2-results__option';

                var attrs = {
                    role: 'option',
                    'data-selected': 'false',
                };

                if (data.disabled) {
                    delete attrs['data-selected'];
                    attrs['aria-disabled'] = 'true';
                }

                if (data.id == null) {
                    delete attrs['data-selected'];
                }

                if (data._resultId != null) {
                    option.id = data._resultId;
                }

                if (data.title) {
                    option.title = data.title;
                }

                if (data.children) {
                    attrs['aria-label'] = data.text;
                    delete attrs['data-selected'];
                }

                for (var attr in attrs) {
                    var val = attrs[attr];

                    option.setAttribute(attr, val);
                }

                if (data.children) {
                    var $option = $(option);

                    var label = document.createElement('strong');
                    label.className = 'select2-results__group';

                    var $label = $(label);
                    this.template(data, label);

                    var $children = [];

                    for (var c = 0; c < data.children.length; c++) {
                        var child = data.children[c];

                        var $child = this.option(child);

                        $children.push($child);
                    }

                    var $childrenContainer = $('<ul></ul>', {
                        class: 'select2-results__options select2-results__options--nested',
                    });

                    $childrenContainer.append($children);

                    $option.append(label);
                    $option.append($childrenContainer);
                } else {
                    this.template(data, option);
                }

                $.data(option, 'data', data);

                return option;
            };

            Results.prototype.bind = function (container, $container) {
                var self = this;

                var id = container.id + '-results';

                this.$results.attr('id', id);

                container.on('results:all', function (params) {
                    self.clear();
                    self.append(params.data);

                    if (container.isOpen()) {
                        self.setClasses();
                        self.highlightFirstItem();
                    }
                });

                container.on('results:append', function (params) {
                    self.append(params.data);

                    if (container.isOpen()) {
                        self.setClasses();
                    }
                });

                container.on('query', function (params) {
                    self.hideMessages();
                    self.showLoading(params);
                });

                container.on('select', function () {
                    if (!container.isOpen()) {
                        return;
                    }

                    self.setClasses();
                    self.highlightFirstItem();
                });

                container.on('unselect', function () {
                    if (!container.isOpen()) {
                        return;
                    }

                    self.setClasses();
                    self.highlightFirstItem();
                });

                container.on('open', function () {
                    // When the dropdown is open, aria-expended="true"
                    self.$results.attr('aria-expanded', 'true');
                    self.$results.attr('aria-hidden', 'false');

                    self.setClasses();
                    self.ensureHighlightVisible();
                });

                container.on('close', function () {
                    // When the dropdown is closed, aria-expended="false"
                    self.$results.attr('aria-expanded', 'false');
                    self.$results.attr('aria-hidden', 'true');
                    self.$results.removeAttr('aria-activedescendant');
                });

                container.on('results:toggle', function () {
                    var $highlighted = self.getHighlightedResults();

                    if ($highlighted.length === 0) {
                        return;
                    }

                    $highlighted.trigger('mouseup');
                });

                container.on('results:select', function () {
                    var $highlighted = self.getHighlightedResults();

                    if ($highlighted.length === 0) {
                        return;
                    }

                    var data = $highlighted.data('data');

                    if ($highlighted.attr('data-selected') == 'true') {
                        self.trigger('close', {});
                    } else {
                        self.trigger('select', {
                            data: data,
                        });
                    }
                });

                container.on('results:previous', function () {
                    var $highlighted = self.getHighlightedResults();

                    var $options = self.$results.find('[data-selected]');

                    var currentIndex = $options.index($highlighted);

                    // If we are already at te top, don't move further
                    if (currentIndex === 0) {
                        return;
                    }

                    var nextIndex = currentIndex - 1;

                    // If none are highlighted, highlight the first
                    if ($highlighted.length === 0) {
                        nextIndex = 0;
                    }

                    var $next = $options.eq(nextIndex);

                    $next.trigger('mouseenter');

                    var currentOffset = self.$results.offset().top;
                    var nextTop = $next.offset().top;
                    var nextOffset = self.$results.scrollTop() + (nextTop - currentOffset);

                    if (nextIndex === 0) {
                        self.$results.scrollTop(0);
                    } else if (nextTop - currentOffset < 0) {
                        self.$results.scrollTop(nextOffset);
                    }
                });

                container.on('results:next', function () {
                    var $highlighted = self.getHighlightedResults();

                    var $options = self.$results.find('[data-selected]');

                    var currentIndex = $options.index($highlighted);

                    var nextIndex = currentIndex + 1;

                    // If we are at the last option, stay there
                    if (nextIndex >= $options.length) {
                        return;
                    }

                    var $next = $options.eq(nextIndex);

                    $next.trigger('mouseenter');

                    var currentOffset = self.$results.offset().top + self.$results.outerHeight(false);
                    var nextBottom = $next.offset().top + $next.outerHeight(false);
                    var nextOffset = self.$results.scrollTop() + nextBottom - currentOffset;

                    if (nextIndex === 0) {
                        self.$results.scrollTop(0);
                    } else if (nextBottom > currentOffset) {
                        self.$results.scrollTop(nextOffset);
                    }
                });

                container.on('results:focus', function (params) {
                    params.element.addClass('select2-results__option--highlighted').attr('aria-selected', 'true');
                    self.$results.attr('aria-activedescendant', params.element.attr('id'));
                });

                container.on('results:message', function (params) {
                    self.displayMessage(params);
                });

                if ($.fn.mousewheel) {
                    this.$results.on('mousewheel', function (e) {
                        var top = self.$results.scrollTop();

                        var bottom = self.$results.get(0).scrollHeight - top + e.deltaY;

                        var isAtTop = e.deltaY > 0 && top - e.deltaY <= 0;
                        var isAtBottom = e.deltaY < 0 && bottom <= self.$results.height();

                        if (isAtTop) {
                            self.$results.scrollTop(0);

                            e.preventDefault();
                            e.stopPropagation();
                        } else if (isAtBottom) {
                            self.$results.scrollTop(self.$results.get(0).scrollHeight - self.$results.height());

                            e.preventDefault();
                            e.stopPropagation();
                        }
                    });
                }

                this.$results.on('mouseup', '.select2-results__option[data-selected]', function (evt) {
                    var $this = $(this);

                    var data = $this.data('data');

                    if ($this.attr('data-selected') === 'true') {
                        if (self.options.get('multiple')) {
                            self.trigger('unselect', {
                                originalEvent: evt,
                                data: data,
                            });
                        } else {
                            self.trigger('close', {});
                        }

                        return;
                    }

                    self.trigger('select', {
                        originalEvent: evt,
                        data: data,
                    });
                });

                this.$results.on('mouseenter', '.select2-results__option[data-selected]', function (evt) {
                    var data = $(this).data('data');

                    self.getHighlightedResults()
                        .removeClass('select2-results__option--highlighted')
                        .attr('aria-selected', 'false');

                    self.trigger('results:focus', {
                        data: data,
                        element: $(this),
                    });
                });
            };

            Results.prototype.getHighlightedResults = function () {
                var $highlighted = this.$results.find('.select2-results__option--highlighted');

                return $highlighted;
            };

            Results.prototype.destroy = function () {
                this.$results.remove();
            };

            Results.prototype.ensureHighlightVisible = function () {
                var $highlighted = this.getHighlightedResults();

                if ($highlighted.length === 0) {
                    return;
                }

                var $options = this.$results.find('[data-selected]');

                var currentIndex = $options.index($highlighted);

                var currentOffset = this.$results.offset().top;
                var nextTop = $highlighted.offset().top;
                var nextOffset = this.$results.scrollTop() + (nextTop - currentOffset);

                var offsetDelta = nextTop - currentOffset;
                nextOffset -= $highlighted.outerHeight(false) * 1;

                if (currentIndex <= 2) {
                    this.$results.scrollTop(0);
                } else if (offsetDelta > this.$results.outerHeight() || offsetDelta < 0) {
                    this.$results.scrollTop(nextOffset);
                }
            };

            Results.prototype.template = function (result, container) {
                var template = this.options.get('templateResult');
                var escapeMarkup = this.options.get('escapeMarkup');

                var content = template(result, container);

                if (content == null) {
                    container.style.display = 'none';
                } else if (typeof content === 'string') {
                    container.innerHTML = escapeMarkup(content);
                } else {
                    $(container).append(content);
                }
            };

            return Results;
        });

        S2.define('select2/keys', [], function () {
            var KEYS = {
                BACKSPACE: 8,
                TAB: 9,
                ENTER: 13,
                SHIFT: 16,
                CTRL: 17,
                ALT: 18,
                ESC: 27,
                SPACE: 32,
                PAGE_UP: 33,
                PAGE_DOWN: 34,
                END: 35,
                HOME: 36,
                LEFT: 37,
                UP: 38,
                RIGHT: 39,
                DOWN: 40,
                DELETE: 46,
            };

            return KEYS;
        });

        S2.define('select2/selection/base', ['jquery', '../utils', '../keys'], function ($, Utils, KEYS) {
            function BaseSelection($element, options) {
                this.$element = $element;
                this.options = options;

                BaseSelection.__super__.constructor.call(this);
            }

            Utils.Extend(BaseSelection, Utils.Observable);

            BaseSelection.prototype.render = function () {
                var $selection = $(
                    '<span class="select2-selection" ' + ' aria-haspopup="true" aria-expanded="false">' + '</span>'
                );

                this._tabindex = 0;

                if (this.$element.data('old-tabindex') != null) {
                    this._tabindex = this.$element.data('old-tabindex');
                } else if (this.$element.attr('tabindex') != null) {
                    this._tabindex = this.$element.attr('tabindex');
                }

                $selection.attr('title', this.$element.attr('title'));
                $selection.attr('tabindex', this._tabindex);

                this.$selection = $selection;

                return $selection;
            };

            BaseSelection.prototype.bind = function (container, $container) {
                var self = this;

                var id = container.id + '-container';
                var resultsId = container.id + '-results';
                var searchHidden = this.options.get('minimumResultsForSearch') === Infinity;

                this.container = container;

                this.$selection.on('focus', function (evt) {
                    self.trigger('focus', evt);
                });

                this.$selection.on('blur', function (evt) {
                    self._handleBlur(evt);
                });

                this.$selection.on('keydown', function (evt) {
                    self.trigger('keypress', evt);

                    if (evt.which === KEYS.SPACE) {
                        evt.preventDefault();
                    }
                });

                container.on('results:focus', function (params) {
                    self.$selection.attr('aria-activedescendant', params.data._resultId);
                });

                container.on('selection:update', function (params) {
                    self.update(params.data);
                });

                container.on('open', function () {
                    // When the dropdown is open, aria-expanded="true"
                    self.$selection.attr('aria-expanded', 'true');
                    self.$selection.attr('aria-owns', resultsId);

                    self._attachCloseHandler(container);
                });

                container.on('close', function () {
                    // When the dropdown is closed, aria-expanded="false"
                    self.$selection.attr('aria-expanded', 'false');
                    self.$selection.removeAttr('aria-activedescendant');
                    self.$selection.removeAttr('aria-owns');

                    // This needs to be delayed as the active element is the body when the
                    // key is pressed.
                    window.setTimeout(function () {
                        self.$selection.focus();
                    }, 1);

                    self._detachCloseHandler(container);
                });

                container.on('enable', function () {
                    self.$selection.attr('tabindex', self._tabindex);
                });

                container.on('disable', function () {
                    self.$selection.attr('tabindex', '-1');
                });
            };

            BaseSelection.prototype._handleBlur = function (evt) {
                var self = this;

                // This needs to be delayed as the active element is the body when the tab
                // key is pressed, possibly along with others.
                window.setTimeout(function () {
                    // Don't trigger `blur` if the focus is still in the selection
                    if (document.activeElement == self.$selection[0] || $.contains(self.$selection[0], document.activeElement)) {
                        return;
                    }

                    self.trigger('blur', evt);
                }, 1);
            };

            BaseSelection.prototype._attachCloseHandler = function (container) {
                var self = this;

                $(document.body).on('mousedown.select2.' + container.id, function (e) {
                    var $target = $(e.target);

                    var $select = $target.closest('.select2');

                    var $all = $('.select2.select2-container--open');

                    $all.each(function () {
                        var $this = $(this);

                        if (this == $select[0]) {
                            return;
                        }

                        var $element = $this.data('element');

                        $element.select2('close');
                    });
                });
            };

            BaseSelection.prototype._detachCloseHandler = function (container) {
                $(document.body).off('mousedown.select2.' + container.id);
            };

            BaseSelection.prototype.position = function ($selection, $container) {
                var $selectionContainer = $container.find('.selection');
                $selectionContainer.append($selection);
            };

            BaseSelection.prototype.destroy = function () {
                this._detachCloseHandler(this.container);
            };

            BaseSelection.prototype.update = function (data) {
                throw new Error('The `update` method must be defined in child classes.');
            };

            return BaseSelection;
        });

        S2.define('select2/selection/single', ['jquery', './base', '../utils', '../keys'], function (
            $,
            BaseSelection,
            Utils,
            KEYS
        ) {
            function SingleSelection() {
                SingleSelection.__super__.constructor.apply(this, arguments);
            }

            Utils.Extend(SingleSelection, BaseSelection);

            SingleSelection.prototype.render = function () {
                var $selection = SingleSelection.__super__.render.call(this);

                $selection.addClass('select2-selection--single');

                $selection.html(
                    '<span class="select2-selection__rendered"></span>' +
                        '<span class="select2-selection__arrow" role="presentation">' +
                        '<b role="presentation"></b>' +
                        '</span>'
                );

                return $selection;
            };

            SingleSelection.prototype.bind = function (container, $container) {
                var self = this;

                SingleSelection.__super__.bind.apply(this, arguments);

                var id = container.id + '-container';

                this.$selection
                    .find('.select2-selection__rendered')
                    .attr('id', id)
                    .attr('role', 'textbox')
                    .attr('aria-readonly', 'true');
                this.$selection.attr('aria-labelledby', id);

                // This makes single non-search selects work in screen readers. If it causes problems elsewhere, remove.
                this.$selection.attr('role', 'combobox');

                this.$selection.on('mousedown', function (evt) {
                    // Only respond to left clicks
                    if (evt.which !== 1) {
                        return;
                    }

                    self.trigger('toggle', {
                        originalEvent: evt,
                    });
                });

                this.$selection.on('focus', function (evt) {
                    // User focuses on the container
                });

                this.$selection.on('keydown', function (evt) {
                    // If user starts typing an alphanumeric key on the keyboard, open if not opened.
                    if (!container.isOpen() && evt.which >= 48 && evt.which <= 90) {
                        container.open();
                    }
                });

                this.$selection.on('blur', function (evt) {
                    // User exits the container
                });

                container.on('focus', function (evt) {
                    if (!container.isOpen()) {
                        self.$selection.focus();
                    }
                });

                container.on('selection:update', function (params) {
                    self.update(params.data);
                });
            };

            SingleSelection.prototype.clear = function () {
                this.$selection.find('.select2-selection__rendered').empty();
            };

            SingleSelection.prototype.display = function (data, container) {
                var template = this.options.get('templateSelection');
                var escapeMarkup = this.options.get('escapeMarkup');

                return escapeMarkup(template(data, container));
            };

            SingleSelection.prototype.selectionContainer = function () {
                return $('<span></span>');
            };

            SingleSelection.prototype.update = function (data) {
                if (data.length === 0) {
                    this.clear();
                    return;
                }

                var selection = data[0];

                var $rendered = this.$selection.find('.select2-selection__rendered');
                var formatted = this.display(selection, $rendered);

                $rendered.empty().append(formatted);
                $rendered.prop('title', selection.title || selection.text);
            };

            return SingleSelection;
        });

        S2.define('select2/selection/multiple', ['jquery', './base', '../utils'], function ($, BaseSelection, Utils) {
            function MultipleSelection($element, options) {
                MultipleSelection.__super__.constructor.apply(this, arguments);
            }

            Utils.Extend(MultipleSelection, BaseSelection);

            MultipleSelection.prototype.render = function () {
                var $selection = MultipleSelection.__super__.render.call(this);

                $selection.addClass('select2-selection--multiple');

                $selection.html(
                    '<ul class="select2-selection__rendered" aria-live="polite" aria-relevant="additions removals" aria-atomic="true"></ul>'
                );

                return $selection;
            };

            MultipleSelection.prototype.bind = function (container, $container) {
                var self = this;

                MultipleSelection.__super__.bind.apply(this, arguments);

                this.$selection.on('click', function (evt) {
                    self.trigger('toggle', {
                        originalEvent: evt,
                    });
                });

                this.$selection.on('click', '.select2-selection__choice__remove', function (evt) {
                    // Ignore the event if it is disabled
                    if (self.options.get('disabled')) {
                        return;
                    }

                    var $remove = $(this);
                    var $selection = $remove.parent();

                    var data = $selection.data('data');

                    self.trigger('unselect', {
                        originalEvent: evt,
                        data: data,
                    });
                });
            };

            MultipleSelection.prototype.clear = function () {
                this.$selection.find('.select2-selection__rendered').empty();
            };

            MultipleSelection.prototype.display = function (data, container) {
                var template = this.options.get('templateSelection');
                var escapeMarkup = this.options.get('escapeMarkup');

                return escapeMarkup(template(data, container));
            };

            MultipleSelection.prototype.selectionContainer = function () {
                var $container = $(
                    '<li class="select2-selection__choice">' +
                        '<span class="select2-selection__choice__remove" role="presentation" aria-hidden="true">' +
                        '&times;' +
                        '</span>' +
                        '</li>'
                );

                return $container;
            };

            MultipleSelection.prototype.update = function (data) {
                this.clear();

                if (data.length === 0) {
                    return;
                }

                var $selections = [];

                for (var d = 0; d < data.length; d++) {
                    var selection = data[d];

                    var $selection = this.selectionContainer();
                    var formatted = this.display(selection, $selection);

                    $selection.append(formatted);
                    $selection.prop('title', selection.title || selection.text);

                    $selection.data('data', selection);

                    $selections.push($selection);
                }

                var $rendered = this.$selection.find('.select2-selection__rendered');

                Utils.appendMany($rendered, $selections);
            };

            return MultipleSelection;
        });

        S2.define('select2/selection/placeholder', ['../utils'], function (Utils) {
            function Placeholder(decorated, $element, options) {
                this.placeholder = this.normalizePlaceholder(options.get('placeholder'));

                decorated.call(this, $element, options);
            }

            Placeholder.prototype.normalizePlaceholder = function (_, placeholder) {
                if (typeof placeholder === 'string') {
                    placeholder = {
                        id: '',
                        text: placeholder,
                    };
                }

                return placeholder;
            };

            Placeholder.prototype.createPlaceholder = function (decorated, placeholder) {
                var $placeholder = this.selectionContainer();

                $placeholder.html(this.display(placeholder));
                $placeholder.addClass('select2-selection__placeholder').removeClass('select2-selection__choice');

                return $placeholder;
            };

            Placeholder.prototype.update = function (decorated, data) {
                var singlePlaceholder = data.length == 1 && data[0].id != this.placeholder.id;
                var multipleSelections = data.length > 1;

                if (multipleSelections || singlePlaceholder) {
                    return decorated.call(this, data);
                }

                this.clear();

                var $placeholder = this.createPlaceholder(this.placeholder);

                this.$selection.find('.select2-selection__rendered').append($placeholder);
            };

            return Placeholder;
        });

        S2.define('select2/selection/allowClear', ['jquery', '../keys'], function ($, KEYS) {
            function AllowClear() {}

            AllowClear.prototype.bind = function (decorated, container, $container) {
                var self = this;

                decorated.call(this, container, $container);

                if (this.placeholder == null) {
                    if (this.options.get('debug') && window.console && console.error) {
                        console.error(
                            'Select2: The `allowClear` option should be used in combination ' + 'with the `placeholder` option.'
                        );
                    }
                }

                this.$selection.on('mousedown', '.select2-selection__clear', function (evt) {
                    self._handleClear(evt);
                });

                container.on('keypress', function (evt) {
                    self._handleKeyboardClear(evt, container);
                });
            };

            AllowClear.prototype._handleClear = function (_, evt) {
                // Ignore the event if it is disabled
                if (this.options.get('disabled')) {
                    return;
                }

                var $clear = this.$selection.find('.select2-selection__clear');

                // Ignore the event if nothing has been selected
                if ($clear.length === 0) {
                    return;
                }

                evt.stopPropagation();

                var data = $clear.data('data');

                for (var d = 0; d < data.length; d++) {
                    var unselectData = {
                        data: data[d],
                    };

                    // Trigger the `unselect` event, so people can prevent it from being
                    // cleared.
                    this.trigger('unselect', unselectData);

                    // If the event was prevented, don't clear it out.
                    if (unselectData.prevented) {
                        return;
                    }
                }

                this.$element.val(this.placeholder.id).trigger('change');

                this.trigger('toggle', {});
            };

            AllowClear.prototype._handleKeyboardClear = function (_, evt, container) {
                if (container.isOpen()) {
                    return;
                }

                if (evt.which == KEYS.DELETE || evt.which == KEYS.BACKSPACE) {
                    this._handleClear(evt);
                }
            };

            AllowClear.prototype.update = function (decorated, data) {
                decorated.call(this, data);

                if (this.$selection.find('.select2-selection__placeholder').length > 0 || data.length === 0) {
                    return;
                }

                var $remove = $('<span class="select2-selection__clear">' + '&times;' + '</span>');
                $remove.data('data', data);

                this.$selection.find('.select2-selection__rendered').prepend($remove);
            };

            return AllowClear;
        });

        S2.define('select2/selection/search', ['jquery', '../utils', '../keys'], function ($, Utils, KEYS) {
            function Search(decorated, $element, options) {
                decorated.call(this, $element, options);
            }

            Search.prototype.render = function (decorated) {
                var $search = $(
                    '<li class="select2-search select2-search--inline">' +
                        '<input class="select2-search__field" type="text" tabindex="-1"' +
                        ' autocomplete="off" autocorrect="off" autocapitalize="off"' +
                        ' spellcheck="false" role="textbox" aria-autocomplete="list" />' +
                        '</li>'
                );

                this.$searchContainer = $search;
                this.$search = $search.find('input');

                var $rendered = decorated.call(this);

                this._transferTabIndex();

                return $rendered;
            };

            Search.prototype.bind = function (decorated, container, $container) {
                var self = this;
                var resultsId = container.id + '-results';

                decorated.call(this, container, $container);

                container.on('open', function () {
                    self.$search.attr('aria-owns', resultsId);
                    self.$search.trigger('focus');
                });

                container.on('close', function () {
                    self.$search.val('');
                    self.$search.removeAttr('aria-activedescendant');
                    self.$search.removeAttr('aria-owns');
                    self.$search.trigger('focus');
                });

                container.on('enable', function () {
                    self.$search.prop('disabled', false);

                    self._transferTabIndex();
                });

                container.on('disable', function () {
                    self.$search.prop('disabled', true);
                });

                container.on('focus', function (evt) {
                    self.$search.trigger('focus');
                });

                container.on('results:focus', function (params) {
                    self.$search.attr('aria-activedescendant', params.data._resultId);
                });

                this.$selection.on('focusin', '.select2-search--inline', function (evt) {
                    self.trigger('focus', evt);
                });

                this.$selection.on('focusout', '.select2-search--inline', function (evt) {
                    self._handleBlur(evt);
                });

                this.$selection.on('keydown', '.select2-search--inline', function (evt) {
                    evt.stopPropagation();

                    self.trigger('keypress', evt);

                    self._keyUpPrevented = evt.isDefaultPrevented();

                    var key = evt.which;

                    if (key === KEYS.BACKSPACE && self.$search.val() === '') {
                        var $previousChoice = self.$searchContainer.prev('.select2-selection__choice');

                        if ($previousChoice.length > 0) {
                            var item = $previousChoice.data('data');

                            self.searchRemoveChoice(item);

                            evt.preventDefault();
                        }
                    }
                });

                // Try to detect the IE version should the `documentMode` property that
                // is stored on the document. This is only implemented in IE and is
                // slightly cleaner than doing a user agent check.
                // This property is not available in Edge, but Edge also doesn't have
                // this bug.
                var msie = document.documentMode;
                var disableInputEvents = msie && msie <= 11;

                // Workaround for browsers which do not support the `input` event
                // This will prevent double-triggering of events for browsers which support
                // both the `keyup` and `input` events.
                this.$selection.on('input.searchcheck', '.select2-search--inline', function (evt) {
                    // IE will trigger the `input` event when a placeholder is used on a
                    // search box. To get around this issue, we are forced to ignore all
                    // `input` events in IE and keep using `keyup`.
                    if (disableInputEvents) {
                        self.$selection.off('input.search input.searchcheck');
                        return;
                    }

                    // Unbind the duplicated `keyup` event
                    self.$selection.off('keyup.search');
                });

                this.$selection.on('keyup.search input.search', '.select2-search--inline', function (evt) {
                    // IE will trigger the `input` event when a placeholder is used on a
                    // search box. To get around this issue, we are forced to ignore all
                    // `input` events in IE and keep using `keyup`.
                    if (disableInputEvents && evt.type === 'input') {
                        self.$selection.off('input.search input.searchcheck');
                        return;
                    }

                    var key = evt.which;

                    // We can freely ignore events from modifier keys
                    if (key == KEYS.SHIFT || key == KEYS.CTRL || key == KEYS.ALT) {
                        return;
                    }

                    // Tabbing will be handled during the `keydown` phase
                    if (key == KEYS.TAB) {
                        return;
                    }

                    self.handleSearch(evt);
                });
            };

            /**
             * This method will transfer the tabindex attribute from the rendered
             * selection to the search box. This allows for the search box to be used as
             * the primary focus instead of the selection container.
             *
             * @private
             */
            Search.prototype._transferTabIndex = function (decorated) {
                this.$search.attr('tabindex', this.$selection.attr('tabindex'));
                this.$selection.attr('tabindex', '-1');
            };

            Search.prototype.createPlaceholder = function (decorated, placeholder) {
                this.$search.attr('placeholder', placeholder.text);
            };

            Search.prototype.update = function (decorated, data) {
                var searchHadFocus = this.$search[0] == document.activeElement;

                this.$search.attr('placeholder', '');

                decorated.call(this, data);

                this.$selection.find('.select2-selection__rendered').append(this.$searchContainer);

                this.resizeSearch();
                if (searchHadFocus) {
                    this.$search.focus();
                }
            };

            Search.prototype.handleSearch = function () {
                this.resizeSearch();

                if (!this._keyUpPrevented) {
                    var input = this.$search.val();

                    this.trigger('query', {
                        term: input,
                    });
                }

                this._keyUpPrevented = false;
            };

            Search.prototype.searchRemoveChoice = function (decorated, item) {
                this.trigger('unselect', {
                    data: item,
                });

                this.$search.val(item.text);
                this.handleSearch();
            };

            Search.prototype.resizeSearch = function () {
                this.$search.css('width', '25px');

                var width = '';

                if (this.$search.attr('placeholder') !== '') {
                    width = this.$selection.find('.select2-selection__rendered').innerWidth();
                } else {
                    var minimumWidth = this.$search.val().length + 1;

                    width = minimumWidth * 0.75 + 'em';
                }

                this.$search.css('width', width);
            };

            return Search;
        });

        S2.define('select2/selection/eventRelay', ['jquery'], function ($) {
            function EventRelay() {}

            EventRelay.prototype.bind = function (decorated, container, $container) {
                var self = this;
                var relayEvents = ['open', 'opening', 'close', 'closing', 'select', 'selecting', 'unselect', 'unselecting'];

                var preventableEvents = ['opening', 'closing', 'selecting', 'unselecting'];

                decorated.call(this, container, $container);

                container.on('*', function (name, params) {
                    // Ignore events that should not be relayed
                    if ($.inArray(name, relayEvents) === -1) {
                        return;
                    }

                    // The parameters should always be an object
                    params = params || {};

                    // Generate the jQuery event for the Select2 event
                    var evt = $.Event('select2:' + name, {
                        params: params,
                    });

                    self.$element.trigger(evt);

                    // Only handle preventable events if it was one
                    if ($.inArray(name, preventableEvents) === -1) {
                        return;
                    }

                    params.prevented = evt.isDefaultPrevented();
                });
            };

            return EventRelay;
        });

        S2.define('select2/translation', ['jquery', 'require'], function ($, require) {
            function Translation(dict) {
                this.dict = dict || {};
            }

            Translation.prototype.all = function () {
                return this.dict;
            };

            Translation.prototype.get = function (key) {
                return this.dict[key];
            };

            Translation.prototype.extend = function (translation) {
                this.dict = $.extend({}, translation.all(), this.dict);
            };

            // Static functions

            Translation._cache = {};

            Translation.loadPath = function (path) {
                if (!(path in Translation._cache)) {
                    var translations = require(path);

                    Translation._cache[path] = translations;
                }

                return new Translation(Translation._cache[path]);
            };

            return Translation;
        });

        S2.define('select2/diacritics', [], function () {
            var diacritics = {
                '\u24B6': 'A',
                '\uFF21': 'A',
                '\u00C0': 'A',
                '\u00C1': 'A',
                '\u00C2': 'A',
                '\u1EA6': 'A',
                '\u1EA4': 'A',
                '\u1EAA': 'A',
                '\u1EA8': 'A',
                '\u00C3': 'A',
                '\u0100': 'A',
                '\u0102': 'A',
                '\u1EB0': 'A',
                '\u1EAE': 'A',
                '\u1EB4': 'A',
                '\u1EB2': 'A',
                '\u0226': 'A',
                '\u01E0': 'A',
                '\u00C4': 'A',
                '\u01DE': 'A',
                '\u1EA2': 'A',
                '\u00C5': 'A',
                '\u01FA': 'A',
                '\u01CD': 'A',
                '\u0200': 'A',
                '\u0202': 'A',
                '\u1EA0': 'A',
                '\u1EAC': 'A',
                '\u1EB6': 'A',
                '\u1E00': 'A',
                '\u0104': 'A',
                '\u023A': 'A',
                '\u2C6F': 'A',
                '\uA732': 'AA',
                '\u00C6': 'AE',
                '\u01FC': 'AE',
                '\u01E2': 'AE',
                '\uA734': 'AO',
                '\uA736': 'AU',
                '\uA738': 'AV',
                '\uA73A': 'AV',
                '\uA73C': 'AY',
                '\u24B7': 'B',
                '\uFF22': 'B',
                '\u1E02': 'B',
                '\u1E04': 'B',
                '\u1E06': 'B',
                '\u0243': 'B',
                '\u0182': 'B',
                '\u0181': 'B',
                '\u24B8': 'C',
                '\uFF23': 'C',
                '\u0106': 'C',
                '\u0108': 'C',
                '\u010A': 'C',
                '\u010C': 'C',
                '\u00C7': 'C',
                '\u1E08': 'C',
                '\u0187': 'C',
                '\u023B': 'C',
                '\uA73E': 'C',
                '\u24B9': 'D',
                '\uFF24': 'D',
                '\u1E0A': 'D',
                '\u010E': 'D',
                '\u1E0C': 'D',
                '\u1E10': 'D',
                '\u1E12': 'D',
                '\u1E0E': 'D',
                '\u0110': 'D',
                '\u018B': 'D',
                '\u018A': 'D',
                '\u0189': 'D',
                '\uA779': 'D',
                '\u01F1': 'DZ',
                '\u01C4': 'DZ',
                '\u01F2': 'Dz',
                '\u01C5': 'Dz',
                '\u24BA': 'E',
                '\uFF25': 'E',
                '\u00C8': 'E',
                '\u00C9': 'E',
                '\u00CA': 'E',
                '\u1EC0': 'E',
                '\u1EBE': 'E',
                '\u1EC4': 'E',
                '\u1EC2': 'E',
                '\u1EBC': 'E',
                '\u0112': 'E',
                '\u1E14': 'E',
                '\u1E16': 'E',
                '\u0114': 'E',
                '\u0116': 'E',
                '\u00CB': 'E',
                '\u1EBA': 'E',
                '\u011A': 'E',
                '\u0204': 'E',
                '\u0206': 'E',
                '\u1EB8': 'E',
                '\u1EC6': 'E',
                '\u0228': 'E',
                '\u1E1C': 'E',
                '\u0118': 'E',
                '\u1E18': 'E',
                '\u1E1A': 'E',
                '\u0190': 'E',
                '\u018E': 'E',
                '\u24BB': 'F',
                '\uFF26': 'F',
                '\u1E1E': 'F',
                '\u0191': 'F',
                '\uA77B': 'F',
                '\u24BC': 'G',
                '\uFF27': 'G',
                '\u01F4': 'G',
                '\u011C': 'G',
                '\u1E20': 'G',
                '\u011E': 'G',
                '\u0120': 'G',
                '\u01E6': 'G',
                '\u0122': 'G',
                '\u01E4': 'G',
                '\u0193': 'G',
                '\uA7A0': 'G',
                '\uA77D': 'G',
                '\uA77E': 'G',
                '\u24BD': 'H',
                '\uFF28': 'H',
                '\u0124': 'H',
                '\u1E22': 'H',
                '\u1E26': 'H',
                '\u021E': 'H',
                '\u1E24': 'H',
                '\u1E28': 'H',
                '\u1E2A': 'H',
                '\u0126': 'H',
                '\u2C67': 'H',
                '\u2C75': 'H',
                '\uA78D': 'H',
                '\u24BE': 'I',
                '\uFF29': 'I',
                '\u00CC': 'I',
                '\u00CD': 'I',
                '\u00CE': 'I',
                '\u0128': 'I',
                '\u012A': 'I',
                '\u012C': 'I',
                '\u0130': 'I',
                '\u00CF': 'I',
                '\u1E2E': 'I',
                '\u1EC8': 'I',
                '\u01CF': 'I',
                '\u0208': 'I',
                '\u020A': 'I',
                '\u1ECA': 'I',
                '\u012E': 'I',
                '\u1E2C': 'I',
                '\u0197': 'I',
                '\u24BF': 'J',
                '\uFF2A': 'J',
                '\u0134': 'J',
                '\u0248': 'J',
                '\u24C0': 'K',
                '\uFF2B': 'K',
                '\u1E30': 'K',
                '\u01E8': 'K',
                '\u1E32': 'K',
                '\u0136': 'K',
                '\u1E34': 'K',
                '\u0198': 'K',
                '\u2C69': 'K',
                '\uA740': 'K',
                '\uA742': 'K',
                '\uA744': 'K',
                '\uA7A2': 'K',
                '\u24C1': 'L',
                '\uFF2C': 'L',
                '\u013F': 'L',
                '\u0139': 'L',
                '\u013D': 'L',
                '\u1E36': 'L',
                '\u1E38': 'L',
                '\u013B': 'L',
                '\u1E3C': 'L',
                '\u1E3A': 'L',
                '\u0141': 'L',
                '\u023D': 'L',
                '\u2C62': 'L',
                '\u2C60': 'L',
                '\uA748': 'L',
                '\uA746': 'L',
                '\uA780': 'L',
                '\u01C7': 'LJ',
                '\u01C8': 'Lj',
                '\u24C2': 'M',
                '\uFF2D': 'M',
                '\u1E3E': 'M',
                '\u1E40': 'M',
                '\u1E42': 'M',
                '\u2C6E': 'M',
                '\u019C': 'M',
                '\u24C3': 'N',
                '\uFF2E': 'N',
                '\u01F8': 'N',
                '\u0143': 'N',
                '\u00D1': 'N',
                '\u1E44': 'N',
                '\u0147': 'N',
                '\u1E46': 'N',
                '\u0145': 'N',
                '\u1E4A': 'N',
                '\u1E48': 'N',
                '\u0220': 'N',
                '\u019D': 'N',
                '\uA790': 'N',
                '\uA7A4': 'N',
                '\u01CA': 'NJ',
                '\u01CB': 'Nj',
                '\u24C4': 'O',
                '\uFF2F': 'O',
                '\u00D2': 'O',
                '\u00D3': 'O',
                '\u00D4': 'O',
                '\u1ED2': 'O',
                '\u1ED0': 'O',
                '\u1ED6': 'O',
                '\u1ED4': 'O',
                '\u00D5': 'O',
                '\u1E4C': 'O',
                '\u022C': 'O',
                '\u1E4E': 'O',
                '\u014C': 'O',
                '\u1E50': 'O',
                '\u1E52': 'O',
                '\u014E': 'O',
                '\u022E': 'O',
                '\u0230': 'O',
                '\u00D6': 'O',
                '\u022A': 'O',
                '\u1ECE': 'O',
                '\u0150': 'O',
                '\u01D1': 'O',
                '\u020C': 'O',
                '\u020E': 'O',
                '\u01A0': 'O',
                '\u1EDC': 'O',
                '\u1EDA': 'O',
                '\u1EE0': 'O',
                '\u1EDE': 'O',
                '\u1EE2': 'O',
                '\u1ECC': 'O',
                '\u1ED8': 'O',
                '\u01EA': 'O',
                '\u01EC': 'O',
                '\u00D8': 'O',
                '\u01FE': 'O',
                '\u0186': 'O',
                '\u019F': 'O',
                '\uA74A': 'O',
                '\uA74C': 'O',
                '\u01A2': 'OI',
                '\uA74E': 'OO',
                '\u0222': 'OU',
                '\u24C5': 'P',
                '\uFF30': 'P',
                '\u1E54': 'P',
                '\u1E56': 'P',
                '\u01A4': 'P',
                '\u2C63': 'P',
                '\uA750': 'P',
                '\uA752': 'P',
                '\uA754': 'P',
                '\u24C6': 'Q',
                '\uFF31': 'Q',
                '\uA756': 'Q',
                '\uA758': 'Q',
                '\u024A': 'Q',
                '\u24C7': 'R',
                '\uFF32': 'R',
                '\u0154': 'R',
                '\u1E58': 'R',
                '\u0158': 'R',
                '\u0210': 'R',
                '\u0212': 'R',
                '\u1E5A': 'R',
                '\u1E5C': 'R',
                '\u0156': 'R',
                '\u1E5E': 'R',
                '\u024C': 'R',
                '\u2C64': 'R',
                '\uA75A': 'R',
                '\uA7A6': 'R',
                '\uA782': 'R',
                '\u24C8': 'S',
                '\uFF33': 'S',
                '\u1E9E': 'S',
                '\u015A': 'S',
                '\u1E64': 'S',
                '\u015C': 'S',
                '\u1E60': 'S',
                '\u0160': 'S',
                '\u1E66': 'S',
                '\u1E62': 'S',
                '\u1E68': 'S',
                '\u0218': 'S',
                '\u015E': 'S',
                '\u2C7E': 'S',
                '\uA7A8': 'S',
                '\uA784': 'S',
                '\u24C9': 'T',
                '\uFF34': 'T',
                '\u1E6A': 'T',
                '\u0164': 'T',
                '\u1E6C': 'T',
                '\u021A': 'T',
                '\u0162': 'T',
                '\u1E70': 'T',
                '\u1E6E': 'T',
                '\u0166': 'T',
                '\u01AC': 'T',
                '\u01AE': 'T',
                '\u023E': 'T',
                '\uA786': 'T',
                '\uA728': 'TZ',
                '\u24CA': 'U',
                '\uFF35': 'U',
                '\u00D9': 'U',
                '\u00DA': 'U',
                '\u00DB': 'U',
                '\u0168': 'U',
                '\u1E78': 'U',
                '\u016A': 'U',
                '\u1E7A': 'U',
                '\u016C': 'U',
                '\u00DC': 'U',
                '\u01DB': 'U',
                '\u01D7': 'U',
                '\u01D5': 'U',
                '\u01D9': 'U',
                '\u1EE6': 'U',
                '\u016E': 'U',
                '\u0170': 'U',
                '\u01D3': 'U',
                '\u0214': 'U',
                '\u0216': 'U',
                '\u01AF': 'U',
                '\u1EEA': 'U',
                '\u1EE8': 'U',
                '\u1EEE': 'U',
                '\u1EEC': 'U',
                '\u1EF0': 'U',
                '\u1EE4': 'U',
                '\u1E72': 'U',
                '\u0172': 'U',
                '\u1E76': 'U',
                '\u1E74': 'U',
                '\u0244': 'U',
                '\u24CB': 'V',
                '\uFF36': 'V',
                '\u1E7C': 'V',
                '\u1E7E': 'V',
                '\u01B2': 'V',
                '\uA75E': 'V',
                '\u0245': 'V',
                '\uA760': 'VY',
                '\u24CC': 'W',
                '\uFF37': 'W',
                '\u1E80': 'W',
                '\u1E82': 'W',
                '\u0174': 'W',
                '\u1E86': 'W',
                '\u1E84': 'W',
                '\u1E88': 'W',
                '\u2C72': 'W',
                '\u24CD': 'X',
                '\uFF38': 'X',
                '\u1E8A': 'X',
                '\u1E8C': 'X',
                '\u24CE': 'Y',
                '\uFF39': 'Y',
                '\u1EF2': 'Y',
                '\u00DD': 'Y',
                '\u0176': 'Y',
                '\u1EF8': 'Y',
                '\u0232': 'Y',
                '\u1E8E': 'Y',
                '\u0178': 'Y',
                '\u1EF6': 'Y',
                '\u1EF4': 'Y',
                '\u01B3': 'Y',
                '\u024E': 'Y',
                '\u1EFE': 'Y',
                '\u24CF': 'Z',
                '\uFF3A': 'Z',
                '\u0179': 'Z',
                '\u1E90': 'Z',
                '\u017B': 'Z',
                '\u017D': 'Z',
                '\u1E92': 'Z',
                '\u1E94': 'Z',
                '\u01B5': 'Z',
                '\u0224': 'Z',
                '\u2C7F': 'Z',
                '\u2C6B': 'Z',
                '\uA762': 'Z',
                '\u24D0': 'a',
                '\uFF41': 'a',
                '\u1E9A': 'a',
                '\u00E0': 'a',
                '\u00E1': 'a',
                '\u00E2': 'a',
                '\u1EA7': 'a',
                '\u1EA5': 'a',
                '\u1EAB': 'a',
                '\u1EA9': 'a',
                '\u00E3': 'a',
                '\u0101': 'a',
                '\u0103': 'a',
                '\u1EB1': 'a',
                '\u1EAF': 'a',
                '\u1EB5': 'a',
                '\u1EB3': 'a',
                '\u0227': 'a',
                '\u01E1': 'a',
                '\u00E4': 'a',
                '\u01DF': 'a',
                '\u1EA3': 'a',
                '\u00E5': 'a',
                '\u01FB': 'a',
                '\u01CE': 'a',
                '\u0201': 'a',
                '\u0203': 'a',
                '\u1EA1': 'a',
                '\u1EAD': 'a',
                '\u1EB7': 'a',
                '\u1E01': 'a',
                '\u0105': 'a',
                '\u2C65': 'a',
                '\u0250': 'a',
                '\uA733': 'aa',
                '\u00E6': 'ae',
                '\u01FD': 'ae',
                '\u01E3': 'ae',
                '\uA735': 'ao',
                '\uA737': 'au',
                '\uA739': 'av',
                '\uA73B': 'av',
                '\uA73D': 'ay',
                '\u24D1': 'b',
                '\uFF42': 'b',
                '\u1E03': 'b',
                '\u1E05': 'b',
                '\u1E07': 'b',
                '\u0180': 'b',
                '\u0183': 'b',
                '\u0253': 'b',
                '\u24D2': 'c',
                '\uFF43': 'c',
                '\u0107': 'c',
                '\u0109': 'c',
                '\u010B': 'c',
                '\u010D': 'c',
                '\u00E7': 'c',
                '\u1E09': 'c',
                '\u0188': 'c',
                '\u023C': 'c',
                '\uA73F': 'c',
                '\u2184': 'c',
                '\u24D3': 'd',
                '\uFF44': 'd',
                '\u1E0B': 'd',
                '\u010F': 'd',
                '\u1E0D': 'd',
                '\u1E11': 'd',
                '\u1E13': 'd',
                '\u1E0F': 'd',
                '\u0111': 'd',
                '\u018C': 'd',
                '\u0256': 'd',
                '\u0257': 'd',
                '\uA77A': 'd',
                '\u01F3': 'dz',
                '\u01C6': 'dz',
                '\u24D4': 'e',
                '\uFF45': 'e',
                '\u00E8': 'e',
                '\u00E9': 'e',
                '\u00EA': 'e',
                '\u1EC1': 'e',
                '\u1EBF': 'e',
                '\u1EC5': 'e',
                '\u1EC3': 'e',
                '\u1EBD': 'e',
                '\u0113': 'e',
                '\u1E15': 'e',
                '\u1E17': 'e',
                '\u0115': 'e',
                '\u0117': 'e',
                '\u00EB': 'e',
                '\u1EBB': 'e',
                '\u011B': 'e',
                '\u0205': 'e',
                '\u0207': 'e',
                '\u1EB9': 'e',
                '\u1EC7': 'e',
                '\u0229': 'e',
                '\u1E1D': 'e',
                '\u0119': 'e',
                '\u1E19': 'e',
                '\u1E1B': 'e',
                '\u0247': 'e',
                '\u025B': 'e',
                '\u01DD': 'e',
                '\u24D5': 'f',
                '\uFF46': 'f',
                '\u1E1F': 'f',
                '\u0192': 'f',
                '\uA77C': 'f',
                '\u24D6': 'g',
                '\uFF47': 'g',
                '\u01F5': 'g',
                '\u011D': 'g',
                '\u1E21': 'g',
                '\u011F': 'g',
                '\u0121': 'g',
                '\u01E7': 'g',
                '\u0123': 'g',
                '\u01E5': 'g',
                '\u0260': 'g',
                '\uA7A1': 'g',
                '\u1D79': 'g',
                '\uA77F': 'g',
                '\u24D7': 'h',
                '\uFF48': 'h',
                '\u0125': 'h',
                '\u1E23': 'h',
                '\u1E27': 'h',
                '\u021F': 'h',
                '\u1E25': 'h',
                '\u1E29': 'h',
                '\u1E2B': 'h',
                '\u1E96': 'h',
                '\u0127': 'h',
                '\u2C68': 'h',
                '\u2C76': 'h',
                '\u0265': 'h',
                '\u0195': 'hv',
                '\u24D8': 'i',
                '\uFF49': 'i',
                '\u00EC': 'i',
                '\u00ED': 'i',
                '\u00EE': 'i',
                '\u0129': 'i',
                '\u012B': 'i',
                '\u012D': 'i',
                '\u00EF': 'i',
                '\u1E2F': 'i',
                '\u1EC9': 'i',
                '\u01D0': 'i',
                '\u0209': 'i',
                '\u020B': 'i',
                '\u1ECB': 'i',
                '\u012F': 'i',
                '\u1E2D': 'i',
                '\u0268': 'i',
                '\u0131': 'i',
                '\u24D9': 'j',
                '\uFF4A': 'j',
                '\u0135': 'j',
                '\u01F0': 'j',
                '\u0249': 'j',
                '\u24DA': 'k',
                '\uFF4B': 'k',
                '\u1E31': 'k',
                '\u01E9': 'k',
                '\u1E33': 'k',
                '\u0137': 'k',
                '\u1E35': 'k',
                '\u0199': 'k',
                '\u2C6A': 'k',
                '\uA741': 'k',
                '\uA743': 'k',
                '\uA745': 'k',
                '\uA7A3': 'k',
                '\u24DB': 'l',
                '\uFF4C': 'l',
                '\u0140': 'l',
                '\u013A': 'l',
                '\u013E': 'l',
                '\u1E37': 'l',
                '\u1E39': 'l',
                '\u013C': 'l',
                '\u1E3D': 'l',
                '\u1E3B': 'l',
                '\u017F': 'l',
                '\u0142': 'l',
                '\u019A': 'l',
                '\u026B': 'l',
                '\u2C61': 'l',
                '\uA749': 'l',
                '\uA781': 'l',
                '\uA747': 'l',
                '\u01C9': 'lj',
                '\u24DC': 'm',
                '\uFF4D': 'm',
                '\u1E3F': 'm',
                '\u1E41': 'm',
                '\u1E43': 'm',
                '\u0271': 'm',
                '\u026F': 'm',
                '\u24DD': 'n',
                '\uFF4E': 'n',
                '\u01F9': 'n',
                '\u0144': 'n',
                '\u00F1': 'n',
                '\u1E45': 'n',
                '\u0148': 'n',
                '\u1E47': 'n',
                '\u0146': 'n',
                '\u1E4B': 'n',
                '\u1E49': 'n',
                '\u019E': 'n',
                '\u0272': 'n',
                '\u0149': 'n',
                '\uA791': 'n',
                '\uA7A5': 'n',
                '\u01CC': 'nj',
                '\u24DE': 'o',
                '\uFF4F': 'o',
                '\u00F2': 'o',
                '\u00F3': 'o',
                '\u00F4': 'o',
                '\u1ED3': 'o',
                '\u1ED1': 'o',
                '\u1ED7': 'o',
                '\u1ED5': 'o',
                '\u00F5': 'o',
                '\u1E4D': 'o',
                '\u022D': 'o',
                '\u1E4F': 'o',
                '\u014D': 'o',
                '\u1E51': 'o',
                '\u1E53': 'o',
                '\u014F': 'o',
                '\u022F': 'o',
                '\u0231': 'o',
                '\u00F6': 'o',
                '\u022B': 'o',
                '\u1ECF': 'o',
                '\u0151': 'o',
                '\u01D2': 'o',
                '\u020D': 'o',
                '\u020F': 'o',
                '\u01A1': 'o',
                '\u1EDD': 'o',
                '\u1EDB': 'o',
                '\u1EE1': 'o',
                '\u1EDF': 'o',
                '\u1EE3': 'o',
                '\u1ECD': 'o',
                '\u1ED9': 'o',
                '\u01EB': 'o',
                '\u01ED': 'o',
                '\u00F8': 'o',
                '\u01FF': 'o',
                '\u0254': 'o',
                '\uA74B': 'o',
                '\uA74D': 'o',
                '\u0275': 'o',
                '\u01A3': 'oi',
                '\u0223': 'ou',
                '\uA74F': 'oo',
                '\u24DF': 'p',
                '\uFF50': 'p',
                '\u1E55': 'p',
                '\u1E57': 'p',
                '\u01A5': 'p',
                '\u1D7D': 'p',
                '\uA751': 'p',
                '\uA753': 'p',
                '\uA755': 'p',
                '\u24E0': 'q',
                '\uFF51': 'q',
                '\u024B': 'q',
                '\uA757': 'q',
                '\uA759': 'q',
                '\u24E1': 'r',
                '\uFF52': 'r',
                '\u0155': 'r',
                '\u1E59': 'r',
                '\u0159': 'r',
                '\u0211': 'r',
                '\u0213': 'r',
                '\u1E5B': 'r',
                '\u1E5D': 'r',
                '\u0157': 'r',
                '\u1E5F': 'r',
                '\u024D': 'r',
                '\u027D': 'r',
                '\uA75B': 'r',
                '\uA7A7': 'r',
                '\uA783': 'r',
                '\u24E2': 's',
                '\uFF53': 's',
                '\u00DF': 's',
                '\u015B': 's',
                '\u1E65': 's',
                '\u015D': 's',
                '\u1E61': 's',
                '\u0161': 's',
                '\u1E67': 's',
                '\u1E63': 's',
                '\u1E69': 's',
                '\u0219': 's',
                '\u015F': 's',
                '\u023F': 's',
                '\uA7A9': 's',
                '\uA785': 's',
                '\u1E9B': 's',
                '\u24E3': 't',
                '\uFF54': 't',
                '\u1E6B': 't',
                '\u1E97': 't',
                '\u0165': 't',
                '\u1E6D': 't',
                '\u021B': 't',
                '\u0163': 't',
                '\u1E71': 't',
                '\u1E6F': 't',
                '\u0167': 't',
                '\u01AD': 't',
                '\u0288': 't',
                '\u2C66': 't',
                '\uA787': 't',
                '\uA729': 'tz',
                '\u24E4': 'u',
                '\uFF55': 'u',
                '\u00F9': 'u',
                '\u00FA': 'u',
                '\u00FB': 'u',
                '\u0169': 'u',
                '\u1E79': 'u',
                '\u016B': 'u',
                '\u1E7B': 'u',
                '\u016D': 'u',
                '\u00FC': 'u',
                '\u01DC': 'u',
                '\u01D8': 'u',
                '\u01D6': 'u',
                '\u01DA': 'u',
                '\u1EE7': 'u',
                '\u016F': 'u',
                '\u0171': 'u',
                '\u01D4': 'u',
                '\u0215': 'u',
                '\u0217': 'u',
                '\u01B0': 'u',
                '\u1EEB': 'u',
                '\u1EE9': 'u',
                '\u1EEF': 'u',
                '\u1EED': 'u',
                '\u1EF1': 'u',
                '\u1EE5': 'u',
                '\u1E73': 'u',
                '\u0173': 'u',
                '\u1E77': 'u',
                '\u1E75': 'u',
                '\u0289': 'u',
                '\u24E5': 'v',
                '\uFF56': 'v',
                '\u1E7D': 'v',
                '\u1E7F': 'v',
                '\u028B': 'v',
                '\uA75F': 'v',
                '\u028C': 'v',
                '\uA761': 'vy',
                '\u24E6': 'w',
                '\uFF57': 'w',
                '\u1E81': 'w',
                '\u1E83': 'w',
                '\u0175': 'w',
                '\u1E87': 'w',
                '\u1E85': 'w',
                '\u1E98': 'w',
                '\u1E89': 'w',
                '\u2C73': 'w',
                '\u24E7': 'x',
                '\uFF58': 'x',
                '\u1E8B': 'x',
                '\u1E8D': 'x',
                '\u24E8': 'y',
                '\uFF59': 'y',
                '\u1EF3': 'y',
                '\u00FD': 'y',
                '\u0177': 'y',
                '\u1EF9': 'y',
                '\u0233': 'y',
                '\u1E8F': 'y',
                '\u00FF': 'y',
                '\u1EF7': 'y',
                '\u1E99': 'y',
                '\u1EF5': 'y',
                '\u01B4': 'y',
                '\u024F': 'y',
                '\u1EFF': 'y',
                '\u24E9': 'z',
                '\uFF5A': 'z',
                '\u017A': 'z',
                '\u1E91': 'z',
                '\u017C': 'z',
                '\u017E': 'z',
                '\u1E93': 'z',
                '\u1E95': 'z',
                '\u01B6': 'z',
                '\u0225': 'z',
                '\u0240': 'z',
                '\u2C6C': 'z',
                '\uA763': 'z',
                '\u0386': '\u0391',
                '\u0388': '\u0395',
                '\u0389': '\u0397',
                '\u038A': '\u0399',
                '\u03AA': '\u0399',
                '\u038C': '\u039F',
                '\u038E': '\u03A5',
                '\u03AB': '\u03A5',
                '\u038F': '\u03A9',
                '\u03AC': '\u03B1',
                '\u03AD': '\u03B5',
                '\u03AE': '\u03B7',
                '\u03AF': '\u03B9',
                '\u03CA': '\u03B9',
                '\u0390': '\u03B9',
                '\u03CC': '\u03BF',
                '\u03CD': '\u03C5',
                '\u03CB': '\u03C5',
                '\u03B0': '\u03C5',
                '\u03C9': '\u03C9',
                '\u03C2': '\u03C3',
            };

            return diacritics;
        });

        S2.define('select2/data/base', ['../utils'], function (Utils) {
            function BaseAdapter($element, options) {
                BaseAdapter.__super__.constructor.call(this);
            }

            Utils.Extend(BaseAdapter, Utils.Observable);

            BaseAdapter.prototype.current = function (callback) {
                throw new Error('The `current` method must be defined in child classes.');
            };

            BaseAdapter.prototype.query = function (params, callback) {
                throw new Error('The `query` method must be defined in child classes.');
            };

            BaseAdapter.prototype.bind = function (container, $container) {
                // Can be implemented in subclasses
            };

            BaseAdapter.prototype.destroy = function () {
                // Can be implemented in subclasses
            };

            BaseAdapter.prototype.generateResultId = function (container, data) {
                var id = '';

                if (container != null) {
                    id += container.id;
                } else {
                    id += Utils.generateChars(4);
                }

                id += '-result-';
                id += Utils.generateChars(4);

                if (data.id != null) {
                    id += '-' + data.id.toString();
                } else {
                    id += '-' + Utils.generateChars(4);
                }
                return id;
            };

            return BaseAdapter;
        });

        S2.define('select2/data/select', ['./base', '../utils', 'jquery'], function (BaseAdapter, Utils, $) {
            function SelectAdapter($element, options) {
                this.$element = $element;
                this.options = options;

                SelectAdapter.__super__.constructor.call(this);
            }

            Utils.Extend(SelectAdapter, BaseAdapter);

            SelectAdapter.prototype.current = function (callback) {
                var data = [];
                var self = this;

                this.$element.find(':selected').each(function () {
                    var $option = $(this);

                    var option = self.item($option);

                    data.push(option);
                });

                callback(data);
            };

            SelectAdapter.prototype.select = function (data) {
                var self = this;

                data.selected = true;

                // If data.element is a DOM node, use it instead
                if ($(data.element).is('option')) {
                    data.element.selected = true;

                    this.$element.trigger('change');

                    return;
                }

                if (this.$element.prop('multiple')) {
                    this.current(function (currentData) {
                        var val = [];

                        data = [data];
                        data.push.apply(data, currentData);

                        for (var d = 0; d < data.length; d++) {
                            var id = data[d].id;

                            if ($.inArray(id, val) === -1) {
                                val.push(id);
                            }
                        }

                        self.$element.val(val);
                        self.$element.trigger('change');
                    });
                } else {
                    var val = data.id;

                    this.$element.val(val);
                    this.$element.trigger('change');
                }
            };

            SelectAdapter.prototype.unselect = function (data) {
                var self = this;

                if (!this.$element.prop('multiple')) {
                    return;
                }

                data.selected = false;

                if ($(data.element).is('option')) {
                    data.element.selected = false;

                    this.$element.trigger('change');

                    return;
                }

                this.current(function (currentData) {
                    var val = [];

                    for (var d = 0; d < currentData.length; d++) {
                        var id = currentData[d].id;

                        if (id !== data.id && $.inArray(id, val) === -1) {
                            val.push(id);
                        }
                    }

                    self.$element.val(val);

                    self.$element.trigger('change');
                });
            };

            SelectAdapter.prototype.bind = function (container, $container) {
                var self = this;

                this.container = container;

                container.on('select', function (params) {
                    self.select(params.data);
                });

                container.on('unselect', function (params) {
                    self.unselect(params.data);
                });
            };

            SelectAdapter.prototype.destroy = function () {
                // Remove anything added to child elements
                this.$element.find('*').each(function () {
                    // Remove any custom data set by Select2
                    $.removeData(this, 'data');
                });
            };

            SelectAdapter.prototype.query = function (params, callback) {
                var data = [];
                var self = this;

                var $options = this.$element.children();

                $options.each(function () {
                    var $option = $(this);

                    if (!$option.is('option') && !$option.is('optgroup')) {
                        return;
                    }

                    var option = self.item($option);

                    var matches = self.matches(params, option);

                    if (matches !== null) {
                        data.push(matches);
                    }
                });

                callback({
                    results: data,
                });
            };

            SelectAdapter.prototype.addOptions = function ($options) {
                Utils.appendMany(this.$element, $options);
            };

            SelectAdapter.prototype.option = function (data) {
                var option;

                if (data.children) {
                    option = document.createElement('optgroup');
                    option.label = data.text;
                } else {
                    option = document.createElement('option');

                    if (option.textContent !== undefined) {
                        option.textContent = data.text;
                    } else {
                        option.innerText = data.text;
                    }
                }

                if (data.id !== undefined) {
                    option.value = data.id;
                }

                if (data.disabled) {
                    option.disabled = true;
                }

                if (data.selected) {
                    option.selected = true;
                }

                if (data.title) {
                    option.title = data.title;
                }

                var $option = $(option);

                var normalizedData = this._normalizeItem(data);
                normalizedData.element = option;

                // Override the option's data with the combined data
                $.data(option, 'data', normalizedData);

                return $option;
            };

            SelectAdapter.prototype.item = function ($option) {
                var data = {};

                data = $.data($option[0], 'data');

                if (data != null) {
                    return data;
                }

                if ($option.is('option')) {
                    data = {
                        id: $option.val(),
                        text: $option.text(),
                        disabled: $option.prop('disabled'),
                        selected: $option.prop('selected'),
                        title: $option.prop('title'),
                    };
                } else if ($option.is('optgroup')) {
                    data = {
                        text: $option.prop('label'),
                        children: [],
                        title: $option.prop('title'),
                    };

                    var $children = $option.children('option');
                    var children = [];

                    for (var c = 0; c < $children.length; c++) {
                        var $child = $($children[c]);

                        var child = this.item($child);

                        children.push(child);
                    }

                    data.children = children;
                }

                data = this._normalizeItem(data);
                data.element = $option[0];

                $.data($option[0], 'data', data);

                return data;
            };

            SelectAdapter.prototype._normalizeItem = function (item) {
                if (!$.isPlainObject(item)) {
                    item = {
                        id: item,
                        text: item,
                    };
                }

                item = $.extend(
                    {},
                    {
                        text: '',
                    },
                    item
                );

                var defaults = {
                    selected: false,
                    disabled: false,
                };

                if (item.id != null) {
                    item.id = item.id.toString();
                }

                if (item.text != null) {
                    item.text = item.text.toString();
                }

                if (item._resultId == null && item.id) {
                    item._resultId = this.generateResultId(this.container, item);
                }

                return $.extend({}, defaults, item);
            };

            SelectAdapter.prototype.matches = function (params, data) {
                var matcher = this.options.get('matcher');

                return matcher(params, data);
            };

            return SelectAdapter;
        });

        S2.define('select2/data/array', ['./select', '../utils', 'jquery'], function (SelectAdapter, Utils, $) {
            function ArrayAdapter($element, options) {
                var data = options.get('data') || [];

                ArrayAdapter.__super__.constructor.call(this, $element, options);

                this.addOptions(this.convertToOptions(data));
            }

            Utils.Extend(ArrayAdapter, SelectAdapter);

            ArrayAdapter.prototype.select = function (data) {
                var $option = this.$element.find('option').filter(function (i, elm) {
                    return elm.value == data.id.toString();
                });

                if ($option.length === 0) {
                    $option = this.option(data);

                    this.addOptions($option);
                }

                ArrayAdapter.__super__.select.call(this, data);
            };

            ArrayAdapter.prototype.convertToOptions = function (data) {
                var self = this;

                var $existing = this.$element.find('option');
                var existingIds = $existing
                    .map(function () {
                        return self.item($(this)).id;
                    })
                    .get();

                var $options = [];

                // Filter out all items except for the one passed in the argument
                function onlyItem(item) {
                    return function () {
                        return $(this).val() == item.id;
                    };
                }

                for (var d = 0; d < data.length; d++) {
                    var item = this._normalizeItem(data[d]);

                    // Skip items which were pre-loaded, only merge the data
                    if ($.inArray(item.id, existingIds) >= 0) {
                        var $existingOption = $existing.filter(onlyItem(item));

                        var existingData = this.item($existingOption);
                        var newData = $.extend(true, {}, item, existingData);

                        var $newOption = this.option(newData);

                        $existingOption.replaceWith($newOption);

                        continue;
                    }

                    var $option = this.option(item);

                    if (item.children) {
                        var $children = this.convertToOptions(item.children);

                        Utils.appendMany($option, $children);
                    }

                    $options.push($option);
                }

                return $options;
            };

            return ArrayAdapter;
        });

        S2.define('select2/data/ajax', ['./array', '../utils', 'jquery'], function (ArrayAdapter, Utils, $) {
            function AjaxAdapter($element, options) {
                this.ajaxOptions = this._applyDefaults(options.get('ajax'));

                if (this.ajaxOptions.processResults != null) {
                    this.processResults = this.ajaxOptions.processResults;
                }

                AjaxAdapter.__super__.constructor.call(this, $element, options);
            }

            Utils.Extend(AjaxAdapter, ArrayAdapter);

            AjaxAdapter.prototype._applyDefaults = function (options) {
                var defaults = {
                    data: function (params) {
                        return $.extend({}, params, {
                            q: params.term,
                        });
                    },
                    transport: function (params, success, failure) {
                        var $request = $.ajax(params);

                        $request.then(success);
                        $request.fail(failure);

                        return $request;
                    },
                };

                return $.extend({}, defaults, options, true);
            };

            AjaxAdapter.prototype.processResults = function (results) {
                return results;
            };

            AjaxAdapter.prototype.query = function (params, callback) {
                var matches = [];
                var self = this;

                if (this._request != null) {
                    // JSONP requests cannot always be aborted
                    if ($.isFunction(this._request.abort)) {
                        this._request.abort();
                    }

                    this._request = null;
                }

                var options = $.extend(
                    {
                        type: 'GET',
                    },
                    this.ajaxOptions
                );

                if (typeof options.url === 'function') {
                    options.url = options.url.call(this.$element, params);
                }

                if (typeof options.data === 'function') {
                    options.data = options.data.call(this.$element, params);
                }

                function request() {
                    var $request = options.transport(
                        options,
                        function (data) {
                            var results = self.processResults(data, params);

                            if (self.options.get('debug') && window.console && console.error) {
                                // Check to make sure that the response included a `results` key.
                                if (!results || !results.results || !$.isArray(results.results)) {
                                    console.error(
                                        'Select2: The AJAX results did not return an array in the ' +
                                            '`results` key of the response.'
                                    );
                                }
                            }

                            callback(results);
                        },
                        function () {
                            // Attempt to detect if a request was aborted
                            // Only works if the transport exposes a status property
                            if ($request.status && $request.status === '0') {
                                return;
                            }

                            self.trigger('results:message', {
                                message: 'errorLoading',
                            });
                        }
                    );

                    self._request = $request;
                }

                if (this.ajaxOptions.delay && params.term != null) {
                    if (this._queryTimeout) {
                        window.clearTimeout(this._queryTimeout);
                    }

                    this._queryTimeout = window.setTimeout(request, this.ajaxOptions.delay);
                } else {
                    request();
                }
            };

            return AjaxAdapter;
        });

        S2.define('select2/data/tags', ['jquery'], function ($) {
            function Tags(decorated, $element, options) {
                var tags = options.get('tags');

                var createTag = options.get('createTag');

                if (createTag !== undefined) {
                    this.createTag = createTag;
                }

                var insertTag = options.get('insertTag');

                if (insertTag !== undefined) {
                    this.insertTag = insertTag;
                }

                decorated.call(this, $element, options);

                if ($.isArray(tags)) {
                    for (var t = 0; t < tags.length; t++) {
                        var tag = tags[t];
                        var item = this._normalizeItem(tag);

                        var $option = this.option(item);

                        this.$element.append($option);
                    }
                }
            }

            Tags.prototype.query = function (decorated, params, callback) {
                var self = this;

                this._removeOldTags();

                if (params.term == null || params.page != null) {
                    decorated.call(this, params, callback);
                    return;
                }

                function wrapper(obj, child) {
                    var data = obj.results;

                    for (var i = 0; i < data.length; i++) {
                        var option = data[i];

                        var checkChildren =
                            option.children != null &&
                            !wrapper(
                                {
                                    results: option.children,
                                },
                                true
                            );

                        var optionText = (option.text || '').toUpperCase();
                        var paramsTerm = (params.term || '').toUpperCase();

                        var checkText = optionText === paramsTerm;

                        if (checkText || checkChildren) {
                            if (child) {
                                return false;
                            }

                            obj.data = data;
                            callback(obj);

                            return;
                        }
                    }

                    if (child) {
                        return true;
                    }

                    var tag = self.createTag(params);

                    if (tag != null) {
                        var $option = self.option(tag);
                        $option.attr('data-select2-tag', true);

                        self.addOptions([$option]);

                        self.insertTag(data, tag);
                    }

                    obj.results = data;

                    callback(obj);
                }

                decorated.call(this, params, wrapper);
            };

            Tags.prototype.createTag = function (decorated, params) {
                var term = $.trim(params.term);

                if (term === '') {
                    return null;
                }

                return {
                    id: term,
                    text: term,
                };
            };

            Tags.prototype.insertTag = function (_, data, tag) {
                data.unshift(tag);
            };

            Tags.prototype._removeOldTags = function (_) {
                var tag = this._lastTag;

                var $options = this.$element.find('option[data-select2-tag]');

                $options.each(function () {
                    if (this.selected) {
                        return;
                    }

                    $(this).remove();
                });
            };

            return Tags;
        });

        S2.define('select2/data/tokenizer', ['jquery'], function ($) {
            function Tokenizer(decorated, $element, options) {
                var tokenizer = options.get('tokenizer');

                if (tokenizer !== undefined) {
                    this.tokenizer = tokenizer;
                }

                decorated.call(this, $element, options);
            }

            Tokenizer.prototype.bind = function (decorated, container, $container) {
                decorated.call(this, container, $container);

                this.$search =
                    container.dropdown.$search || container.selection.$search || $container.find('.select2-search__field');
            };

            Tokenizer.prototype.query = function (decorated, params, callback) {
                var self = this;

                function createAndSelect(data) {
                    // Normalize the data object so we can use it for checks
                    var item = self._normalizeItem(data);

                    // Check if the data object already exists as a tag
                    // Select it if it doesn't
                    var $existingOptions = self.$element.find('option').filter(function () {
                        return $(this).val() === item.id;
                    });

                    // If an existing option wasn't found for it, create the option
                    if (!$existingOptions.length) {
                        var $option = self.option(item);
                        $option.attr('data-select2-tag', true);

                        self._removeOldTags();
                        self.addOptions([$option]);
                    }

                    // Select the item, now that we know there is an option for it
                    select(item);
                }

                function select(data) {
                    self.trigger('select', {
                        data: data,
                    });
                }

                params.term = params.term || '';

                var tokenData = this.tokenizer(params, this.options, createAndSelect);

                if (tokenData.term !== params.term) {
                    // Replace the search term if we have the search box
                    if (this.$search.length) {
                        this.$search.val(tokenData.term);
                        this.$search.focus();
                    }

                    params.term = tokenData.term;
                }

                decorated.call(this, params, callback);
            };

            Tokenizer.prototype.tokenizer = function (_, params, options, callback) {
                var separators = options.get('tokenSeparators') || [];
                var term = params.term;
                var i = 0;

                var createTag =
                    this.createTag ||
                    function (params) {
                        return {
                            id: params.term,
                            text: params.term,
                        };
                    };

                while (i < term.length) {
                    var termChar = term[i];

                    if ($.inArray(termChar, separators) === -1) {
                        i++;

                        continue;
                    }

                    var part = term.substr(0, i);
                    var partParams = $.extend({}, params, {
                        term: part,
                    });

                    var data = createTag(partParams);

                    if (data == null) {
                        i++;
                        continue;
                    }

                    callback(data);

                    // Reset the term to not include the tokenized portion
                    term = term.substr(i + 1) || '';
                    i = 0;
                }

                return {
                    term: term,
                };
            };

            return Tokenizer;
        });

        S2.define('select2/data/minimumInputLength', [], function () {
            function MinimumInputLength(decorated, $e, options) {
                this.minimumInputLength = options.get('minimumInputLength');

                decorated.call(this, $e, options);
            }

            MinimumInputLength.prototype.query = function (decorated, params, callback) {
                params.term = params.term || '';

                if (params.term.length < this.minimumInputLength) {
                    this.trigger('results:message', {
                        message: 'inputTooShort',
                        args: {
                            minimum: this.minimumInputLength,
                            input: params.term,
                            params: params,
                        },
                    });

                    return;
                }

                decorated.call(this, params, callback);
            };

            return MinimumInputLength;
        });

        S2.define('select2/data/maximumInputLength', [], function () {
            function MaximumInputLength(decorated, $e, options) {
                this.maximumInputLength = options.get('maximumInputLength');

                decorated.call(this, $e, options);
            }

            MaximumInputLength.prototype.query = function (decorated, params, callback) {
                params.term = params.term || '';

                if (this.maximumInputLength > 0 && params.term.length > this.maximumInputLength) {
                    this.trigger('results:message', {
                        message: 'inputTooLong',
                        args: {
                            maximum: this.maximumInputLength,
                            input: params.term,
                            params: params,
                        },
                    });

                    return;
                }

                decorated.call(this, params, callback);
            };

            return MaximumInputLength;
        });

        S2.define('select2/data/maximumSelectionLength', [], function () {
            function MaximumSelectionLength(decorated, $e, options) {
                this.maximumSelectionLength = options.get('maximumSelectionLength');

                decorated.call(this, $e, options);
            }

            MaximumSelectionLength.prototype.query = function (decorated, params, callback) {
                var self = this;

                this.current(function (currentData) {
                    var count = currentData != null ? currentData.length : 0;
                    if (self.maximumSelectionLength > 0 && count >= self.maximumSelectionLength) {
                        self.trigger('results:message', {
                            message: 'maximumSelected',
                            args: {
                                maximum: self.maximumSelectionLength,
                            },
                        });
                        return;
                    }
                    decorated.call(self, params, callback);
                });
            };

            return MaximumSelectionLength;
        });

        S2.define('select2/dropdown', ['jquery', './utils'], function ($, Utils) {
            function Dropdown($element, options) {
                this.$element = $element;
                this.options = options;

                Dropdown.__super__.constructor.call(this);
            }

            Utils.Extend(Dropdown, Utils.Observable);

            Dropdown.prototype.render = function () {
                var $dropdown = $('<span class="select2-dropdown">' + '<span class="select2-results"></span>' + '</span>');

                $dropdown.attr('dir', this.options.get('dir'));

                this.$dropdown = $dropdown;

                return $dropdown;
            };

            Dropdown.prototype.bind = function () {
                // Should be implemented in subclasses
            };

            Dropdown.prototype.position = function ($dropdown, $container) {
                // Should be implmented in subclasses
            };

            Dropdown.prototype.destroy = function () {
                // Remove the dropdown from the DOM
                this.$dropdown.remove();
            };

            return Dropdown;
        });

        S2.define('select2/dropdown/search', ['jquery', '../utils'], function ($, Utils) {
            function Search() {}

            Search.prototype.render = function (decorated) {
                var $rendered = decorated.call(this);

                var $search = $(
                    '<span class="select2-search select2-search--dropdown">' +
                        '<input class="select2-search__field" type="text" tabindex="-1"' +
                        ' autocomplete="off" autocorrect="off" autocapitalize="off"' +
                        ' spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="true" />' +
                        '</span>'
                );

                this.$searchContainer = $search;
                this.$search = $search.find('input');

                $rendered.prepend($search);

                return $rendered;
            };

            Search.prototype.bind = function (decorated, container, $container) {
                var self = this;
                var resultsId = container.id + '-results';

                decorated.call(this, container, $container);

                this.$search.on('keydown', function (evt) {
                    self.trigger('keypress', evt);

                    self._keyUpPrevented = evt.isDefaultPrevented();
                });

                // Workaround for browsers which do not support the `input` event
                // This will prevent double-triggering of events for browsers which support
                // both the `keyup` and `input` events.
                this.$search.on('input', function (evt) {
                    // Unbind the duplicated `keyup` event
                    $(this).off('keyup');
                });

                this.$search.on('keyup input', function (evt) {
                    self.handleSearch(evt);
                });

                container.on('open', function () {
                    self.$search.attr('tabindex', 0);
                    self.$search.attr('aria-owns', resultsId);
                    self.$search.focus();

                    window.setTimeout(function () {
                        self.$search.focus();
                    }, 0);
                });

                container.on('close', function () {
                    self.$search.attr('tabindex', -1);
                    self.$search.removeAttr('aria-activedescendant');
                    self.$search.removeAttr('aria-owns');
                    self.$search.val('');
                });

                container.on('focus', function () {
                    if (container.isOpen()) {
                        self.$search.focus();
                    }
                });

                container.on('results:all', function (params) {
                    if (params.query.term == null || params.query.term === '') {
                        var showSearch = self.showSearch(params);

                        if (showSearch) {
                            self.$searchContainer.removeClass('select2-search--hide');
                        } else {
                            self.$searchContainer.addClass('select2-search--hide');
                        }
                    }
                });

                container.on('results:focus', function (params) {
                    self.$search.attr('aria-activedescendant', params.data._resultId);
                });
            };

            Search.prototype.handleSearch = function (evt) {
                if (!this._keyUpPrevented) {
                    var input = this.$search.val();

                    this.trigger('query', {
                        term: input,
                    });
                }

                this._keyUpPrevented = false;
            };

            Search.prototype.showSearch = function (_, params) {
                return true;
            };

            return Search;
        });

        S2.define('select2/dropdown/hidePlaceholder', [], function () {
            function HidePlaceholder(decorated, $element, options, dataAdapter) {
                this.placeholder = this.normalizePlaceholder(options.get('placeholder'));

                decorated.call(this, $element, options, dataAdapter);
            }

            HidePlaceholder.prototype.append = function (decorated, data) {
                data.results = this.removePlaceholder(data.results);

                decorated.call(this, data);
            };

            HidePlaceholder.prototype.normalizePlaceholder = function (_, placeholder) {
                if (typeof placeholder === 'string') {
                    placeholder = {
                        id: '',
                        text: placeholder,
                    };
                }

                return placeholder;
            };

            HidePlaceholder.prototype.removePlaceholder = function (_, data) {
                var modifiedData = data.slice(0);

                for (var d = data.length - 1; d >= 0; d--) {
                    var item = data[d];

                    if (this.placeholder.id === item.id) {
                        modifiedData.splice(d, 1);
                    }
                }

                return modifiedData;
            };

            return HidePlaceholder;
        });

        S2.define('select2/dropdown/infiniteScroll', ['jquery'], function ($) {
            function InfiniteScroll(decorated, $element, options, dataAdapter) {
                this.lastParams = {};

                decorated.call(this, $element, options, dataAdapter);

                this.$loadingMore = this.createLoadingMore();
                this.loading = false;
            }

            InfiniteScroll.prototype.append = function (decorated, data) {
                this.$loadingMore.remove();
                this.loading = false;

                decorated.call(this, data);

                if (this.showLoadingMore(data)) {
                    this.$results.append(this.$loadingMore);
                }
            };

            InfiniteScroll.prototype.bind = function (decorated, container, $container) {
                var self = this;

                decorated.call(this, container, $container);

                container.on('query', function (params) {
                    self.lastParams = params;
                    self.loading = true;
                });

                container.on('query:append', function (params) {
                    self.lastParams = params;
                    self.loading = true;
                });

                this.$results.on('scroll', function () {
                    var isLoadMoreVisible = $.contains(document.documentElement, self.$loadingMore[0]);

                    if (self.loading || !isLoadMoreVisible) {
                        return;
                    }

                    var currentOffset = self.$results.offset().top + self.$results.outerHeight(false);
                    var loadingMoreOffset = self.$loadingMore.offset().top + self.$loadingMore.outerHeight(false);

                    if (currentOffset + 50 >= loadingMoreOffset) {
                        self.loadMore();
                    }
                });
            };

            InfiniteScroll.prototype.loadMore = function () {
                this.loading = true;

                var params = $.extend({}, { page: 1 }, this.lastParams);

                params.page++;

                this.trigger('query:append', params);
            };

            InfiniteScroll.prototype.showLoadingMore = function (_, data) {
                return data.pagination && data.pagination.more;
            };

            InfiniteScroll.prototype.createLoadingMore = function () {
                var $option = $(
                    '<li ' +
                        'class="select2-results__option select2-results__option--load-more"' +
                        'role="option" aria-disabled="true"></li>'
                );

                var message = this.options.get('translations').get('loadingMore');

                $option.html(message(this.lastParams));

                return $option;
            };

            return InfiniteScroll;
        });

        S2.define('select2/dropdown/attachBody', ['jquery', '../utils'], function ($, Utils) {
            function AttachBody(decorated, $element, options) {
                this.$dropdownParent = options.get('dropdownParent') || $(document.body);

                decorated.call(this, $element, options);
            }

            AttachBody.prototype.bind = function (decorated, container, $container) {
                var self = this;

                var setupResultsEvents = false;

                decorated.call(this, container, $container);

                container.on('open', function () {
                    self._showDropdown();
                    self._attachPositioningHandler(container);

                    if (!setupResultsEvents) {
                        setupResultsEvents = true;

                        container.on('results:all', function () {
                            self._positionDropdown();
                            self._resizeDropdown();
                        });

                        container.on('results:append', function () {
                            self._positionDropdown();
                            self._resizeDropdown();
                        });
                    }
                });

                container.on('close', function () {
                    self._hideDropdown();
                    self._detachPositioningHandler(container);
                });

                this.$dropdownContainer.on('mousedown', function (evt) {
                    evt.stopPropagation();
                });
            };

            AttachBody.prototype.destroy = function (decorated) {
                decorated.call(this);

                this.$dropdownContainer.remove();
            };

            AttachBody.prototype.position = function (decorated, $dropdown, $container) {
                // Clone all of the container classes
                $dropdown.attr('class', $container.attr('class'));

                $dropdown.removeClass('select2');
                $dropdown.addClass('select2-container--open');

                $dropdown.css({
                    position: 'absolute',
                    top: -999999,
                });

                this.$container = $container;
            };

            AttachBody.prototype.render = function (decorated) {
                var $container = $('<span></span>');

                var $dropdown = decorated.call(this);
                $container.append($dropdown);

                this.$dropdownContainer = $container;

                return $container;
            };

            AttachBody.prototype._hideDropdown = function (decorated) {
                this.$dropdownContainer.detach();
            };

            AttachBody.prototype._attachPositioningHandler = function (decorated, container) {
                var self = this;

                var scrollEvent = 'scroll.select2.' + container.id;
                var resizeEvent = 'resize.select2.' + container.id;
                var orientationEvent = 'orientationchange.select2.' + container.id;

                var $watchers = this.$container.parents().filter(Utils.hasScroll);
                $watchers.each(function () {
                    $(this).data('select2-scroll-position', {
                        x: $(this).scrollLeft(),
                        y: $(this).scrollTop(),
                    });
                });

                $watchers.on(scrollEvent, function (ev) {
                    var position = $(this).data('select2-scroll-position');
                    $(this).scrollTop(position.y);
                });

                $(window).on(scrollEvent + ' ' + resizeEvent + ' ' + orientationEvent, function (e) {
                    self._positionDropdown();
                    self._resizeDropdown();
                });
            };

            AttachBody.prototype._detachPositioningHandler = function (decorated, container) {
                var scrollEvent = 'scroll.select2.' + container.id;
                var resizeEvent = 'resize.select2.' + container.id;
                var orientationEvent = 'orientationchange.select2.' + container.id;

                var $watchers = this.$container.parents().filter(Utils.hasScroll);
                $watchers.off(scrollEvent);

                $(window).off(scrollEvent + ' ' + resizeEvent + ' ' + orientationEvent);
            };

            AttachBody.prototype._positionDropdown = function () {
                var $window = $(window);

                var isCurrentlyAbove = this.$dropdown.hasClass('select2-dropdown--above');
                var isCurrentlyBelow = this.$dropdown.hasClass('select2-dropdown--below');

                var newDirection = null;

                var offset = this.$container.offset();

                offset.bottom = offset.top + this.$container.outerHeight(false);

                var container = {
                    height: this.$container.outerHeight(false),
                };

                container.top = offset.top;
                container.bottom = offset.top + container.height;

                var dropdown = {
                    height: this.$dropdown.outerHeight(false),
                };

                var viewport = {
                    top: $window.scrollTop(),
                    bottom: $window.scrollTop() + $window.height(),
                };

                var enoughRoomAbove = false; //viewport.top < (offset.top - dropdown.height);
                var enoughRoomBelow = true; //viewport.bottom > (offset.bottom + dropdown.height);

                var css = {
                    left: offset.left,
                    top: container.bottom,
                };

                // Determine what the parent element is to use for calciulating the offset
                var $offsetParent = this.$dropdownParent;

                // For statically positoned elements, we need to get the element
                // that is determining the offset
                if ($offsetParent.css('position') === 'static') {
                    $offsetParent = $offsetParent.offsetParent();
                }

                var parentOffset = $offsetParent.offset();

                css.top -= parentOffset.top;
                css.left -= parentOffset.left;

                if (!isCurrentlyAbove && !isCurrentlyBelow) {
                    newDirection = 'below';
                }

                if (!enoughRoomBelow && enoughRoomAbove && !isCurrentlyAbove) {
                    newDirection = 'above';
                } else if (!enoughRoomAbove && enoughRoomBelow && isCurrentlyAbove) {
                    newDirection = 'below';
                }

                if (newDirection == 'above' || (isCurrentlyAbove && newDirection !== 'below')) {
                    css.top = container.top - parentOffset.top - dropdown.height;
                }

                if (newDirection != null) {
                    this.$dropdown
                        .removeClass('select2-dropdown--below select2-dropdown--above')
                        .addClass('select2-dropdown--' + newDirection);
                    this.$container
                        .removeClass('select2-container--below select2-container--above')
                        .addClass('select2-container--' + newDirection);
                }

                this.$dropdownContainer.css(css);
            };

            AttachBody.prototype._resizeDropdown = function () {
                var css = {
                    width: this.$container.outerWidth(false) + 'px',
                };

                if (this.options.get('dropdownAutoWidth')) {
                    css.minWidth = css.width;
                    css.position = 'relative';
                    css.width = 'auto';
                }

                this.$dropdown.css(css);
            };

            AttachBody.prototype._showDropdown = function (decorated) {
                this.$dropdownContainer.appendTo(this.$dropdownParent);

                this._positionDropdown();
                this._resizeDropdown();
            };

            return AttachBody;
        });

        S2.define('select2/dropdown/minimumResultsForSearch', [], function () {
            function countResults(data) {
                var count = 0;

                for (var d = 0; d < data.length; d++) {
                    var item = data[d];

                    if (item.children) {
                        count += countResults(item.children);
                    } else {
                        count++;
                    }
                }

                return count;
            }

            function MinimumResultsForSearch(decorated, $element, options, dataAdapter) {
                this.minimumResultsForSearch = options.get('minimumResultsForSearch');

                if (this.minimumResultsForSearch < 0) {
                    this.minimumResultsForSearch = Infinity;
                }

                decorated.call(this, $element, options, dataAdapter);
            }

            MinimumResultsForSearch.prototype.showSearch = function (decorated, params) {
                if (countResults(params.data.results) < this.minimumResultsForSearch) {
                    return false;
                }

                return decorated.call(this, params);
            };

            return MinimumResultsForSearch;
        });

        S2.define('select2/dropdown/selectOnClose', [], function () {
            function SelectOnClose() {}

            SelectOnClose.prototype.bind = function (decorated, container, $container) {
                var self = this;

                decorated.call(this, container, $container);

                container.on('close', function (params) {
                    self._handleSelectOnClose(params);
                });
            };

            SelectOnClose.prototype._handleSelectOnClose = function (_, params) {
                if (params && params.originalSelect2Event != null) {
                    var event = params.originalSelect2Event;

                    // Don't select an item if the close event was triggered from a select or
                    // unselect event
                    if (event._type === 'select' || event._type === 'unselect') {
                        return;
                    }
                }

                var $highlightedResults = this.getHighlightedResults();

                // Only select highlighted results
                if ($highlightedResults.length < 1) {
                    return;
                }

                var data = $highlightedResults.data('data');

                // Don't re-select already selected resulte
                if ((data.element != null && data.element.selected) || (data.element == null && data.selected)) {
                    return;
                }

                this.trigger('select', {
                    data: data,
                });
            };

            return SelectOnClose;
        });

        S2.define('select2/dropdown/closeOnSelect', [], function () {
            function CloseOnSelect() {}

            CloseOnSelect.prototype.bind = function (decorated, container, $container) {
                var self = this;

                decorated.call(this, container, $container);

                container.on('select', function (evt) {
                    self._selectTriggered(evt);
                });

                container.on('unselect', function (evt) {
                    self._selectTriggered(evt);
                });
            };

            CloseOnSelect.prototype._selectTriggered = function (_, evt) {
                var originalEvent = evt.originalEvent;

                // Don't close if the control key is being held
                if (originalEvent && originalEvent.ctrlKey) {
                    return;
                }

                this.trigger('close', {
                    originalEvent: originalEvent,
                    originalSelect2Event: evt,
                });
            };

            return CloseOnSelect;
        });

        S2.define('select2/i18n/en', [], function () {
            // English
            return {
                errorLoading: function () {
                    return 'The results could not be loaded.';
                },
                inputTooLong: function (args) {
                    var overChars = args.input.length - args.maximum;

                    var message = 'Please delete ' + overChars + ' character';

                    if (overChars != 1) {
                        message += 's';
                    }

                    return message;
                },
                inputTooShort: function (args) {
                    var remainingChars = args.minimum - args.input.length;

                    var message = 'Please enter ' + remainingChars + ' or more characters';

                    return message;
                },
                loadingMore: function () {
                    return 'Loading more results';
                },
                maximumSelected: function (args) {
                    var message = 'You can only select ' + args.maximum + ' item';

                    if (args.maximum != 1) {
                        message += 's';
                    }

                    return message;
                },
                noResults: function () {
                    return 'No results found';
                },
                searching: function () {
                    return 'Searching';
                },
            };
        });

        S2.define(
            'select2/defaults',
            [
                'jquery',
                'require',

                './results',

                './selection/single',
                './selection/multiple',
                './selection/placeholder',
                './selection/allowClear',
                './selection/search',
                './selection/eventRelay',

                './utils',
                './translation',
                './diacritics',

                './data/select',
                './data/array',
                './data/ajax',
                './data/tags',
                './data/tokenizer',
                './data/minimumInputLength',
                './data/maximumInputLength',
                './data/maximumSelectionLength',

                './dropdown',
                './dropdown/search',
                './dropdown/hidePlaceholder',
                './dropdown/infiniteScroll',
                './dropdown/attachBody',
                './dropdown/minimumResultsForSearch',
                './dropdown/selectOnClose',
                './dropdown/closeOnSelect',

                './i18n/en',
            ],
            function (
                $,
                require,

                ResultsList,

                SingleSelection,
                MultipleSelection,
                Placeholder,
                AllowClear,
                SelectionSearch,
                EventRelay,

                Utils,
                Translation,
                DIACRITICS,

                SelectData,
                ArrayData,
                AjaxData,
                Tags,
                Tokenizer,
                MinimumInputLength,
                MaximumInputLength,
                MaximumSelectionLength,

                Dropdown,
                DropdownSearch,
                HidePlaceholder,
                InfiniteScroll,
                AttachBody,
                MinimumResultsForSearch,
                SelectOnClose,
                CloseOnSelect,

                EnglishTranslation
            ) {
                function Defaults() {
                    this.reset();
                }

                Defaults.prototype.apply = function (options) {
                    options = $.extend(true, {}, this.defaults, options);

                    if (options.dataAdapter == null) {
                        if (options.ajax != null) {
                            options.dataAdapter = AjaxData;
                        } else if (options.data != null) {
                            options.dataAdapter = ArrayData;
                        } else {
                            options.dataAdapter = SelectData;
                        }

                        if (options.minimumInputLength > 0) {
                            options.dataAdapter = Utils.Decorate(options.dataAdapter, MinimumInputLength);
                        }

                        if (options.maximumInputLength > 0) {
                            options.dataAdapter = Utils.Decorate(options.dataAdapter, MaximumInputLength);
                        }

                        if (options.maximumSelectionLength > 0) {
                            options.dataAdapter = Utils.Decorate(options.dataAdapter, MaximumSelectionLength);
                        }

                        if (options.tags) {
                            options.dataAdapter = Utils.Decorate(options.dataAdapter, Tags);
                        }

                        if (options.tokenSeparators != null || options.tokenizer != null) {
                            options.dataAdapter = Utils.Decorate(options.dataAdapter, Tokenizer);
                        }

                        if (options.query != null) {
                            var Query = require(options.amdBase + 'compat/query');

                            options.dataAdapter = Utils.Decorate(options.dataAdapter, Query);
                        }

                        if (options.initSelection != null) {
                            var InitSelection = require(options.amdBase + 'compat/initSelection');

                            options.dataAdapter = Utils.Decorate(options.dataAdapter, InitSelection);
                        }
                    }

                    if (options.resultsAdapter == null) {
                        options.resultsAdapter = ResultsList;

                        if (options.ajax != null) {
                            options.resultsAdapter = Utils.Decorate(options.resultsAdapter, InfiniteScroll);
                        }

                        if (options.placeholder != null) {
                            options.resultsAdapter = Utils.Decorate(options.resultsAdapter, HidePlaceholder);
                        }

                        if (options.selectOnClose) {
                            options.resultsAdapter = Utils.Decorate(options.resultsAdapter, SelectOnClose);
                        }
                    }

                    if (options.dropdownAdapter == null) {
                        if (options.multiple) {
                            options.dropdownAdapter = Dropdown;
                        } else {
                            var SearchableDropdown = Utils.Decorate(Dropdown, DropdownSearch);

                            options.dropdownAdapter = SearchableDropdown;
                        }

                        if (options.minimumResultsForSearch !== 0) {
                            options.dropdownAdapter = Utils.Decorate(options.dropdownAdapter, MinimumResultsForSearch);
                        }

                        if (options.closeOnSelect) {
                            options.dropdownAdapter = Utils.Decorate(options.dropdownAdapter, CloseOnSelect);
                        }

                        if (
                            options.dropdownCssClass != null ||
                            options.dropdownCss != null ||
                            options.adaptDropdownCssClass != null
                        ) {
                            var DropdownCSS = require(options.amdBase + 'compat/dropdownCss');

                            options.dropdownAdapter = Utils.Decorate(options.dropdownAdapter, DropdownCSS);
                        }

                        options.dropdownAdapter = Utils.Decorate(options.dropdownAdapter, AttachBody);
                    }

                    if (options.selectionAdapter == null) {
                        if (options.multiple) {
                            options.selectionAdapter = MultipleSelection;
                        } else {
                            options.selectionAdapter = SingleSelection;
                        }

                        // Add the placeholder mixin if a placeholder was specified
                        if (options.placeholder != null) {
                            options.selectionAdapter = Utils.Decorate(options.selectionAdapter, Placeholder);
                        }

                        if (options.allowClear) {
                            options.selectionAdapter = Utils.Decorate(options.selectionAdapter, AllowClear);
                        }

                        if (options.multiple) {
                            options.selectionAdapter = Utils.Decorate(options.selectionAdapter, SelectionSearch);
                        }

                        if (
                            options.containerCssClass != null ||
                            options.containerCss != null ||
                            options.adaptContainerCssClass != null
                        ) {
                            var ContainerCSS = require(options.amdBase + 'compat/containerCss');

                            options.selectionAdapter = Utils.Decorate(options.selectionAdapter, ContainerCSS);
                        }

                        options.selectionAdapter = Utils.Decorate(options.selectionAdapter, EventRelay);
                    }

                    if (typeof options.language === 'string') {
                        // Check if the language is specified with a region
                        if (options.language.indexOf('-') > 0) {
                            // Extract the region information if it is included
                            var languageParts = options.language.split('-');
                            var baseLanguage = languageParts[0];

                            options.language = [options.language, baseLanguage];
                        } else {
                            options.language = [options.language];
                        }
                    }

                    if ($.isArray(options.language)) {
                        var languages = new Translation();
                        options.language.push('en');

                        var languageNames = options.language;

                        for (var l = 0; l < languageNames.length; l++) {
                            var name = languageNames[l];
                            var language = {};

                            try {
                                // Try to load it with the original name
                                language = Translation.loadPath(name);
                            } catch (e) {
                                try {
                                    // If we couldn't load it, check if it wasn't the full path
                                    name = this.defaults.amdLanguageBase + name;
                                    language = Translation.loadPath(name);
                                } catch (ex) {
                                    // The translation could not be loaded at all. Sometimes this is
                                    // because of a configuration problem, other times this can be
                                    // because of how Select2 helps load all possible translation files.
                                    if (options.debug && window.console && console.warn) {
                                        console.warn(
                                            'Select2: The language file for "' +
                                                name +
                                                '" could not be ' +
                                                'automatically loaded. A fallback will be used instead.'
                                        );
                                    }

                                    continue;
                                }
                            }

                            languages.extend(language);
                        }

                        options.translations = languages;
                    } else {
                        var baseTranslation = Translation.loadPath(this.defaults.amdLanguageBase + 'en');
                        var customTranslation = new Translation(options.language);

                        customTranslation.extend(baseTranslation);

                        options.translations = customTranslation;
                    }

                    return options;
                };

                Defaults.prototype.reset = function () {
                    function stripDiacritics(text) {
                        // Used 'uni range + named function' from http://jsperf.com/diacritics/18
                        function match(a) {
                            return DIACRITICS[a] || a;
                        }

                        return text.replace(/[^\u0000-\u007E]/g, match);
                    }

                    function matcher(params, data) {
                        // Always return the object if there is nothing to compare
                        if ($.trim(params.term) === '') {
                            return data;
                        }

                        // Do a recursive check for options with children
                        if (data.children && data.children.length > 0) {
                            // Clone the data object if there are children
                            // This is required as we modify the object to remove any non-matches
                            var match = $.extend(true, {}, data);

                            // Check each child of the option
                            for (var c = data.children.length - 1; c >= 0; c--) {
                                var child = data.children[c];

                                var matches = matcher(params, child);

                                // If there wasn't a match, remove the object in the array
                                if (matches == null) {
                                    match.children.splice(c, 1);
                                }
                            }

                            // If any children matched, return the new object
                            if (match.children.length > 0) {
                                return match;
                            }

                            // If there were no matching children, check just the plain object
                            return matcher(params, match);
                        }

                        var original = stripDiacritics(data.text).toUpperCase();
                        var term = stripDiacritics(params.term).toUpperCase();

                        // Check if the text contains the term
                        if (original.indexOf(term) > -1) {
                            return data;
                        }

                        // If it doesn't contain the term, don't return anything
                        return null;
                    }

                    this.defaults = {
                        amdBase: './',
                        amdLanguageBase: './i18n/',
                        closeOnSelect: true,
                        debug: false,
                        dropdownAutoWidth: false,
                        escapeMarkup: Utils.escapeMarkup,
                        language: EnglishTranslation,
                        matcher: matcher,
                        minimumInputLength: 0,
                        maximumInputLength: 0,
                        maximumSelectionLength: 0,
                        minimumResultsForSearch: 0,
                        selectOnClose: false,
                        sorter: function (data) {
                            return data;
                        },
                        templateResult: function (result) {
                            return result.text;
                        },
                        templateSelection: function (selection) {
                            return selection.text;
                        },
                        theme: 'default',
                        width: 'resolve',
                    };
                };

                Defaults.prototype.set = function (key, value) {
                    var camelKey = $.camelCase(key);

                    var data = {};
                    data[camelKey] = value;

                    var convertedData = Utils._convertData(data);

                    $.extend(this.defaults, convertedData);
                };

                var defaults = new Defaults();

                return defaults;
            }
        );

        S2.define('select2/options', ['require', 'jquery', './defaults', './utils'], function (require, $, Defaults, Utils) {
            function Options(options, $element) {
                this.options = options;

                if ($element != null) {
                    this.fromElement($element);
                }

                this.options = Defaults.apply(this.options);

                if ($element && $element.is('input')) {
                    var InputCompat = require(this.get('amdBase') + 'compat/inputData');

                    this.options.dataAdapter = Utils.Decorate(this.options.dataAdapter, InputCompat);
                }
            }

            Options.prototype.fromElement = function ($e) {
                var excludedData = ['select2'];

                if (this.options.multiple == null) {
                    this.options.multiple = $e.prop('multiple');
                }

                if (this.options.disabled == null) {
                    this.options.disabled = $e.prop('disabled');
                }

                if (this.options.language == null) {
                    if ($e.prop('lang')) {
                        this.options.language = $e.prop('lang').toLowerCase();
                    } else if ($e.closest('[lang]').prop('lang')) {
                        this.options.language = $e.closest('[lang]').prop('lang');
                    }
                }

                if (this.options.dir == null) {
                    if ($e.prop('dir')) {
                        this.options.dir = $e.prop('dir');
                    } else if ($e.closest('[dir]').prop('dir')) {
                        this.options.dir = $e.closest('[dir]').prop('dir');
                    } else {
                        this.options.dir = 'ltr';
                    }
                }

                $e.prop('disabled', this.options.disabled);
                $e.prop('multiple', this.options.multiple);

                if ($e.data('select2Tags')) {
                    if (this.options.debug && window.console && console.warn) {
                        console.warn(
                            'Select2: The `data-select2-tags` attribute has been changed to ' +
                                'use the `data-data` and `data-tags="true"` attributes and will be ' +
                                'removed in future versions of Select2.'
                        );
                    }

                    $e.data('data', $e.data('select2Tags'));
                    $e.data('tags', true);
                }

                if ($e.data('ajaxUrl')) {
                    if (this.options.debug && window.console && console.warn) {
                        console.warn(
                            'Select2: The `data-ajax-url` attribute has been changed to ' +
                                '`data-ajax--url` and support for the old attribute will be removed' +
                                ' in future versions of Select2.'
                        );
                    }

                    $e.attr('ajax--url', $e.data('ajaxUrl'));
                    $e.data('ajax--url', $e.data('ajaxUrl'));
                }

                var dataset = {};

                // Prefer the element's `dataset` attribute if it exists
                // jQuery 1.x does not correctly handle data attributes with multiple dashes
                if ($.fn.jquery && $.fn.jquery.substr(0, 2) == '1.' && $e[0].dataset) {
                    dataset = $.extend(true, {}, $e[0].dataset, $e.data());
                } else {
                    dataset = $e.data();
                }

                var data = $.extend(true, {}, dataset);

                data = Utils._convertData(data);

                for (var key in data) {
                    if ($.inArray(key, excludedData) > -1) {
                        continue;
                    }

                    if ($.isPlainObject(this.options[key])) {
                        $.extend(this.options[key], data[key]);
                    } else {
                        this.options[key] = data[key];
                    }
                }

                return this;
            };

            Options.prototype.get = function (key) {
                return this.options[key];
            };

            Options.prototype.set = function (key, val) {
                this.options[key] = val;
            };

            return Options;
        });

        S2.define('select2/core', ['jquery', './options', './utils', './keys'], function ($, Options, Utils, KEYS) {
            var Select2 = function ($element, options) {
                if ($element.data('select2') != null) {
                    $element.data('select2').destroy();
                }

                this.$element = $element;

                this.id = this._generateId($element);

                options = options || {};

                this.options = new Options(options, $element);

                Select2.__super__.constructor.call(this);

                // Set up the tabindex

                var tabindex = $element.attr('tabindex') || 0;
                $element.data('old-tabindex', tabindex);
                $element.attr('tabindex', '-1');

                // Set up containers and adapters

                var DataAdapter = this.options.get('dataAdapter');
                this.dataAdapter = new DataAdapter($element, this.options);

                var $container = this.render();

                this._placeContainer($container);

                var SelectionAdapter = this.options.get('selectionAdapter');
                this.selection = new SelectionAdapter($element, this.options);
                this.$selection = this.selection.render();

                this.selection.position(this.$selection, $container);

                var DropdownAdapter = this.options.get('dropdownAdapter');
                this.dropdown = new DropdownAdapter($element, this.options);
                this.$dropdown = this.dropdown.render();

                this.dropdown.position(this.$dropdown, $container);

                var ResultsAdapter = this.options.get('resultsAdapter');
                this.results = new ResultsAdapter($element, this.options, this.dataAdapter);
                this.$results = this.results.render();

                this.results.position(this.$results, this.$dropdown);

                // Bind events

                var self = this;

                // Bind the container to all of the adapters
                this._bindAdapters();

                // Register any DOM event handlers
                this._registerDomEvents();

                // Register any internal event handlers
                this._registerDataEvents();
                this._registerSelectionEvents();
                this._registerDropdownEvents();
                this._registerResultsEvents();
                this._registerEvents();

                // Set the initial state
                this.dataAdapter.current(function (initialData) {
                    self.trigger('selection:update', {
                        data: initialData,
                    });
                });

                // Hide the original select
                $element.addClass('select2-hidden-accessible');
                $element.attr('aria-hidden', 'true');

                // Synchronize any monitored attributes
                this._syncAttributes();

                $element.data('select2', this);
            };

            Utils.Extend(Select2, Utils.Observable);

            Select2.prototype._generateId = function ($element) {
                var id = '';

                if ($element.attr('id') != null) {
                    id = $element.attr('id');
                } else if ($element.attr('name') != null) {
                    id = $element.attr('name') + '-' + Utils.generateChars(2);
                } else {
                    id = Utils.generateChars(4);
                }

                id = id.replace(/(:|\.|\[|\]|,)/g, '');
                id = 'select2-' + id;

                return id;
            };

            Select2.prototype._placeContainer = function ($container) {
                $container.insertAfter(this.$element);

                var width = this._resolveWidth(this.$element, this.options.get('width'));

                if (width != null) {
                    $container.css('width', width);
                }
            };

            Select2.prototype._resolveWidth = function ($element, method) {
                var WIDTH = /^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;

                if (method == 'resolve') {
                    var styleWidth = this._resolveWidth($element, 'style');

                    if (styleWidth != null) {
                        return styleWidth;
                    }

                    return this._resolveWidth($element, 'element');
                }

                if (method == 'element') {
                    var elementWidth = $element.outerWidth(false);

                    if (elementWidth <= 0) {
                        return 'auto';
                    }

                    return elementWidth + 'px';
                }

                if (method == 'style') {
                    var style = $element.attr('style');

                    if (typeof style !== 'string') {
                        return null;
                    }

                    var attrs = style.split(';');

                    for (var i = 0, l = attrs.length; i < l; i = i + 1) {
                        var attr = attrs[i].replace(/\s/g, '');
                        var matches = attr.match(WIDTH);

                        if (matches !== null && matches.length >= 1) {
                            return matches[1];
                        }
                    }

                    return null;
                }

                return method;
            };

            Select2.prototype._bindAdapters = function () {
                this.dataAdapter.bind(this, this.$container);
                this.selection.bind(this, this.$container);

                this.dropdown.bind(this, this.$container);
                this.results.bind(this, this.$container);
            };

            Select2.prototype._registerDomEvents = function () {
                var self = this;

                this.$element.on('change.select2', function () {
                    self.dataAdapter.current(function (data) {
                        self.trigger('selection:update', {
                            data: data,
                        });
                    });
                });

                this.$element.on('focus.select2', function (evt) {
                    self.trigger('focus', evt);
                });

                this._syncA = Utils.bind(this._syncAttributes, this);
                this._syncS = Utils.bind(this._syncSubtree, this);

                if (this.$element[0].attachEvent) {
                    this.$element[0].attachEvent('onpropertychange', this._syncA);
                }

                var observer = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
                if (observer != null) {
                    this._observer = new observer(function (mutations) {
                        $.each(mutations, self._syncA);
                        $.each(mutations, self._syncS);
                    });
                    this._observer.observe(this.$element[0], {
                        attributes: true,
                        childList: true,
                        subtree: false,
                    });
                } else if (this.$element[0].addEventListener) {
                    this.$element[0].addEventListener('DOMAttrModified', self._syncA, false);
                    this.$element[0].addEventListener('DOMNodeInserted', self._syncS, false);
                    this.$element[0].addEventListener('DOMNodeRemoved', self._syncS, false);
                }
            };

            Select2.prototype._registerDataEvents = function () {
                var self = this;

                this.dataAdapter.on('*', function (name, params) {
                    self.trigger(name, params);
                });
            };

            Select2.prototype._registerSelectionEvents = function () {
                var self = this;
                var nonRelayEvents = ['toggle', 'focus'];

                this.selection.on('toggle', function () {
                    self.toggleDropdown();
                });

                this.selection.on('focus', function (params) {
                    self.focus(params);
                });

                this.selection.on('*', function (name, params) {
                    if ($.inArray(name, nonRelayEvents) !== -1) {
                        return;
                    }

                    self.trigger(name, params);
                });
            };

            Select2.prototype._registerDropdownEvents = function () {
                var self = this;

                this.dropdown.on('*', function (name, params) {
                    self.trigger(name, params);
                });
            };

            Select2.prototype._registerResultsEvents = function () {
                var self = this;

                this.results.on('*', function (name, params) {
                    self.trigger(name, params);
                });
            };

            Select2.prototype._registerEvents = function () {
                var self = this;

                this.on('open', function () {
                    self.$container.addClass('select2-container--open');
                });

                this.on('close', function () {
                    self.$container.removeClass('select2-container--open');
                });

                this.on('enable', function () {
                    self.$container.removeClass('select2-container--disabled');
                });

                this.on('disable', function () {
                    self.$container.addClass('select2-container--disabled');
                });

                this.on('blur', function () {
                    self.$container.removeClass('select2-container--focus');
                });

                this.on('query', function (params) {
                    if (!self.isOpen()) {
                        self.trigger('open', {});
                    }

                    this.dataAdapter.query(params, function (data) {
                        self.trigger('results:all', {
                            data: data,
                            query: params,
                        });
                    });
                });

                this.on('query:append', function (params) {
                    this.dataAdapter.query(params, function (data) {
                        self.trigger('results:append', {
                            data: data,
                            query: params,
                        });
                    });
                });

                this.on('keypress', function (evt) {
                    var key = evt.which;

                    if (self.isOpen()) {
                        if (key === KEYS.ESC || key === KEYS.TAB || (key === KEYS.UP && evt.altKey)) {
                            self.close();

                            evt.preventDefault();
                        } else if (key === KEYS.ENTER) {
                            self.trigger('results:select', {});

                            evt.preventDefault();
                        } else if (key === KEYS.SPACE && evt.ctrlKey) {
                            self.trigger('results:toggle', {});

                            evt.preventDefault();
                        } else if (key === KEYS.UP) {
                            self.trigger('results:previous', {});

                            evt.preventDefault();
                        } else if (key === KEYS.DOWN) {
                            self.trigger('results:next', {});

                            evt.preventDefault();
                        }
                    } else {
                        if (key === KEYS.ENTER || key === KEYS.SPACE || (key === KEYS.DOWN && evt.altKey)) {
                            self.open();

                            evt.preventDefault();
                        }
                    }
                });
            };

            Select2.prototype._syncAttributes = function () {
                this.options.set('disabled', this.$element.prop('disabled'));

                if (this.options.get('disabled')) {
                    if (this.isOpen()) {
                        this.close();
                    }

                    this.trigger('disable', {});
                } else {
                    this.trigger('enable', {});
                }
            };

            Select2.prototype._syncSubtree = function (evt, mutations) {
                var changed = false;
                var self = this;

                // Ignore any mutation events raised for elements that aren't options or
                // optgroups. This handles the case when the select element is destroyed
                if (evt && evt.target && evt.target.nodeName !== 'OPTION' && evt.target.nodeName !== 'OPTGROUP') {
                    return;
                }

                if (!mutations) {
                    // If mutation events aren't supported, then we can only assume that the
                    // change affected the selections
                    changed = true;
                } else if (mutations.addedNodes && mutations.addedNodes.length > 0) {
                    for (var n = 0; n < mutations.addedNodes.length; n++) {
                        var node = mutations.addedNodes[n];

                        if (node.selected) {
                            changed = true;
                        }
                    }
                } else if (mutations.removedNodes && mutations.removedNodes.length > 0) {
                    changed = true;
                }

                // Only re-pull the data if we think there is a change
                if (changed) {
                    this.dataAdapter.current(function (currentData) {
                        self.trigger('selection:update', {
                            data: currentData,
                        });
                    });
                }
            };

            /**
             * Override the trigger method to automatically trigger pre-events when
             * there are events that can be prevented.
             */
            Select2.prototype.trigger = function (name, args) {
                var actualTrigger = Select2.__super__.trigger;
                var preTriggerMap = {
                    open: 'opening',
                    close: 'closing',
                    select: 'selecting',
                    unselect: 'unselecting',
                };

                if (args === undefined) {
                    args = {};
                }

                if (name in preTriggerMap) {
                    var preTriggerName = preTriggerMap[name];
                    var preTriggerArgs = {
                        prevented: false,
                        name: name,
                        args: args,
                    };

                    actualTrigger.call(this, preTriggerName, preTriggerArgs);

                    if (preTriggerArgs.prevented) {
                        args.prevented = true;

                        return;
                    }
                }

                actualTrigger.call(this, name, args);
            };

            Select2.prototype.toggleDropdown = function () {
                if (this.options.get('disabled')) {
                    return;
                }

                if (this.isOpen()) {
                    this.close();
                } else {
                    this.open();
                }
            };

            Select2.prototype.open = function () {
                if (this.isOpen()) {
                    return;
                }

                this.trigger('query', {});
            };

            Select2.prototype.close = function () {
                if (!this.isOpen()) {
                    return;
                }

                this.trigger('close', {});
            };

            Select2.prototype.isOpen = function () {
                return this.$container.hasClass('select2-container--open');
            };

            Select2.prototype.hasFocus = function () {
                return this.$container.hasClass('select2-container--focus');
            };

            Select2.prototype.focus = function (data) {
                // No need to re-trigger focus events if we are already focused
                if (this.hasFocus()) {
                    return;
                }

                this.$container.addClass('select2-container--focus');
                this.trigger('focus', {});
            };

            Select2.prototype.enable = function (args) {
                if (this.options.get('debug') && window.console && console.warn) {
                    console.warn(
                        'Select2: The `select2("enable")` method has been deprecated and will' +
                            ' be removed in later Select2 versions. Use $element.prop("disabled")' +
                            ' instead.'
                    );
                }

                if (args == null || args.length === 0) {
                    args = [true];
                }

                var disabled = !args[0];

                this.$element.prop('disabled', disabled);
            };

            Select2.prototype.data = function () {
                if (this.options.get('debug') && arguments.length > 0 && window.console && console.warn) {
                    console.warn(
                        'Select2: Data can no longer be set using `select2("data")`. You ' +
                            'should consider setting the value instead using `$element.val()`.'
                    );
                }

                var data = [];

                this.dataAdapter.current(function (currentData) {
                    data = currentData;
                });

                return data;
            };

            Select2.prototype.val = function (args) {
                if (this.options.get('debug') && window.console && console.warn) {
                    console.warn(
                        'Select2: The `select2("val")` method has been deprecated and will be' +
                            ' removed in later Select2 versions. Use $element.val() instead.'
                    );
                }

                if (args == null || args.length === 0) {
                    return this.$element.val();
                }

                var newVal = args[0];

                if ($.isArray(newVal)) {
                    newVal = $.map(newVal, function (obj) {
                        return obj.toString();
                    });
                }

                this.$element.val(newVal).trigger('change');
            };

            Select2.prototype.destroy = function () {
                this.$container.remove();

                if (this.$element[0].detachEvent) {
                    this.$element[0].detachEvent('onpropertychange', this._syncA);
                }

                if (this._observer != null) {
                    this._observer.disconnect();
                    this._observer = null;
                } else if (this.$element[0].removeEventListener) {
                    this.$element[0].removeEventListener('DOMAttrModified', this._syncA, false);
                    this.$element[0].removeEventListener('DOMNodeInserted', this._syncS, false);
                    this.$element[0].removeEventListener('DOMNodeRemoved', this._syncS, false);
                }

                this._syncA = null;
                this._syncS = null;

                this.$element.off('.select2');
                this.$element.attr('tabindex', this.$element.data('old-tabindex'));

                this.$element.removeClass('select2-hidden-accessible');
                this.$element.attr('aria-hidden', 'false');
                this.$element.removeData('select2');

                this.dataAdapter.destroy();
                this.selection.destroy();
                this.dropdown.destroy();
                this.results.destroy();

                this.dataAdapter = null;
                this.selection = null;
                this.dropdown = null;
                this.results = null;
            };

            Select2.prototype.render = function () {
                var $container = $(
                    '<span class="select2 select2-container">' +
                        '<span class="selection"></span>' +
                        '<span class="dropdown-wrapper" aria-hidden="true"></span>' +
                        '</span>'
                );

                $container.attr('dir', this.options.get('dir'));

                this.$container = $container;

                this.$container.addClass('select2-container--' + this.options.get('theme'));

                $container.data('element', this.$element);

                return $container;
            };

            return Select2;
        });

        S2.define('select2/compat/utils', ['jquery'], function ($) {
            function syncCssClasses($dest, $src, adapter) {
                var classes,
                    replacements = [],
                    adapted;

                classes = $.trim($dest.attr('class'));

                if (classes) {
                    classes = '' + classes; // for IE which returns object

                    $(classes.split(/\s+/)).each(function () {
                        // Save all Select2 classes
                        if (this.indexOf('select2-') === 0) {
                            replacements.push(this);
                        }
                    });
                }

                classes = $.trim($src.attr('class'));

                if (classes) {
                    classes = '' + classes; // for IE which returns object

                    $(classes.split(/\s+/)).each(function () {
                        // Only adapt non-Select2 classes
                        if (this.indexOf('select2-') !== 0) {
                            adapted = adapter(this);

                            if (adapted != null) {
                                replacements.push(adapted);
                            }
                        }
                    });
                }

                $dest.attr('class', replacements.join(' '));
            }

            return {
                syncCssClasses: syncCssClasses,
            };
        });

        S2.define('select2/compat/containerCss', ['jquery', './utils'], function ($, CompatUtils) {
            // No-op CSS adapter that discards all classes by default
            function _containerAdapter(clazz) {
                return null;
            }

            function ContainerCSS() {}

            ContainerCSS.prototype.render = function (decorated) {
                var $container = decorated.call(this);

                var containerCssClass = this.options.get('containerCssClass') || '';

                if ($.isFunction(containerCssClass)) {
                    containerCssClass = containerCssClass(this.$element);
                }

                var containerCssAdapter = this.options.get('adaptContainerCssClass');
                containerCssAdapter = containerCssAdapter || _containerAdapter;

                if (containerCssClass.indexOf(':all:') !== -1) {
                    containerCssClass = containerCssClass.replace(':all:', '');

                    var _cssAdapter = containerCssAdapter;

                    containerCssAdapter = function (clazz) {
                        var adapted = _cssAdapter(clazz);

                        if (adapted != null) {
                            // Append the old one along with the adapted one
                            return adapted + ' ' + clazz;
                        }

                        return clazz;
                    };
                }

                var containerCss = this.options.get('containerCss') || {};

                if ($.isFunction(containerCss)) {
                    containerCss = containerCss(this.$element);
                }

                CompatUtils.syncCssClasses($container, this.$element, containerCssAdapter);

                $container.css(containerCss);
                $container.addClass(containerCssClass);

                return $container;
            };

            return ContainerCSS;
        });

        S2.define('select2/compat/dropdownCss', ['jquery', './utils'], function ($, CompatUtils) {
            // No-op CSS adapter that discards all classes by default
            function _dropdownAdapter(clazz) {
                return null;
            }

            function DropdownCSS() {}

            DropdownCSS.prototype.render = function (decorated) {
                var $dropdown = decorated.call(this);

                var dropdownCssClass = this.options.get('dropdownCssClass') || '';

                if ($.isFunction(dropdownCssClass)) {
                    dropdownCssClass = dropdownCssClass(this.$element);
                }

                var dropdownCssAdapter = this.options.get('adaptDropdownCssClass');
                dropdownCssAdapter = dropdownCssAdapter || _dropdownAdapter;

                if (dropdownCssClass.indexOf(':all:') !== -1) {
                    dropdownCssClass = dropdownCssClass.replace(':all:', '');

                    var _cssAdapter = dropdownCssAdapter;

                    dropdownCssAdapter = function (clazz) {
                        var adapted = _cssAdapter(clazz);

                        if (adapted != null) {
                            // Append the old one along with the adapted one
                            return adapted + ' ' + clazz;
                        }

                        return clazz;
                    };
                }

                var dropdownCss = this.options.get('dropdownCss') || {};

                if ($.isFunction(dropdownCss)) {
                    dropdownCss = dropdownCss(this.$element);
                }

                CompatUtils.syncCssClasses($dropdown, this.$element, dropdownCssAdapter);

                $dropdown.css(dropdownCss);
                $dropdown.addClass(dropdownCssClass);

                return $dropdown;
            };

            return DropdownCSS;
        });

        S2.define('select2/compat/initSelection', ['jquery'], function ($) {
            function InitSelection(decorated, $element, options) {
                if (options.get('debug') && window.console && console.warn) {
                    console.warn(
                        'Select2: The `initSelection` option has been deprecated in favor' +
                            ' of a custom data adapter that overrides the `current` method. ' +
                            'This method is now called multiple times instead of a single ' +
                            'time when the instance is initialized. Support will be removed ' +
                            'for the `initSelection` option in future versions of Select2'
                    );
                }

                this.initSelection = options.get('initSelection');
                this._isInitialized = false;

                decorated.call(this, $element, options);
            }

            InitSelection.prototype.current = function (decorated, callback) {
                var self = this;

                if (this._isInitialized) {
                    decorated.call(this, callback);

                    return;
                }

                this.initSelection.call(null, this.$element, function (data) {
                    self._isInitialized = true;

                    if (!$.isArray(data)) {
                        data = [data];
                    }

                    callback(data);
                });
            };

            return InitSelection;
        });

        S2.define('select2/compat/inputData', ['jquery'], function ($) {
            function InputData(decorated, $element, options) {
                this._currentData = [];
                this._valueSeparator = options.get('valueSeparator') || ',';

                if ($element.prop('type') === 'hidden') {
                    if (options.get('debug') && console && console.warn) {
                        console.warn(
                            'Select2: Using a hidden input with Select2 is no longer ' +
                                'supported and may stop working in the future. It is recommended ' +
                                'to use a `<select>` element instead.'
                        );
                    }
                }

                decorated.call(this, $element, options);
            }

            InputData.prototype.current = function (_, callback) {
                function getSelected(data, selectedIds) {
                    var selected = [];

                    if (data.selected || $.inArray(data.id, selectedIds) !== -1) {
                        data.selected = true;
                        selected.push(data);
                    } else {
                        data.selected = false;
                    }

                    if (data.children) {
                        selected.push.apply(selected, getSelected(data.children, selectedIds));
                    }

                    return selected;
                }

                var selected = [];

                for (var d = 0; d < this._currentData.length; d++) {
                    var data = this._currentData[d];

                    selected.push.apply(selected, getSelected(data, this.$element.val().split(this._valueSeparator)));
                }

                callback(selected);
            };

            InputData.prototype.select = function (_, data) {
                if (!this.options.get('multiple')) {
                    this.current(function (allData) {
                        $.map(allData, function (data) {
                            data.selected = false;
                        });
                    });

                    this.$element.val(data.id);
                    this.$element.trigger('change');
                } else {
                    var value = this.$element.val();
                    value += this._valueSeparator + data.id;

                    this.$element.val(value);
                    this.$element.trigger('change');
                }
            };

            InputData.prototype.unselect = function (_, data) {
                var self = this;

                data.selected = false;

                this.current(function (allData) {
                    var values = [];

                    for (var d = 0; d < allData.length; d++) {
                        var item = allData[d];

                        if (data.id == item.id) {
                            continue;
                        }

                        values.push(item.id);
                    }

                    self.$element.val(values.join(self._valueSeparator));
                    self.$element.trigger('change');
                });
            };

            InputData.prototype.query = function (_, params, callback) {
                var results = [];

                for (var d = 0; d < this._currentData.length; d++) {
                    var data = this._currentData[d];

                    var matches = this.matches(params, data);

                    if (matches !== null) {
                        results.push(matches);
                    }
                }

                callback({
                    results: results,
                });
            };

            InputData.prototype.addOptions = function (_, $options) {
                var options = $.map($options, function ($option) {
                    return $.data($option[0], 'data');
                });

                this._currentData.push.apply(this._currentData, options);
            };

            return InputData;
        });

        S2.define('select2/compat/matcher', ['jquery'], function ($) {
            function oldMatcher(matcher) {
                function wrappedMatcher(params, data) {
                    var match = $.extend(true, {}, data);

                    if (params.term == null || $.trim(params.term) === '') {
                        return match;
                    }

                    if (data.children) {
                        for (var c = data.children.length - 1; c >= 0; c--) {
                            var child = data.children[c];

                            // Check if the child object matches
                            // The old matcher returned a boolean true or false
                            var doesMatch = matcher(params.term, child.text, child);

                            // If the child didn't match, pop it off
                            if (!doesMatch) {
                                match.children.splice(c, 1);
                            }
                        }

                        if (match.children.length > 0) {
                            return match;
                        }
                    }

                    if (matcher(params.term, data.text, data)) {
                        return match;
                    }

                    return null;
                }

                return wrappedMatcher;
            }

            return oldMatcher;
        });

        S2.define('select2/compat/query', [], function () {
            function Query(decorated, $element, options) {
                if (options.get('debug') && window.console && console.warn) {
                    console.warn(
                        'Select2: The `query` option has been deprecated in favor of a ' +
                            'custom data adapter that overrides the `query` method. Support ' +
                            'will be removed for the `query` option in future versions of ' +
                            'Select2.'
                    );
                }

                decorated.call(this, $element, options);
            }

            Query.prototype.query = function (_, params, callback) {
                params.callback = callback;

                var query = this.options.get('query');

                query.call(null, params);
            };

            return Query;
        });

        S2.define('select2/dropdown/attachContainer', [], function () {
            function AttachContainer(decorated, $element, options) {
                decorated.call(this, $element, options);
            }

            AttachContainer.prototype.position = function (decorated, $dropdown, $container) {
                var $dropdownContainer = $container.find('.dropdown-wrapper');
                $dropdownContainer.append($dropdown);

                $dropdown.addClass('select2-dropdown--below');
                $container.addClass('select2-container--below');
            };

            return AttachContainer;
        });

        S2.define('select2/dropdown/stopPropagation', [], function () {
            function StopPropagation() {}

            StopPropagation.prototype.bind = function (decorated, container, $container) {
                decorated.call(this, container, $container);

                var stoppedEvents = [
                    'blur',
                    'change',
                    'click',
                    'dblclick',
                    'focus',
                    'focusin',
                    'focusout',
                    'input',
                    'keydown',
                    'keyup',
                    'keypress',
                    'mousedown',
                    'mouseenter',
                    'mouseleave',
                    'mousemove',
                    'mouseover',
                    'mouseup',
                    'search',
                    'touchend',
                    'touchstart',
                ];

                this.$dropdown.on(stoppedEvents.join(' '), function (evt) {
                    evt.stopPropagation();
                });
            };

            return StopPropagation;
        });

        S2.define('select2/selection/stopPropagation', [], function () {
            function StopPropagation() {}

            StopPropagation.prototype.bind = function (decorated, container, $container) {
                decorated.call(this, container, $container);

                var stoppedEvents = [
                    'blur',
                    'change',
                    'click',
                    'dblclick',
                    'focus',
                    'focusin',
                    'focusout',
                    'input',
                    'keydown',
                    'keyup',
                    'keypress',
                    'mousedown',
                    'mouseenter',
                    'mouseleave',
                    'mousemove',
                    'mouseover',
                    'mouseup',
                    'search',
                    'touchend',
                    'touchstart',
                ];

                this.$selection.on(stoppedEvents.join(' '), function (evt) {
                    evt.stopPropagation();
                });
            };

            return StopPropagation;
        });

        /*!
         * jQuery Mousewheel 3.1.13
         *
         * Copyright jQuery Foundation and other contributors
         * Released under the MIT license
         * http://jquery.org/license
         */

        (function (factory) {
            if (typeof S2.define === 'function' && S2.define.amd) {
                // AMD. Register as an anonymous module.
                S2.define('jquery-mousewheel', ['jquery'], factory);
            } else if (typeof exports === 'object') {
                // Node/CommonJS style for Browserify
                module.exports = factory;
            } else {
                // Browser globals
                factory(jQuery);
            }
        })(function ($) {
            var toFix = ['wheel', 'mousewheel', 'DOMMouseScroll', 'MozMousePixelScroll'],
                toBind =
                    'onwheel' in document || document.documentMode >= 9
                        ? ['wheel']
                        : ['mousewheel', 'DomMouseScroll', 'MozMousePixelScroll'],
                slice = Array.prototype.slice,
                nullLowestDeltaTimeout,
                lowestDelta;

            if ($.event.fixHooks) {
                for (var i = toFix.length; i; ) {
                    $.event.fixHooks[toFix[--i]] = $.event.mouseHooks;
                }
            }

            var special = ($.event.special.mousewheel = {
                version: '3.1.12',

                setup: function () {
                    if (this.addEventListener) {
                        for (var i = toBind.length; i; ) {
                            this.addEventListener(toBind[--i], handler, false);
                        }
                    } else {
                        this.onmousewheel = handler;
                    }
                    // Store the line height and page height for this particular element
                    $.data(this, 'mousewheel-line-height', special.getLineHeight(this));
                    $.data(this, 'mousewheel-page-height', special.getPageHeight(this));
                },

                teardown: function () {
                    if (this.removeEventListener) {
                        for (var i = toBind.length; i; ) {
                            this.removeEventListener(toBind[--i], handler, false);
                        }
                    } else {
                        this.onmousewheel = null;
                    }
                    // Clean up the data we added to the element
                    $.removeData(this, 'mousewheel-line-height');
                    $.removeData(this, 'mousewheel-page-height');
                },

                getLineHeight: function (elem) {
                    var $elem = $(elem),
                        $parent = $elem['offsetParent' in $.fn ? 'offsetParent' : 'parent']();
                    if (!$parent.length) {
                        $parent = $('body');
                    }
                    return parseInt($parent.css('fontSize'), 10) || parseInt($elem.css('fontSize'), 10) || 16;
                },

                getPageHeight: function (elem) {
                    return $(elem).height();
                },

                settings: {
                    adjustOldDeltas: true, // see shouldAdjustOldDeltas() below
                    normalizeOffset: true, // calls getBoundingClientRect for each event
                },
            });

            $.fn.extend({
                mousewheel: function (fn) {
                    return fn ? this.bind('mousewheel', fn) : this.trigger('mousewheel');
                },

                unmousewheel: function (fn) {
                    return this.unbind('mousewheel', fn);
                },
            });

            function handler(event) {
                var orgEvent = event || window.event,
                    args = slice.call(arguments, 1),
                    delta = 0,
                    deltaX = 0,
                    deltaY = 0,
                    absDelta = 0,
                    offsetX = 0,
                    offsetY = 0;
                event = $.event.fix(orgEvent);
                event.type = 'mousewheel';

                // Old school scrollwheel delta
                if ('detail' in orgEvent) {
                    deltaY = orgEvent.detail * -1;
                }
                if ('wheelDelta' in orgEvent) {
                    deltaY = orgEvent.wheelDelta;
                }
                if ('wheelDeltaY' in orgEvent) {
                    deltaY = orgEvent.wheelDeltaY;
                }
                if ('wheelDeltaX' in orgEvent) {
                    deltaX = orgEvent.wheelDeltaX * -1;
                }

                // Firefox < 17 horizontal scrolling related to DOMMouseScroll event
                if ('axis' in orgEvent && orgEvent.axis === orgEvent.HORIZONTAL_AXIS) {
                    deltaX = deltaY * -1;
                    deltaY = 0;
                }

                // Set delta to be deltaY or deltaX if deltaY is 0 for backwards compatabilitiy
                delta = deltaY === 0 ? deltaX : deltaY;

                // New school wheel delta (wheel event)
                if ('deltaY' in orgEvent) {
                    deltaY = orgEvent.deltaY * -1;
                    delta = deltaY;
                }
                if ('deltaX' in orgEvent) {
                    deltaX = orgEvent.deltaX;
                    if (deltaY === 0) {
                        delta = deltaX * -1;
                    }
                }

                // No change actually happened, no reason to go any further
                if (deltaY === 0 && deltaX === 0) {
                    return;
                }

                // Need to convert lines and pages to pixels if we aren't already in pixels
                // There are three delta modes:
                //   * deltaMode 0 is by pixels, nothing to do
                //   * deltaMode 1 is by lines
                //   * deltaMode 2 is by pages
                if (orgEvent.deltaMode === 1) {
                    var lineHeight = $.data(this, 'mousewheel-line-height');
                    delta *= lineHeight;
                    deltaY *= lineHeight;
                    deltaX *= lineHeight;
                } else if (orgEvent.deltaMode === 2) {
                    var pageHeight = $.data(this, 'mousewheel-page-height');
                    delta *= pageHeight;
                    deltaY *= pageHeight;
                    deltaX *= pageHeight;
                }

                // Store lowest absolute delta to normalize the delta values
                absDelta = Math.max(Math.abs(deltaY), Math.abs(deltaX));

                if (!lowestDelta || absDelta < lowestDelta) {
                    lowestDelta = absDelta;

                    // Adjust older deltas if necessary
                    if (shouldAdjustOldDeltas(orgEvent, absDelta)) {
                        lowestDelta /= 40;
                    }
                }

                // Adjust older deltas if necessary
                if (shouldAdjustOldDeltas(orgEvent, absDelta)) {
                    // Divide all the things by 40!
                    delta /= 40;
                    deltaX /= 40;
                    deltaY /= 40;
                }

                // Get a whole, normalized value for the deltas
                delta = Math[delta >= 1 ? 'floor' : 'ceil'](delta / lowestDelta);
                deltaX = Math[deltaX >= 1 ? 'floor' : 'ceil'](deltaX / lowestDelta);
                deltaY = Math[deltaY >= 1 ? 'floor' : 'ceil'](deltaY / lowestDelta);

                // Normalise offsetX and offsetY properties
                if (special.settings.normalizeOffset && this.getBoundingClientRect) {
                    var boundingRect = this.getBoundingClientRect();
                    offsetX = event.clientX - boundingRect.left;
                    offsetY = event.clientY - boundingRect.top;
                }

                // Add information to the event object
                event.deltaX = deltaX;
                event.deltaY = deltaY;
                event.deltaFactor = lowestDelta;
                event.offsetX = offsetX;
                event.offsetY = offsetY;
                // Go ahead and set deltaMode to 0 since we converted to pixels
                // Although this is a little odd since we overwrite the deltaX/Y
                // properties with normalized deltas.
                event.deltaMode = 0;

                // Add event and delta to the front of the arguments
                args.unshift(event, delta, deltaX, deltaY);

                // Clearout lowestDelta after sometime to better
                // handle multiple device types that give different
                // a different lowestDelta
                // Ex: trackpad = 3 and mouse wheel = 120
                if (nullLowestDeltaTimeout) {
                    clearTimeout(nullLowestDeltaTimeout);
                }
                nullLowestDeltaTimeout = setTimeout(nullLowestDelta, 200);

                return ($.event.dispatch || $.event.handle).apply(this, args);
            }

            function nullLowestDelta() {
                lowestDelta = null;
            }

            function shouldAdjustOldDeltas(orgEvent, absDelta) {
                // If this is an older event and the delta is divisable by 120,
                // then we are assuming that the browser is treating this as an
                // older mouse wheel event and that we should divide the deltas
                // by 40 to try and get a more usable deltaFactor.
                // Side note, this actually impacts the reported scroll distance
                // in older browsers and can cause scrolling to be slower than native.
                // Turn this off by setting $.event.special.mousewheel.settings.adjustOldDeltas to false.
                return special.settings.adjustOldDeltas && orgEvent.type === 'mousewheel' && absDelta % 120 === 0;
            }
        });

        S2.define('jquery.select2', ['jquery', 'jquery-mousewheel', './select2/core', './select2/defaults'], function (
            $,
            _,
            Select2,
            Defaults
        ) {
            if ($.fn.selectWoo == null) {
                // All methods that should return the element
                var thisMethods = ['open', 'close', 'destroy'];

                $.fn.selectWoo = function (options) {
                    options = options || {};

                    if (typeof options === 'object') {
                        this.each(function () {
                            var instanceOptions = $.extend(true, {}, options);

                            var instance = new Select2($(this), instanceOptions);
                        });

                        return this;
                    } else if (typeof options === 'string') {
                        var ret;
                        var args = Array.prototype.slice.call(arguments, 1);

                        this.each(function () {
                            var instance = $(this).data('select2');

                            if (instance == null && window.console && console.error) {
                                console.error(
                                    "The select2('" +
                                        options +
                                        "') method was called on an " +
                                        'element that is not using Select2.'
                                );
                            }

                            ret = instance[options].apply(instance, args);
                        });

                        // Check if we should be returning `this`
                        if ($.inArray(options, thisMethods) > -1) {
                            return this;
                        }

                        return ret;
                    } else {
                        throw new Error('Invalid arguments for Select2: ' + options);
                    }
                };
            }

            if ($.fn.select2 != null && $.fn.select2.defaults != null) {
                $.fn.selectWoo.defaults = $.fn.select2.defaults;
            }

            if ($.fn.selectWoo.defaults == null) {
                $.fn.selectWoo.defaults = Defaults;
            }

            // Also register selectWoo under select2 if select2 is not already present.
            $.fn.select2 = $.fn.select2 || $.fn.selectWoo;

            return Select2;
        });

        // Return the AMD loader configuration so it can be used outside of this file
        return {
            define: S2.define,
            require: S2.require,
        };
    })();

    // Autoload the jQuery bindings
    // We know that all of the modules exist above this, so we're safe
    var select2 = S2.require('jquery.select2');

    // Hold the AMD module references on the jQuery function that was just loaded
    // This allows Select2 to use the internal loader outside of this file, such
    // as in the language files.
    jQuery.fn.select2.amd = S2;
    jQuery.fn.selectWoo.amd = S2;

    // Return the Select2 instance for anyone who is importing it.
    return select2;
});

/*!
 * Parsley.js
 * Version 2.9.2
 * http://parsleyjs.org
 * Guillaume Potier - <guillaume@wisembly.com>
 * Marc-Andre Lafortune - <petroselinum@marc-andre.ca>
 * MIT Licensed
 */
!(function (t, e) {
    'object' == typeof exports && 'undefined' != typeof module
        ? (module.exports = e(require('jquery')))
        : 'function' == typeof define && define.amd
        ? define(['jquery'], e)
        : ((t = t || self).parsley = e(t.jQuery));
})(this, function (h) {
    'use strict';
    function n(t) {
        return (n =
            'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator
                ? function (t) {
                      return typeof t;
                  }
                : function (t) {
                      return t && 'function' == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t;
                  })(t);
    }
    function l() {
        return (l =
            Object.assign ||
            function (t) {
                for (var e = 1; e < arguments.length; e++) {
                    var i = arguments[e];
                    for (var r in i) Object.prototype.hasOwnProperty.call(i, r) && (t[r] = i[r]);
                }
                return t;
            }).apply(this, arguments);
    }
    function o(t, e) {
        return (
            (function (t) {
                if (Array.isArray(t)) return t;
            })(t) ||
            (function (t, e) {
                if (!(Symbol.iterator in Object(t) || '[object Arguments]' === Object.prototype.toString.call(t))) return;
                var i = [],
                    r = !0,
                    n = !1,
                    s = void 0;
                try {
                    for (var a, o = t[Symbol.iterator](); !(r = (a = o.next()).done) && (i.push(a.value), !e || i.length !== e); r = !0);
                } catch (t) {
                    (n = !0), (s = t);
                } finally {
                    try {
                        r || null == o.return || o.return();
                    } finally {
                        if (n) throw s;
                    }
                }
                return i;
            })(t, e) ||
            (function () {
                throw new TypeError('Invalid attempt to destructure non-iterable instance');
            })()
        );
    }
    function u(t) {
        return (
            (function (t) {
                if (Array.isArray(t)) {
                    for (var e = 0, i = new Array(t.length); e < t.length; e++) i[e] = t[e];
                    return i;
                }
            })(t) ||
            (function (t) {
                if (Symbol.iterator in Object(t) || '[object Arguments]' === Object.prototype.toString.call(t)) return Array.from(t);
            })(t) ||
            (function () {
                throw new TypeError('Invalid attempt to spread non-iterable instance');
            })()
        );
    }
    var t = 1,
        e = {},
        d = {
            attr: function (t, e, i) {
                var r,
                    n,
                    s,
                    a = new RegExp('^' + e, 'i');
                if (void 0 === i) i = {};
                else for (r in i) i.hasOwnProperty(r) && delete i[r];
                if (!t) return i;
                for (r = (s = t.attributes).length; r--; )
                    (n = s[r]) && n.specified && a.test(n.name) && (i[this.camelize(n.name.slice(e.length))] = this.deserializeValue(n.value));
                return i;
            },
            checkAttr: function (t, e, i) {
                return t.hasAttribute(e + i);
            },
            setAttr: function (t, e, i, r) {
                t.setAttribute(this.dasherize(e + i), String(r));
            },
            getType: function (t) {
                return t.getAttribute('type') || 'text';
            },
            generateID: function () {
                return '' + t++;
            },
            deserializeValue: function (e) {
                var t;
                try {
                    return e
                        ? 'true' == e || ('false' != e && ('null' == e ? null : isNaN((t = Number(e))) ? (/^[\[\{]/.test(e) ? JSON.parse(e) : e) : t))
                        : e;
                } catch (t) {
                    return e;
                }
            },
            camelize: function (t) {
                return t.replace(/-+(.)?/g, function (t, e) {
                    return e ? e.toUpperCase() : '';
                });
            },
            dasherize: function (t) {
                return t
                    .replace(/::/g, '/')
                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
                    .replace(/([a-z\d])([A-Z])/g, '$1_$2')
                    .replace(/_/g, '-')
                    .toLowerCase();
            },
            warn: function () {
                var t;
                window.console && 'function' == typeof window.console.warn && (t = window.console).warn.apply(t, arguments);
            },
            warnOnce: function (t) {
                e[t] || ((e[t] = !0), this.warn.apply(this, arguments));
            },
            _resetWarnings: function () {
                e = {};
            },
            trimString: function (t) {
                return t.replace(/^\s+|\s+$/g, '');
            },
            parse: {
                date: function (t) {
                    var e = t.match(/^(\d{4,})-(\d\d)-(\d\d)$/);
                    if (!e) return null;
                    var i = o(
                            e.map(function (t) {
                                return parseInt(t, 10);
                            }),
                            4
                        ),
                        r = (i[0], i[1]),
                        n = i[2],
                        s = i[3],
                        a = new Date(r, n - 1, s);
                    return a.getFullYear() !== r || a.getMonth() + 1 !== n || a.getDate() !== s ? null : a;
                },
                string: function (t) {
                    return t;
                },
                integer: function (t) {
                    return isNaN(t) ? null : parseInt(t, 10);
                },
                number: function (t) {
                    if (isNaN(t)) throw null;
                    return parseFloat(t);
                },
                boolean: function (t) {
                    return !/^\s*false\s*$/i.test(t);
                },
                object: function (t) {
                    return d.deserializeValue(t);
                },
                regexp: function (t) {
                    var e = '';
                    return (
                        (t = /^\/.*\/(?:[gimy]*)$/.test(t)
                            ? ((e = t.replace(/.*\/([gimy]*)$/, '$1')), t.replace(new RegExp('^/(.*?)/' + e + '$'), '$1'))
                            : '^' + t + '$'),
                        new RegExp(t, e)
                    );
                },
            },
            parseRequirement: function (t, e) {
                var i = this.parse[t || 'string'];
                if (!i) throw 'Unknown requirement specification: "' + t + '"';
                var r = i(e);
                if (null === r) throw 'Requirement is not a '.concat(t, ': "').concat(e, '"');
                return r;
            },
            namespaceEvents: function (t, e) {
                return (t = this.trimString(t || '').split(/\s+/))[0]
                    ? h
                          .map(t, function (t) {
                              return ''.concat(t, '.').concat(e);
                          })
                          .join(' ')
                    : '';
            },
            difference: function (t, i) {
                var r = [];
                return (
                    h.each(t, function (t, e) {
                        -1 == i.indexOf(e) && r.push(e);
                    }),
                    r
                );
            },
            all: function (t) {
                return h.when.apply(h, u(t).concat([42, 42]));
            },
            objectCreate:
                Object.create ||
                function (t) {
                    if (1 < arguments.length) throw Error('Second argument not supported');
                    if ('object' != n(t)) throw TypeError('Argument must be an object');
                    i.prototype = t;
                    var e = new i();
                    return (i.prototype = null), e;
                },
            _SubmitSelector: 'input[type="submit"], button:submit',
        };
    function i() {}
    function r() {
        this.__id__ = d.generateID();
    }
    var s = {
        namespace: 'data-parsley-',
        inputs: 'input, textarea, select',
        excluded: 'input[type=button], input[type=submit], input[type=reset], input[type=hidden]',
        priorityEnabled: !0,
        multiple: null,
        group: null,
        uiEnabled: !0,
        validationThreshold: 3,
        focus: 'first',
        trigger: !1,
        triggerAfterFailure: 'input',
        errorClass: 'parsley-error',
        successClass: 'parsley-success',
        classHandler: function () {},
        errorsContainer: function () {},
        errorsWrapper: '<ul class="parsley-errors-list"></ul>',
        errorTemplate: '<li></li>',
    };
    r.prototype = {
        asyncSupport: !0,
        _pipeAccordingToValidationResult: function () {
            function t() {
                var t = h.Deferred();
                return !0 !== e.validationResult && t.reject(), t.resolve().promise();
            }
            var e = this;
            return [t, t];
        },
        actualizeOptions: function () {
            return (
                d.attr(this.element, this.options.namespace, this.domOptions),
                this.parent && this.parent.actualizeOptions && this.parent.actualizeOptions(),
                this
            );
        },
        _resetOptions: function (t) {
            for (var e in ((this.domOptions = d.objectCreate(this.parent.options)), (this.options = d.objectCreate(this.domOptions)), t))
                t.hasOwnProperty(e) && (this.options[e] = t[e]);
            this.actualizeOptions();
        },
        _listeners: null,
        on: function (t, e) {
            return (this._listeners = this._listeners || {}), (this._listeners[t] = this._listeners[t] || []).push(e), this;
        },
        subscribe: function (t, e) {
            h.listenTo(this, t.toLowerCase(), e);
        },
        off: function (t, e) {
            var i = this._listeners && this._listeners[t];
            if (i)
                if (e) for (var r = i.length; r--; ) i[r] === e && i.splice(r, 1);
                else delete this._listeners[t];
            return this;
        },
        unsubscribe: function (t) {
            h.unsubscribeTo(this, t.toLowerCase());
        },
        trigger: function (t, e, i) {
            e = e || this;
            var r,
                n = this._listeners && this._listeners[t];
            if (n) for (var s = n.length; s--; ) if (!1 === (r = n[s].call(e, e, i))) return r;
            return !this.parent || this.parent.trigger(t, e, i);
        },
        asyncIsValid: function (t, e) {
            return d.warnOnce('asyncIsValid is deprecated; please use whenValid instead'), this.whenValid({ group: t, force: e });
        },
        _findRelated: function () {
            return this.options.multiple
                ? h(this.parent.element.querySelectorAll('['.concat(this.options.namespace, 'multiple="').concat(this.options.multiple, '"]')))
                : this.$element;
        },
    };
    function c(t) {
        h.extend(!0, this, t);
    }
    c.prototype = {
        validate: function (t, e) {
            if (this.fn) return 3 < arguments.length && (e = [].slice.call(arguments, 1, -1)), this.fn(t, e);
            if (Array.isArray(t)) {
                if (!this.validateMultiple) throw 'Validator `' + this.name + '` does not handle multiple values';
                return this.validateMultiple.apply(this, arguments);
            }
            var i = arguments[arguments.length - 1];
            if (this.validateDate && i._isDateInput())
                return (arguments[0] = d.parse.date(arguments[0])), null !== arguments[0] && this.validateDate.apply(this, arguments);
            if (this.validateNumber)
                return !t || (!isNaN(t) && ((arguments[0] = parseFloat(arguments[0])), this.validateNumber.apply(this, arguments)));
            if (this.validateString) return this.validateString.apply(this, arguments);
            throw 'Validator `' + this.name + '` only handles multiple values';
        },
        parseRequirements: function (t, e) {
            if ('string' != typeof t) return Array.isArray(t) ? t : [t];
            var i = this.requirementType;
            if (Array.isArray(i)) {
                for (
                    var r = (function (t, e) {
                            var i = t.match(/^\s*\[(.*)\]\s*$/);
                            if (!i) throw 'Requirement is not an array: "' + t + '"';
                            var r = i[1].split(',').map(d.trimString);
                            if (r.length !== e) throw 'Requirement has ' + r.length + ' values when ' + e + ' are needed';
                            return r;
                        })(t, i.length),
                        n = 0;
                    n < r.length;
                    n++
                )
                    r[n] = d.parseRequirement(i[n], r[n]);
                return r;
            }
            return h.isPlainObject(i)
                ? (function (t, e, i) {
                      var r = null,
                          n = {};
                      for (var s in t)
                          if (s) {
                              var a = i(s);
                              'string' == typeof a && (a = d.parseRequirement(t[s], a)), (n[s] = a);
                          } else r = d.parseRequirement(t[s], e);
                      return [r, n];
                  })(i, t, e)
                : [d.parseRequirement(i, t)];
        },
        requirementType: 'string',
        priority: 2,
    };
    function a(t, e) {
        (this.__class__ = 'ValidatorRegistry'), (this.locale = 'en'), this.init(t || {}, e || {});
    }
    var p = {
        email: /^((([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))$/,
        number: /^-?(\d*\.)?\d+(e[-+]?\d+)?$/i,
        integer: /^-?\d+$/,
        digits: /^\d+$/,
        alphanum: /^\w+$/i,
        date: {
            test: function (t) {
                return null !== d.parse.date(t);
            },
        },
        url: new RegExp(
            '^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-zA-Z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/\\S*)?$'
        ),
    };
    p.range = p.number;
    function f(t) {
        var e = ('' + t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);
        return e ? Math.max(0, (e[1] ? e[1].length : 0) - (e[2] ? +e[2] : 0)) : 0;
    }
    function m(s, a) {
        return function (t) {
            for (var e = arguments.length, i = new Array(1 < e ? e - 1 : 0), r = 1; r < e; r++) i[r - 1] = arguments[r];
            return i.pop(), a.apply(void 0, [t].concat(u(((n = s), i.map(d.parse[n])))));
            var n;
        };
    }
    function g(t) {
        return {
            validateDate: m('date', t),
            validateNumber: m('number', t),
            requirementType: t.length <= 2 ? 'string' : ['string', 'string'],
            priority: 30,
        };
    }
    a.prototype = {
        init: function (t, e) {
            for (var i in ((this.catalog = e), (this.validators = l({}, this.validators)), t)) this.addValidator(i, t[i].fn, t[i].priority);
            window.Parsley.trigger('parsley:validator:init');
        },
        setLocale: function (t) {
            if (void 0 === this.catalog[t]) throw new Error(t + ' is not available in the catalog');
            return (this.locale = t), this;
        },
        addCatalog: function (t, e, i) {
            return 'object' === n(e) && (this.catalog[t] = e), !0 === i ? this.setLocale(t) : this;
        },
        addMessage: function (t, e, i) {
            return void 0 === this.catalog[t] && (this.catalog[t] = {}), (this.catalog[t][e] = i), this;
        },
        addMessages: function (t, e) {
            for (var i in e) this.addMessage(t, i, e[i]);
            return this;
        },
        addValidator: function (t, e, i) {
            if (this.validators[t]) d.warn('Validator "' + t + '" is already defined.');
            else if (s.hasOwnProperty(t)) return void d.warn('"' + t + '" is a restricted keyword and is not a valid validator name.');
            return this._setValidator.apply(this, arguments);
        },
        hasValidator: function (t) {
            return !!this.validators[t];
        },
        updateValidator: function (t, e, i) {
            return this.validators[t]
                ? this._setValidator.apply(this, arguments)
                : (d.warn('Validator "' + t + '" is not already defined.'), this.addValidator.apply(this, arguments));
        },
        removeValidator: function (t) {
            return this.validators[t] || d.warn('Validator "' + t + '" is not defined.'), delete this.validators[t], this;
        },
        _setValidator: function (t, e, i) {
            for (var r in ('object' !== n(e) && (e = { fn: e, priority: i }), e.validate || (e = new c(e)), (this.validators[t] = e).messages || {}))
                this.addMessage(r, t, e.messages[r]);
            return this;
        },
        getErrorMessage: function (t) {
            var e;
            'type' === t.name
                ? (e = (this.catalog[this.locale][t.name] || {})[t.requirements])
                : (e = this.formatMessage(this.catalog[this.locale][t.name], t.requirements));
            return e || this.catalog[this.locale].defaultMessage || this.catalog.en.defaultMessage;
        },
        formatMessage: function (t, e) {
            if ('object' !== n(e)) return 'string' == typeof t ? t.replace(/%s/i, e) : '';
            for (var i in e) t = this.formatMessage(t, e[i]);
            return t;
        },
        validators: {
            notblank: {
                validateString: function (t) {
                    return /\S/.test(t);
                },
                priority: 2,
            },
            required: {
                validateMultiple: function (t) {
                    return 0 < t.length;
                },
                validateString: function (t) {
                    return /\S/.test(t);
                },
                priority: 512,
            },
            type: {
                validateString: function (t, e, i) {
                    var r = 2 < arguments.length && void 0 !== i ? i : {},
                        n = r.step,
                        s = void 0 === n ? 'any' : n,
                        a = r.base,
                        o = void 0 === a ? 0 : a,
                        l = p[e];
                    if (!l) throw new Error('validator type `' + e + '` is not supported');
                    if (!t) return !0;
                    if (!l.test(t)) return !1;
                    if ('number' === e && !/^any$/i.test(s || '')) {
                        var u = Number(t),
                            d = Math.max(f(s), f(o));
                        if (f(u) > d) return !1;
                        var h = function (t) {
                            return Math.round(t * Math.pow(10, d));
                        };
                        if ((h(u) - h(o)) % h(s) != 0) return !1;
                    }
                    return !0;
                },
                requirementType: { '': 'string', step: 'string', base: 'number' },
                priority: 256,
            },
            pattern: {
                validateString: function (t, e) {
                    return !t || e.test(t);
                },
                requirementType: 'regexp',
                priority: 64,
            },
            minlength: {
                validateString: function (t, e) {
                    return !t || t.length >= e;
                },
                requirementType: 'integer',
                priority: 30,
            },
            maxlength: {
                validateString: function (t, e) {
                    return t.length <= e;
                },
                requirementType: 'integer',
                priority: 30,
            },
            length: {
                validateString: function (t, e, i) {
                    return !t || (t.length >= e && t.length <= i);
                },
                requirementType: ['integer', 'integer'],
                priority: 30,
            },
            mincheck: {
                validateMultiple: function (t, e) {
                    return t.length >= e;
                },
                requirementType: 'integer',
                priority: 30,
            },
            maxcheck: {
                validateMultiple: function (t, e) {
                    return t.length <= e;
                },
                requirementType: 'integer',
                priority: 30,
            },
            check: {
                validateMultiple: function (t, e, i) {
                    return t.length >= e && t.length <= i;
                },
                requirementType: ['integer', 'integer'],
                priority: 30,
            },
            min: g(function (t, e) {
                return e <= t;
            }),
            max: g(function (t, e) {
                return t <= e;
            }),
            range: g(function (t, e, i) {
                return e <= t && t <= i;
            }),
            equalto: {
                validateString: function (t, e) {
                    if (!t) return !0;
                    var i = h(e);
                    return i.length ? t === i.val() : t === e;
                },
                priority: 256,
            },
            euvatin: {
                validateString: function (t) {
                    if (!t) return !0;
                    return /^[A-Z][A-Z][A-Za-z0-9 -]{2,}$/.test(t);
                },
                priority: 30,
            },
        },
    };
    var v = {};
    (v.Form = {
        _actualizeTriggers: function () {
            var e = this;
            this.$element.on('submit.Parsley', function (t) {
                e.onSubmitValidate(t);
            }),
                this.$element.on('click.Parsley', d._SubmitSelector, function (t) {
                    e.onSubmitButton(t);
                }),
                !1 !== this.options.uiEnabled && this.element.setAttribute('novalidate', '');
        },
        focus: function () {
            if (!(this._focusedField = null) === this.validationResult || 'none' === this.options.focus) return null;
            for (var t = 0; t < this.fields.length; t++) {
                var e = this.fields[t];
                if (
                    !0 !== e.validationResult &&
                    0 < e.validationResult.length &&
                    void 0 === e.options.noFocus &&
                    ((this._focusedField = e.$element), 'first' === this.options.focus)
                )
                    break;
            }
            return null === this._focusedField ? null : this._focusedField.focus();
        },
        _destroyUI: function () {
            this.$element.off('.Parsley');
        },
    }),
        (v.Field = {
            _reflowUI: function () {
                if ((this._buildUI(), this._ui)) {
                    var t = (function t(e, i, r) {
                        for (var n = [], s = [], a = 0; a < e.length; a++) {
                            for (var o = !1, l = 0; l < i.length; l++)
                                if (e[a].assert.name === i[l].assert.name) {
                                    o = !0;
                                    break;
                                }
                            o ? s.push(e[a]) : n.push(e[a]);
                        }
                        return { kept: s, added: n, removed: r ? [] : t(i, e, !0).added };
                    })(this.validationResult, this._ui.lastValidationResult);
                    (this._ui.lastValidationResult = this.validationResult),
                        this._manageStatusClass(),
                        this._manageErrorsMessages(t),
                        this._actualizeTriggers(),
                        (!t.kept.length && !t.added.length) || this._failedOnce || ((this._failedOnce = !0), this._actualizeTriggers());
                }
            },
            getErrorsMessages: function () {
                if (!0 === this.validationResult) return [];
                for (var t = [], e = 0; e < this.validationResult.length; e++)
                    t.push(this.validationResult[e].errorMessage || this._getErrorMessage(this.validationResult[e].assert));
                return t;
            },
            addError: function (t, e) {
                var i = 1 < arguments.length && void 0 !== e ? e : {},
                    r = i.message,
                    n = i.assert,
                    s = i.updateClass,
                    a = void 0 === s || s;
                this._buildUI(), this._addError(t, { message: r, assert: n }), a && this._errorClass();
            },
            updateError: function (t, e) {
                var i = 1 < arguments.length && void 0 !== e ? e : {},
                    r = i.message,
                    n = i.assert,
                    s = i.updateClass,
                    a = void 0 === s || s;
                this._buildUI(), this._updateError(t, { message: r, assert: n }), a && this._errorClass();
            },
            removeError: function (t, e) {
                var i = (1 < arguments.length && void 0 !== e ? e : {}).updateClass,
                    r = void 0 === i || i;
                this._buildUI(), this._removeError(t), r && this._manageStatusClass();
            },
            _manageStatusClass: function () {
                this.hasConstraints() && this.needsValidation() && !0 === this.validationResult
                    ? this._successClass()
                    : 0 < this.validationResult.length
                    ? this._errorClass()
                    : this._resetClass();
            },
            _manageErrorsMessages: function (t) {
                if (void 0 === this.options.errorsMessagesDisabled) {
                    if (void 0 !== this.options.errorMessage)
                        return t.added.length || t.kept.length
                            ? (this._insertErrorWrapper(),
                              0 === this._ui.$errorsWrapper.find('.parsley-custom-error-message').length &&
                                  this._ui.$errorsWrapper.append(h(this.options.errorTemplate).addClass('parsley-custom-error-message')),
                              this._ui.$errorClassHandler.attr('aria-describedby', this._ui.errorsWrapperId),
                              this._ui.$errorsWrapper
                                  .addClass('filled')
                                  .attr('aria-hidden', 'false')
                                  .find('.parsley-custom-error-message')
                                  .html(this.options.errorMessage))
                            : (this._ui.$errorClassHandler.removeAttr('aria-describedby'),
                              this._ui.$errorsWrapper
                                  .removeClass('filled')
                                  .attr('aria-hidden', 'true')
                                  .find('.parsley-custom-error-message')
                                  .remove());
                    for (var e = 0; e < t.removed.length; e++) this._removeError(t.removed[e].assert.name);
                    for (e = 0; e < t.added.length; e++)
                        this._addError(t.added[e].assert.name, { message: t.added[e].errorMessage, assert: t.added[e].assert });
                    for (e = 0; e < t.kept.length; e++)
                        this._updateError(t.kept[e].assert.name, { message: t.kept[e].errorMessage, assert: t.kept[e].assert });
                }
            },
            _addError: function (t, e) {
                var i = e.message,
                    r = e.assert;
                this._insertErrorWrapper(),
                    this._ui.$errorClassHandler.attr('aria-describedby', this._ui.errorsWrapperId),
                    this._ui.$errorsWrapper
                        .addClass('filled')
                        .attr('aria-hidden', 'false')
                        .append(
                            h(this.options.errorTemplate)
                                .addClass('parsley-' + t)
                                .html(i || this._getErrorMessage(r))
                        );
            },
            _updateError: function (t, e) {
                var i = e.message,
                    r = e.assert;
                this._ui.$errorsWrapper
                    .addClass('filled')
                    .find('.parsley-' + t)
                    .html(i || this._getErrorMessage(r));
            },
            _removeError: function (t) {
                this._ui.$errorClassHandler.removeAttr('aria-describedby'),
                    this._ui.$errorsWrapper
                        .removeClass('filled')
                        .attr('aria-hidden', 'true')
                        .find('.parsley-' + t)
                        .remove();
            },
            _getErrorMessage: function (t) {
                var e = t.name + 'Message';
                return void 0 !== this.options[e] ? window.Parsley.formatMessage(this.options[e], t.requirements) : window.Parsley.getErrorMessage(t);
            },
            _buildUI: function () {
                if (!this._ui && !1 !== this.options.uiEnabled) {
                    var t = {};
                    this.element.setAttribute(this.options.namespace + 'id', this.__id__),
                        (t.$errorClassHandler = this._manageClassHandler()),
                        (t.errorsWrapperId = 'parsley-id-' + (this.options.multiple ? 'multiple-' + this.options.multiple : this.__id__)),
                        (t.$errorsWrapper = h(this.options.errorsWrapper).attr('id', t.errorsWrapperId)),
                        (t.lastValidationResult = []),
                        (t.validationInformationVisible = !1),
                        (this._ui = t);
                }
            },
            _manageClassHandler: function () {
                if ('string' == typeof this.options.classHandler && h(this.options.classHandler).length) return h(this.options.classHandler);
                var t = this.options.classHandler;
                if (
                    ('string' == typeof this.options.classHandler &&
                        'function' == typeof window[this.options.classHandler] &&
                        (t = window[this.options.classHandler]),
                    'function' == typeof t)
                ) {
                    var e = t.call(this, this);
                    if (void 0 !== e && e.length) return e;
                } else {
                    if ('object' === n(t) && t instanceof jQuery && t.length) return t;
                    t && d.warn('The class handler `' + t + '` does not exist in DOM nor as a global JS function');
                }
                return this._inputHolder();
            },
            _inputHolder: function () {
                return this.options.multiple && 'SELECT' !== this.element.nodeName ? this.$element.parent() : this.$element;
            },
            _insertErrorWrapper: function () {
                var t = this.options.errorsContainer;
                if (0 !== this._ui.$errorsWrapper.parent().length) return this._ui.$errorsWrapper.parent();
                if ('string' == typeof t) {
                    if (h(t).length) return h(t).append(this._ui.$errorsWrapper);
                    'function' == typeof window[t]
                        ? (t = window[t])
                        : d.warn('The errors container `' + t + '` does not exist in DOM nor as a global JS function');
                }
                return (
                    'function' == typeof t && (t = t.call(this, this)),
                    'object' === n(t) && t.length ? t.append(this._ui.$errorsWrapper) : this._inputHolder().after(this._ui.$errorsWrapper)
                );
            },
            _actualizeTriggers: function () {
                var t,
                    e = this,
                    i = this._findRelated();
                i.off('.Parsley'),
                    this._failedOnce
                        ? i.on(d.namespaceEvents(this.options.triggerAfterFailure, 'Parsley'), function () {
                              e._validateIfNeeded();
                          })
                        : (t = d.namespaceEvents(this.options.trigger, 'Parsley')) &&
                          i.on(t, function (t) {
                              e._validateIfNeeded(t);
                          });
            },
            _validateIfNeeded: function (t) {
                var e = this;
                (t &&
                    /key|input/.test(t.type) &&
                    (!this._ui || !this._ui.validationInformationVisible) &&
                    this.getValue().length <= this.options.validationThreshold) ||
                    (this.options.debounce
                        ? (window.clearTimeout(this._debounced),
                          (this._debounced = window.setTimeout(function () {
                              return e.validate();
                          }, this.options.debounce)))
                        : this.validate());
            },
            _resetUI: function () {
                (this._failedOnce = !1),
                    this._actualizeTriggers(),
                    void 0 !== this._ui &&
                        (this._ui.$errorsWrapper.removeClass('filled').children().remove(),
                        this._resetClass(),
                        (this._ui.lastValidationResult = []),
                        (this._ui.validationInformationVisible = !1));
            },
            _destroyUI: function () {
                this._resetUI(), void 0 !== this._ui && this._ui.$errorsWrapper.remove(), delete this._ui;
            },
            _successClass: function () {
                (this._ui.validationInformationVisible = !0),
                    this._ui.$errorClassHandler.removeClass(this.options.errorClass).addClass(this.options.successClass);
            },
            _errorClass: function () {
                (this._ui.validationInformationVisible = !0),
                    this._ui.$errorClassHandler.removeClass(this.options.successClass).addClass(this.options.errorClass);
            },
            _resetClass: function () {
                this._ui.$errorClassHandler.removeClass(this.options.successClass).removeClass(this.options.errorClass);
            },
        });
    function y(t, e, i) {
        (this.__class__ = 'Form'),
            (this.element = t),
            (this.$element = h(t)),
            (this.domOptions = e),
            (this.options = i),
            (this.parent = window.Parsley),
            (this.fields = []),
            (this.validationResult = null);
    }
    var _ = { pending: null, resolved: !0, rejected: !1 };
    y.prototype = {
        onSubmitValidate: function (t) {
            var e = this;
            if (!0 !== t.parsley) {
                var i = this._submitSource || this.$element.find(d._SubmitSelector)[0];
                if (
                    ((this._submitSource = null),
                    this.$element.find('.parsley-synthetic-submit-button').prop('disabled', !0),
                    !i || null === i.getAttribute('formnovalidate'))
                ) {
                    window.Parsley._remoteCache = {};
                    var r = this.whenValidate({ event: t });
                    ('resolved' === r.state() && !1 !== this._trigger('submit')) ||
                        (t.stopImmediatePropagation(),
                        t.preventDefault(),
                        'pending' === r.state() &&
                            r.done(function () {
                                e._submit(i);
                            }));
                }
            }
        },
        onSubmitButton: function (t) {
            this._submitSource = t.currentTarget;
        },
        _submit: function (t) {
            if (!1 !== this._trigger('submit')) {
                if (t) {
                    var e = this.$element.find('.parsley-synthetic-submit-button').prop('disabled', !1);
                    0 === e.length && (e = h('<input class="parsley-synthetic-submit-button" type="hidden">').appendTo(this.$element)),
                        e.attr({ name: t.getAttribute('name'), value: t.getAttribute('value') });
                }
                this.$element.trigger(l(h.Event('submit'), { parsley: !0 }));
            }
        },
        validate: function (t) {
            if (1 <= arguments.length && !h.isPlainObject(t)) {
                d.warnOnce('Calling validate on a parsley form without passing arguments as an object is deprecated.');
                var e = Array.prototype.slice.call(arguments);
                t = { group: e[0], force: e[1], event: e[2] };
            }
            return _[this.whenValidate(t).state()];
        },
        whenValidate: function (t) {
            var e,
                i = this,
                r = 0 < arguments.length && void 0 !== t ? t : {},
                n = r.group,
                s = r.force,
                a = r.event;
            (this.submitEvent = a) &&
                (this.submitEvent = l({}, a, {
                    preventDefault: function () {
                        d.warnOnce('Using `this.submitEvent.preventDefault()` is deprecated; instead, call `this.validationResult = false`'),
                            (i.validationResult = !1);
                    },
                })),
                (this.validationResult = !0),
                this._trigger('validate'),
                this._refreshFields();
            var o = this._withoutReactualizingFormOptions(function () {
                return h.map(i.fields, function (t) {
                    return t.whenValidate({ force: s, group: n });
                });
            });
            return (e = d
                .all(o)
                .done(function () {
                    i._trigger('success');
                })
                .fail(function () {
                    (i.validationResult = !1), i.focus(), i._trigger('error');
                })
                .always(function () {
                    i._trigger('validated');
                })).pipe.apply(e, u(this._pipeAccordingToValidationResult()));
        },
        isValid: function (t) {
            if (1 <= arguments.length && !h.isPlainObject(t)) {
                d.warnOnce('Calling isValid on a parsley form without passing arguments as an object is deprecated.');
                var e = Array.prototype.slice.call(arguments);
                t = { group: e[0], force: e[1] };
            }
            return _[this.whenValid(t).state()];
        },
        whenValid: function (t) {
            var e = this,
                i = 0 < arguments.length && void 0 !== t ? t : {},
                r = i.group,
                n = i.force;
            this._refreshFields();
            var s = this._withoutReactualizingFormOptions(function () {
                return h.map(e.fields, function (t) {
                    return t.whenValid({ group: r, force: n });
                });
            });
            return d.all(s);
        },
        refresh: function () {
            return this._refreshFields(), this;
        },
        reset: function () {
            for (var t = 0; t < this.fields.length; t++) this.fields[t].reset();
            this._trigger('reset');
        },
        destroy: function () {
            this._destroyUI();
            for (var t = 0; t < this.fields.length; t++) this.fields[t].destroy();
            this.$element.removeData('Parsley'), this._trigger('destroy');
        },
        _refreshFields: function () {
            return this.actualizeOptions()._bindFields();
        },
        _bindFields: function () {
            var n = this,
                t = this.fields;
            return (
                (this.fields = []),
                (this.fieldsMappedById = {}),
                this._withoutReactualizingFormOptions(function () {
                    n.$element
                        .find(n.options.inputs)
                        .not(n.options.excluded)
                        .not('['.concat(n.options.namespace, 'excluded=true]'))
                        .each(function (t, e) {
                            var i = new window.Parsley.Factory(e, {}, n);
                            if ('Field' === i.__class__ || 'FieldMultiple' === i.__class__) {
                                var r = i.__class__ + '-' + i.__id__;
                                void 0 === n.fieldsMappedById[r] && ((n.fieldsMappedById[r] = i), n.fields.push(i));
                            }
                        }),
                        h.each(d.difference(t, n.fields), function (t, e) {
                            e.reset();
                        });
                }),
                this
            );
        },
        _withoutReactualizingFormOptions: function (t) {
            var e = this.actualizeOptions;
            this.actualizeOptions = function () {
                return this;
            };
            var i = t();
            return (this.actualizeOptions = e), i;
        },
        _trigger: function (t) {
            return this.trigger('form:' + t);
        },
    };
    function b(t, e, i, r, n) {
        var s = window.Parsley._validatorRegistry.validators[e],
            a = new c(s);
        l(this, {
            validator: a,
            name: e,
            requirements: i,
            priority: (r = r || t.options[e + 'Priority'] || a.priority),
            isDomConstraint: (n = !0 === n),
        }),
            this._parseRequirements(t.options);
    }
    function w(t, e, i, r) {
        (this.__class__ = 'Field'),
            (this.element = t),
            (this.$element = h(t)),
            void 0 !== r && (this.parent = r),
            (this.options = i),
            (this.domOptions = e),
            (this.constraints = []),
            (this.constraintsByName = {}),
            (this.validationResult = !0),
            this._bindConstraints();
    }
    var F = {
        pending: null,
        resolved: !0,
        rejected: !(b.prototype = {
            validate: function (t, e) {
                var i;
                return (i = this.validator).validate.apply(i, [t].concat(u(this.requirementList), [e]));
            },
            _parseRequirements: function (i) {
                var r = this;
                this.requirementList = this.validator.parseRequirements(this.requirements, function (t) {
                    return i[r.name + ((e = t)[0].toUpperCase() + e.slice(1))];
                    var e;
                });
            },
        }),
    };
    w.prototype = {
        validate: function (t) {
            1 <= arguments.length &&
                !h.isPlainObject(t) &&
                (d.warnOnce('Calling validate on a parsley field without passing arguments as an object is deprecated.'), (t = { options: t }));
            var e = this.whenValidate(t);
            if (!e) return !0;
            switch (e.state()) {
                case 'pending':
                    return null;
                case 'resolved':
                    return !0;
                case 'rejected':
                    return this.validationResult;
            }
        },
        whenValidate: function (t) {
            var e,
                i = this,
                r = 0 < arguments.length && void 0 !== t ? t : {},
                n = r.force,
                s = r.group;
            if ((this.refresh(), !s || this._isInGroup(s)))
                return (
                    (this.value = this.getValue()),
                    this._trigger('validate'),
                    (e = this.whenValid({ force: n, value: this.value, _refreshed: !0 })
                        .always(function () {
                            i._reflowUI();
                        })
                        .done(function () {
                            i._trigger('success');
                        })
                        .fail(function () {
                            i._trigger('error');
                        })
                        .always(function () {
                            i._trigger('validated');
                        })).pipe.apply(e, u(this._pipeAccordingToValidationResult()))
                );
        },
        hasConstraints: function () {
            return 0 !== this.constraints.length;
        },
        needsValidation: function (t) {
            return void 0 === t && (t = this.getValue()), !(!t.length && !this._isRequired() && void 0 === this.options.validateIfEmpty);
        },
        _isInGroup: function (t) {
            return Array.isArray(this.options.group) ? -1 !== h.inArray(t, this.options.group) : this.options.group === t;
        },
        isValid: function (t) {
            if (1 <= arguments.length && !h.isPlainObject(t)) {
                d.warnOnce('Calling isValid on a parsley field without passing arguments as an object is deprecated.');
                var e = Array.prototype.slice.call(arguments);
                t = { force: e[0], value: e[1] };
            }
            var i = this.whenValid(t);
            return !i || F[i.state()];
        },
        whenValid: function (t) {
            var r = this,
                e = 0 < arguments.length && void 0 !== t ? t : {},
                i = e.force,
                n = void 0 !== i && i,
                s = e.value,
                a = e.group;
            if ((e._refreshed || this.refresh(), !a || this._isInGroup(a))) {
                if (((this.validationResult = !0), !this.hasConstraints())) return h.when();
                if ((null == s && (s = this.getValue()), !this.needsValidation(s) && !0 !== n)) return h.when();
                var o = this._getGroupedConstraints(),
                    l = [];
                return (
                    h.each(o, function (t, e) {
                        var i = d.all(
                            h.map(e, function (t) {
                                return r._validateConstraint(s, t);
                            })
                        );
                        if ((l.push(i), 'rejected' === i.state())) return !1;
                    }),
                    d.all(l)
                );
            }
        },
        _validateConstraint: function (t, e) {
            var i = this,
                r = e.validate(t, this);
            return (
                !1 === r && (r = h.Deferred().reject()),
                d.all([r]).fail(function (t) {
                    i.validationResult instanceof Array || (i.validationResult = []),
                        i.validationResult.push({ assert: e, errorMessage: 'string' == typeof t && t });
                })
            );
        },
        getValue: function () {
            var t;
            return null ==
                (t =
                    'function' == typeof this.options.value
                        ? this.options.value(this)
                        : void 0 !== this.options.value
                        ? this.options.value
                        : this.$element.val())
                ? ''
                : this._handleWhitespace(t);
        },
        reset: function () {
            return this._resetUI(), this._trigger('reset');
        },
        destroy: function () {
            this._destroyUI(), this.$element.removeData('Parsley'), this.$element.removeData('FieldMultiple'), this._trigger('destroy');
        },
        refresh: function () {
            return this._refreshConstraints(), this;
        },
        _refreshConstraints: function () {
            return this.actualizeOptions()._bindConstraints();
        },
        refreshConstraints: function () {
            return d.warnOnce("Parsley's refreshConstraints is deprecated. Please use refresh"), this.refresh();
        },
        addConstraint: function (t, e, i, r) {
            if (window.Parsley._validatorRegistry.validators[t]) {
                var n = new b(this, t, e, i, r);
                'undefined' !== this.constraintsByName[n.name] && this.removeConstraint(n.name),
                    this.constraints.push(n),
                    (this.constraintsByName[n.name] = n);
            }
            return this;
        },
        removeConstraint: function (t) {
            for (var e = 0; e < this.constraints.length; e++)
                if (t === this.constraints[e].name) {
                    this.constraints.splice(e, 1);
                    break;
                }
            return delete this.constraintsByName[t], this;
        },
        updateConstraint: function (t, e, i) {
            return this.removeConstraint(t).addConstraint(t, e, i);
        },
        _bindConstraints: function () {
            for (var t = [], e = {}, i = 0; i < this.constraints.length; i++)
                !1 === this.constraints[i].isDomConstraint && (t.push(this.constraints[i]), (e[this.constraints[i].name] = this.constraints[i]));
            for (var r in ((this.constraints = t), (this.constraintsByName = e), this.options)) this.addConstraint(r, this.options[r], void 0, !0);
            return this._bindHtml5Constraints();
        },
        _bindHtml5Constraints: function () {
            null !== this.element.getAttribute('required') && this.addConstraint('required', !0, void 0, !0),
                null !== this.element.getAttribute('pattern') && this.addConstraint('pattern', this.element.getAttribute('pattern'), void 0, !0);
            var t = this.element.getAttribute('min'),
                e = this.element.getAttribute('max');
            null !== t && null !== e
                ? this.addConstraint('range', [t, e], void 0, !0)
                : null !== t
                ? this.addConstraint('min', t, void 0, !0)
                : null !== e && this.addConstraint('max', e, void 0, !0),
                null !== this.element.getAttribute('minlength') && null !== this.element.getAttribute('maxlength')
                    ? this.addConstraint('length', [this.element.getAttribute('minlength'), this.element.getAttribute('maxlength')], void 0, !0)
                    : null !== this.element.getAttribute('minlength')
                    ? this.addConstraint('minlength', this.element.getAttribute('minlength'), void 0, !0)
                    : null !== this.element.getAttribute('maxlength') &&
                      this.addConstraint('maxlength', this.element.getAttribute('maxlength'), void 0, !0);
            var i = d.getType(this.element);
            return 'number' === i
                ? this.addConstraint(
                      'type',
                      ['number', { step: this.element.getAttribute('step') || '1', base: t || this.element.getAttribute('value') }],
                      void 0,
                      !0
                  )
                : /^(email|url|range|date)$/i.test(i)
                ? this.addConstraint('type', i, void 0, !0)
                : this;
        },
        _isRequired: function () {
            return void 0 !== this.constraintsByName.required && !1 !== this.constraintsByName.required.requirements;
        },
        _trigger: function (t) {
            return this.trigger('field:' + t);
        },
        _handleWhitespace: function (t) {
            return (
                !0 === this.options.trimValue &&
                    d.warnOnce('data-parsley-trim-value="true" is deprecated, please use data-parsley-whitespace="trim"'),
                'squish' === this.options.whitespace && (t = t.replace(/\s{2,}/g, ' ')),
                ('trim' !== this.options.whitespace && 'squish' !== this.options.whitespace && !0 !== this.options.trimValue) ||
                    (t = d.trimString(t)),
                t
            );
        },
        _isDateInput: function () {
            var t = this.constraintsByName.type;
            return t && 'date' === t.requirements;
        },
        _getGroupedConstraints: function () {
            if (!1 === this.options.priorityEnabled) return [this.constraints];
            for (var t = [], e = {}, i = 0; i < this.constraints.length; i++) {
                var r = this.constraints[i].priority;
                e[r] || t.push((e[r] = [])), e[r].push(this.constraints[i]);
            }
            return (
                t.sort(function (t, e) {
                    return e[0].priority - t[0].priority;
                }),
                t
            );
        },
    };
    function C() {
        this.__class__ = 'FieldMultiple';
    }
    C.prototype = {
        addElement: function (t) {
            return this.$elements.push(t), this;
        },
        _refreshConstraints: function () {
            var t;
            if (((this.constraints = []), 'SELECT' === this.element.nodeName)) return this.actualizeOptions()._bindConstraints(), this;
            for (var e = 0; e < this.$elements.length; e++)
                if (h('html').has(this.$elements[e]).length) {
                    t = this.$elements[e].data('FieldMultiple')._refreshConstraints().constraints;
                    for (var i = 0; i < t.length; i++) this.addConstraint(t[i].name, t[i].requirements, t[i].priority, t[i].isDomConstraint);
                } else this.$elements.splice(e, 1);
            return this;
        },
        getValue: function () {
            if ('function' == typeof this.options.value) return this.options.value(this);
            if (void 0 !== this.options.value) return this.options.value;
            if ('INPUT' === this.element.nodeName) {
                var t = d.getType(this.element);
                if ('radio' === t) return this._findRelated().filter(':checked').val() || '';
                if ('checkbox' === t) {
                    var e = [];
                    return (
                        this._findRelated()
                            .filter(':checked')
                            .each(function () {
                                e.push(h(this).val());
                            }),
                        e
                    );
                }
            }
            return 'SELECT' === this.element.nodeName && null === this.$element.val() ? [] : this.$element.val();
        },
        _init: function () {
            return (this.$elements = [this.$element]), this;
        },
    };
    function A(t, e, i) {
        (this.element = t), (this.$element = h(t));
        var r = this.$element.data('Parsley');
        if (r)
            return (
                void 0 !== i && r.parent === window.Parsley && ((r.parent = i), r._resetOptions(r.options)), 'object' === n(e) && l(r.options, e), r
            );
        if (!this.$element.length) throw new Error('You must bind Parsley on an existing element.');
        if (void 0 !== i && 'Form' !== i.__class__) throw new Error('Parent instance must be a Form instance');
        return (this.parent = i || window.Parsley), this.init(e);
    }
    A.prototype = {
        init: function (t) {
            return (
                (this.__class__ = 'Parsley'),
                (this.__version__ = '2.9.2'),
                (this.__id__ = d.generateID()),
                this._resetOptions(t),
                'FORM' === this.element.nodeName ||
                (d.checkAttr(this.element, this.options.namespace, 'validate') && !this.$element.is(this.options.inputs))
                    ? this.bind('parsleyForm')
                    : this.isMultiple()
                    ? this.handleMultiple()
                    : this.bind('parsleyField')
            );
        },
        isMultiple: function () {
            var t = d.getType(this.element);
            return 'radio' === t || 'checkbox' === t || ('SELECT' === this.element.nodeName && null !== this.element.getAttribute('multiple'));
        },
        handleMultiple: function () {
            var t,
                e,
                r = this;
            if (
                ((this.options.multiple = this.options.multiple || (t = this.element.getAttribute('name')) || this.element.getAttribute('id')),
                'SELECT' === this.element.nodeName && null !== this.element.getAttribute('multiple'))
            )
                return (this.options.multiple = this.options.multiple || this.__id__), this.bind('parsleyFieldMultiple');
            if (!this.options.multiple)
                return (
                    d.warn(
                        'To be bound by Parsley, a radio, a checkbox and a multiple select input must have either a name or a multiple option.',
                        this.$element
                    ),
                    this
                );
            (this.options.multiple = this.options.multiple.replace(/(:|\.|\[|\]|\{|\}|\$)/g, '')),
                t &&
                    h('input[name="' + t + '"]').each(function (t, e) {
                        var i = d.getType(e);
                        ('radio' !== i && 'checkbox' !== i) || e.setAttribute(r.options.namespace + 'multiple', r.options.multiple);
                    });
            for (var i = this._findRelated(), n = 0; n < i.length; n++)
                if (void 0 !== (e = h(i.get(n)).data('Parsley'))) {
                    this.$element.data('FieldMultiple') || e.addElement(this.$element);
                    break;
                }
            return this.bind('parsleyField', !0), e || this.bind('parsleyFieldMultiple');
        },
        bind: function (t, e) {
            var i;
            switch (t) {
                case 'parsleyForm':
                    i = h.extend(new y(this.element, this.domOptions, this.options), new r(), window.ParsleyExtend)._bindFields();
                    break;
                case 'parsleyField':
                    i = h.extend(new w(this.element, this.domOptions, this.options, this.parent), new r(), window.ParsleyExtend);
                    break;
                case 'parsleyFieldMultiple':
                    i = h.extend(new w(this.element, this.domOptions, this.options, this.parent), new C(), new r(), window.ParsleyExtend)._init();
                    break;
                default:
                    throw new Error(t + 'is not a supported Parsley type');
            }
            return (
                this.options.multiple && d.setAttr(this.element, this.options.namespace, 'multiple', this.options.multiple),
                void 0 !== e
                    ? this.$element.data('FieldMultiple', i)
                    : (this.$element.data('Parsley', i), i._actualizeTriggers(), i._trigger('init')),
                i
            );
        },
    };
    var E = h.fn.jquery.split('.');
    if (parseInt(E[0]) <= 1 && parseInt(E[1]) < 8) throw 'The loaded version of jQuery is too old. Please upgrade to 1.8.x or better.';
    E.forEach || d.warn('Parsley requires ES5 to run properly. Please include https://github.com/es-shims/es5-shim');
    var x = l(new r(), { element: document, $element: h(document), actualizeOptions: null, _resetOptions: null, Factory: A, version: '2.9.2' });
    l(w.prototype, v.Field, r.prototype),
        l(y.prototype, v.Form, r.prototype),
        l(A.prototype, r.prototype),
        (h.fn.parsley = h.fn.psly =
            function (t) {
                if (1 < this.length) {
                    var e = [];
                    return (
                        this.each(function () {
                            e.push(h(this).parsley(t));
                        }),
                        e
                    );
                }
                if (0 != this.length) return new A(this[0], t);
            }),
        void 0 === window.ParsleyExtend && (window.ParsleyExtend = {}),
        (x.options = l(d.objectCreate(s), window.ParsleyConfig)),
        (window.ParsleyConfig = x.options),
        (window.Parsley = window.psly = x),
        (x.Utils = d),
        (window.ParsleyUtils = {}),
        h.each(d, function (t, e) {
            'function' == typeof e &&
                (window.ParsleyUtils[t] = function () {
                    return d.warnOnce('Accessing `window.ParsleyUtils` is deprecated. Use `window.Parsley.Utils` instead.'), d[t].apply(d, arguments);
                });
        });
    var $ = (window.Parsley._validatorRegistry = new a(window.ParsleyConfig.validators, window.ParsleyConfig.i18n));
    (window.ParsleyValidator = {}),
        h.each(
            'setLocale addCatalog addMessage addMessages getErrorMessage formatMessage addValidator updateValidator removeValidator hasValidator'.split(
                ' '
            ),
            function (t, e) {
                (window.Parsley[e] = function () {
                    return $[e].apply($, arguments);
                }),
                    (window.ParsleyValidator[e] = function () {
                        var t;
                        return (
                            d.warnOnce(
                                "Accessing the method '"
                                    .concat(e, "' through Validator is deprecated. Simply call 'window.Parsley.")
                                    .concat(e, "(...)'")
                            ),
                            (t = window.Parsley)[e].apply(t, arguments)
                        );
                    });
            }
        ),
        (window.Parsley.UI = v),
        (window.ParsleyUI = {
            removeError: function (t, e, i) {
                var r = !0 !== i;
                return (
                    d.warnOnce(
                        "Accessing UI is deprecated. Call 'removeError' on the instance directly. Please comment in issue 1073 as to your need to call this method."
                    ),
                    t.removeError(e, { updateClass: r })
                );
            },
            getErrorsMessages: function (t) {
                return d.warnOnce("Accessing UI is deprecated. Call 'getErrorsMessages' on the instance directly."), t.getErrorsMessages();
            },
        }),
        h.each('addError updateError'.split(' '), function (t, a) {
            window.ParsleyUI[a] = function (t, e, i, r, n) {
                var s = !0 !== n;
                return (
                    d.warnOnce(
                        "Accessing UI is deprecated. Call '".concat(
                            a,
                            "' on the instance directly. Please comment in issue 1073 as to your need to call this method."
                        )
                    ),
                    t[a](e, { message: i, assert: r, updateClass: s })
                );
            };
        }),
        !1 !== window.ParsleyConfig.autoBind &&
            h(function () {
                h('[data-parsley-validate]').length && h('[data-parsley-validate]').parsley();
            });
    function V() {
        d.warnOnce("Parsley's pubsub module is deprecated; use the 'on' and 'off' methods on parsley instances or window.Parsley");
    }
    var P = h({});
    function O(e, i) {
        return (
            e.parsleyAdaptedCallback ||
                (e.parsleyAdaptedCallback = function () {
                    var t = Array.prototype.slice.call(arguments, 0);
                    t.unshift(this), e.apply(i || P, t);
                }),
            e.parsleyAdaptedCallback
        );
    }
    var T = 'parsley:';
    function M(t) {
        return 0 === t.lastIndexOf(T, 0) ? t.substr(T.length) : t;
    }
    return (
        (h.listen = function (t, e) {
            var i;
            if (
                (V(),
                'object' === n(arguments[1]) && 'function' == typeof arguments[2] && ((i = arguments[1]), (e = arguments[2])),
                'function' != typeof e)
            )
                throw new Error('Wrong parameters');
            window.Parsley.on(M(t), O(e, i));
        }),
        (h.listenTo = function (t, e, i) {
            if ((V(), !(t instanceof w || t instanceof y))) throw new Error('Must give Parsley instance');
            if ('string' != typeof e || 'function' != typeof i) throw new Error('Wrong parameters');
            t.on(M(e), O(i));
        }),
        (h.unsubscribe = function (t, e) {
            if ((V(), 'string' != typeof t || 'function' != typeof e)) throw new Error('Wrong arguments');
            window.Parsley.off(M(t), e.parsleyAdaptedCallback);
        }),
        (h.unsubscribeTo = function (t, e) {
            if ((V(), !(t instanceof w || t instanceof y))) throw new Error('Must give Parsley instance');
            t.off(M(e));
        }),
        (h.unsubscribeAll = function (e) {
            V(),
                window.Parsley.off(M(e)),
                h('form,input,textarea,select').each(function () {
                    var t = h(this).data('Parsley');
                    t && t.off(M(e));
                });
        }),
        (h.emit = function (t, e) {
            V();
            var i = e instanceof w || e instanceof y,
                r = Array.prototype.slice.call(arguments, i ? 2 : 1);
            r.unshift(M(t)), i || (e = window.Parsley), e.trigger.apply(e, u(r));
        }),
        h.extend(!0, x, {
            asyncValidators: {
                default: {
                    fn: function (t) {
                        return 200 <= t.status && t.status < 300;
                    },
                    url: !1,
                },
                reverse: {
                    fn: function (t) {
                        return t.status < 200 || 300 <= t.status;
                    },
                    url: !1,
                },
            },
            addAsyncValidator: function (t, e, i, r) {
                return (x.asyncValidators[t] = { fn: e, url: i || !1, options: r || {} }), this;
            },
        }),
        x.addValidator('remote', {
            requirementType: { '': 'string', validator: 'string', reverse: 'boolean', options: 'object' },
            validateString: function (t, e, i, r) {
                var n,
                    s,
                    a = {},
                    o = i.validator || (!0 === i.reverse ? 'reverse' : 'default');
                if (void 0 === x.asyncValidators[o]) throw new Error('Calling an undefined async validator: `' + o + '`');
                -1 < (e = x.asyncValidators[o].url || e).indexOf('{value}')
                    ? (e = e.replace('{value}', encodeURIComponent(t)))
                    : (a[r.element.getAttribute('name') || r.element.getAttribute('id')] = t);
                var l = h.extend(!0, i.options || {}, x.asyncValidators[o].options);
                (n = h.extend(!0, {}, { url: e, data: a, type: 'GET' }, l)),
                    r.trigger('field:ajaxoptions', r, n),
                    (s = h.param(n)),
                    void 0 === x._remoteCache && (x._remoteCache = {});
                function u() {
                    var t = x.asyncValidators[o].fn.call(r, d, e, i);
                    return (t = t || h.Deferred().reject()), h.when(t);
                }
                var d = (x._remoteCache[s] = x._remoteCache[s] || h.ajax(n));
                return d.then(u, u);
            },
            priority: -1,
        }),
        x.on('form:submit', function () {
            x._remoteCache = {};
        }),
        (r.prototype.addAsyncValidator = function () {
            return (
                d.warnOnce(
                    'Accessing the method `addAsyncValidator` through an instance is deprecated. Simply call `Parsley.addAsyncValidator(...)`'
                ),
                x.addAsyncValidator.apply(x, arguments)
            );
        }),
        x.addMessages('en', {
            defaultMessage: 'This value seems to be invalid.',
            type: {
                email: 'This value should be a valid email.',
                url: 'This value should be a valid url.',
                number: 'This value should be a valid number.',
                integer: 'This value should be a valid integer.',
                digits: 'This value should be digits.',
                alphanum: 'This value should be alphanumeric.',
            },
            notblank: 'This value should not be blank.',
            required: 'This value is required.',
            pattern: 'This value seems to be invalid.',
            min: 'This value should be greater than or equal to %s.',
            max: 'This value should be lower than or equal to %s.',
            range: 'This value should be between %s and %s.',
            minlength: 'This value is too short. It should have %s characters or more.',
            maxlength: 'This value is too long. It should have %s characters or fewer.',
            length: 'This value length is invalid. It should be between %s and %s characters long.',
            mincheck: 'You must select at least %s choices.',
            maxcheck: 'You must select %s choices or fewer.',
            check: 'You must select between %s and %s choices.',
            equalto: 'This value should be the same.',
            euvatin: "It's not a valid VAT Identification Number.",
        }),
        x.setLocale('en'),
        new (function () {
            var r = this,
                n = window || global;
            l(this, {
                isNativeEvent: function (t) {
                    return t.originalEvent && !1 !== t.originalEvent.isTrusted;
                },
                fakeInputEvent: function (t) {
                    r.isNativeEvent(t) && h(t.target).trigger('input');
                },
                misbehaves: function (t) {
                    r.isNativeEvent(t) &&
                        (r.behavesOk(t), h(document).on('change.inputevent', t.data.selector, r.fakeInputEvent), r.fakeInputEvent(t));
                },
                behavesOk: function (t) {
                    r.isNativeEvent(t) &&
                        h(document).off('input.inputevent', t.data.selector, r.behavesOk).off('change.inputevent', t.data.selector, r.misbehaves);
                },
                install: function () {
                    if (!n.inputEventPatched) {
                        n.inputEventPatched = '0.0.3';
                        for (var t = 0, e = ['select', 'input[type="checkbox"]', 'input[type="radio"]', 'input[type="file"]']; t < e.length; t++) {
                            var i = e[t];
                            h(document)
                                .on('input.inputevent', i, { selector: i }, r.behavesOk)
                                .on('change.inputevent', i, { selector: i }, r.misbehaves);
                        }
                    }
                },
                uninstall: function () {
                    delete n.inputEventPatched, h(document).off('.inputevent');
                },
            });
        })().install(),
        x
    );
});
//# sourceMappingURL=parsley.min.js.map
//# sourceMappingURL=parsley.min.js.map

/*!
 * JavaScript Cookie v2.1.2
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
;(function (factory) {
	if (typeof define === 'function' && define.amd) {
		define(factory);
	} else if (typeof exports === 'object') {
		module.exports = factory();
	} else {
		var OldCookies = window.Cookies;
		var api = window.Cookies = factory();
		api.noConflict = function () {
			window.Cookies = OldCookies;
			return api;
		};
	}
}(function () {
	function extend () {
		var i = 0;
		var result = {};
		for (; i < arguments.length; i++) {
			var attributes = arguments[ i ];
			for (var key in attributes) {
				result[key] = attributes[key];
			}
		}
		return result;
	}

	function init (converter) {
		function api (key, value, attributes) {
			var result;
			if (typeof document === 'undefined') {
				return;
			}

			// Write

			if (arguments.length > 1) {
				attributes = extend({
					path: '/'
				}, api.defaults, attributes);

				if (typeof attributes.expires === 'number') {
					var expires = new Date();
					expires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);
					attributes.expires = expires;
				}

				try {
					result = JSON.stringify(value);
					if (/^[\{\[]/.test(result)) {
						value = result;
					}
				} catch (e) {}

				if (!converter.write) {
					value = encodeURIComponent(String(value))
						.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);
				} else {
					value = converter.write(value, key);
				}

				key = encodeURIComponent(String(key));
				key = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);
				key = key.replace(/[\(\)]/g, escape);

				return (document.cookie = [
					key, '=', value,
					attributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE
					attributes.path    && '; path=' + attributes.path,
					attributes.domain  && '; domain=' + attributes.domain,
					attributes.secure ? '; secure' : ''
				].join(''));
			}

			// Read

			if (!key) {
				result = {};
			}

			// To prevent the for loop in the first place assign an empty array
			// in case there are no cookies at all. Also prevents odd result when
			// calling "get()"
			var cookies = document.cookie ? document.cookie.split('; ') : [];
			var rdecode = /(%[0-9A-Z]{2})+/g;
			var i = 0;

			for (; i < cookies.length; i++) {
				var parts = cookies[i].split('=');
				var cookie = parts.slice(1).join('=');

				if (cookie.charAt(0) === '"') {
					cookie = cookie.slice(1, -1);
				}

				try {
					var name = parts[0].replace(rdecode, decodeURIComponent);
					cookie = converter.read ?
						converter.read(cookie, name) : converter(cookie, name) ||
						cookie.replace(rdecode, decodeURIComponent);

					if (this.json) {
						try {
							cookie = JSON.parse(cookie);
						} catch (e) {}
					}

					if (key === name) {
						result = cookie;
						break;
					}

					if (!key) {
						result[name] = cookie;
					}
				} catch (e) {}
			}

			return result;
		}

		api.set = api;
		api.get = function (key) {
			return api(key);
		};
		api.getJSON = function () {
			return api.apply({
				json: true
			}, [].slice.call(arguments));
		};
		api.defaults = {};

		api.remove = function (key, attributes) {
			api(key, '', extend(attributes, {
				expires: -1
			}));
		};

		api.withConverter = init;

		return api;
	}

	return init(function () {});
}));

/*! picturefill - v3.0.2 - 2016-02-12
 * https://scottjehl.github.io/picturefill/
 * Copyright (c) 2016 https://github.com/scottjehl/picturefill/blob/master/Authors.txt; Licensed MIT
 */
!function(a){var b=navigator.userAgent;a.HTMLPictureElement&&/ecko/.test(b)&&b.match(/rv\:(\d+)/)&&RegExp.$1<45&&addEventListener("resize",function(){var b,c=document.createElement("source"),d=function(a){var b,d,e=a.parentNode;"PICTURE"===e.nodeName.toUpperCase()?(b=c.cloneNode(),e.insertBefore(b,e.firstElementChild),setTimeout(function(){e.removeChild(b)})):(!a._pfLastSize||a.offsetWidth>a._pfLastSize)&&(a._pfLastSize=a.offsetWidth,d=a.sizes,a.sizes+=",100vw",setTimeout(function(){a.sizes=d}))},e=function(){var a,b=document.querySelectorAll("picture > img, img[srcset][sizes]");for(a=0;a<b.length;a++)d(b[a])},f=function(){clearTimeout(b),b=setTimeout(e,99)},g=a.matchMedia&&matchMedia("(orientation: landscape)"),h=function(){f(),g&&g.addListener&&g.addListener(f)};return c.srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",/^[c|i]|d$/.test(document.readyState||"")?h():document.addEventListener("DOMContentLoaded",h),f}())}(window),function(a,b,c){"use strict";function d(a){return" "===a||"	"===a||"\n"===a||"\f"===a||"\r"===a}function e(b,c){var d=new a.Image;return d.onerror=function(){A[b]=!1,ba()},d.onload=function(){A[b]=1===d.width,ba()},d.src=c,"pending"}function f(){M=!1,P=a.devicePixelRatio,N={},O={},s.DPR=P||1,Q.width=Math.max(a.innerWidth||0,z.clientWidth),Q.height=Math.max(a.innerHeight||0,z.clientHeight),Q.vw=Q.width/100,Q.vh=Q.height/100,r=[Q.height,Q.width,P].join("-"),Q.em=s.getEmValue(),Q.rem=Q.em}function g(a,b,c,d){var e,f,g,h;return"saveData"===B.algorithm?a>2.7?h=c+1:(f=b-c,e=Math.pow(a-.6,1.5),g=f*e,d&&(g+=.1*e),h=a+g):h=c>1?Math.sqrt(a*b):a,h>c}function h(a){var b,c=s.getSet(a),d=!1;"pending"!==c&&(d=r,c&&(b=s.setRes(c),s.applySetCandidate(b,a))),a[s.ns].evaled=d}function i(a,b){return a.res-b.res}function j(a,b,c){var d;return!c&&b&&(c=a[s.ns].sets,c=c&&c[c.length-1]),d=k(b,c),d&&(b=s.makeUrl(b),a[s.ns].curSrc=b,a[s.ns].curCan=d,d.res||aa(d,d.set.sizes)),d}function k(a,b){var c,d,e;if(a&&b)for(e=s.parseSet(b),a=s.makeUrl(a),c=0;c<e.length;c++)if(a===s.makeUrl(e[c].url)){d=e[c];break}return d}function l(a,b){var c,d,e,f,g=a.getElementsByTagName("source");for(c=0,d=g.length;d>c;c++)e=g[c],e[s.ns]=!0,f=e.getAttribute("srcset"),f&&b.push({srcset:f,media:e.getAttribute("media"),type:e.getAttribute("type"),sizes:e.getAttribute("sizes")})}function m(a,b){function c(b){var c,d=b.exec(a.substring(m));return d?(c=d[0],m+=c.length,c):void 0}function e(){var a,c,d,e,f,i,j,k,l,m=!1,o={};for(e=0;e<h.length;e++)f=h[e],i=f[f.length-1],j=f.substring(0,f.length-1),k=parseInt(j,10),l=parseFloat(j),X.test(j)&&"w"===i?((a||c)&&(m=!0),0===k?m=!0:a=k):Y.test(j)&&"x"===i?((a||c||d)&&(m=!0),0>l?m=!0:c=l):X.test(j)&&"h"===i?((d||c)&&(m=!0),0===k?m=!0:d=k):m=!0;m||(o.url=g,a&&(o.w=a),c&&(o.d=c),d&&(o.h=d),d||c||a||(o.d=1),1===o.d&&(b.has1x=!0),o.set=b,n.push(o))}function f(){for(c(T),i="",j="in descriptor";;){if(k=a.charAt(m),"in descriptor"===j)if(d(k))i&&(h.push(i),i="",j="after descriptor");else{if(","===k)return m+=1,i&&h.push(i),void e();if("("===k)i+=k,j="in parens";else{if(""===k)return i&&h.push(i),void e();i+=k}}else if("in parens"===j)if(")"===k)i+=k,j="in descriptor";else{if(""===k)return h.push(i),void e();i+=k}else if("after descriptor"===j)if(d(k));else{if(""===k)return void e();j="in descriptor",m-=1}m+=1}}for(var g,h,i,j,k,l=a.length,m=0,n=[];;){if(c(U),m>=l)return n;g=c(V),h=[],","===g.slice(-1)?(g=g.replace(W,""),e()):f()}}function n(a){function b(a){function b(){f&&(g.push(f),f="")}function c(){g[0]&&(h.push(g),g=[])}for(var e,f="",g=[],h=[],i=0,j=0,k=!1;;){if(e=a.charAt(j),""===e)return b(),c(),h;if(k){if("*"===e&&"/"===a[j+1]){k=!1,j+=2,b();continue}j+=1}else{if(d(e)){if(a.charAt(j-1)&&d(a.charAt(j-1))||!f){j+=1;continue}if(0===i){b(),j+=1;continue}e=" "}else if("("===e)i+=1;else if(")"===e)i-=1;else{if(","===e){b(),c(),j+=1;continue}if("/"===e&&"*"===a.charAt(j+1)){k=!0,j+=2;continue}}f+=e,j+=1}}}function c(a){return k.test(a)&&parseFloat(a)>=0?!0:l.test(a)?!0:"0"===a||"-0"===a||"+0"===a?!0:!1}var e,f,g,h,i,j,k=/^(?:[+-]?[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?(?:ch|cm|em|ex|in|mm|pc|pt|px|rem|vh|vmin|vmax|vw)$/i,l=/^calc\((?:[0-9a-z \.\+\-\*\/\(\)]+)\)$/i;for(f=b(a),g=f.length,e=0;g>e;e++)if(h=f[e],i=h[h.length-1],c(i)){if(j=i,h.pop(),0===h.length)return j;if(h=h.join(" "),s.matchesMedia(h))return j}return"100vw"}b.createElement("picture");var o,p,q,r,s={},t=!1,u=function(){},v=b.createElement("img"),w=v.getAttribute,x=v.setAttribute,y=v.removeAttribute,z=b.documentElement,A={},B={algorithm:""},C="data-pfsrc",D=C+"set",E=navigator.userAgent,F=/rident/.test(E)||/ecko/.test(E)&&E.match(/rv\:(\d+)/)&&RegExp.$1>35,G="currentSrc",H=/\s+\+?\d+(e\d+)?w/,I=/(\([^)]+\))?\s*(.+)/,J=a.picturefillCFG,K="position:absolute;left:0;visibility:hidden;display:block;padding:0;border:none;font-size:1em;width:1em;overflow:hidden;clip:rect(0px, 0px, 0px, 0px)",L="font-size:100%!important;",M=!0,N={},O={},P=a.devicePixelRatio,Q={px:1,"in":96},R=b.createElement("a"),S=!1,T=/^[ \t\n\r\u000c]+/,U=/^[, \t\n\r\u000c]+/,V=/^[^ \t\n\r\u000c]+/,W=/[,]+$/,X=/^\d+$/,Y=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,Z=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c)},$=function(a){var b={};return function(c){return c in b||(b[c]=a(c)),b[c]}},_=function(){var a=/^([\d\.]+)(em|vw|px)$/,b=function(){for(var a=arguments,b=0,c=a[0];++b in a;)c=c.replace(a[b],a[++b]);return c},c=$(function(a){return"return "+b((a||"").toLowerCase(),/\band\b/g,"&&",/,/g,"||",/min-([a-z-\s]+):/g,"e.$1>=",/max-([a-z-\s]+):/g,"e.$1<=",/calc([^)]+)/g,"($1)",/(\d+[\.]*[\d]*)([a-z]+)/g,"($1 * e.$2)",/^(?!(e.[a-z]|[0-9\.&=|><\+\-\*\(\)\/])).*/gi,"")+";"});return function(b,d){var e;if(!(b in N))if(N[b]=!1,d&&(e=b.match(a)))N[b]=e[1]*Q[e[2]];else try{N[b]=new Function("e",c(b))(Q)}catch(f){}return N[b]}}(),aa=function(a,b){return a.w?(a.cWidth=s.calcListLength(b||"100vw"),a.res=a.w/a.cWidth):a.res=a.d,a},ba=function(a){if(t){var c,d,e,f=a||{};if(f.elements&&1===f.elements.nodeType&&("IMG"===f.elements.nodeName.toUpperCase()?f.elements=[f.elements]:(f.context=f.elements,f.elements=null)),c=f.elements||s.qsa(f.context||b,f.reevaluate||f.reselect?s.sel:s.selShort),e=c.length){for(s.setupRun(f),S=!0,d=0;e>d;d++)s.fillImg(c[d],f);s.teardownRun(f)}}};o=a.console&&console.warn?function(a){console.warn(a)}:u,G in v||(G="src"),A["image/jpeg"]=!0,A["image/gif"]=!0,A["image/png"]=!0,A["image/svg+xml"]=b.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"),s.ns=("pf"+(new Date).getTime()).substr(0,9),s.supSrcset="srcset"in v,s.supSizes="sizes"in v,s.supPicture=!!a.HTMLPictureElement,s.supSrcset&&s.supPicture&&!s.supSizes&&!function(a){v.srcset="data:,a",a.src="data:,a",s.supSrcset=v.complete===a.complete,s.supPicture=s.supSrcset&&s.supPicture}(b.createElement("img")),s.supSrcset&&!s.supSizes?!function(){var a="data:image/gif;base64,R0lGODlhAgABAPAAAP///wAAACH5BAAAAAAALAAAAAACAAEAAAICBAoAOw==",c="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",d=b.createElement("img"),e=function(){var a=d.width;2===a&&(s.supSizes=!0),q=s.supSrcset&&!s.supSizes,t=!0,setTimeout(ba)};d.onload=e,d.onerror=e,d.setAttribute("sizes","9px"),d.srcset=c+" 1w,"+a+" 9w",d.src=c}():t=!0,s.selShort="picture>img,img[srcset]",s.sel=s.selShort,s.cfg=B,s.DPR=P||1,s.u=Q,s.types=A,s.setSize=u,s.makeUrl=$(function(a){return R.href=a,R.href}),s.qsa=function(a,b){return"querySelector"in a?a.querySelectorAll(b):[]},s.matchesMedia=function(){return a.matchMedia&&(matchMedia("(min-width: 0.1em)")||{}).matches?s.matchesMedia=function(a){return!a||matchMedia(a).matches}:s.matchesMedia=s.mMQ,s.matchesMedia.apply(this,arguments)},s.mMQ=function(a){return a?_(a):!0},s.calcLength=function(a){var b=_(a,!0)||!1;return 0>b&&(b=!1),b},s.supportsType=function(a){return a?A[a]:!0},s.parseSize=$(function(a){var b=(a||"").match(I);return{media:b&&b[1],length:b&&b[2]}}),s.parseSet=function(a){return a.cands||(a.cands=m(a.srcset,a)),a.cands},s.getEmValue=function(){var a;if(!p&&(a=b.body)){var c=b.createElement("div"),d=z.style.cssText,e=a.style.cssText;c.style.cssText=K,z.style.cssText=L,a.style.cssText=L,a.appendChild(c),p=c.offsetWidth,a.removeChild(c),p=parseFloat(p,10),z.style.cssText=d,a.style.cssText=e}return p||16},s.calcListLength=function(a){if(!(a in O)||B.uT){var b=s.calcLength(n(a));O[a]=b?b:Q.width}return O[a]},s.setRes=function(a){var b;if(a){b=s.parseSet(a);for(var c=0,d=b.length;d>c;c++)aa(b[c],a.sizes)}return b},s.setRes.res=aa,s.applySetCandidate=function(a,b){if(a.length){var c,d,e,f,h,k,l,m,n,o=b[s.ns],p=s.DPR;if(k=o.curSrc||b[G],l=o.curCan||j(b,k,a[0].set),l&&l.set===a[0].set&&(n=F&&!b.complete&&l.res-.1>p,n||(l.cached=!0,l.res>=p&&(h=l))),!h)for(a.sort(i),f=a.length,h=a[f-1],d=0;f>d;d++)if(c=a[d],c.res>=p){e=d-1,h=a[e]&&(n||k!==s.makeUrl(c.url))&&g(a[e].res,c.res,p,a[e].cached)?a[e]:c;break}h&&(m=s.makeUrl(h.url),o.curSrc=m,o.curCan=h,m!==k&&s.setSrc(b,h),s.setSize(b))}},s.setSrc=function(a,b){var c;a.src=b.url,"image/svg+xml"===b.set.type&&(c=a.style.width,a.style.width=a.offsetWidth+1+"px",a.offsetWidth+1&&(a.style.width=c))},s.getSet=function(a){var b,c,d,e=!1,f=a[s.ns].sets;for(b=0;b<f.length&&!e;b++)if(c=f[b],c.srcset&&s.matchesMedia(c.media)&&(d=s.supportsType(c.type))){"pending"===d&&(c=d),e=c;break}return e},s.parseSets=function(a,b,d){var e,f,g,h,i=b&&"PICTURE"===b.nodeName.toUpperCase(),j=a[s.ns];(j.src===c||d.src)&&(j.src=w.call(a,"src"),j.src?x.call(a,C,j.src):y.call(a,C)),(j.srcset===c||d.srcset||!s.supSrcset||a.srcset)&&(e=w.call(a,"srcset"),j.srcset=e,h=!0),j.sets=[],i&&(j.pic=!0,l(b,j.sets)),j.srcset?(f={srcset:j.srcset,sizes:w.call(a,"sizes")},j.sets.push(f),g=(q||j.src)&&H.test(j.srcset||""),g||!j.src||k(j.src,f)||f.has1x||(f.srcset+=", "+j.src,f.cands.push({url:j.src,d:1,set:f}))):j.src&&j.sets.push({srcset:j.src,sizes:null}),j.curCan=null,j.curSrc=c,j.supported=!(i||f&&!s.supSrcset||g&&!s.supSizes),h&&s.supSrcset&&!j.supported&&(e?(x.call(a,D,e),a.srcset=""):y.call(a,D)),j.supported&&!j.srcset&&(!j.src&&a.src||a.src!==s.makeUrl(j.src))&&(null===j.src?a.removeAttribute("src"):a.src=j.src),j.parsed=!0},s.fillImg=function(a,b){var c,d=b.reselect||b.reevaluate;a[s.ns]||(a[s.ns]={}),c=a[s.ns],(d||c.evaled!==r)&&((!c.parsed||b.reevaluate)&&s.parseSets(a,a.parentNode,b),c.supported?c.evaled=r:h(a))},s.setupRun=function(){(!S||M||P!==a.devicePixelRatio)&&f()},s.supPicture?(ba=u,s.fillImg=u):!function(){var c,d=a.attachEvent?/d$|^c/:/d$|^c|^i/,e=function(){var a=b.readyState||"";f=setTimeout(e,"loading"===a?200:999),b.body&&(s.fillImgs(),c=c||d.test(a),c&&clearTimeout(f))},f=setTimeout(e,b.body?9:99),g=function(a,b){var c,d,e=function(){var f=new Date-d;b>f?c=setTimeout(e,b-f):(c=null,a())};return function(){d=new Date,c||(c=setTimeout(e,b))}},h=z.clientHeight,i=function(){M=Math.max(a.innerWidth||0,z.clientWidth)!==Q.width||z.clientHeight!==h,h=z.clientHeight,M&&s.fillImgs()};Z(a,"resize",g(i,99)),Z(b,"readystatechange",e)}(),s.picturefill=ba,s.fillImgs=ba,s.teardownRun=u,ba._=s,a.picturefillCFG={pf:s,push:function(a){var b=a.shift();"function"==typeof s[b]?s[b].apply(s,a):(B[b]=a[0],S&&s.fillImgs({reselect:!0}))}};for(;J&&J.length;)a.picturefillCFG.push(J.shift());a.picturefill=ba,"object"==typeof module&&"object"==typeof module.exports?module.exports=ba:"function"==typeof define&&define.amd&&define("picturefill",function(){return ba}),s.supPicture||(A["image/webp"]=e("image/webp","data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA=="))}(window,document);
/*!
 * headroom.js v0.9.3 - Give your page some headroom. Hide your header until you need it
 * Copyright (c) 2016 Nick Williams - http://wicky.nillia.ms/headroom.js
 * License: MIT
 */

(function(root, factory) {
  'use strict';

  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module.
    define([], factory);
  }
  else if (typeof exports === 'object') {
    // COMMONJS
    module.exports = factory();
  }
  else {
    // BROWSER
    root.Headroom = factory();
  }
}(this, function() {
  'use strict';

  /* exported features */
  
  var features = {
    bind : !!(function(){}.bind),
    classList : 'classList' in document.documentElement,
    rAF : !!(window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame)
  };
  window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;
  
  /**
   * Handles debouncing of events via requestAnimationFrame
   * @see http://www.html5rocks.com/en/tutorials/speed/animations/
   * @param {Function} callback The callback to handle whichever event
   */
  function Debouncer (callback) {
    this.callback = callback;
    this.ticking = false;
  }
  Debouncer.prototype = {
    constructor : Debouncer,
  
    /**
     * dispatches the event to the supplied callback
     * @private
     */
    update : function() {
      this.callback && this.callback();
      this.ticking = false;
    },
  
    /**
     * ensures events don't get stacked
     * @private
     */
    requestTick : function() {
      if(!this.ticking) {
        requestAnimationFrame(this.rafCallback || (this.rafCallback = this.update.bind(this)));
        this.ticking = true;
      }
    },
  
    /**
     * Attach this as the event listeners
     */
    handleEvent : function() {
      this.requestTick();
    }
  };
  /**
   * Check if object is part of the DOM
   * @constructor
   * @param {Object} obj element to check
   */
  function isDOMElement(obj) {
    return obj && typeof window !== 'undefined' && (obj === window || obj.nodeType);
  }
  
  /**
   * Helper function for extending objects
   */
  function extend (object /*, objectN ... */) {
    if(arguments.length <= 0) {
      throw new Error('Missing arguments in extend function');
    }
  
    var result = object || {},
        key,
        i;
  
    for (i = 1; i < arguments.length; i++) {
      var replacement = arguments[i] || {};
  
      for (key in replacement) {
        // Recurse into object except if the object is a DOM element
        if(typeof result[key] === 'object' && ! isDOMElement(result[key])) {
          result[key] = extend(result[key], replacement[key]);
        }
        else {
          result[key] = result[key] || replacement[key];
        }
      }
    }
  
    return result;
  }
  
  /**
   * Helper function for normalizing tolerance option to object format
   */
  function normalizeTolerance (t) {
    return t === Object(t) ? t : { down : t, up : t };
  }
  
  /**
   * UI enhancement for fixed headers.
   * Hides header when scrolling down
   * Shows header when scrolling up
   * @constructor
   * @param {DOMElement} elem the header element
   * @param {Object} options options for the widget
   */
  function Headroom (elem, options) {
    options = extend(options, Headroom.options);
  
    this.lastKnownScrollY = 0;
    this.elem             = elem;
    this.tolerance        = normalizeTolerance(options.tolerance);
    this.classes          = options.classes;
    this.offset           = options.offset;
    this.scroller         = options.scroller;
    this.initialised      = false;
    this.onPin            = options.onPin;
    this.onUnpin          = options.onUnpin;
    this.onTop            = options.onTop;
    this.onNotTop         = options.onNotTop;
    this.onBottom         = options.onBottom;
    this.onNotBottom      = options.onNotBottom;
  }
  Headroom.prototype = {
    constructor : Headroom,
  
    /**
     * Initialises the widget
     */
    init : function() {
      if(!Headroom.cutsTheMustard) {
        return;
      }
  
      this.debouncer = new Debouncer(this.update.bind(this));
      this.elem.classList.add(this.classes.initial);
  
      // defer event registration to handle browser 
      // potentially restoring previous scroll position
      setTimeout(this.attachEvent.bind(this), 100);
  
      return this;
    },
  
    /**
     * Unattaches events and removes any classes that were added
     */
    destroy : function() {
      var classes = this.classes;
  
      this.initialised = false;
      this.elem.classList.remove(classes.unpinned, classes.pinned, classes.top, classes.notTop, classes.initial);
      this.scroller.removeEventListener('scroll', this.debouncer, false);
    },
  
    /**
     * Attaches the scroll event
     * @private
     */
    attachEvent : function() {
      if(!this.initialised){
        this.lastKnownScrollY = this.getScrollY();
        this.initialised = true;
        this.scroller.addEventListener('scroll', this.debouncer, false);
  
        this.debouncer.handleEvent();
      }
    },
    
    /**
     * Unpins the header if it's currently pinned
     */
    unpin : function() {
      var classList = this.elem.classList,
        classes = this.classes;
      
      if(classList.contains(classes.pinned) || !classList.contains(classes.unpinned)) {
        classList.add(classes.unpinned);
        classList.remove(classes.pinned);
        this.onUnpin && this.onUnpin.call(this);
      }
    },
  
    /**
     * Pins the header if it's currently unpinned
     */
    pin : function() {
      var classList = this.elem.classList,
        classes = this.classes;
      
      if(classList.contains(classes.unpinned)) {
        classList.remove(classes.unpinned);
        classList.add(classes.pinned);
        this.onPin && this.onPin.call(this);
      }
    },
  
    /**
     * Handles the top states
     */
    top : function() {
      var classList = this.elem.classList,
        classes = this.classes;
      
      if(!classList.contains(classes.top)) {
        classList.add(classes.top);
        classList.remove(classes.notTop);
        this.onTop && this.onTop.call(this);
      }
    },
  
    /**
     * Handles the not top state
     */
    notTop : function() {
      var classList = this.elem.classList,
        classes = this.classes;
      
      if(!classList.contains(classes.notTop)) {
        classList.add(classes.notTop);
        classList.remove(classes.top);
        this.onNotTop && this.onNotTop.call(this);
      }
    },
  
    bottom : function() {
      var classList = this.elem.classList,
        classes = this.classes;
      
      if(!classList.contains(classes.bottom)) {
        classList.add(classes.bottom);
        classList.remove(classes.notBottom);
        this.onBottom && this.onBottom.call(this);
      }
    },
  
    /**
     * Handles the not top state
     */
    notBottom : function() {
      var classList = this.elem.classList,
        classes = this.classes;
      
      if(!classList.contains(classes.notBottom)) {
        classList.add(classes.notBottom);
        classList.remove(classes.bottom);
        this.onNotBottom && this.onNotBottom.call(this);
      }
    },
  
    /**
     * Gets the Y scroll position
     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window.scrollY
     * @return {Number} pixels the page has scrolled along the Y-axis
     */
    getScrollY : function() {
      return (this.scroller.pageYOffset !== undefined)
        ? this.scroller.pageYOffset
        : (this.scroller.scrollTop !== undefined)
          ? this.scroller.scrollTop
          : (document.documentElement || document.body.parentNode || document.body).scrollTop;
    },
  
    /**
     * Gets the height of the viewport
     * @see http://andylangton.co.uk/blog/development/get-viewport-size-width-and-height-javascript
     * @return {int} the height of the viewport in pixels
     */
    getViewportHeight : function () {
      return window.innerHeight
        || document.documentElement.clientHeight
        || document.body.clientHeight;
    },
  
    /**
     * Gets the physical height of the DOM element
     * @param  {Object}  elm the element to calculate the physical height of which
     * @return {int}     the physical height of the element in pixels
     */
    getElementPhysicalHeight : function (elm) {
      return Math.max(
        elm.offsetHeight,
        elm.clientHeight
      );
    },
  
    /**
     * Gets the physical height of the scroller element
     * @return {int} the physical height of the scroller element in pixels
     */
    getScrollerPhysicalHeight : function () {
      return (this.scroller === window || this.scroller === document.body)
        ? this.getViewportHeight()
        : this.getElementPhysicalHeight(this.scroller);
    },
  
    /**
     * Gets the height of the document
     * @see http://james.padolsey.com/javascript/get-document-height-cross-browser/
     * @return {int} the height of the document in pixels
     */
    getDocumentHeight : function () {
      var body = document.body,
        documentElement = document.documentElement;
    
      return Math.max(
        body.scrollHeight, documentElement.scrollHeight,
        body.offsetHeight, documentElement.offsetHeight,
        body.clientHeight, documentElement.clientHeight
      );
    },
  
    /**
     * Gets the height of the DOM element
     * @param  {Object}  elm the element to calculate the height of which
     * @return {int}     the height of the element in pixels
     */
    getElementHeight : function (elm) {
      return Math.max(
        elm.scrollHeight,
        elm.offsetHeight,
        elm.clientHeight
      );
    },
  
    /**
     * Gets the height of the scroller element
     * @return {int} the height of the scroller element in pixels
     */
    getScrollerHeight : function () {
      return (this.scroller === window || this.scroller === document.body)
        ? this.getDocumentHeight()
        : this.getElementHeight(this.scroller);
    },
  
    /**
     * determines if the scroll position is outside of document boundaries
     * @param  {int}  currentScrollY the current y scroll position
     * @return {bool} true if out of bounds, false otherwise
     */
    isOutOfBounds : function (currentScrollY) {
      var pastTop  = currentScrollY < 0,
        pastBottom = currentScrollY + this.getScrollerPhysicalHeight() > this.getScrollerHeight();
      
      return pastTop || pastBottom;
    },
  
    /**
     * determines if the tolerance has been exceeded
     * @param  {int} currentScrollY the current scroll y position
     * @return {bool} true if tolerance exceeded, false otherwise
     */
    toleranceExceeded : function (currentScrollY, direction) {
      return Math.abs(currentScrollY-this.lastKnownScrollY) >= this.tolerance[direction];
    },
  
    /**
     * determine if it is appropriate to unpin
     * @param  {int} currentScrollY the current y scroll position
     * @param  {bool} toleranceExceeded has the tolerance been exceeded?
     * @return {bool} true if should unpin, false otherwise
     */
    shouldUnpin : function (currentScrollY, toleranceExceeded) {
      var scrollingDown = currentScrollY > this.lastKnownScrollY,
        pastOffset = currentScrollY >= this.offset;
  
      return scrollingDown && pastOffset && toleranceExceeded;
    },
  
    /**
     * determine if it is appropriate to pin
     * @param  {int} currentScrollY the current y scroll position
     * @param  {bool} toleranceExceeded has the tolerance been exceeded?
     * @return {bool} true if should pin, false otherwise
     */
    shouldPin : function (currentScrollY, toleranceExceeded) {
      var scrollingUp  = currentScrollY < this.lastKnownScrollY,
        pastOffset = currentScrollY <= this.offset;
  
      return (scrollingUp && toleranceExceeded) || pastOffset;
    },
  
    /**
     * Handles updating the state of the widget
     */
    update : function() {
      var currentScrollY  = this.getScrollY(),
        scrollDirection = currentScrollY > this.lastKnownScrollY ? 'down' : 'up',
        toleranceExceeded = this.toleranceExceeded(currentScrollY, scrollDirection);
  
      if(this.isOutOfBounds(currentScrollY)) { // Ignore bouncy scrolling in OSX
        return;
      }
  
      if (currentScrollY <= this.offset ) {
        this.top();
      } else {
        this.notTop();
      }
  
      if(currentScrollY + this.getViewportHeight() >= this.getScrollerHeight()) {
        this.bottom();
      }
      else {
        this.notBottom();
      }
  
      if(this.shouldUnpin(currentScrollY, toleranceExceeded)) {
        this.unpin();
      }
      else if(this.shouldPin(currentScrollY, toleranceExceeded)) {
        this.pin();
      }
  
      this.lastKnownScrollY = currentScrollY;
    }
  };
  /**
   * Default options
   * @type {Object}
   */
  Headroom.options = {
    tolerance : {
      up : 0,
      down : 0
    },
    offset : 0,
    scroller: window,
    classes : {
      pinned : 'headroom--pinned',
      unpinned : 'headroom--unpinned',
      top : 'headroom--top',
      notTop : 'headroom--not-top',
      bottom : 'headroom--bottom',
      notBottom : 'headroom--not-bottom',
      initial : 'headroom'
    }
  };
  Headroom.cutsTheMustard = typeof features !== 'undefined' && features.rAF && features.bind && features.classList;

  return Headroom;
}));
(function($) {

  if(!$) {
    return;
  }

  ////////////
  // Plugin //
  ////////////

  $.fn.headroom = function(option) {
    return this.each(function() {
      var $this   = $(this),
        data      = $this.data('headroom'),
        options   = typeof option === 'object' && option;

      options = $.extend(true, {}, Headroom.options, options);

      if (!data) {
        data = new Headroom(this, options);
        data.init();
        $this.data('headroom', data);
      }
      if (typeof option === 'string') {
        data[option]();

        if(option === 'destroy'){
          $this.removeData('headroom');
        }
      }
    });
  };

  //////////////
  // Data API //
  //////////////

  $('[data-headroom]').each(function() {
    var $this = $(this);
    $this.headroom($this.data());
  });

}(window.Zepto || window.jQuery));
'use strict';

var APP = (window.APP = window.APP || {});

APP.core = {};

APP.core.controller = (function () {
    var _route = '';

    var _allowDuplicateRoutes = ['vueInstanceWrapper', 'choosePaymentMethod'];

    var _invokedRoutes = [];

    var setRoute = function (strVal) {
        _route = strVal;
    };

    var getRoute = function () {
        return _route;
    };

    var locateRoutableElementsInDOM = function (attribute) {
        var matchingElements = [];
        var allElements = document.getElementsByTagName('*');
        for (var i = 0, n = allElements.length; i < n; i++) {
            if (allElements[i].getAttribute(attribute) !== null) {
                // Element exists with attribute. Add to array.
                matchingElements.push(allElements[i]);
            }
        }
        // Sort array in descending order based on component initialization priority
        //Teaser-new component has the maximum priority of 100
        matchingElements.sort(function (a, b) {
            var a_priority = $(a).data('init-priority');
            var b_priority = $(b).data('init-priority');
            a_priority = a_priority ? parseInt(a_priority) : 0;
            b_priority = b_priority ? parseInt(b_priority) : 0;
            return b_priority - a_priority;
        });

        return matchingElements;
    };

    var executeRouteForElement = function (element) {
        var namespace = APP;
        var route = getRoute();
        var action = 'init';
        if (route !== '' && namespace[route] && typeof namespace[route][action] === 'function' && preventDuplicate(route)) {
            namespace[route][action](element, false);
            // console.log('APP.controller.init | APP.' + route + '.init() invoked');
        }
    };

    var preventDuplicate = function (test) {
        if (_invokedRoutes.indexOf(test) > -1) {
            return false;
        } else {
            if (_allowDuplicateRoutes.indexOf(test) == -1) {
                _invokedRoutes.push(test);
            }
            return true;
        }
    };

    var init = function () {
        var routes = locateRoutableElementsInDOM('data-action');

        for (var i = 0; i < routes.length; i++) {
            var element = routes[i];
            var routeName = element.getAttribute('data-action');
            setRoute(routeName);
            executeRouteForElement(element);
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.cookie = (function () {
    var cookies = {
        userInfo: null,
        userInfoMFA: null,
        partnerPromo: null,
        appleusinf: null,
    };

    var decryptCookies = function () {
        var deferred = new $.Deferred();

        APP.global.postFormData(
            '/bin/servlet/cval',
            null,
            function (response) {
                cookies.userInfo = response.usinf;
                cookies.userInfoMFA = response.usinfmfa;
                cookies.partnerPromo = response.ppromo;
                cookies.appleusinf = response.appleusinf;
                if (APP.login.isLoggedIn() && !cookies.userInfo) {
                    deferred.reject();
                    APP.session.logout();
                    alert('There is something wrong. Please sign-in again.');
                } else {
                    if (APP.login.isLoggedIn() && window.Cookies.get('registered_user')) {
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'sign_up',
                            'login_method' : getUserInfo().signinProvider === 'Apple' ? 'apple' : 'email',
                            'is_logged_in' : 'true'
                        });
                    }else if(APP.login.isLoggedIn() && !window.Cookies.get('signin_tagging')){
                        window.Cookies.set('signin_tagging', true, {
                            secure: APP.global.isSecureCookie(),
                        });
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'login',
                            'login_method' : getUserInfo().signinProvider === 'Apple' ? 'apple' : 'email',
                            'is_logged_in' : 'true'
                        });
                    }
                    deferred.resolve();
                }
            },
            function () {
                deferred.reject();
                APP.session.logout();
                alert('There is something wrong. Please sign-in again.');
            }
        );

        return deferred.promise();
    };

    var deleteCookie = function (cookieName) {
        return APP.global.postFormData(
            '/bin/servlet/rmcval',
            {
                cn: cookieName,
            },
            function (response) {
                console.log('cookie deleted');
            },
            function (err) {
                console.error(err);
            }
        );
    };

    var getUserInfo = function () {
        return JSON.parse(cookies.userInfo);
    };

    var getUserInfoMFA = function () {
        return JSON.parse(cookies.userInfoMFA);
    };

    var getPartnerPromo = function () {
        return JSON.parse(cookies.partnerPromo);
    };

    var getAppleUserInfo = function () {
        return JSON.parse(cookies.appleusinf);
    };

    var isDltPilotUser = function () {
        return window.Cookies.get('dlt_st') !== undefined ? true : false;
    };

    var isOneCardUser = function () {
        return getUserInfo().noOfDDCards == 1;
    };

    var init = function () {
        if (!APP.global.isEditMode()) {
            return decryptCookies();
        } else {
            return new $.Deferred().resolve();
        }
    };

    return {
        init: init,
        decryptCookies: decryptCookies,
        getUserInfo: getUserInfo,
        getUserInfoMFA: getUserInfoMFA,
        getPartnerPromo: getPartnerPromo,
        getAppleUserInfo: getAppleUserInfo,
        deleteCookie: deleteCookie,
        isDltPilotUser: isDltPilotUser,
        isOneCardUser: isOneCardUser,
    };
})();

'use strict';

/* global Parsley */

var APP = (window.APP = window.APP || {});

APP.global = (function () {
    var templates = {
        error: '' + "<div class='u-page-error'>{msg}</div>",
    };

    var loaderVisible = false;

    var resizeRouteList = [];

    var width = $(window).width();
    var height = $(window).height();

    var bindOnResize = function () {
        $(window).resize(function () {
            if ($(window).width() != width || $(window).height() != height) {
                clearTimeout($.data(this, 'resizeEvents'));
                $.data(
                    this,
                    'resizeEvents',
                    setTimeout(function () {
                        width = $(window).width();
                        height = $(window).height();
                        $.each(resizeRouteList, function () {
                            var route = this;
                            APP[route].bindOnResize();
                            // TODO: Remove log pre-production; keep for testing for now
                            // console.log( 'bindOnResize fired for: ' + this);
                        });
                    }, 200)
                );
            }
        });
    };
    var disableWCMmode = function () {
        // console.log('APP.global.disableWCMmode');
        $('a').each(function (idx) {
            var append;
            if ($(this).attr('href')) {
                if ($(this).attr('href').match('#')) {
                    append = $(this).attr('href');
                } else if ($(this).attr('href').indexOf('?') > -1) {
                    append = $(this).attr('href') + '&wcmmode=disabled';
                } else {
                    append = $(this).attr('href') + '?wcmmode=disabled';
                }
                $(this).attr('href', append);
            }
        });
    };

    var setMode = function () {
        // console.log('APP.global.setMode');
        if (APP.isEdit) {
            $('html').addClass('isEdit');
            console.log('set mode to edit');
        }
        if (APP.isDesign) {
            $('html').addClass('isDesign');
            console.log('set mode to design');
        }
        if (window.location.href.indexOf('wcmmode=disabled') > -1) {
            disableWCMmode();
        }
    };

    var initFormValidation = function () {
        $('.js-validate').parsley({
            inputs: Parsley.options.inputs + ',[data-parsley-telephone]',
        });
    };

    var bindEventsToUI = function () {
        // console.log('APP.global.bindEventsToUI');
        bindOnResize();
    };

    var initGlobalComponents = function () {};

    var initPageComponents = function () {
        APP.core.controller.init();
    };

    var toggleDataShowHide = function () {
        $('body').on('click', '[data-toggle]', function (e) {
            if (!$(this).parent().hasClass('js-has-toggle-event')) {
                if ($(this).is('a')) {
                    e.preventDefault();
                }

                var idsToShow = $(this).attr('data-toggle').split(',');
                var idToShow;

                for (var i = 0; i < idsToShow.length; i++) {
                    idToShow = '#' + idsToShow[i].trim();
                    //console.log(idToShow);
                    $(idToShow).slideToggle();
                }
            }
        });
    };

    var toggleDataShow = function () {
        $('body').on('click', '[data-show]', function (e) {
            if ($(this).is('a')) {
                e.preventDefault();
            }

            var idsToShow = $(this).attr('data-show').split(',');
            var idToShow;

            for (var i = 0; i < idsToShow.length; i++) {
                idToShow = '#' + idsToShow[i].trim();
                //console.log(idToShow);
                $(idToShow).slideDown();
            }
        });
    };

    var toggleDataHide = function () {
        $('body').on('click', '[data-hide]', function (e) {
            if ($(this).is('a')) {
                e.preventDefault();
            }

            var idsToShow = $(this).attr('data-hide').split(',');
            var idToShow;

            for (var i = 0; i < idsToShow.length; i++) {
                idToShow = '#' + idsToShow[i].trim();
                //console.log(idToShow);
                $(idToShow).slideUp();
            }
        });
    };

    var toggleDataByIndex = function () {
        $('body').on('change', '[data-toggle-index] select', function (e) {
            var selectedIndex = $(this).prop('selectedIndex');

            var selectedClass = '.' + $(this).parents('[data-toggle-index]').attr('data-toggle-index');
            var options = $(selectedClass);
            options.hide();
            options.eq(selectedIndex).show();
        });
    };

    var jumpScroll = function () {
        $('body').on('click', '.u-jump-to a[href^="#"], .u-back-to-top', function (e) {
            var $this = $(this);
            var anchor = $this.attr('href');
            var anchorPos = $(anchor).offset().top;

            e.preventDefault();

            $('html, body').animate(
                {
                    scrollTop: anchorPos,
                },
                600
            );
        });
    };

    var initializeSegmentedComponents = function () {
        //'target-dom-loaded' event is called By CQ clientlib on load of segmented component.
        $(window).on('target-dom-loaded', function (e) {
            var loadedElement = $(e.target);

            var components = $(loadedElement).find('[data-action]');
            for (var i = 0; i < components.length; i++) {
                var component = APP[components.eq(i).data('action')];
                if (component && component.init) {
                    component.init(components[i], true);
                }
            }
            initGlobalComponents(); // To enable dropdowns
            initFormValidation(); // To enable validation on segmented forms
            window.picturefill(); // To set the correct size of Image on page

            setTimeout(function () {
                // Hack to fix component overlap issue in segmented components.
                loadedElement.find('.campaign').removeAttr('style');
            }, 250);
            setTimeout(function () {
                $(window).scrollTop(0);
            }, 1000);

            APP.globalNav.bindFooterLogosAnalyticsEvents(); // add GTM tagging to partner logos
        });
    };

    var debounce = function (func, wait, immediate) {
        var timeout;
        return function () {
            var context = this,
                args = arguments;
            var later = function () {
                timeout = null;
                if (!immediate) {
                    func.apply(context, args);
                }
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) {
                func.apply(context, args);
            }
        };
    };

    var postFormData = function (actionURL, requestObject, successHandler, failureHandler) {
        showLoader();
        var request = $.ajax({
            url: actionURL,
            method: 'POST',
            data: requestObject,
        });
        request.done(successHandler);
        request.fail(failureHandler);
        request.always(function (jqXHR) {
            hideLoader();
        });

        return request;
    };

    var showLoader = function () {
        if (!loaderVisible) {
            var siteWrapper = $('.site-wrapper');
            var loader = $('<div class="ajax-loader js-ajax-loader">');
            siteWrapper.append(loader);
            loaderVisible = true;
        }
    };

    var hideLoader = function () {
        if ($.active == 0) {
            var siteWrapper = $('.site-wrapper');
            siteWrapper.find('.js-ajax-loader').remove();
            loaderVisible = false;
        }
    };

    var getErrorMsg = function (jqXHR, $selectedContainer) {
        removeError();
        var msg;
        if (typeof jqXHR === 'string') {
            msg = window.CQ.I18n.getMessage(jqXHR);
        } else {
            var response = JSON.parse(jqXHR.responseText);
            msg = response.error.message;
        }

        $selectedContainer.prepend(
            APP.registration.generateMarkup(templates.error, {
                msg: msg,
            })
        );

        this.focusError();

        return msg;
    };

    var removeError = function ($context) {
        if ($context) {
            $context.find('.u-page-error').remove();
        } else {
            $('.u-page-error').remove();
        }
    };

    var focusError = function () {
        var errorDiv = $('.u-page-error').first();
        var heightMenu = $('.global-nav').height();
        var scrollPos = errorDiv.offset().top - heightMenu - 10;
        //console.log(scrollPos);
        $(window).scrollTop(scrollPos);
    };

    var getURLParameter = function (name) {
        return (
            decodeURIComponent(
                (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')
            ) || null
        );
    };

    var getEncodedURLParameter = function (name) {
        return (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20') || null;
    };

    var removeURLParameter = function (key, url) {
        var oldUrl = url ? url : window.location.href,
            rtn = oldUrl.split('?')[0],
            param,
            params_arr = [],
            queryString = oldUrl.indexOf('?') !== -1 ? oldUrl.split('?')[1] : '';
        if (queryString !== '') {
            params_arr = queryString.split('&');
            for (var i = params_arr.length - 1; i >= 0; i -= 1) {
                param = params_arr[i].split('=')[0];
                if (param === key) {
                    params_arr.splice(i, 1);
                }
            }
            rtn = rtn + '?' + params_arr.join('&');
        }
        // if no more query params, remove the ?
        if (rtn.indexOf('?') + 1 === rtn.length) {
            rtn = rtn.substring(0, rtn.length - 1);
        }

        return rtn;
    };

    var isEditMode = function () {
        // if wcm cookie is set to 'edit' AND there is no 'disabled' query parameter, isEditMode is true
        if (window.Cookies.get('wcmmode') === 'edit' && getURLParameter('wcmmode') !== 'disabled') {
            console.log('isEditMode: true');
            return true;
        } else {
            console.log('isEditMode: false');
            return false;
        }
    };

    var isDebugMode = function () {
        return getURLParameter('debug') ? true : false;
    };

    var initAJAXSetup = function () {
        $.ajaxSetup({
            statusCode: {
                401: function (jqXHR, textStatus) {
                    var response = JSON.parse(jqXHR.responseText);
                    if (response.error && response.error.code === 'AUTH0001') {
                        window.location.reload();
                    }
                },
            },
        });
        $(document).ajaxStart(function () {
            showLoader();
        });
        $(document).ajaxStop(function () {
            hideLoader();
        });
    };

    //logType: log level to used (info, debug)
    // objectToLogged: json object to logged
    // message: text to add to the log
    var sendToLogger = function (logType, objectToLogged, message) {
        // log cases when order number was null
        $.ajax({
            url: '/bin/servlet/logger',
            type: 'POST',
            data: JSON.stringify({ logType: logType, data: objectToLogged, message: message }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                console.log('logged');
            },
        });
    };

    var createReferrerEntyInSessionStorage = function () {
        var currentPageUrl = window.location.href;
        $(window).on('beforeunload', function () {
            window.sessionStorage.setItem('page-referrer', currentPageUrl);
        });
    };

    var getPageReferrer = function () {
        var referrer = '';
        var referrerFromSS = window.sessionStorage.getItem('page-referrer');
        if (document.referrer) {
            referrer = document.referrer;
        } else if (referrerFromSS) {
            referrer = referrerFromSS;
        }

        return referrer;
    };

    var matchWords = function (subject, words) {
        var regexMetachars = /[(){[*+?.\\^$|]/g;

        for (var i = 0; i < words.length; i++) {
            words[i] = words[i].replace(regexMetachars, '\\$&');
        }

        var regex = new RegExp('\\b(?:' + words.join('|') + ')\\b', 'gi');

        return subject.match(regex) || [];
    };

    var matchPagePathNames = function (pathName, words) {
        var matchArr = [];
        for (var i = 0; i < words.length; i++) {
            if (pathName == words[i]) {
                matchArr.push(words[i]);
            } else {
                matchArr = matchArr.concat(matchWords(pathName, [words[i]]));
            }
        }

        return matchArr;
    };

    var clearCCPASessionOnOtherPage = function () {
        var currentPage = window.location.href;
        if (currentPage.indexOf('mfa') == -1 && !(currentPage.indexOf('consumer-rights') > -1 || currentPage.indexOf('do-not-sell') > -1)) {
            APP.formDoNotSellLoginRedirection.clearAllCCPASessionKeys();
        }
    };

    var isLocalHost = function () {
        return window.location.hostname == 'localhost';
    };

    var isProduction = function () {
        return window.location.hostname == 'www.dunkindonuts.com';
    };

    var isSecureCookie = function () {
        return !isLocalHost();
    };

    var isDunkinNation = function () {
        var host = window.location.hostname;
        if (host.indexOf('dunkinnation') != -1) {
            $('#main-content').addClass('dunkinnation');
        }
    };

    var navigateToLink = function (elem) {
        var $elem = $(elem);
        if ($elem.data('href')) {
            var url = $elem.data('href');
            var target = $elem.data('target');
            if ($elem.data('externallink')) {
                a = document.createElement('a');
                a.href = url;
                APP.interstitial.handleExternalLinks(null, a.href, a.host);
            } else {
                window.open(url, target);
            }
        }
    };

    var onEnterNavigateToLink = function (event, elem) {
        if (event.which == 13 || event.keyCode == 13) {
            event.preventDefault();
            navigateToLink(elem);
            return false;
        }
        return true;
    };

    var generateMarkupForCookie = function (template, data) {
        return template.replace(/{[^{}]+}/g, function (key) {
            return data[key.replace(/[{}]+/g, '')] || '';
        });
    };

    var vueComponentTransitionMixin = {
        data: function () {
            return {
                triggerTransition: 1,
            };
        },
        methods: {
            transitionBetweenScreens: function (callback, enableTransition) {
                var self = this;
                if (enableTransition) {
                    if (self.triggerTransition) {
                        self.triggerTransition--;
                        setTimeout(function () {
                            callback.call(self);
                            self.triggerTransition++;
                        }, 300);
                    }
                } else {
                    callback.call(self);
                }
            },
        },
    };

    var showDltEnrollmentModal = function(){
        if(APP.login.isLoggedIn() && !localStorage.getItem("dlt_enrollment_popup")){
            setTimeout(function(){
                localStorage.setItem("dlt_enrollment_popup", "true");
                APP.modal.showModal(null, $("#dlt_enrollment_popup"));
            }, 10000);
        }
    };

    var init = function () {
        showDltEnrollmentModal();

        isDunkinNation();
        /**
         * initialize global components
         */
        createReferrerEntyInSessionStorage();
        clearCCPASessionOnOtherPage();

        initGlobalComponents();

        /**
         * initialize components for the current page
         */
        initPageComponents();
        bindEventsToUI();
        setMode();
        jumpScroll();
        initFormValidation();

        toggleDataShowHide();
        toggleDataShow();
        toggleDataHide();
        toggleDataByIndex();

        initializeSegmentedComponents();

        APP.ada.init();
        APP.timeout.init();
        APP.googleMap.init();
        APP.registration.init();
        APP.session.init();

        $('body').addClass('body--ready');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        resizeRouteList: resizeRouteList,
        bindEventsToUI: bindEventsToUI,
        debounce: debounce,
        postFormData: postFormData,
        showLoader: showLoader,
        hideLoader: hideLoader,
        getErrorMsg: getErrorMsg,
        focusError: focusError,
        removeError: removeError,
        getURLParameter: getURLParameter,
        getEncodedURLParameter: getEncodedURLParameter,
        removeURLParameter: removeURLParameter,
        isEditMode: isEditMode,
        isDebugMode: isDebugMode,
        sendToLogger: sendToLogger,
        getPageReferrer: getPageReferrer,
        isLocalHost: isLocalHost,
        isProduction: isProduction,
        isSecureCookie: isSecureCookie,
        matchWords: matchWords,
        matchPagePathNames: matchPagePathNames,
        navigateToLink: navigateToLink,
        onEnterNavigateToLink: onEnterNavigateToLink,
        generateMarkupForCookie: generateMarkupForCookie,
        initAJAXSetup: initAJAXSetup,
        vueComponentTransitionMixin: vueComponentTransitionMixin,
    };
})();

APP.global.initAJAXSetup();

$(document).ready(function () {
    APP.cookie.init().done(function () {
        if (APP.login.isLoggedIn() && !window.Cookies.get('dlt_st')) {
            APP.loyaltyService.getLoyaltyProfile().done(function (response) {
                if (response.data.dltEnabled) {
                    window.Cookies.set('dlt_st', true, {
                        secure: APP.global.isSecureCookie(),
                    });
                    if (window.location.href.indexOf('perks-rewards') > -1) {
                        window.location.reload();
                    } else {
                        APP.global.init();
                    }
                } else {
                    APP.global.init();
                }
            });
        } else {
            APP.global.init();
        }
    });
});

$(window).on('load', function () {
    window.loaded = true;
    console.log('sprint-javelin');
});

// Avoid `console` errors in browsers that lack a console.
'use strict';
(function() {
    var method;
    var noop = function () {};
    var methods = [
        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
        'timeStamp', 'trace', 'warn'
    ];
    var length = methods.length;
    var console = (window.console = window.console || {});

    while (length--) {
        method = methods[length];

        // Only stub undefined methods.
        if (!console[method]) {
            console[method] = noop;
        }
    }
}());

'use strict';

/* global Cookie */

var APP = (window.APP = window.APP || {});

APP.formUtils = (function () {
    var toggleRequiredAttrForm = function ($form, excludedIDs) {
        var inputs = $form.find('input, select');
        var addAttr;

        for (var j = 0; j < inputs.length; j++) {
            addAttr = true;

            for (var i = 0; i < excludedIDs.length; i++) {
                if (excludedIDs[i] === inputs.eq(j).attr('id')) {
                    addAttr = false;
                }
            }

            if (addAttr) {
                toggleAttr(inputs.eq(j), 'required', true);
            }
        }
    };

    var toggleAttr = function ($input, attribute, value) {
        if ($input.attr(attribute) && $input.attr(attribute) === value) {
            $input.removeAttr(attribute);
        } else {
            $input.attr(attribute, value);
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        toggleRequiredAttrForm: toggleRequiredAttrForm,
    };
})();

/*
 * Date Utility for date/time operations
 * Author : Gaurav
 */
'use strict';

var APP = (window.APP = window.APP || {});

APP.dateUtils = (function () {
    var defaults = {
        weekdays: ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'],
        months: ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'],
    };

    var getCurrentDate = function () {
        var date = new Date();
        return date;
    };

    var getCurrentDay = function () {
        var currentDay = defaults.weekdays[this.getCurrentDayIndex()];
        return currentDay;
    };

    var getCurrentDayIndex = function () {
        var currentDayIndex = this.getCurrentDate().getDay();
        return currentDayIndex;
    };

    var getWeekDays = function () {
        return defaults.weekdays;
    };

    var getMonths = function () {
        return defaults.months;
    };

    var getMonthNumber = function (val) {
        var num = 0;
        for (var i = 0; i <= defaults.months.length; i++) {
            if (val === defaults.months[i]) {
                num = i + 1;
                break;
            }
        }
        return num > 0 ? num : 'undefined';
    };

    var convertMilitaryTimeToStdTime = function (militaryTime) {
        var standardTime = militaryTime;
        var hours, minutes;

        if (militaryTime && /\:/.test(militaryTime)) {
            hours = parseInt(militaryTime.split(/\:/)[0], 10);
            minutes = parseInt(militaryTime.split(/\:/)[1], 10);

            var dn = 'am';
            if (hours > 12) {
                dn = 'pm';
                hours = hours - 12;
            }
            if (hours === 12) {
                dn = 'pm';
            }

            if (hours === 0) {
                hours = 12;
            }

            if (minutes <= 9) {
                minutes = '0' + minutes;
            }

            standardTime = {
                hours: hours,
                minutes: minutes,
                dn: dn,
            };
        }

        return standardTime;
    };

    var ordinal_suffix_of = function (i) {
        var j = i % 10,
            k = i % 100;
        if (j === 1 && k !== 11) {
            return i + 'st';
        }
        if (j === 2 && k !== 12) {
            return i + 'nd';
        }
        if (j === 3 && k !== 13) {
            return i + 'rd';
        }
        return i + 'th';
    };

    var getStartAndEndDateOfMonth = function (y, m) {
        m = m - 1;
        var s_d_obj = new Date(y, m);
        var e_d_obj = new Date(new Date(y, m + 1) - 1);

        var s_y = s_d_obj.getFullYear();
        var s_m = s_d_obj.getMonth() + 1;
        s_m = s_m < 10 ? '0' + s_m : s_m;
        var s_d = s_d_obj.getDate();
        s_d = s_d < 10 ? '0' + s_d : s_d;

        var e_y = e_d_obj.getFullYear();
        var e_m = e_d_obj.getMonth() + 1;
        e_m = e_m < 10 ? '0' + e_m : e_m;
        var e_d = e_d_obj.getDate();
        e_d = e_d < 10 ? '0' + e_d : e_d;

        return {
            startDate: s_y + '-' + s_m + '-' + s_d,
            endDate: e_y + '-' + e_m + '-' + e_d,
        };
    };

    function LastDayOfMonth(Year, Month) {
        return new Date(new Date(Year, Month, 1) - 1);
    }

    /**
     * interfaces to public functions
     */
    return {
        getCurrentDate: getCurrentDate,
        getCurrentDayIndex: getCurrentDayIndex,
        getCurrentDay: getCurrentDay,
        getWeekDays: getWeekDays,
        getMonths: getMonths,
        getMonthNumber: getMonthNumber,
        convertMilitaryTimeToStdTime: convertMilitaryTimeToStdTime,
        ordinal_suffix_of: ordinal_suffix_of,
        getStartAndEndDateOfMonth: getStartAndEndDateOfMonth,
    };
})();

"use strict";

/* global Cookies */

var APP = (window.APP = window.APP || {});

APP.ada = (function () {
    var HIGH_CONTRAST_CLASS = "body--high-contrast";
    var IS_ACTIVE_CLASS = "is-active";
    var windowSizeLg = 1024;

    var getHighContrastMode = function () {
        return Cookies.get("high-contrast-mode") === "true";
    };

    var setHighContrastMode = function () {
        Cookies.set("high-contrast-mode", "true");
        $("body").addClass(HIGH_CONTRAST_CLASS);
    };

    var removeHighContrastMode = function () {
        Cookies.set("high-contrast-mode", "false");
        $("body").removeClass(HIGH_CONTRAST_CLASS);
    };

    var checkImageAlt = function () {
        $("img:not([alt])").attr("alt", "");
    };

    var bindEventsToUI = function () {
        $(".utility-bar__toggles").on("click", function (e) {
            var isHighContrastMode = $(this).find("input").prop("checked");
            if (isHighContrastMode) {
                setHighContrastMode();
            } else {
                removeHighContrastMode();
            }
        });

        $(".js-contrast-toggle").on("click", function (e) {
            e.preventDefault();
            $("body").toggleClass(HIGH_CONTRAST_CLASS);
        });

        $(".js-skip-to-content").click(function (e) {
            e.preventDefault();
            $("#main-content").focus();
        });

        if (getHighContrastMode()) {
            setHighContrastMode();
        }

        if ($(window).width() >= windowSizeLg) {
            $(".js-global-nav-link").attr("aria-haspopup", true);
        }
    };

    var init = function () {
        // console.log('APP.ada');
        bindEventsToUI();
        checkImageAlt();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        getHighContrastMode: getHighContrastMode,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.login = (function () {
    var bindEventsToUI = function () {};

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('login'); */
    };

    var isLoggedIn = function () {
        return window.Cookies.get('lg_st') !== undefined ? true : false;
    };

    var isEmailOnly = function () {
        return false;
    };

    var isDDPerksUser = function () {
        var userInfoJSON = getUserInfo();
        if (userInfoJSON) {
            return getUserInfo().perksUser;
        } else {
            return false;
        }
    };

    var getUserInfo = function () {
        return APP.cookie.getUserInfo();
    };

    var init = function (element) {
        // console.log('APP.login');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('login');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        isLoggedIn: isLoggedIn,
        isEmailOnly: isEmailOnly,
        isDDPerksUser: isDDPerksUser,
        getUserInfo: getUserInfo,
    };
})();

/*
 * General Utility for session or local storage
 * Author : Divya/Gaurav
 */
'use strict';

var APP = window.APP = window.APP || {};


APP.storage = (function () {

    var storage = localStorage;

    /**
     * gets the string from the local storage
     * @param   {string}  key 
     * @returns {string} value
     */
    var getAsString = function (key) {
        return storage.getItem(key);
    };

    /**
     * gets the JSON object from the string value in storage
     * @param   {string}   key
     * @returns {JSON object}
     */
    var get = function (key) {
        try {
            return JSON.parse(localStorage.getItem(key));
        } catch (e) {
            return localStorage.getItem(key);
        }
    };

    /**
     * sets the string value, fetched from the JSON object, in storage
     * @param   {string}   key
     * @param   {JSON object}   value
     * @returns {boolean} 
     */
    var set = function (key, value) {
        if (typeof value === 'object') {
            storage.setItem(key, JSON.stringify(value));
        } else {
            storage.setItem(key, value);
        }
        return true;
    };

    /**
     * checks if key is present in storage
     * @param {string} key 
     */
    var hasKey = function (key) {
        if (key in storage) {
            return true;
        } else {
            return false;
        }
    };
    
    var removeKey = function (key) {
        storage.removeItem(key);
    };

    /**
     * [[Description]]
     */
    var isEmpty = function () {

    };

    /**
     * interfaces to public functions
     */
    return {
        get: get,
        set: set,
        getAsString: getAsString,
        hasKey: hasKey,
        isEmpty: isEmpty,
        remove: removeKey
    };

}());

$(document).ready(APP.storage.init);

 'use strict';

var APP = window.APP = window.APP || {};

APP.geolocation = (function() {

    var geoposition;
    var deferred = new $.Deferred();
    var options = {
        maximumAge: 1000,
        timeout: 15000,
        enableHighAccuracy: true
    };

    var _onSuccess = function(position) {
        //console.log('DEVICE POSITION');
        //console.log('LAT: ' + position.coords.latitude + ' - LON: ' +  position.coords.longitude);
        geoposition = position;
        deferred.resolve(geoposition);
    };

    var _onError = function (error) {
        console.log(error);
        deferred.reject(error);
    };

    var _getLocation = function () {
        navigator.geolocation.getCurrentPosition(
            _onSuccess.bind(this),
            _onError.bind(this), 
            options
        );
        return deferred.promise();
    };

    return {
        location: _getLocation
    };
}());
'usestrict';
var APP = (window.APP = window.APP || {});
APP.googleMap = (function () {
    var defaults = {
        servletUrl: '/bin/servlet/dsl',
        serviceName: {
            DSL: 'DSL',
            MAP_CONFIG: 'GOOGLE_MAP_CONFIG',
        },
        storageKey: 'google-map-config',
        requestPayload: function (service, location, radius, maxMatches) {
            this.service = service;
            this.origin = location ? location.lat + ',' + location.lng : null;
            this.radius = radius;
            this.maxMatches = maxMatches;
            this.pageSize = 1;
            this.units = 'm';
            this.ambiguities = 'ignore';
        },
        map: null,
        geocoder: null,
        markersArray: [],
        mapContainerSelector: '#stores-map',
        location: {
            city: '',
            state: '',
            postal: '',
            dma_cd: '',
            lat: '',
            lng: '',
        },
    };
    var dmaCookie = {
        name: 'DMA',
        delimiter: ':',
        template: '{city}:{state}:{postal}:{dma_cd}:{lat}:{lng}',
        expiry: 1, //days,
        security: APP.global.isSecureCookie(),
    };
    var isMapReady = new $.Deferred();

    var getMapConfig = function () {
        var deferred = new $.Deferred();
        var isConfigAvailable = defaults.storageKey in sessionStorage;
        if (isConfigAvailable) {
            deferred.resolve(JSON.parse(sessionStorage.getItem(defaults.storageKey)));
        } else {
            var payload = new defaults.requestPayload(defaults.serviceName.MAP_CONFIG, null, null, null);
            $.ajax({
                url: defaults.servletUrl,
                method: 'POST',
                data: payload,
            })
                .done(function (response) {
                    response = response.data;
                    sessionStorage.setItem(defaults.storageKey, JSON.stringify(response));
                    deferred.resolve(response);
                })
                .fail(function (error) {
                    deferred.reject(error);
                    console.error(error);
                });
        }
        return deferred.promise();
    };
    var isValidZipCode = function (zipCode) {
        var deferred = new $.Deferred();
        isMapReady.done(function (config) {
            defaults.geocoder.geocode(
                {
                    componentRestrictions: {
                        country: 'US',
                        postalCode: zipCode,
                    },
                },
                function (results, status) {
                    if (status == 'OK') {
                        deferred.resolve();
                    } else {
                        deferred.reject();
                    }
                }
            );
        });
        return deferred.promise();
    };
    var isCaliforniaZipCode = function(zipCode){
        var deferred = new $.Deferred();
        isMapReady.done(function (config) {
            defaults.geocoder.geocode(
                {
                    componentRestrictions: {
                        country: 'US',
                        postalCode: zipCode,
                        administrativeArea: "California"
                    },
                },
                function (results, status) {
                    if (status == 'OK') {
                        deferred.resolve();
                    } else {
                        deferred.reject();
                    }
                }
            );
        });
        return deferred.promise();
    };
    var getLocationByIP = function () {
        var deferred = new $.Deferred();
        isMapReady.done(function (config) {
            var paramObj = {
                key: config.ApiKey,
            };
            $.ajax({
                url: config.geoLocationApiUrl + '?' + $.param(paramObj),
                method: 'POST',
            })
                .done(function (response) {
                    if (response.error) {
                        deferred.reject(response.error);
                        console.error(response.error);
                    } else {
                        deferred.resolve(response.location);
                    }
                })
                .fail(function (error) {
                    deferred.reject(error);
                    console.error(error);
                });
        });
        return deferred.promise();
    };
    var getLocationByAddress = function (searchTerm) {
        var deferred = new $.Deferred();
        isMapReady.done(function (config) {
            defaults.geocoder
                .geocode({ address: searchTerm })
                .then(function (response) {
                    deferred.resolve(response.results[0].geometry.location);
                })
                .catch(function (e) {
                    deferred.reject(e);
                    console.error('Geocode was not successful for the following reason: ' + e);
                });
        });
        return deferred.promise();
    };
    var getStoreDataFromDSL = function (deferred, location, radius, maxMatches) {
        var payload = new defaults.requestPayload(defaults.serviceName.DSL, location, radius, maxMatches);

        $.ajax({
            url: defaults.servletUrl,
            method: 'POST',
            data: payload,
        })
            .done(function (response) {
                response = response.data;
                if (response.errorCode) {
                    deferred.reject(response);
                    console.error(response);
                } else {
                    deferred.resolve(response);
                }
            })
            .fail(function (error) {
                deferred.reject(error);
                console.error(error);
            });
        return deferred.promise();
    };
    var getStoreAttributesAndCreateDMA = function (location) {
        var maxMatches = 1;
        var radius = 200;

        getStoreDataFromDSL(new $.Deferred(), location, radius, maxMatches)
            .done(function (response) {
                if (response.storeAttributes && response.storeAttributes.length > 0) {
                    locationDetails = response.storeAttributes[0];
                } else {
                    locationDetails = defaults.location;
                }
            })
            .fail(function () {
                locationDetails = defaults.location;
            })
            .always(function () {
                createDMACookie(locationDetails);
            });
    };
    var initializeGoogleMap = function () {
        var $storesMapElem = $(defaults.mapContainerSelector);
        defaults.geocoder = new google.maps.Geocoder();
        if ($storesMapElem.length) {
            defaults.map = new google.maps.Map($storesMapElem[0]);
            google.maps.Map.prototype.clearMarkers = function () {
                for (var i = 0; i < defaults.markersArray.length; i++) {
                    defaults.markersArray[i].setMap(null);
                }
                defaults.markersArray.length = 0;
            };
        }
    };
    var geocodeStoreMapMarkers = function (start, end, filteredStores) {
        isMapReady.done(function (config) {
            defaults.map.clearMarkers();
            var icon = {
                path: 'M141.723,78.786A18.213,18.213,0,0,0,123.509,97c0,15.611,18.214,29.6,18.214,29.6s18.214-13.986,18.214-29.6A18.214,18.214,0,0,0,141.723,78.786Z',
                scale: 1,
                fillColor: '#c63663',
                strokeWeight: 0,
                fillOpacity: 1,
                anchor: new google.maps.Point(143, 132),
                labelOrigin: new google.maps.Point(142, 100),
            };
            var latlngbounds = new google.maps.LatLngBounds();
            for (var i = start; i < end; i++) {
                var latLng = {
                    lat: parseFloat(filteredStores[i].lat),
                    lng: parseFloat(filteredStores[i].lng),
                };
                latlngbounds.extend(latLng);
                var marker = new google.maps.Marker({
                    position: latLng,
                    map: defaults.map,
                    label: {
                        text: (i + 1).toString(),
                        color: 'white',
                        fontWeight: 'bold',
                        fontSize: '20px',
                    },
                    icon: icon,
                });
                marker.set('recordId', filteredStores[i].recordId);
                marker.addListener('click', function (e) {
                    scrollToStore(this.get('recordId'));
                });
                defaults.markersArray.push(marker);
            }
            defaults.map.fitBounds(latlngbounds);
            if(filteredStores.length == 1){
                defaults.map.setZoom(17);
            }
        });
    };
    var scrollToStore = function (storeId) {
        var $store = $('#' + storeId);
        if ($(window).width() > 1024) {
            // Adding 3px to hide the top border in store items
            var adjustScrollPos = APP.storeItem.isStoreSearchResult() ? 3 : 0;
            $('body, html').animate(
                { scrollTop: $store.offset().top - $('.js-global-nav').height() - $('.location-search').height() + adjustScrollPos },
                400
            );
        } else {
            $('body, html').animate({ scrollTop: $store.offset().top - $('.js-global-nav').height() }, 400);
        }
    };
    var getLocationDetails = function (location) {
        if (!dmaCookieExists()) {
            if (location) {
                defaults.location.lat = location.lat;
                defaults.location.lng = location.lng;
                getStoreAttributesAndCreateDMA(location);
            } else {
                getLocationByIP().done(function (location) {
                    defaults.location.lat = location.lat;
                    defaults.location.lng = location.lng;
                    getStoreAttributesAndCreateDMA(location);
                });
            }
        }
    };
    var dmaCookieExists = function () {
        return window.Cookies.get(dmaCookie.name) ? true : false;
    };
    var createDMACookie = function (locationDetails) {
        var cookieString = APP.global.generateMarkupForCookie(dmaCookie.template, locationDetails);

        window.Cookies.set(dmaCookie.name, cookieString, {
            expires: dmaCookie.expiry,
            secure: dmaCookie.security,
        });

        $(window).trigger('dma-created');
    };
    var init = function () {
        var $body = $('body');

        isMapReady.done(function (config) {
            if (!$body.data('avoid-geolocation')) {
                if (!dmaCookieExists()) {
                    APP.geolocation
                        .location()
                        .then(function (origin) {
                            var location = {
                                lat: origin.coords.latitude,
                                lng: origin.coords.longitude,
                            };
                            getLocationDetails(location);
                        })
                        .fail(function () {
                            getLocationDetails(null);
                        });
                }
            }
        });

        if (!APP.global.isEditMode()) {
            getMapConfig().done(function (config) {
                $.getScript(config.googleMapJsLibraryUrl + '?key=' + config.ApiKey).done(function () {
                    initializeGoogleMap();
                    isMapReady.resolve(config);
                });
            });
        }
    };

    return {
        init: init,
        getLocationDetailsToCreateDMA: getStoreAttributesAndCreateDMA,
        getStoreDataFromDSL: getStoreDataFromDSL,
        getLocationByAddress: getLocationByAddress,
        geocodeStoreMapMarkers: geocodeStoreMapMarkers,
        getLocationByIP: getLocationByIP,
        dmaCookieExists: dmaCookieExists,
        isValidZipCode: isValidZipCode,
        isCaliforniaZipCode: isCaliforniaZipCode
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.timeout = (function () {
    var timerWorker;
    var authenticateURLPattern = '';
    var logoutURL = '/bin/servlet/signin';
    var redirectURL = '/';
    var timeOutInterval = 600;
    var redirectLoggedEnabled = false;
    var siteHomepage = '/';
    var perksURL = '/';
    var nonPerksURL = '/';

    var logoutSuccess = function (msg) {
        if (msg.data) {
            window.alert(window.CQ.I18n.getMessage('idle_timeout_msg'));
            window.location.href = redirectURL;
            Cookies.remove('registered_user');
        } else {
            logoutFailure();
        }
    };

    var logoutFailure = function () {
        console.log('Logout failure.');
    };

    var logout = function () {
        APP.global.postFormData(
            logoutURL,
            {
                service: 'logout',
            },
            APP.timeout.logoutSuccess,
            APP.timeout.logoutFailure
        );
    };

    var exit = function () {
        timerWorker.terminate();
        $(document).off('mousemove keypress click dblclick', resetWorker);
        logout();
        APP.session.clear();
    };

    var stopWorker = function (e) {
        if (e.data) {
            exit();
        }
    };

    var startWorker = function () {
        timerWorker = new Worker('/etc/designs/dd/scripts/workers/timeout-worker.js');
        timerWorker.postMessage({
            action: 'start',
            interval: timeOutInterval,
        });
    };

    var resetWorker = function () {
        timerWorker.postMessage({
            action: 'reset',
        });
    };

    var initIdleTimeout = function () {
        startWorker();
        $(document).on('mousemove keypress click dblclick', resetWorker);
        timerWorker.onmessage = stopWorker;
    };

    var validateLoggerUserRedirect = function () {
        redirectLoggedEnabled = $('#redirectLoggedEnabled').val() === 'true' || redirectLoggedEnabled;
        siteHomepage = $('#siteHomepage').val() || siteHomepage;
        perksURL = $('#perksDashboardPage').val();
        nonPerksURL = $('#nonPerksDashboardPage').val();
        var currentURL =
            window.location.pathname.indexOf('.') > 0
                ? window.location.pathname.substring(0, window.location.pathname.indexOf('.'))
                : window.location.pathname;
        var validRegExpURL = new RegExp(currentURL + '$');
        var isValidURL = validRegExpURL.test(siteHomepage);

        if (redirectLoggedEnabled && isValidURL) {
            if (APP.login.isDDPerksUser()) {
                window.location.href = perksURL;
            } else {
                window.location.href = nonPerksURL;
            }
        }
        return;
    };

    //Initialize
    var init = function () {
        // console.log('APP.Timeout');
        if (window.Worker === undefined) {
            console.log("Browser doesn't support Web Workers!");
            return;
        }
        authenticateURLPattern = $('#securePath').val() || authenticateURLPattern;
        redirectURL = $('#logoutURL').val() || redirectURL;
        timeOutInterval = $('#idleTimeOut').val() || timeOutInterval;

        if (window.Cookies.get('wcmmode') !== 'edit') {
            // Should not work on author mode
            var currentURL = window.location.href;
            var validRegExpURL = new RegExp(authenticateURLPattern);
            var isValidURL = validRegExpURL.test(currentURL);

            if (APP.login.isLoggedIn()) {
                // Validate if loogged in users need to be redirected to dashboard
                validateLoggerUserRedirect();

                initIdleTimeout();
            }
            if (isValidURL && !APP.login.isLoggedIn()) {
                window.location.href = redirectURL;
            }
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        logoutSuccess: logoutSuccess,
        logoutFailure: logoutFailure,
        initIdleTimeout: initIdleTimeout,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.registration = (function () {
    
    var state = 0;
    var cardBalance = 0;
    var orderNo = 0;
    var statesTraversed = [];
    var registrationSteps = [
        {
            component: 'formRegistration',
            selector: '.js-form-registration'
        },
        {
            component: 'formAddCard',
            selector: '.js-form-add-card'
        },
        {
            component: 'formAddExistingCard',
            selector: '.js-form-add-existing-card'
        },
        {
            component: 'formRegAddAmount',
            selector: '.js-reg-add-amount-form'
        },
        {
            component: 'formRegPayment',
            selector: '.js-reg-payment-form'
        },
        {
            component: 'formDoubleCheck',
            selector: '.js-form-double-check'
        }
    ];
    var creditCardTypes = {
        amex: ['AMEX', 'amex.png'],
        discover: ['DISC', 'discover.png'],
        jcb: ['JCB', 'jcb.png'],
        mastercard: ['MC', 'mastercard.png'],
        master: ['MC', 'mastercard.png'],
        visa: ['VISA', 'visa.png']
    };
    var dinersCard = 'diners_club_carte_blanche';
    var dinersInternationalCard = 'diners_club_international';
    creditCardTypes[dinersCard] = ['DINERSCLUB', 'dinersclub.png'];
    creditCardTypes[dinersInternationalCard] = ['DINERSCLUB', 'dinersclub.png'];
    var months = [
        ['jan', 'January'],
        ['feb', 'February'],
        ['mar', 'March'],
        ['apr', 'April'],
        ['may', 'May'],
        ['jun', 'June'],
        ['jul', 'July'],
        ['aug', 'August'],
        ['sep', 'September'], 
        ['oct', 'October'], 
        ['nov', 'November'], 
        ['dec', 'December']
    ];
    months.indexOf = function (key) {
        var $this = $(this);
        var length = $this.length;
        for (var i = 0; i<length; i++) {
            if($this[i][0] === key) {
                return i;
            }
        }
        return -1;
    };
    var isVisaCheckoutFlow = false;
    var isVisaCheckoutEdit = false;
    var isMasterpassFlow = false;
    var templates = {
        error: '' +
            '<div class=\'u-page-error\'>{msg}</div>'
    };
    var $window;
    var $exitModal;
    var $progressIcons;
    var registrationWrapper = '.js-registration-wrapper';
    var registrationDetails = {
    	    profile : {},
    	    creditcard : {},
    		enrollmentType : '',
            skip: false,
    		ddCard : {},
    		recharge : {},
    		autoRecharge : {}
    };
    var profileAddressId = '';
    
    var updateProgressBar = function (newState) {
        if(newState === 0) {
            $progressIcons.eq(0).addClass('is-active');
            $progressIcons.eq(1).removeClass('is-active');
            $progressIcons.eq(2).removeClass('is-active');
        }
        else if(newState === 1 || newState === 2 || newState === 3) {
            $progressIcons.eq(0).addClass('is-active');
            $progressIcons.eq(1).addClass('is-active');
            $progressIcons.eq(2).removeClass('is-active');
        }
        else {
            $progressIcons.eq(0).addClass('is-active');
            $progressIcons.eq(1).addClass('is-active');
            $progressIcons.eq(2).addClass('is-active');
        }
    };
    
    var changeState = function (newState) {
        $(registrationSteps[state].selector)
        .parents(registrationWrapper)
        .hide();
        $(registrationSteps[newState].selector)
        .parents(registrationWrapper)
        .show();
        updateProgressBar(newState);
        $(window).scrollTop(0);
        state = newState;
        if(APP[registrationSteps[state].component].onComponentShow) {
            APP[registrationSteps[state].component].onComponentShow(registrationDetails);
        }
    };
    
    var nextState = function (skipOneStep) {
        if(skipOneStep) {
            statesTraversed.push(state + 2);
            changeState(state + 2); //From add card screen to directly new card screen skipping add existing card.
        }
        else {
            statesTraversed.push(state + 1);
            changeState(state + 1);
        }
    };
    
    var previousState = function (e) {
        e.preventDefault();
        if(statesTraversed.length > 1) {
            statesTraversed.pop();
            changeState(statesTraversed.slice(-1)[0]);
        }
        else {
            handleRegistartionExit();
        }
    };
    
    var goToState = function(targetState) {
        while(state !== targetState && statesTraversed.length > 0) { 
            var tempState = statesTraversed.pop();
            state = statesTraversed.slice(-1)[0];
            $(registrationSteps[tempState].selector)
            .parents(registrationWrapper)
            .hide();
        }
        
        // if hide all elements and state is still different than target, then set state = target
        if(state !== targetState && statesTraversed.length === 0) {
        		state = targetState;
        }
        
        $(registrationSteps[state].selector)
            .parents(registrationWrapper)
            .show();
        updateProgressBar(targetState);
        $(window).scrollTop(0);
        if(APP[registrationSteps[state].component].onComponentShow) {
            APP[registrationSteps[state].component].onComponentShow(registrationDetails);
        }
    };
    
    var handleRegistartionExit = function () {
        $exitModal.show(0).addClass('modal--show');
    };
    
    var backButtonHandler = function (e) {
        var dialogText = window.CQ.I18n.getMessage('back-button-alert');
        e.returnValue = dialogText;
        return dialogText;
    };
    
    var generateMarkup = function (template, data) {
        return template.replace(/{[^{}]+}/g, function (key) {
            return data[key.replace(/[{}]+/g, '')] || '';
        });
    };
    
    var showError = function (msg) {
        removeErrors();
        $(registrationSteps[state].selector).prepend(generateMarkup(templates.error, {
            msg: msg
        }));
        APP.global.focusError();
    };
    
    var removeErrors = function () {
        $(registrationSteps[state].selector)
            .find('.u-page-error')
            .remove();
    };
    
    var setCardBalance = function (balance) {
        cardBalance = balance;
    };
    
    var getCardBalance = function (balance) {
        return cardBalance;
    };
    
    var updateRegistrationDetails = function (updateObj) {
        $.extend(registrationDetails, updateObj);
    };
    
    var getCardType = function (cardNumber) {
        return $('<input>').attr({
                type: 'number',
                value: cardNumber
            }).validateCreditCard();
    };
    
    var visaCheckoutSuccess = function (data, payment) {
        var cardObject = getCardType(data.paymentInstrument.accountNumber);
        var cardObjectProperty = 'card_type';
        var cardType = creditCardTypes[cardObject[cardObjectProperty].name][0];
        
        updateRegistrationDetails({
            creditcard : {
                cardNumber: data.paymentInstrument.accountNumber,
                type : cardType,
                cardSecurityCode : '',
                expMonth : data.paymentInstrument.expirationDate.month,
                expYear : data.paymentInstrument.expirationDate.year,
                walletType : 'VISA',
                vcoUserId : data.userData.encUserId,
                referenceCallId : payment.callid,
                address :{
                    firstName : data.paymentInstrument.billingAddress.firstName,
                    lastName : data.paymentInstrument.billingAddress.lastName,
                    firstStreet: data.paymentInstrument.billingAddress.line1,
                    secondStreet: '',
                    city : data.paymentInstrument.billingAddress.city,
                    state : data.paymentInstrument.billingAddress.stateProvinceCode,
                    country : data.paymentInstrument.billingAddress.countryCode,
                    zipCode5 : data.paymentInstrument.billingAddress.postalCode
                }
            }
        });
        isVisaCheckoutFlow = true;
        if(isVisaCheckoutEdit) {
            APP.formDoubleCheck.onComponentShow(registrationDetails);
            isVisaCheckoutEdit = false;
        }
        else {
            nextState();   
        }
        APP.global.hideLoader();
    };
    
    var visaCheckoutFailure = function (payment, error) {
        isVisaCheckoutEdit = false;
        APP.registration.showError(window.CQ.I18n.getMessage('registration.visaCheckoutFailure'));
        APP.global.hideLoader();
    };
    
    var walletCancelHandler = function () {
        isVisaCheckoutEdit = false;
        isMasterpassFlow = false;
        APP.global.hideLoader();
    };

    var masterpassSuccessHandler = function(mpResponse) {
        //console.log(mpResponse);
        APP.masterpass.getCreditCardDetails(mpResponse.oauth_token, mpResponse.oauth_verifier, mpResponse.checkout_resource_url)
        .then(function(response) {
        	var recipientNameArray = response.data.personalInfo.recipientName.split(' ');
            var firstName;
        	var lastName;
        	
        	if (recipientNameArray.length === 2) {
        		firstName = recipientNameArray[0];
        		lastName = recipientNameArray[1];
        	} else if (recipientNameArray.length === 3) {
        		firstName = recipientNameArray[0] + ' ' + recipientNameArray[1];
        		lastName = recipientNameArray[2];
        	} else if (recipientNameArray.length === 4) {
        		firstName = recipientNameArray[0] + ' ' + recipientNameArray[1];
        		lastName = recipientNameArray[2] + ' ' + recipientNameArray[3];
        	}
        	
            updateRegistrationDetails({
                creditcard : {
                    cardNumber: response.data.card.accountNumber,
                    encryptedCCId: '',
                    type : creditCardTypes[response.data.card.brandId][0],
                    expMonth : response.data.card.expiryMonth,
                    expYear : response.data.card.expiryYear,
                    cardSecurityCode: '',
                    walletType : 'MC',
                    walletId : response.data.walletID,
                    vcoUserId : response.data.personalInfo.recipientEmailAddress,
                    referenceCallId : mpResponse.oauth_token,
                    address : {
                        encryptedAddressId: '',
                        firstStreet: response.data.card.billingAddress.line1,
                        secondStreet: '',
                        city : response.data.card.billingAddress.city,
                        state : response.data.card.billingAddress.subdivision.split('-')[1],
                        zipCode5 : response.data.card.billingAddress.postalCode,
                        firstName: firstName,
                        lastName: lastName
                    }
                }
            });

            nextState();
            APP.formDoubleCheck.onComponentShow(registrationDetails);
            APP.global.hideLoader();

        });
    };
    
    var masterpassFailureHandler = function(response) {
        console.log('Failure: ' + JSON.stringify(response));
        var msg = window.CQ.I18n.getMessage('Masterpass_Failure'); 
        APP.global.hideLoader();
    };
    
    var editForm = function (e) {
        e.preventDefault();
        var $this = $(this);
        var targetComponent = $this.attr('href').split('#')[1];
        switch(targetComponent) {
            case 'personal': goToState(0); 
                            break;
            case 'billing': goToState(4);
                            break;
            case 'dd-card': if(statesTraversed.indexOf(2) > 0) {
                                goToState(2);
                            }
                            else {
                                goToState(1);
                            }
                            break;
            case 'value-card': goToState(3);
                            break;
            default: break;
        }
    };
    
    var postData = function ( actionURL, method, contentType, requestObject, successHandler, failureHandler, skipLoader ) {
        if(!skipLoader) {
            APP.global.showLoader();
        }
        var request = $.ajax({
            url: actionURL,
            method: method || 'POST',
            contentType: contentType || 'application/x-www-form-urlencoded; charset=UTF-8',
            data: requestObject
        });
        request.done(successHandler);
        request.fail(failureHandler);
        request.always(function () {
            if(!skipLoader) {
                APP.global.hideLoader();   
            }
        });
    };
    
    var getQueryParameter = function (name, url) {
        if (!url) {
            url = window.location.href;   
        }
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) {
            return null;
        }
        if (!results[2]) {
            return '';
        }
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    };
    
    var ordinalSuffixOf = function(i) {
        var j = i % 10,
            k = i % 100;
        if (j === 1 && k !== 11) {
            return i + 'st';
        }
        if (j === 2 && k !== 12) {
            return i + 'nd';
        }
        if (j === 3 && k !== 13) {
            return i + 'rd';
        }
        return i + 'th';
    };
    
    var setOrder = function (order) {
        orderNo = order;
    };
    
    var getOrder = function () {
        return orderNo;  
    };
    
    var setProfileAddressId = function (addressId) {
        profileAddressId = addressId;
    };
    
    var getProfileAddressId = function () {
        return profileAddressId;
    };
    
    var setVisaCheckout = function (val) {
        isVisaCheckoutFlow = val;
    };
    
    var bindEventsToUI = function () {
        $('.js-signup-back').on('click touchend', previousState);
        $('.js-tile-edit').find('a').on('click touchend', editForm);
        $exitModal.on('click touchend', '.u-cta--primary', APP.modal.closeModal);
        $exitModal.on('click touchend', '.u-cta--secondary', function (e) {
            e.preventDefault();
            window.onbeforeunload = undefined;
            window.history.go(-1);
            return false; //Required to work properly in chrome browser
        });
        $(registrationWrapper).on('click', '.js-masterpass-btn', function (e) {
            e.preventDefault();
            APP.global.removeError();
            window.onbeforeunload = undefined;
            APP.global.showLoader();
            APP.masterpass.init(registrationDetails.recharge.amount, 'ManualReload', registrationDetails, masterpassSuccessHandler, walletCancelHandler, masterpassFailureHandler);
        });

        window.onbeforeunload = backButtonHandler;
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('registration'); */
    };

    var initializeRegistration = function () {
        // console.log('APP.registration');
        $window = $('window');
        $exitModal = $('#registration-back-modal');
        $progressIcons = $('.js-progress-icons li');
        bindEventsToUI();
        $(registrationSteps[state].selector).parents(registrationWrapper).show();
        statesTraversed.push(state);
        if(APP[registrationSteps[state].component].onComponentShow) {
            APP[registrationSteps[state].component].onComponentShow(registrationDetails);
        }
        //APP.global.resizeRouteList.push('registration');
    };
    
    var init = function () {
        var registrationFormExists = $(registrationSteps[state].selector).length > 0 ? true : false;
        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;
        if(registrationFormExists && !isEditMode) {
            $('.js-registration-wrapper').hide();
            //APP.visaCheckout.initialize(10 , visaCheckoutSuccess, visaCheckoutFailure, walletCancelHandler);
            APP.masterpass.removeRedirectParamsOnCancelOrFailure();
            if(APP.masterpass.isMPRedirectSuccess()) {
                APP.formAddCard.onComponentShow();
                APP.masterpass.getTransactionDetails().then(function(response){
                    var data = JSON.parse(response.data);
                    updateRegistrationDetails({
                        profile: data.profile,
                        enrollmentType : data.enrollmentType,
                        skip: data.skip,
                        ddCard : data.ddCard,
                        recharge : data.recharge,
                        autoRecharge : data.autoRecharge
                    });
                    $('input[name="terms"]').attr('checked', true);
                    changeState(4);
                });
                masterpassSuccessHandler(JSON.parse(APP.masterpass.getQueryParams()));
                APP.masterpass.removeRedirectParams();
            } 

            initializeRegistration();
        }
        if(isEditMode) {
            $(registrationWrapper).show(); // To enable component preview in authoring mode.
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        showError: showError,
        removeErrors: removeErrors,
        nextState: nextState,
        previousState: previousState,
        months: months,
        setCardBalance: setCardBalance,
        getCardBalance: getCardBalance,
        updateRegistrationDetails: updateRegistrationDetails,
        getCardType: getCardType,
        creditCardTypes: creditCardTypes,
        visaCheckoutSuccess: visaCheckoutSuccess,
        visaCheckoutFailure: visaCheckoutFailure,
        walletCancelHandler: walletCancelHandler,
        masterpassSuccessHandler: masterpassSuccessHandler,
        masterpassFailureHandler: masterpassFailureHandler, 
        postData: postData,
        setVisaCheckout: setVisaCheckout,
        getQueryParameter: getQueryParameter,
        ordinalSuffixOf: ordinalSuffixOf,
        generateMarkup: generateMarkup,
        getOrder: getOrder,
        setOrder: setOrder,
        setProfileAddressId: setProfileAddressId,
        getProfileAddressId: getProfileAddressId,
        isMasterpassFlow : isMasterpassFlow
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.store = (function () {
    var defaultsStoreSearch = {
        maxMatches: 30,
        radius: 25,
        units: 'm',
        ambiguities: 'ignore',
    };
    var defaultsClosestStore = {
        maxMatches: 5,
        radius: 1000,
        units: 'm',
        ambiguities: 'ignore',
    };

    var amenities = {
        adv_ord_y: 'adv_ord', //On the go Ordering,
        adv_ord_a: 'adv_ord', //On the go Ordering Different Response from MapRequest,
        curbside_y: 'curbside', //Curbside
        dunkincardenabled_y: 'dunkincardenabled', //Accepts DD Cards
        drivein_y: 'drivein', //Drive Thru
        drivein_d: 'drivein', //Drive Thru
        turbooven_n: 'turbooven', //Limited menu
        turbooven_null: 'turbooven', //Limited menu
        beverageonly_y: 'beverageonly', //Beverage Only
        k_cup_y: 'k_cup', //K-Cup
        wireless_y: 'wireless', //Free Wi-Fi
        sun_hours_24hours: 'sun_hours', //Open 24 Hours
        combostore_y: 'combostore', //Baskin Robbins
        tap_unit_y: 'tap_unit', //On Tap
        dine_in_y: 'dine_in', //Dine In
        walkup_flag_y: 'walkup_flag', // Walk-Up
        kosher_y: 'kosher', //Kosher
    };

    var additionalAmenitiesForFilter = {};

    var timeFormat = '{hours}:{minutes}{dn}';

    var getAllAmenitiesForFiltering = function () {
        return $.extend({}, amenities, additionalAmenitiesForFilter);
    };

    var checkAnyDOWExists = function (obj) {
        var weekDays = APP.dateUtils.getWeekDays();
        var totalWeekDays = weekDays.length;
        var exists = false;
        var currentDay;
        for (var i = 0; i < totalWeekDays; i++) {
            currentDay = obj[weekDays[i] + '_hours'];
            if (currentDay !== undefined && currentDay !== '') {
                exists = true;
                break;
            }
        }
        return exists;
    };

    var msg24hour = window.CQ.I18n.getMessage('store.open_24_hours');
    var msgClosed = window.CQ.I18n.getMessage('store.hours_closed');
    var weekendDisplayName = window.CQ.I18n.getMessage('weekspan_weekend');
    var weekdayDisplayName = window.CQ.I18n.getMessage('weekspan_weekday');
    var weekDisplayName = window.CQ.I18n.getMessage('weekspan_week');

    var setOrigin = function () {
        var cookieValue = window.Cookies.get('DMA');

        if (cookieValue) {
            //console.log(cookieValue);
            var temp = cookieValue.split(':');
            var locationDetails = {
                city: temp[0],
                state: temp[1],
                postal: temp[2],
                dma_cd: temp[3],
                lat: temp[4],
                lng: temp[5],
            };

            return {
                lat: locationDetails.lat,
                lng: locationDetails.lng,
            };
        }
    };

    var getStores = function (searchTerm) {
        var location = setOrigin();
        var deferred = new $.Deferred();

        if (searchTerm) {
            APP.googleMap
                .getLocationByAddress(searchTerm)
                .done(function (location) {
                    location = {
                        lat: location.lat(),
                        lng: location.lng(),
                    };
                    APP.googleMap.getStoreDataFromDSL(deferred, location, defaultsStoreSearch.radius, defaultsStoreSearch.maxMatches);
                })
                .fail(function (err) {
                    deferred.reject(err);
                });
        } else {
            APP.googleMap.getStoreDataFromDSL(deferred, location, defaultsStoreSearch.radius, defaultsStoreSearch.maxMatches);
        }

        return deferred.promise();
    };

    var getClosestStore = function (radius) {
        var location = setOrigin();
        radius = radius || defaultsClosestStore.radius;
        return APP.googleMap.getStoreDataFromDSL(new $.Deferred(), location, defaultsStoreSearch.radius, defaultsClosestStore.maxMatches);
    };

    var getStoreLocalPageURL = function (store) {
        if (APP.global.isProduction()) {
            return 'https://locations.dunkindonuts.com/en/' + store.recordId;
        } else {
            return 'https://locations_dunkindonuts_com.yextpages.net/en/' + store.recordId;
        }
    };

    //generates markup based on js object and html template
    var generateMarkup = function (template, data) {
        return template.replace(/{[^{}]+}/g, function (key) {
            if (!!key && !!data) {
                if (key === '{postal}') {
                    if (data.postal.length < 5) {
                        return '0' + data[key.replace(/[{}]+/g, '')];
                    } else {
                        return data[key.replace(/[{}]+/g, '')];
                    }
                } else {
                    var val = data[key.replace(/[{}]+/g, '')];
                    return val ? val : '';
                }
            } else {
                return '';
            }
        });
    };

    //Returns Processed Closest store data
    var getStoreDetailMarkup = function (response, template) {
        var closestStore = response[0];
        return {
            address: processAddress(closestStore, template),
            storeTimings: processClosestStoreTimings(closestStore, template),
            amenities: processAmenities(closestStore, template, true),
            phone: processPhone(closestStore, template),
        };
    };

    //Returns Processed Search store data
    var getStoreResultsMarkup = function (response, template) {
        var searchResults = response;
        var totalResults = searchResults.length;
        var markup = [];
        for (var i = 0; i < totalResults; i++) {
            markup.push({
                address: processAddress(searchResults[i], template),
                distance: processDistance(searchResults[i], template),
                storeTimings: processStoreTimings(searchResults[i], template),
                phone: processPhone(searchResults[i], template),
                fax: processFax(searchResults[i], template),
                amenities: processAmenities(searchResults[i], template, false),
            });
        }
        return markup;
    };

    //Returns Processed Search Carrers data
    var getCarrerResultsMarkup = function (response, template) {
        var searchResults = response;
        var totalResults = searchResults.length;
        var markup = [];
        for (var i = 0; i < totalResults; i++) {
            markup.push({
                address: processAddress(searchResults[i], template),
                distance: processDistance(searchResults[i], template),
                storeTimings: processStoreTimings(searchResults[i], template),
                phone: processPhone(searchResults[i], template),
                fax: processFax(searchResults[i], template),
                recordId: processRecordId(searchResults[i], template),
                dbi_fee_hr_link: processBtnCareers(searchResults[i], template),
            });
        }
        return markup;
    };

    var getStoreTime = function (hours) {
        var is24hour = !!hours && /24HOURS/gi.test(hours);
        var openingHour;
        var closingHour;

        if (!!hours && !is24hour) {
            var militaryTimeSplit = hours.split(/-/);
            openingHour = generateMarkup(timeFormat, APP.dateUtils.convertMilitaryTimeToStdTime(militaryTimeSplit[0]));
            closingHour = generateMarkup(timeFormat, APP.dateUtils.convertMilitaryTimeToStdTime(militaryTimeSplit[1]));
            return {
                openingHour: openingHour,
                closingHour: closingHour,
            };
        } else if (is24hour) {
            return {
                openingHour: '24HOURS',
            };
        }
    };

    //Process closest store timings
    var processClosestStoreTimings = function (closestStoreDetails, template) {
        var unformattedStoreHours = closestStoreDetails[APP.dateUtils.getCurrentDay() + '_hours'];
        var currentDOWExists = unformattedStoreHours !== undefined && unformattedStoreHours !== '' ? true : false;

        var paragraphPrefix = '<p>';
        var timePrefix = ": <span class='value'>";
        var timeSuffix = '</span></p>';

        if (currentDOWExists) {
            var isStoreOpen24Hours = /24HOURS/gi.test(unformattedStoreHours);
            if (isStoreOpen24Hours) {
                closestStoreDetails = {
                    time: window.CQ.I18n.getMessage('store.open_24_hours'),
                };
            } else {
                //If time string contains a hyphen, split opening and closing hours and format them
                if (/-/.test(unformattedStoreHours)) {
                    var storeTime = getStoreTime(unformattedStoreHours);
                    closestStoreDetails = {
                        time: paragraphPrefix + 'Today' + timePrefix + storeTime.openingHour + ' - ' + storeTime.closingHour + timeSuffix,
                    };
                }
            }
        } else {
            var anyDOWExists = checkAnyDOWExists(closestStoreDetails);
            if (anyDOWExists) {
                closestStoreDetails = {
                    time: window.CQ.I18n.getMessage('store.today_closed'),
                };
            } else {
                closestStoreDetails = {
                    time: window.CQ.I18n.getMessage('store.open_time_vary'),
                };
            }
        }
        return generateMarkup(template.timings, closestStoreDetails);
    };

    var checkStoreStatus = function (day) {
        if (day.openingHour === '24HOURS') {
            return msg24hour;
        } else if (day.openingHour && day.closingHour) {
            return day.openingHour + ' - ' + day.closingHour;
        } else {
            return '<span class="store-item__timings--closed">' + msgClosed + '</span>';
        }
    };

    //Process and format store open/close timings
    var processStoreTimings = function (closestStoreDetails, template) {
        var anyDOWExists = checkAnyDOWExists(closestStoreDetails);

        if (anyDOWExists) {
            // console.log(closestStoreDetails);

            var sunDisplay = window.CQ.I18n.getMessage('dayabbr_sunday');
            var sunHours = getStoreTime(closestStoreDetails.sun_hours) || {};

            var monDisplay = window.CQ.I18n.getMessage('dayabbr_monday');
            var monHours = getStoreTime(closestStoreDetails.mon_hours) || {};

            var tueDisplay = window.CQ.I18n.getMessage('dayabbr_tuesday');
            var tueHours = getStoreTime(closestStoreDetails.tue_hours) || {};

            var wedDisplay = window.CQ.I18n.getMessage('dayabbr_wednesday');
            var wedHours = getStoreTime(closestStoreDetails.wed_hours) || {};

            var thuDisplay = window.CQ.I18n.getMessage('dayabbr_thursday');
            var thuHours = getStoreTime(closestStoreDetails.thu_hours) || {};

            var friDisplay = window.CQ.I18n.getMessage('dayabbr_friday');
            var friHours = getStoreTime(closestStoreDetails.fri_hours) || {};

            var satDisplay = window.CQ.I18n.getMessage('dayabbr_saturday');
            var satHours = getStoreTime(closestStoreDetails.sat_hours) || {};

            var paragraphPrefix = '<p>';
            var timePrefix = ": <span class='value'>";
            var timeSuffix = '</span></p>';

            var weekdayMatch =
                monHours.openingHour === tueHours.openingHour &&
                tueHours.openingHour === wedHours.openingHour &&
                wedHours.openingHour === thuHours.openingHour &&
                thuHours.openingHour === friHours.openingHour &&
                monHours.closingHour === tueHours.closingHour &&
                tueHours.closingHour === wedHours.closingHour &&
                wedHours.closingHour === thuHours.closingHour &&
                thuHours.closingHour === friHours.closingHour;

            var weekendMatch = sunHours.openingHour === satHours.openingHour && sunHours.closingHour === satHours.closingHour;

            var weekMatch =
                weekdayMatch && weekendMatch && monHours.openingHour === sunHours.openingHour && monHours.closingHour === sunHours.closingHour;

            // construct Hours list per Store
            var timeHTML = '';

            if (weekMatch) {
                timeHTML += paragraphPrefix + weekDisplayName + timePrefix + checkStoreStatus(sunHours) + timeSuffix;
            } else {
                if (!weekendMatch) {
                    timeHTML += paragraphPrefix + sunDisplay + timePrefix + checkStoreStatus(sunHours) + timeSuffix;
                }
                if (weekdayMatch) {
                    timeHTML += paragraphPrefix + weekdayDisplayName + timePrefix + checkStoreStatus(monHours) + timeSuffix;
                } else {
                    timeHTML += paragraphPrefix + monDisplay + timePrefix + checkStoreStatus(monHours) + timeSuffix;
                    timeHTML += paragraphPrefix + tueDisplay + timePrefix + checkStoreStatus(tueHours) + timeSuffix;
                    timeHTML += paragraphPrefix + wedDisplay + timePrefix + checkStoreStatus(wedHours) + timeSuffix;
                    timeHTML += paragraphPrefix + thuDisplay + timePrefix + checkStoreStatus(thuHours) + timeSuffix;
                    timeHTML += paragraphPrefix + friDisplay + timePrefix + checkStoreStatus(friHours) + timeSuffix;
                }
                if (!weekendMatch) {
                    timeHTML += paragraphPrefix + satDisplay + timePrefix + checkStoreStatus(satHours) + timeSuffix;
                } else if (weekendMatch) {
                    timeHTML += paragraphPrefix + weekendDisplayName + timePrefix + checkStoreStatus(satHours) + timeSuffix;
                }
            }

            // return final Hours list
            closestStoreDetails = {
                time: timeHTML,
            };
        } else {
            closestStoreDetails = {
                time: window.CQ.I18n.getMessage('store.hours_not_available'),
            };
        }
        return generateMarkup(template.timings, closestStoreDetails);
    };

    //Process store address and generate address markup
    var processAddress = function (closestStoreDetails, template) {
        return generateMarkup(template.address, closestStoreDetails);
    };

    //Process store distance and generate markup
    var processDistance = function (closestStoreDetails, template) {
        closestStoreDetails.distance = parseFloat(closestStoreDetails.distance).toFixed(2);
        return generateMarkup(template.distance, closestStoreDetails);
    };

    //Process store phone and generate markup
    var processPhone = function (closestStoreDetails, template) {
        return generateMarkup(template.phone, closestStoreDetails);
    };

    //Process store recordId and generate markup
    var processRecordId = function (closestStoreDetails, template) {
        return generateMarkup(template.recordId, closestStoreDetails);
    };

    //Process store fax and generate markup
    var processFax = function (closestStoreDetails, template) {
        return generateMarkup(template.fax, closestStoreDetails);
    };

    //Process store fax and generate markup
    var processBtnCareers = function (closestStoreDetails, template) {
        return generateMarkup(template.btnApply, closestStoreDetails);
    };

    //Process store amenities and generate markup
    var processAmenities = function (amenitiesObject, template, isClosestStore) {
        var amenArr = '';
        var index = 1;
        $.each(amenities, function (key, value) {
            if (isClosestStore && index > 3) {
                return false; //Break out of each loop.
            }
            var amenityExists = amenitiesObject[value];
            if (!!amenityExists && key === value + '_' + amenityExists.toLowerCase()) {
                amenArr += generateMarkup(template.amenities, {
                    key: value,
                    amenity: window.CQ.I18n.getMessage('store.' + value),
                });
                index++;
            }
        });
        return amenArr;
    };

    /**
     * interfaces to public functions
     */
    return {
        getStores: getStores,
        getClosestStore: getClosestStore,
        generateMarkup: generateMarkup,
        getStoreDetailMarkup: getStoreDetailMarkup,
        getStoreResultsMarkup: getStoreResultsMarkup,
        getCarrerResultsMarkup: getCarrerResultsMarkup,
        getAllAmenitiesForFiltering: getAllAmenitiesForFiltering,
        getStoreLocalPageURL: getStoreLocalPageURL,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.centinal = (function() {

    var $centinalForm;
    var skipCentinal = true;
    var verificationError;
    


    var validateCentinalResSuccess;
    var validateCentinalResFailure;
    var validateCentinalResNoAction;

    var skipCentinalFlow = function() {
        return skipCentinal;
    };

    var getVerificationError = function() {
        return verificationError;
    };

    var centinalFormHandler = function(order, successHandler, errorHandler, noActionHandler) {
    		// cardinal removed, code commented out to avoid extra calls
        /*validateCentinalResSuccess = successHandler;
        validateCentinalResFailure = errorHandler;
        validateCentinalResNoAction = noActionHandler;
        $(document).unbind('ajaxStop');
        
		// call service to log order detail before sending to centinal
        APP.global.sendToLogger('info', order.OrderDetails);
        
        // new validation check to avoid order number sent empty
        if(!order.OrderDetails.OrderNumber) {
        		// on any case the order number is null or empty, set hardcoded value
        		order.OrderDetails.OrderNumber = '999-3DS-999'; 
        		
        		// log cases when order number was null
        		APP.global.sendToLogger('info', order.OrderDetails,'No OrderNumber');
        }
        
        window.Cardinal.start('cca', order); */
    };

    var bindEventsToUI = function() {
    		// cardinal removed, code commented to avoid extra calls
        /*$centinalForm = $('.js-form-centinal');
        $centinalForm.on('submit', centinalFormHandler);*/
    };

    var bindOnResize = function() {
        /*
         * Don't forget to uncomment
         * APP.global.resizeRouteList.push('centinal');
         */
    };

    var init = function(element) {
        // console.log('APP.centinal');
        bindEventsToUI();
        loadJWTFromServer();
    };

    var loadJWTFromServer = function(loadJWTFromServerSuccess, loadJWTFromServerFailure) {
    		// cardinal removed, code commented to avoid extra calls
        /*var request = $.ajax({
            url: '/bin/servlet/centinal',
            method: 'POST',
            contentType: 'application/json'
        });
        request.done(function(response) {
            intializeCardinal(loadJWTFromServerSuccess, response.data.jwt, response.data.jwtId);
        });
        request.fail(function(jqXHR, textStatus) {
            loadJWTFromServerFailure(jqXHR);
        });*/
    };

    var intializeCardinal = function(loadJWTFromServerSuccess, jwt, jwtId) {
    		// cardinal removed, code commented to avoid extra calls
        
    		/*window.Cardinal.configure({
            logging: {
                level: 'verbose'
            }
        });

        window.Cardinal.on('payments.setupComplete', function() {
            loadJWTFromServerSuccess(jwt, jwtId);
        });

        window.Cardinal.setup('init', {
            jwt: jwt
        });

        window.Cardinal.on('payments.validated', function(data, jwt) {
            var response = JSON.stringify(data);
            switch (data.ActionCode) {
                case 'SUCCESS':
                    console.log('Success: ' + response);
                    if (validateCentinalResSuccess === undefined) {
                        break;
                    }
                    if (jwt) {
                        validateCentinalResSuccess(response, jwt);
                    } else {
                        validateCentinalResFailure(response);
                    }
                    break;
                case 'NOACTION':
                    console.log('NOACTION: ' + response);
                    if (validateCentinalResNoAction) {
                        validateCentinalResNoAction(response, jwt);
                    }
                    break;
                case 'FAILURE':
                    console.log('FAILURE: ' + response);
                    if (validateCentinalResFailure) {
                        validateCentinalResFailure(response, data.ActionCode);
                    }
                    break;
                case 'ERROR':
                    console.log('ERROR: ' + response);
                    if (validateCentinalResFailure) {
                        validateCentinalResFailure(response, data.ActionCode);
                    } else {
                        var errorNumber = data.ErrorNumber;
                        console.log(data);
                        if (errorNumber === 10001 || errorNumber === 10002 || errorNumber === 10003 ||
                            errorNumber === 10007 || errorNumber === 10009) {
                            skipCentinal = true;
                            verificationError = {
                                errorMsg: data.ErrorDescription,
                                errorNo: data.ErrorNumber,
                                statusCode: data.ActionCode,
                                statusMessage: data.ErrorDescription
                            };
                        }
                    }
                    break;
                default:
                    break;
            }
        });*/
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        loadJWTFromServer: loadJWTFromServer,
        centinalFormHandler: centinalFormHandler,
        skipCentinalFlow: skipCentinalFlow,
        getVerificationError: getVerificationError
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.session = (function () {
    var sessionDuration = 900000;
    var checkingInterval = 60000;
    var threshold = 300000;
    var sessionKey = 'session-exp';
    var sessionTimer;

    var updateExpiryCookie = function () {
        var request = $.ajax({
            url: '/bin/servlet/userAuthentication',
            method: 'POST',
        });
        request.done(function (response) {
            initialize();
        });
    };

    var checkExpiry = function () {
        if (window.sessionStorage.getItem(sessionKey) === null) {
            return;
        }
        var expiryTime = window.sessionStorage.getItem(sessionKey);
        var currentTime = Date.now();
        var diff = expiryTime - currentTime;
        if (diff <= threshold) {
            clearInterval(sessionTimer);
            updateExpiryCookie();
            sessionTimer = window.setInterval(checkExpiry, checkingInterval);
        }
    };

    var initialize = function () {
        var expiryTime = Date.now() + parseInt(sessionDuration);
        window.sessionStorage.setItem(sessionKey, expiryTime);
    };

    var clear = function () {
        clearInterval(sessionTimer);
        window.sessionStorage.removeItem(sessionKey);
    };

    var logout = function () {
        APP.global.postFormData(
            '/bin/servlet/signin',
            {
                service: 'logout',
            },
            function (response) {
                if (response.data) {
                    APP.session.clear();
                    Cookies.remove('registered_user');
                    Cookies.remove('signin_tagging');
                    window.location.href = $('#logoutURL').val();
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event' : 'logout',
                        'is_logged_in' : 'false'
                    });

                } else {
                    console.log('Logout failure!');
                }
            },
            function () {
                console.log('Logout failure!');
            }
        );
    };

    //Initialize
    var init = function () {
        // console.log('APP.Session');

        sessionDuration = $('#idleTimeOut').val() * 1000 || sessionDuration;

        //Should not work in author mode.
        if (window.Cookies.get('wcmmode') !== 'edit' && APP.login.isLoggedIn()) {
            if (window.sessionStorage.getItem(sessionKey) === null) {
                updateExpiryCookie();
            }
            sessionTimer = window.setInterval(checkExpiry, checkingInterval);
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        initialize: initialize,
        clear: clear,
        logout: logout,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.cardManagement = (function () {

    var cardList;

    var setDDCardsListAjax = function () {
        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                service: 'getDdCardDetails'
            }),
            dataType: 'json',
            contentType: 'application/json'
        });
    };

    var setBalanceLoggedInAjax = function (cardNumber, cardPin) {
        return $.ajax({
            url: '/bin/servlet/ddcard',
            method: 'POST',
            data: {
                'service': 'getBalance',
                'card-number': cardNumber,
                'pin': cardPin
            }
        });
    };

    var setBalanceAjax = function (cardNumber, cardPin) {
        return $.ajax({
            url: '/bin/servlet/transaction',
            method: 'POST',
            data:  JSON.stringify({
                'service': 'getBalance',
                'card-number': cardNumber,
                'pin': cardPin
            }),
	        dataType: 'text',
	        contentType: 'application/json'
        });
    };

    var formatBalance = function (bal) {
        var balString = parseFloat(bal).toFixed(2)
            .toString();
        var decimalPlace = balString.indexOf('.');
        var dollars = balString.substring(0, decimalPlace);
        var cents = balString.substring(decimalPlace + 1);

        return {
            dollars: dollars,
            cents: cents 
        };
    };

    var setBalanceUI = function($section, data) {
        var balance = APP.cardManagement.formatBalance(data.balance);
        $section.find('.js-balance-dollar').text('$' + balance.dollars);
        $section.find('.js-balance-cents').text('.' + balance.cents);
        $section.find('.js-balance-date').text(data.displayDate);
    };
    

    /**
     * interfaces to public functions
     */
    return {
        setDDCardsListAjax: setDDCardsListAjax,
        setBalanceLoggedInAjax : setBalanceLoggedInAjax,
        setBalanceAjax : setBalanceAjax, 
        formatBalance : formatBalance,
        setBalanceUI : setBalanceUI
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.manageProfile = (function () {
    var $firstName,
        $lastName,
        $zipCode,
        $email,
        $birthDay,
        $birthDayMonth,
        $mobileNumber,
        ANIMATED_CLASS = 'u-cta--animated',
        SUCCESS_CLASS = 'u-cta--success',
        UPDATED_TEXT = 'UPDATED',
        UPDATE_TEXT = 'UPDATE',
        DISABLED_CLASS = 'disabled',
        months = APP.dateUtils.getMonths();

    var loadProfile = function ($form) {
        APP.global.showLoader();
        APP.global.removeError();

        $firstName = $form.find('#firstName');
        $lastName = $form.find('#lastName');
        $zipCode = $form.find('#profileZipCode');
        $email = $form.find('#email');
        $birthDay = $form.find('#birthdayDay');
        $birthDayMonth = $form.find('#birthdayMonth');
        $mobileNumber = $form.find('#telephone');

        $.ajax({
            type: 'POST',
            url: '/bin/servlet/profile',
            data: 'service=getProfileInfo',
            success: function (response) {
                var data = response.data;
                var $checkbox = $form.find('input[type="checkbox"]');

                if (data.emailOptIn) {
                    $checkbox.prop('checked', true);
                } else {
                    $checkbox.removeProp('checked');
                }

                $firstName.val(data.firstName);
                $lastName.val(data.lastName);
                $zipCode.val(data.profileZip);
                var birthDate = new Date(data.dateOfBirth);
                APP.formSelect.changeSelection($birthDayMonth, months[birthDate.getMonth()]);
                APP.formSelect.changeSelection($birthDay, birthDate.getDate());
                $mobileNumber.val(formatPhoneNumber(data.primaryPhone, false));
                $email.val(data.email);
                APP.global.hideLoader();
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $form);
                APP.global.hideLoader();
            },
            contentType: 'application/x-www-form-urlencoded',
        });
    };

    var updateProfile = function ($form, $cta, $msgContainer) {
        APP.global.removeError();
        $msgContainer.hide();
        $form
            .parsley()
            .whenValidate()
            .done(function () {
                APP.global.showLoader();
                $.ajax({
                    type: 'POST',
                    url: '/bin/servlet/profile',
                    data: $form.serialize(),
                    success: function (response) {
                        APP.loyaltyService.getLoyaltyProfile(true).done(function (response) {
                            if (response.data.dltEnabled) {
                                window.Cookies.set('dlt_st', true, {
                                    secure: APP.global.isSecureCookie(),
                                });
                            }
                        });
                        $cta.html(UPDATED_TEXT);
                        $cta.addClass(SUCCESS_CLASS);
                        $cta.addClass(DISABLED_CLASS);
                        $msgContainer.show();
                        setTimeout(function () {
                            $cta.removeClass(SUCCESS_CLASS);
                            $cta.html(UPDATE_TEXT);
                            $cta.removeClass(DISABLED_CLASS);
                            $msgContainer.hide();
                            APP.global.hideLoader();
                        }, 2000);
                    },
                    error: function (jqXHR) {
                        APP.global.getErrorMsg(jqXHR, $form);
                        APP.global.hideLoader();
                    },
                    contentType: 'application/x-www-form-urlencoded',
                });
            });
    };

    var updatePassword = function ($form, successHandler, failHandler) {
        APP.global.removeError();
        if ($form.parsley().validate()) {
            APP.global.postFormData('/bin/servlet/password', $form.serialize(), successHandler, failHandler);
        }
    };

    function ajax_response(success) {
        var str = '';
        if (success) {
            str = '{ "data": "Test service." }';
        } else {
            str = '{ "error": "Process failed!" }';
        }

        var deferred = $.Deferred().resolve(str);
        return deferred.promise();
    }

    var updateZipcode = function ($form, successHandler, failHandler) {
        APP.global.removeError();
        $form
            .parsley()
            .whenValidate()
            .done(function () {
                APP.global.showLoader();
                //var request = ajax_response(true);

                APP.global.postFormData('/bin/servlet/profile', $form.serialize(), successHandler, failHandler);

                request.done(successHandler);
                request.fail(failHandler);
            });
    };

    var formatPhoneNumber = function (primaryPhone, isMasked) {
        var cleaned = ('' + primaryPhone).replace(/\D/g, '');
        var match = cleaned.match(/^(\d{3})(\d{3})(\d{4})$/);
        if (match) {
            if (isMasked) {
                return '(' + match[1].replace(/./g, '*') + ') ' + match[2].replace(/./g, '*') + '-' + match[3];
            } else {
                return '(' + match[1] + ') ' + match[2] + '-' + match[3];
            }
        }
        return null;
    };

    return {
        loadProfile: loadProfile,
        updateProfile: updateProfile,
        updatePassword: updatePassword,
        updateZipcode: updateZipcode,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.analytics = (function () {
    /**
     * Constants.
     */
    var Events = {
        CLICK: 'Click',
        APP_DOWNLOAD: 'App Download',
        VIDEO_START: 'Video started',
        VIDEO_END: 'Video ended',
    };

    var EventCategories = {
        NAVIGATION: 'Navigation',
        LOCATION: 'Location',
        HOMEPAGE: 'Homepage',
        PERKS_LP: 'Perks LP',
        DD_CARD: "Dunkin' Card",
        DD_CARDS: "Dunkin' Cards",
        MANAGE_ACCOUNT: 'ManageAccount',
        SHOP: 'Shop',
        MENU: 'Menu',
        PERKS_REGISTRATION: 'Perks Registration',
        ABOUT: 'About',
        PATS: 'Pats365',
        USER_ID: 'userid',
        CAREERS: 'Careers',
        YOUTUBE: 'YouTube',
    };

    var NavigationActions = {
        GLOBAL_NAV: 'Global Nav',
        TOP_NAV: 'Top Nav',
        QUICK_LINKS: 'Quick Links',
        BACK_TO_TOP: 'Back to Top',
        PARTNERS: 'Partners',
        GLOBAL_NAV_PROMO: 'Global Nav Promo',
        SOCIAL: 'Social',
        FOOTER: 'Footer',
    };

    var EventLabels = {
        PERKS_TAB: 'DD perks tab',
        ZIPCODE_SEARCH: 'Zip Code Search',
        SHOW_DETAILS: 'Show Details',
        APP_ANDROID: 'App Android Download',
        APP_IPHONE: 'App iTunes Download',
        MASTERCARD_CHECKOUT: 'Masterpass Checkout',
        VISA_CHECKOUT: 'Visa Checkout',
        ARROW_LEFT: 'Left',
        ARROW_RIGHT: 'Right',
    };

    var dataLayer = (window.dataLayer = window.dataLayer || {});
    var printGTMObj = false;
    var userInfoObj;

    /**
     * Fire a navigation analytics event.
     *
     * @param eventAction Constant with the NavigationAction to fire
     * @param linkText Text of the link to store in the event
     */
    var fireNavigationEvent = function (eventAction, linkText) {
        if (eventAction && linkText) {
            return fireAnalyticsEvent(EventCategories.NAVIGATION, EventCategories.NAVIGATION, eventAction, linkText);
        }

        return null;
    };

    /**
     * Fire a analytics event for specific Category.
     *
     * @param eventCategory Constant with the event category
     * @param eventAction Constant with the NavigationAction to fire
     * @param linkText Text of the link to store in the event
     */
    var fireCategoryEvent = function (eventCategory, eventAction, linkText) {
        if (eventCategory && eventAction && linkText) {
            return fireAnalyticsEvent(eventCategory, eventCategory, eventAction, linkText);
        }

        return null;
    };

    /**
     * Fire a analytics event to track loyalty id
     *
     * @param event id of current user
     * @param loyaltyId numeric value corresponding to users loyalty id
     */
    var fireLoyaltyEvent = function (loyaltyId, perksUser, noOfDDCards) {
        if (dataLayer && dataLayer.push) {
            var eventObj = {
                event: EventCategories.USER_ID,
                loyaltyid: loyaltyId,
                perksUser: perksUser,
                noOfDDCards: noOfDDCards,
            };

            if (printGTMObj) {
                console.log('Object pushed to dataLayer: ', eventObj);
            }

            return dataLayer.push(eventObj);
        }

        return null;
    };

    /**
     * Fire the dataLayer event if all the conditions are met.
     *
     * @param event Constant with the Event to fire
     * @param eventCateogry Constant with the EventCategory to fire
     * @param eventAction Action value to fire from the defined constants
     * @param eventLabel Label of the event to fire
     */
    var fireAnalyticsEvent = function (event, eventCategory, eventAction, eventLabel) {
        if (dataLayer && dataLayer.push) {
            var eventObj = {
                event: event,
                eventCategory: eventCategory,
                eventAction: eventAction,
                eventLabel: eventLabel,
            };

            if (printGTMObj) {
                console.log('Object pushed to dataLayer: ', eventObj);
            }

            return dataLayer.push(eventObj);
        }

        return null;
    };

    /**
     * Function to set tagging for general links teasers CTA, teasers links, download app links
     *
     * @param eventCategoryParam category for the corresponding event to tag
     * @param $context jQuery context to bind the events
     */
    var bindGeneralCTATagging = function (eventCategoryParam, $context) {
        if (!$context) {
            $context = $('.js-main-content');
        }

        //console.log('bindGeneralCTATagging:' + eventCategoryParam);
        // teasers CTA
        $('a.u-cta', $context).on('click', function () {
            var $this = $(this);
            var $contactForm = $this.closest('.form-contact-us-comments');

            // primary cta for contact us will trigger tracking after form validation, so it gets excluded from this call
            if ($contactForm.length <= 0 || !$this.hasClass('u-cta--primary')) {
                var eventLabel = $this.text();
                if (eventLabel && eventLabel !== '') {
                    eventLabel = eventLabel.trim();
                }

                // check if cta is under an accordion component, if so, accordion name should be appended to event label
                if ($this.parents('.js-accordion-panel').length) {
                    var accordionId = $this.parents('.js-accordion-panel').attr('id');
                    if (accordionId) {
                        var accordionText = $('.js-accordion-anchor-navigation .js-anchor-links a[href="#' + accordionId + '"]').text();
                        if (accordionText) {
                            eventLabel += ' - ' + accordionText;
                        }
                    }
                }

                var imageLabel = '';
                if ($this.has('img').length > 0) {
                    imageLabel = ' Button';
                }

                var href = $this.attr('href');
                // app download
                if (href && href.indexOf('itunes') !== -1) {
                    APP.analytics.fireCategoryEvent(
                        eventCategoryParam,
                        APP.analytics.Events.APP_DOWNLOAD,
                        APP.analytics.EventLabels.APP_IPHONE + imageLabel
                    );
                } else if (href && href.indexOf('play.google') !== -1) {
                    APP.analytics.fireCategoryEvent(
                        eventCategoryParam,
                        APP.analytics.Events.APP_DOWNLOAD,
                        APP.analytics.EventLabels.APP_ANDROID + imageLabel
                    );
                } else {
                    APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
                }
            }
        });

        // clicks on interstitial overlay
        var interstitialTagging = function () {
            $('#js-intersitial-main-wrapper').on('click', '.interstitial__main a', function () {
                var $this = $(this);
                var title = $this.attr('title');
                if (title && title !== '') {
                    title = title.trim();
                }
                APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, title);
            });
        };

        setTimeout(interstitialTagging, 2000);

        // teasers links
        $('.js-main-content a.teaser__link, .js-main-content a.promo-tile__link').on('click', function () {
            var $this = $(this);
            var title = $('.teaser__title .teaser__title-01', $this).text();
            if (title && title !== '') {
                title = title.trim();
            }

            var subTitle = $('.teaser__subtitle', $this).text();
            if (subTitle && subTitle !== '') {
                subTitle = subTitle.trim();
            }

            var eventLabel = title + ' ' + subTitle;
            APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
        });

        // text links
        $('.text a, .teaser__text a').on('click', function () {
            var $this = $(this);
            var eventLabel = $this.text() || $this.attr('title');

            APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
        });

        // related links
        $('.related-links__list a').on('click', function () {
            var $this = $(this);
            var eventLabel = $this.text() || $this.attr('title');
            if (eventLabel && eventLabel !== '') {
                eventLabel = eventLabel.trim();
            }

            APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
        });

        // anchor navigation
        $('.aem-wrap--anchor-navigation').on('click', 'a.js-anchor-link', function () {
            var $this = $(this);
            var eventLabel = $this.text() || $this.attr('title');

            APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
        });

        $('.js-main-content').on('click', '.career-item--results .js-career-item__cta a.u-cta', function () {
            var $this = $(this);
            var eventLabel = $this.text().trim();

            // get record Id to differentiate which cta was clicked
            var storeId = $this.parents('li').attr('recordid');
            if (storeId) {
                eventLabel += ' [' + storeId + ']';
            }
            APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.CAREERS, APP.analytics.Events.CLICK, eventLabel);
        });

        // nutrution table content
        $('.js-main-content').on('click', '.nutrition-toggle__container a.js-nutrition-toggle-link, .nutrition-table a', function () {
            var $this = $(this);
            var eventLabel = $this.text() || $this.attr('title');

            APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
        });

        // pagination nav arrow links
        $('.js-main-content').on('click', '.slick-prev', function () {
            var $this = $(this);
            var eventLabel = APP.analytics.EventLabels.ARROW_LEFT;
            APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
        });

        $('.js-main-content').on('click', '.slick-next', function () {
            var $this = $(this);
            var eventLabel = APP.analytics.EventLabels.ARROW_RIGHT;
            APP.analytics.fireCategoryEvent(eventCategoryParam, APP.analytics.Events.CLICK, eventLabel);
        });
    };

    var trackLoyaltyId = function () {
        var userInfoCookie = APP.cookie.getUserInfo();

        if (userInfoCookie) {
            var userInfoObj = userInfoCookie;

            if (userInfoObj) {
                fireLoyaltyEvent(userInfoObj.loyaltyId, userInfoObj.perksUser, userInfoObj.noOfDDCards);
            }
        }
    };

    /**
     * Function to initialize gtm component if configured on the page
     */
    var init = function () {
        var taggingCategory = $('.js-generalTagging').data('eventcategory');

        if (taggingCategory && taggingCategory !== '') {
            bindGeneralCTATagging(taggingCategory);
        }

        trackLoyaltyId();

        // include youtube iframe API
        var tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    };

    /**
     * Function to enable/disabled printing the object pushed to the dataLayer
     *
     * @param printEnabled true to print the gtm obj to push.  Default is false.
     */
    var debugObjPushed = function (printEnabled) {
        printGTMObj = printEnabled;
    };

    /**
     * interfaces to public functions and constants
     */
    return {
        init: init,
        NavigationActions: NavigationActions,
        EventLabels: EventLabels,
        Events: Events,
        EventCategories: EventCategories,
        fireNavigationEvent: fireNavigationEvent,
        fireCategoryEvent: fireCategoryEvent,
        bindGeneralCTATagging: bindGeneralCTATagging,
        debugObjPushed: debugObjPushed,
        trackLoyaltyId: trackLoyaltyId,
    };
})();

$(document).ready(APP.analytics.init);

'use strict';

var APP = window.APP = window.APP || {};

APP.registrationMT = (function () {
    
    var state = 0;
    var cardBalance = 0;
    var orderNo = 0;
    var statesTraversed = [];
    var registrationSteps = [
        {
            component: 'formSimplifiedRegistration',
            selector: '.js-form-simplified-registration'
        } 
    ];
    var months = [
        ['jan', 'January'],
        ['feb', 'February'],
        ['mar', 'March'],
        ['apr', 'April'],
        ['may', 'May'],
        ['jun', 'June'],
        ['jul', 'July'],
        ['aug', 'August'],
        ['sep', 'September'], 
        ['oct', 'October'], 
        ['nov', 'November'], 
        ['dec', 'December']
    ];
    months.indexOf = function (key) {
        var $this = $(this);
        var length = $this.length;
        for (var i = 0; i<length; i++) {
            if($this[i][0] === key) {
                return i;
            }
        }
        return -1;
    };
    var templates = {
        error: '' +
            '<div class=\'u-page-error\'>{msg}</div>'
    };
    var $window;
    var $exitModal;
    var $progressIcons;
    var registrationWrapper = '.js-registration-wrapper';
    var registrationDetails = {
    	    profile : {},
    	    creditcard : {},
    		enrollmentType : '',
            skip: false,
    		ddCard : {},
    		recharge : {},
    		autoRecharge : {}
    };
    var profileAddressId = '';
    
    var updateProgressBar = function (newState) {
        if(newState === 0) {
            $progressIcons.eq(0).addClass('is-active');
            $progressIcons.eq(1).removeClass('is-active');
            $progressIcons.eq(2).removeClass('is-active');
        }
        else if(newState === 1 || newState === 2 || newState === 3) {
            $progressIcons.eq(0).addClass('is-active');
            $progressIcons.eq(1).addClass('is-active');
            $progressIcons.eq(2).removeClass('is-active');
        }
        else {
            $progressIcons.eq(0).addClass('is-active');
            $progressIcons.eq(1).addClass('is-active');
            $progressIcons.eq(2).addClass('is-active');
        }
    };
    
    var changeState = function (newState) {
        $(registrationSteps[state].selector)
        .parents(registrationWrapper)
        .hide();
        $(registrationSteps[newState].selector)
        .parents(registrationWrapper)
        .show();
        updateProgressBar(newState);
        $(window).scrollTop(0);
        state = newState;
        if(APP[registrationSteps[state].component].onComponentShow) {
            APP[registrationSteps[state].component].onComponentShow(registrationDetails);
        }
    };
    
    var nextState = function (skipOneStep) {
        if(skipOneStep) {
            statesTraversed.push(state + 2);
            changeState(state + 2); //From add card screen to directly new card screen skipping add existing card.
        }
        else {
            statesTraversed.push(state + 1);
            changeState(state + 1);
        }
    };
    
    var previousState = function (e) {
        e.preventDefault();
        if(statesTraversed.length > 1) {
            statesTraversed.pop();
            changeState(statesTraversed.slice(-1)[0]);
        }
        else {
            handleRegistartionExit();
        }
    };
    
    var goToState = function(targetState) {
        while(state !== targetState && statesTraversed.length > 0) { 
            var tempState = statesTraversed.pop();
            state = statesTraversed.slice(-1)[0];
            $(registrationSteps[tempState].selector)
            .parents(registrationWrapper)
            .hide();
        }
        
        // if hide all elements and state is still different than target, then set state = target
        if(state !== targetState && statesTraversed.length === 0) {
        		state = targetState;
        }
        
        $(registrationSteps[state].selector)
            .parents(registrationWrapper)
            .show();
        updateProgressBar(targetState);
        $(window).scrollTop(0);
        if(APP[registrationSteps[state].component].onComponentShow) {
            APP[registrationSteps[state].component].onComponentShow(registrationDetails);
        }
    };
    
    var handleRegistartionExit = function () {
        $exitModal.show(0).addClass('modal--show');
    };
    
    var backButtonHandler = function (e) {
        var dialogText = window.CQ.I18n.getMessage('back-button-alert');
        e.returnValue = dialogText;
        return dialogText;
    };
    
    var generateMarkup = function (template, data) {
        return template.replace(/{[^{}]+}/g, function (key) {
            return data[key.replace(/[{}]+/g, '')] || '';
        });
    };
    
    var showError = function (msg) {
        removeErrors();
        $(registrationSteps[state].selector).prepend(generateMarkup(templates.error, {
            msg: msg
        }));
        APP.global.focusError();
    };
    
    var removeErrors = function () {
        $(registrationSteps[state].selector)
            .find('.u-page-error')
            .remove();
    };
    
    var updateRegistrationDetailsMT = function (updateObj) {
        $.extend(registrationDetails, updateObj);
    };
    
    
    var editForm = function (e) {
        e.preventDefault();
        var $this = $(this);
        var targetComponent = $this.attr('href').split('#')[1];
        switch(targetComponent) {
            case 'personal': goToState(0); 
                            break;
            case 'billing': goToState(4);
                            break;
            case 'dd-card': if(statesTraversed.indexOf(2) > 0) {
                                goToState(2);
                            }
                            else {
                                goToState(1);
                            }
                            break;
            case 'value-card': goToState(3);
                            break;
            default: break;
        }
    };
    
    var postData = function ( actionURL, method, contentType, requestObject, successHandler, failureHandler, skipLoader ) {
        if(!skipLoader) {
            APP.global.showLoader();
        }
        var request = $.ajax({
            url: actionURL,
            method: method || 'POST',
            contentType: contentType || 'application/x-www-form-urlencoded; charset=UTF-8',
            data: requestObject
        });
        request.done(successHandler);
        request.fail(failureHandler);
        request.always(function () {
            if(!skipLoader) {
                APP.global.hideLoader();   
            }
        });
    };

    
    var setProfileAddressId = function (addressId) {
        profileAddressId = addressId;
    };
    
    var getProfileAddressId = function () {
        return profileAddressId;
    };
    
    var getQueryParameter = function (name, url) {
        if (!url) {
            url = window.location.href;   
        }
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) {
            return null;
        }
        if (!results[2]) {
            return '';
        }
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    };
    
    var bindEventsToUI = function () {
        $('.js-signup-back').on('click touchend', previousState);
        $('.js-tile-edit').find('a').on('click touchend', editForm);
        $exitModal.on('click touchend', '.u-cta--primary', APP.modal.closeModal);
        $exitModal.on('click touchend', '.u-cta--secondary', function (e) {
            e.preventDefault();
            window.onbeforeunload = undefined;
            window.history.go(-1);
            return false; //Required to work properly in chrome browser
        });

        window.onbeforeunload = backButtonHandler;
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('registration'); */
    };

    var initializeRegistration = function () {
        $window = $('window');
        $exitModal = $('#registration-back-modal');
        $progressIcons = $('.js-progress-icons li');
        bindEventsToUI();
        $(registrationSteps[state].selector).parents(registrationWrapper).show();
        statesTraversed.push(state);
        if(APP[registrationSteps[state].component].onComponentShow) {
            APP[registrationSteps[state].component].onComponentShow(registrationDetails);
        }
    };
    
    var init = function () {
        var registrationFormExists = $(registrationSteps[state].selector).length > 0 ? true : false;
        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;
        if(registrationFormExists && !isEditMode) {
            $('.js-registration-wrapper').hide();

            initializeRegistration();
        }
        if(isEditMode) {
            $(registrationWrapper).show(); // To enable component preview in authoring mode.
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        showError: showError,
        removeErrors: removeErrors,
        months: months,
        getQueryParameter: getQueryParameter,
        nextState: nextState,
        previousState: previousState,
        updateRegistrationDetailsMT: updateRegistrationDetailsMT,
        postData: postData,
        generateMarkup: generateMarkup,
        setProfileAddressId: setProfileAddressId,
        getProfileAddressId: getProfileAddressId,
    };

}());

'use strict';

var APP = (window.APP = window.APP || {});

APP.kountDataCollector = (function () {
    var sessionId = new $.Deferred();

    var triggerDataCollection = function (data) {
        var src = '/bin/servlet/logo.htm?m=' + data.m + '&s=' + data.sessionid;

        var $dataCollectorContainer = $('<div>').attr('class', 'js-data-collector');

        $('#main-content').append($dataCollectorContainer);

        var $iframe = $('<iframe>');
        $iframe.attr('width', 1).attr('height', 1).attr('frameborder', 0).attr('scrolling', 'no').attr('src', src);

        var $input = $('<input>').attr('type', 'hidden').attr('id', 'sid').val(data.sessionid);

        $('.js-data-collector').html($iframe).append($input);
    };

    var createSessionIdInput = function ($form, data) {
        var $input = $('<input>').attr('type', 'hidden').attr('id', 'sessionId').attr('name', 'sessionId').val(data.sessionid);
        $form.append($input);
    };

    var init = function ($form) {
        if (!APP.global.isEditMode()) {
            $.ajax({
                type: 'GET',
                url: '/bin/servlet/kountsession',
                success: function (response) {
                    if (response.enabled) {
                        triggerDataCollection(response);
                        createSessionIdInput($form, response);
                        sessionId.resolve(response.sessionid);
                    }
                },
                error: function (jqXHR, response) {},
            });
        }
    };

    return {
        init: init,
        sessionId: sessionId,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.loyaltyService = (function () {
    var rewardsCatalogDeferred, programDetailsAjax, loyaltyProfileAjax, allCertificatesAjax, availableOffersAjax;

    var getRewardsCatalog = function () {
        if (!rewardsCatalogDeferred) {
            APP.global.showLoader();
            rewardsCatalogDeferred = new $.Deferred();
            $.ajax({
                type: 'POST',
                url: '/bin/servlet/rewardscatalog',
            })
                .done(function (response) {
                    if (response.data.errorCode) {
                        rewardsCatalogDeferred.reject({
                            errorCode: response.data.errorCode,
                            message: response.data.errorMessage,
                        });
                    } else {
                        rewardsCatalogDeferred.resolve(response);
                    }
                })
                .fail(function (err) {
                    rewardsCatalogDeferred.reject(err);
                });
        }

        return rewardsCatalogDeferred.promise();
    };

    var getProgramDetails = function () {
        if (!programDetailsAjax) {
            programDetailsAjax = APP.global.postFormData('/bin/servlet/programdetails');
        }

        return programDetailsAjax;
    };

    var getLoyaltyProfile = function (forceDataRefresh) {
        if (!loyaltyProfileAjax || forceDataRefresh) {
            APP.global.showLoader();
            loyaltyProfileAjax = $.ajax({
                type: 'POST',
                url: '/bin/servlet/loyalty',
                data: JSON.stringify({
                    service: 'getLoyaltyProfile',
                }),
                dataType: 'json',
                contentType: 'application/json',
            });
        }

        return loyaltyProfileAjax;
    };

    var resetLoyaltyEventStatus = function () {
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/loyalty',
            data: JSON.stringify({
                service: 'resetLoyaltyEventStatus',
            }),
            dataType: 'json',
            contentType: 'application/json',
        });
    };

    var getAllCertificates = function () {
        if (!allCertificatesAjax) {
            APP.global.showLoader();
            allCertificatesAjax = $.ajax({
                type: 'POST',
                url: '/bin/servlet/loyalty',
                data: JSON.stringify({
                    service: 'getAllCertificates',
                }),
                dataType: 'json',
                contentType: 'application/json',
            });
        }

        return allCertificatesAjax;
    };

    var getAvailableOffers = function () {
        if (!availableOffersAjax) {
            APP.global.showLoader();
            availableOffersAjax = $.ajax({
                type: 'POST',
                url: '/bin/servlet/getAvailableOffers',
                data: JSON.stringify({
                    service: 'getAvailableOffers',
                }),
                dataType: 'json',
                contentType: 'application/json',
                dataFilter: function (data, type) {
                    data = JSON.parse(data).data;
                    data.bonusPoints = [];
                    data.offersAndDeals = [];
                    $.each(data.offerList, function (index, obj) {
                        if (obj.imageURL2.match(/(plus\d+|add\d+|\d+x)/g)) {
                            obj.bonusPointVal = obj.imageURL2.match(/(\d+x|\d+)/g);
                            data.bonusPoints.push(obj);
                        } else {
                            data.offersAndDeals.push(obj);
                        }
                    });
                    delete data.offerList;
                    return JSON.stringify(data);
                },
            });
        }

        return availableOffersAjax;
    };

    return {
        getRewardsCatalog: getRewardsCatalog,
        getProgramDetails: getProgramDetails,
        getLoyaltyProfile: getLoyaltyProfile,
        getAllCertificates: getAllCertificates,
        getAvailableOffers: getAvailableOffers,
        resetLoyaltyEventStatus: resetLoyaltyEventStatus,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.managePaymentsStore = {
    state: {
        ddCards: [],
        ddCardImages: [],
        creditCards: [],
        allAddresses: [],
        selectedDDCard: null,
        selectedCreditCard: null,
        mergeBalance: {
            fromCard: '',
            toCard: '',
            swapped: false,
        },
    },
    selectors: {
        addDunkinCardModal: '#add-dunkin-card-modal',
        mergeBalanceModal: '#merge-balance-modal',
        deleteDDCardConfirmationModal: '#delete-dd-card-confirmation-modal',
        deleteCreditCardConfirmationModal: '#delete-credit-card-confirmation-modal',
        addEditPaymentTypeModal: '#add-edit-payment-type-modal',
        turnOffArConfirmationModal: '#turn-off-ar-confirmation-modal',
    },
    runningRequests: [],
    getAllDDCards: function ($errorElem) {
        var self = this,
            fname = 'getAllDDCards';
        if (self.runningRequests.indexOf(fname) == -1) {
            self.runningRequests.push(fname);
            $.ajax({
                type: 'POST',
                url: '/bin/servlet/transaction',
                data: JSON.stringify({
                    service: 'getDdCardDetails',
                }),
                dataType: 'json',
                contentType: 'application/json',
            })
                .done(function (response) {
                    self.state.ddCards = response.data;
                })
                .fail(function (jqXHR) {
                    var response = JSON.parse(jqXHR.responseText);
                    if (response.error.code != 'APP4238') {
                        APP.global.getErrorMsg(jqXHR, $errorElem);
                    }
                })
                .always(function () {
                    self.runningRequests.splice(self.runningRequests.indexOf(fname), 1);
                });
        }
    },
    getAllDDCardsImages: function($errorElem, callBackFn){
        var self = this,
            fname = 'getAllDDCardsImages';
        if (self.runningRequests.indexOf(fname) == -1) {
            self.runningRequests.push(fname);
            $.ajax({
                type: 'POST',
                url: '/bin/servlet/transaction',
                data: JSON.stringify({
                    service: 'getDDCardDesignInfo',
                }),
                dataType: 'json',
                contentType: 'application/json',
            })
                .done(function (response) {
                    self.state.ddCardImages = response.data.availableGiftCardDesigns;
                })
                .fail(function (jqXHR) {
                    APP.global.getErrorMsg(jqXHR, $errorElem);
                })
                .always(function () {
                    self.runningRequests.splice(self.runningRequests.indexOf(fname), 1);
                    callBackFn ? callBackFn() : null;
                });
        }
    },
    addDDCard: function (actionURL, formData, $errorElem) {
        var self = this;
        return APP.global.postFormData(
            actionURL,
            formData,
            function (response) {
                self.state.ddCards.push(response.data);
            },
            function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            }
        );
    },
    deleteDDCard: function ($errorElem) {
        var self = this;
        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                'card-number': self.state.selectedDDCard.cardNumber,
                service: 'deleteDdCard',
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                if(self.state.selectedDDCard.defaultCard){
                    self.getAllDDCards($errorElem);
                }
                else{
                    self.state.ddCards.splice(self.state.ddCards.indexOf(self.state.selectedDDCard), 1);
                }
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });
    },
    getDDCardBalance: function () {
        var self = this;
        return $.ajax({
            url: '/bin/servlet/ddcard',
            method: 'POST',
            data: {
                service: 'getBalance',
                'card-number': self.state.selectedDDCard.cardNumber,
                pin: self.state.selectedDDCard.cardPin,
            },
            success: function (response) {
                self.state.selectedDDCard.balance.balance = response.data.balance;
                self.state.selectedDDCard.balance.displayDate = response.data.displayDate;
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });
    },
    rechargeDDCard: function (actionURL, payload, $errorElem) {
        var self = this;
        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify(payload),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                self.updateCardBalanceAfterRecharge(response.data.ddCard.balance.balance);
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });
    },
    updateCardBalanceAfterRecharge: function (newBalance) {
        this.state.selectedDDCard.balance.balance = newBalance;
    },

    getAutoReloadDetails: function (cardNumber, $errorElem) {
        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                ddCard: {
                    cardNumber: cardNumber,
                },
                service: 'getAutoRechargeDetails',
            }),
            dataType: 'json',
            contentType: 'application/json',
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });
    },
    turnOnAutoRecharge: function (autoRechargeObj, $errorElem) {
        var self = this;
        var autoReloadJSON = {
            autoRecharge: autoRechargeObj,
            service: 'autoRechargeDdCard',
        };
        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify(autoReloadJSON),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                self.updateAutoReloadStatus(true);
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });
    },
    turnOffAutoRecharge: function (cardNumber, $errorElem) {
        var self = this;
        var autoReloadJSON = {
            ddCard: {
                cardNumber: cardNumber,
            },
            service: 'turnOffAutoRecharge',
        };
        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify(autoReloadJSON),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                if (response.data) {
                    self.updateAutoReloadStatus(false);
                }
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });
    },
    updateAutoReloadStatus: function (status) {
        this.state.selectedDDCard.autorechargeActive = status;
    },

    mergeBalanceDDCard: function (fromCard, toCard, recaptchaResponse, $errorElem) {
        var self = this;
        var deferred = new $.Deferred();
        var transferBalanceJSON = {
            ddCard: {
                cardNumber: toCard.cardNumber,
                ddCards: [fromCard.cardNumber],
            },
            service: 'mergeBalanceDDCard',
            'g-recaptcha-response': recaptchaResponse,
        };

        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: encodeURIComponent(JSON.stringify(transferBalanceJSON)),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                if (response.data.failure.length > 0) {
                    deferred.reject(response);
                    APP.global.getErrorMsg(response.data.failure[0].errorMessage, $errorElem);
                } else {
                    deferred.resolve(response);
                    self.updateToCardAfterMergeBalance(fromCard, toCard, response.data.newBalance);
                    self.deleteMergedCardFromList(fromCard);
                }
            },
            error: function (jqXHR) {
                deferred.reject(jqXHR);
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });

        return deferred.promise();
    },
    setCardsForMergeBalance: function (fromCard) {
        this.state.mergeBalance.fromCard = fromCard;
        this.state.mergeBalance.toCard = this.state.ddCards.find(function (card) {
            return card.defaultCard;
        });
        this.state.mergeBalance.swapped = false;
    },
    swapCardsForMergeBalance: function () {
        this.state.mergeBalance.swapped = !this.state.mergeBalance.swapped;
    },
    updateToCardAfterMergeBalance: function (fromCard, toCard, newBalance) {
        toCard.balance.balance = newBalance;
        if (fromCard.defaultCard) {
            toCard.defaultCard = true;
        }
        this.state.ddCards.splice(this.state.ddCards.indexOf(toCard), 1);
        this.state.ddCards.unshift(toCard);
    },
    deleteMergedCardFromList: function (fromCard) {
        this.state.ddCards.splice(this.state.ddCards.indexOf(fromCard), 1);
    },
    setPrimaryDDCard: function ($errorElem) {
        var self = this;
        var payload = {
            ddCard: this.state.selectedDDCard,
            service: 'setPrimaryDDCard',
        };

        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify(payload),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                var prevDefaultCard = self.state.ddCards.find(function (card) {
                    return card.defaultCard;
                });
                prevDefaultCard.defaultCard = false;
                self.state.selectedDDCard.defaultCard = true;
                self.state.ddCards.splice(self.state.ddCards.indexOf(self.state.selectedDDCard), 1);
                self.state.ddCards.unshift(self.state.selectedDDCard);
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
        });
    },
    setSelectedDDCard: function (obj) {
        this.state.selectedDDCard = obj;
    },
    clearSelectedDDCard: function () {
        this.state.selectedDDCard = null;
    },

    getCreditCards: function ($errorElem) {
        var self = this,
            fname = 'getCreditCards',
            $errorElements = $();
        $errorElements = $errorElements.add($errorElem);

        if (self.runningRequests.indexOf(fname) == -1) {
            self.runningRequests.push(fname);
            $.ajax({
                type: 'POST',
                url: '/bin/servlet/creditcard',
                data: JSON.stringify({
                    service: 'getCreditCards',
                }),
                contentType: 'application/json',
                dataType: 'json',
            })
                .done(function (response) {
                    self.state.creditCards = response.data;
                })
                .fail(function (jqXHR) {
                    var response = JSON.parse(jqXHR.responseText);
                    if (response.error.code != 'APP4206') {
                        APP.global.getErrorMsg(jqXHR, $errorElem);
                    }
                })
                .always(function () {
                    self.runningRequests.splice(self.runningRequests.indexOf(fname), 1);
                });
        }
    },
    addCreditCard: function (ccObj, $errorElem) {
        var self = this;
        var ccPayload = {
            creditcard: ccObj,
            service: 'addCreditCard',
        };

        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/creditcard',
            data: JSON.stringify(ccPayload),
            contentType: 'application/json',
            success: function (response) {
                self.state.creditCards.push(response.data);
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
                $('.u-page-error').get(0).scrollIntoView({
                    behavior: 'smooth',
                });
            },
        });
    },
    modifyCreditCard: function (ccObj, $errorElem) {
        var self = this;
        var ccPayload = {
            creditcard: ccObj,
            service: 'modifyCreditCard',
        };

        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/creditcard',
            data: JSON.stringify(ccPayload),
            success: function (response) {
                self.state.selectedCreditCard.autorecharge = response.data.autorecharge;
                self.state.selectedCreditCard.active = response.data.active;
                self.state.selectedCreditCard.encryptedAddressId = response.data.encryptedAddressId;
                self.state.selectedCreditCard.encryptedCCId = response.data.encryptedCCId;
                self.state.selectedCreditCard.expMonth = response.data.expMonth;
                self.state.selectedCreditCard.expYear = response.data.expYear;
                self.state.selectedCreditCard.holderName = response.data.holderName;
                self.state.selectedCreditCard.type = response.data.type;
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            },
            dataType: 'json',
            contentType: 'application/json',
        });
    },
    updateCreditCardDetailsAfterModify: function (card) {},
    setSelectedCreditCard: function (obj) {
        this.state.selectedCreditCard = obj;
    },
    clearSelectedCreditCard: function () {
        this.state.selectedCreditCard = null;
    },
    deleteCreditCard: function (encryptedCCId, $errorElem) {
        var self = this;
        var creditCardData = {
            creditcard: {
                encryptedCCId: encryptedCCId,
            },
            service: 'deleteCreditCard',
        };
        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/creditcard',
            data: JSON.stringify(creditCardData),
            dataType: 'json',
            contentType: 'application/json',
        })
            .done(function (response) {
                self.state.creditCards.splice(self.state.creditCards.indexOf(self.state.selectedCreditCard), 1);
                self.getAllDDCards($());
            })
            .fail(function () {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            });
    },

    getAllAddresses: function ($errorElem) {
        var self = this,
            fname = 'getAllAddresses';
        if (self.runningRequests.indexOf(fname) == -1) {
            self.runningRequests.push(fname);
            $.ajax({
                type: 'POST',
                url: '/bin/servlet/address',
                data: JSON.stringify({
                    service: 'getAllAddresses',
                }),
                dataType: 'json',
                contentType: 'application/json',
            })
                .done(function (response) {
                    self.state.allAddresses = response.data;
                })
                .fail(function (jqXHR) {
                    APP.global.getErrorMsg(jqXHR, $errorElem);
                })
                .always(function () {
                    self.runningRequests.splice(self.runningRequests.indexOf(fname), 1);
                });
        }
    },
    addNewAddress: function (addressObj, $errorElem) {
        var self = this;
        var addressPayload = {
            address: addressObj,
            service: 'addNewAddress',
        };

        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/address',
            data: JSON.stringify(addressPayload),
            dataType: 'json',
            contentType: 'application/json',
        })
            .done(function (response) {
                self.state.allAddresses.push(response.data);
            })
            .fail(function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            });
    },
    updateAddress: function (addressObj, originalAddressObj, $errorElem) {
        var addressPayload = {
            address: addressObj,
            service: 'modifyAddress',
        };

        return $.ajax({
            type: 'POST',
            url: '/bin/servlet/address',
            data: JSON.stringify(addressPayload),
            dataType: 'json',
            contentType: 'application/json',
        })
            .done(function (response) {
                originalAddressObj.firstStreet = response.data.firstStreet;
                originalAddressObj.secondStreet = response.data.secondStreet;
                originalAddressObj.city = response.data.city;
                originalAddressObj.state = response.data.state;
                originalAddressObj.zipCode5 = response.data.zipCode5;
                originalAddressObj.firstName = response.data.firstName;
                originalAddressObj.lastName = response.data.lastName;
            })
            .fail(function () {
                APP.global.getErrorMsg(jqXHR, $errorElem);
            });
    },

    showSuccessModal: function (title, subTitle, delay) {
        var $modal = $('#manage-payments-success-modal');
        $modal.find('.teaser-new__title > span').text(title);
        $modal.find('.teaser-new__subtitle').text(subTitle);
        if (delay) {
            setTimeout(function () {
                APP.modal.showModal(null, $modal);
            }, 1000);
        } else {
            APP.modal.showModal(null, $modal);
        }
    },

    getDDCardImageMixin: {
        methods: {
            getDDCardImage: function(card){
                var cardDesign;
                if(card){
                    cardDesign = APP.managePaymentsStore.state.ddCardImages.find(function(design){
                        return design.cardDesignId == card.designId;
                    });
                }
                return cardDesign ? cardDesign.art[0].images[2].url : "/etc/designs/dd/images/dd-card/dd-sample-card.svg";
            }
        }
    }
};

/*! jQuery UI - v1.12.1 - 2020-10-26
 * http://jqueryui.com
 * Includes: keycode.js, widgets/datepicker.js
 * Copyright jQuery Foundation and other contributors; Licensed MIT */

(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], factory);
    } else {
        // Browser globals
        factory(jQuery);
    }
})(function ($) {
    $.ui = $.ui || {};

    var version = ($.ui.version = '1.12.1');

    /*!
     * jQuery UI Keycode 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Keycode
    //>>group: Core
    //>>description: Provide keycodes as keynames
    //>>docs: http://api.jqueryui.com/jQuery.ui.keyCode/

    var keycode = ($.ui.keyCode = {
        BACKSPACE: 8,
        COMMA: 188,
        DELETE: 46,
        DOWN: 40,
        END: 35,
        ENTER: 13,
        ESCAPE: 27,
        HOME: 36,
        LEFT: 37,
        PAGE_DOWN: 34,
        PAGE_UP: 33,
        PERIOD: 190,
        RIGHT: 39,
        SPACE: 32,
        TAB: 9,
        UP: 38,
    });

    // jscs:disable maximumLineLength
    /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
    /*!
     * jQuery UI Datepicker 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Datepicker
    //>>group: Widgets
    //>>description: Displays a calendar from an input or inline for selecting dates.
    //>>docs: http://api.jqueryui.com/datepicker/
    //>>demos: http://jqueryui.com/datepicker/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/datepicker.css
    //>>css.theme: ../../themes/base/theme.css

    $.extend($.ui, { datepicker: { version: '1.12.1' } });

    var datepicker_instActive;

    function datepicker_getZindex(elem) {
        var position, value;
        while (elem.length && elem[0] !== document) {
            // Ignore z-index if position is set to a value where z-index is ignored by the browser
            // This makes behavior of this function consistent across browsers
            // WebKit always returns auto if the element is positioned
            position = elem.css('position');
            if (position === 'absolute' || position === 'relative' || position === 'fixed') {
                // IE returns 0 when zIndex is not specified
                // other browsers return a string
                // we ignore the case of nested elements with an explicit value of 0
                // <div style="z-index: -10;"><div style="z-index: 0;"></div></div>
                value = parseInt(elem.css('zIndex'), 10);
                if (!isNaN(value) && value !== 0) {
                    return value;
                }
            }
            elem = elem.parent();
        }

        return 0;
    }
    /* Date picker manager.
   Use the singleton instance of this class, $.datepicker, to interact with the date picker.
   Settings for (groups of) date pickers are maintained in an instance object,
   allowing multiple different settings on the same page. */

    function Datepicker() {
        this._curInst = null; // The current instance in use
        this._keyEvent = false; // If the last event was a key event
        this._disabledInputs = []; // List of date picker inputs that have been disabled
        this._datepickerShowing = false; // True if the popup picker is showing , false if not
        this._inDialog = false; // True if showing within a "dialog", false if not
        this._mainDivId = 'ui-datepicker-div'; // The ID of the main datepicker division
        this._inlineClass = 'ui-datepicker-inline'; // The name of the inline marker class
        this._appendClass = 'ui-datepicker-append'; // The name of the append marker class
        this._triggerClass = 'ui-datepicker-trigger'; // The name of the trigger marker class
        this._dialogClass = 'ui-datepicker-dialog'; // The name of the dialog marker class
        this._disableClass = 'ui-datepicker-disabled'; // The name of the disabled covering marker class
        this._unselectableClass = 'ui-datepicker-unselectable'; // The name of the unselectable cell marker class
        this._currentClass = 'ui-datepicker-current-day'; // The name of the current day marker class
        this._dayOverClass = 'ui-datepicker-days-cell-over'; // The name of the day hover marker class
        this.regional = []; // Available regional settings, indexed by language code
        this.regional[''] = {
            // Default regional settings
            closeText: 'Done', // Display text for close link
            prevText: 'Prev', // Display text for previous month link
            nextText: 'Next', // Display text for next month link
            currentText: 'Today', // Display text for current month link
            monthNames: [
                'January',
                'February',
                'March',
                'April',
                'May',
                'June',
                'July',
                'August',
                'September',
                'October',
                'November',
                'December',
            ], // Names of months for drop-down and formatting
            monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], // For formatting
            dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'], // For formatting
            dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'], // For formatting
            dayNamesMin: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'], // Column headings for days starting at Sunday
            weekHeader: 'Wk', // Column header for week of the year
            dateFormat: 'mm/dd/yy', // See format options on parseDate
            firstDay: 0, // The first day of the week, Sun = 0, Mon = 1, ...
            isRTL: false, // True if right-to-left language, false if left-to-right
            showMonthAfterYear: false, // True if the year select precedes month, false for month then year
            yearSuffix: '', // Additional text to append to the year in the month headers
        };
        this._defaults = {
            // Global defaults for all the date picker instances
            showOn: 'focus', // "focus" for popup on focus,
            // "button" for trigger button, or "both" for either
            showAnim: 'fadeIn', // Name of jQuery animation for popup
            showOptions: {}, // Options for enhanced animations
            defaultDate: null, // Used when field is blank: actual date,
            // +/-number for offset from today, null for today
            appendText: '', // Display text following the input box, e.g. showing the format
            buttonText: '...', // Text for trigger button
            buttonImage: '', // URL for trigger button image
            buttonImageOnly: false, // True if the image appears alone, false if it appears on a button
            hideIfNoPrevNext: false, // True to hide next/previous month links
            // if not applicable, false to just disable them
            navigationAsDateFormat: false, // True if date formatting applied to prev/today/next links
            gotoCurrent: false, // True if today link goes back to current selection instead
            changeMonth: false, // True if month can be selected directly, false if only prev/next
            changeYear: false, // True if year can be selected directly, false if only prev/next
            yearRange: 'c-10:c+10', // Range of years to display in drop-down,
            // either relative to today's year (-nn:+nn), relative to currently displayed year
            // (c-nn:c+nn), absolute (nnnn:nnnn), or a combination of the above (nnnn:-n)
            showOtherMonths: false, // True to show dates in other months, false to leave blank
            selectOtherMonths: false, // True to allow selection of dates in other months, false for unselectable
            showWeek: false, // True to show week of the year, false to not show it
            calculateWeek: this.iso8601Week, // How to calculate the week of the year,
            // takes a Date and returns the number of the week for it
            shortYearCutoff: '+10', // Short year values < this are in the current century,
            // > this are in the previous century,
            // string value starting with "+" for current year + value
            minDate: null, // The earliest selectable date, or null for no limit
            maxDate: null, // The latest selectable date, or null for no limit
            duration: 'fast', // Duration of display/closure
            beforeShowDay: null, // Function that takes a date and returns an array with
            // [0] = true if selectable, false if not, [1] = custom CSS class name(s) or "",
            // [2] = cell title (optional), e.g. $.datepicker.noWeekends
            beforeShow: null, // Function that takes an input field and
            // returns a set of custom settings for the date picker
            onSelect: null, // Define a callback function when a date is selected
            onChangeMonthYear: null, // Define a callback function when the month or year is changed
            onClose: null, // Define a callback function when the datepicker is closed
            numberOfMonths: 1, // Number of months to show at a time
            showCurrentAtPos: 0, // The position in multipe months at which to show the current month (starting at 0)
            stepMonths: 1, // Number of months to step back/forward
            stepBigMonths: 12, // Number of months to step back/forward for the big links
            altField: '', // Selector for an alternate field to store selected dates into
            altFormat: '', // The date format to use for the alternate field
            constrainInput: true, // The input is constrained by the current date format
            showButtonPanel: false, // True to show button panel, false to not show it
            autoSize: false, // True to size the input for the date format, false to leave as is
            disabled: false, // The initial disabled state
        };
        $.extend(this._defaults, this.regional['']);
        this.regional.en = $.extend(true, {}, this.regional['']);
        this.regional['en-US'] = $.extend(true, {}, this.regional.en);
        this.dpDiv = datepicker_bindHover(
            $(
                "<div id='" +
                    this._mainDivId +
                    "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"
            )
        );
    }

    $.extend(Datepicker.prototype, {
        /* Class name added to elements to indicate already configured with a date picker. */
        markerClassName: 'hasDatepicker',

        //Keep track of the maximum number of rows displayed (see #7043)
        maxRows: 4,

        // TODO rename to "widget" when switching to widget factory
        _widgetDatepicker: function () {
            return this.dpDiv;
        },

        /* Override the default settings for all instances of the date picker.
         * @param  settings  object - the new settings to use as defaults (anonymous object)
         * @return the manager object
         */
        setDefaults: function (settings) {
            datepicker_extendRemove(this._defaults, settings || {});
            return this;
        },

        /* Attach the date picker to a jQuery selection.
         * @param  target	element - the target input field or division or span
         * @param  settings  object - the new settings to use for this date picker instance (anonymous)
         */
        _attachDatepicker: function (target, settings) {
            var nodeName, inline, inst;
            nodeName = target.nodeName.toLowerCase();
            inline = nodeName === 'div' || nodeName === 'span';
            if (!target.id) {
                this.uuid += 1;
                target.id = 'dp' + this.uuid;
            }
            inst = this._newInst($(target), inline);
            inst.settings = $.extend({}, settings || {});
            if (nodeName === 'input') {
                this._connectDatepicker(target, inst);
            } else if (inline) {
                this._inlineDatepicker(target, inst);
            }
        },

        /* Create a new instance object. */
        _newInst: function (target, inline) {
            var id = target[0].id.replace(/([^A-Za-z0-9_\-])/g, '\\\\$1'); // escape jQuery meta chars
            return {
                id: id,
                input: target, // associated target
                selectedDay: 0,
                selectedMonth: 0,
                selectedYear: 0, // current selection
                drawMonth: 0,
                drawYear: 0, // month being drawn
                inline: inline, // is datepicker inline or not
                dpDiv: !inline
                    ? this.dpDiv // presentation div
                    : datepicker_bindHover(
                          $(
                              "<div class='" +
                                  this._inlineClass +
                                  " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"
                          )
                      ),
            };
        },

        /* Attach the date picker to an input field. */
        _connectDatepicker: function (target, inst) {
            var input = $(target);
            inst.append = $([]);
            inst.trigger = $([]);
            if (input.hasClass(this.markerClassName)) {
                return;
            }
            this._attachments(input, inst);
            input
                .addClass(this.markerClassName)
                .on('keydown', this._doKeyDown)
                .on('keypress', this._doKeyPress)
                .on('keyup', this._doKeyUp);
            this._autoSize(inst);
            $.data(target, 'datepicker', inst);

            //If disabled option is true, disable the datepicker once it has been attached to the input (see ticket #5665)
            if (inst.settings.disabled) {
                this._disableDatepicker(target);
            }
        },

        /* Make attachments based on settings. */
        _attachments: function (input, inst) {
            var showOn,
                buttonText,
                buttonImage,
                appendText = this._get(inst, 'appendText'),
                isRTL = this._get(inst, 'isRTL');

            if (inst.append) {
                inst.append.remove();
            }
            if (appendText) {
                inst.append = $("<span class='" + this._appendClass + "'>" + appendText + '</span>');
                input[isRTL ? 'before' : 'after'](inst.append);
            }

            input.off('focus', this._showDatepicker);

            if (inst.trigger) {
                inst.trigger.remove();
            }

            showOn = this._get(inst, 'showOn');
            if (showOn === 'focus' || showOn === 'both') {
                // pop-up date picker when in the marked field
                input.on('focus', this._showDatepicker);
            }
            if (showOn === 'button' || showOn === 'both') {
                // pop-up date picker when button clicked
                buttonText = this._get(inst, 'buttonText');
                buttonImage = this._get(inst, 'buttonImage');
                inst.trigger = $(
                    this._get(inst, 'buttonImageOnly')
                        ? $('<img/>').addClass(this._triggerClass).attr({ src: buttonImage, alt: buttonText, title: buttonText })
                        : $("<button type='button'></button>")
                              .addClass(this._triggerClass)
                              .html(
                                  !buttonImage
                                      ? buttonText
                                      : $('<img/>').attr({ src: buttonImage, alt: buttonText, title: buttonText })
                              )
                );
                input[isRTL ? 'before' : 'after'](inst.trigger);
                inst.trigger.on('click', function () {
                    if ($.datepicker._datepickerShowing && $.datepicker._lastInput === input[0]) {
                        $.datepicker._hideDatepicker();
                    } else if ($.datepicker._datepickerShowing && $.datepicker._lastInput !== input[0]) {
                        $.datepicker._hideDatepicker();
                        $.datepicker._showDatepicker(input[0]);
                    } else {
                        $.datepicker._showDatepicker(input[0]);
                    }
                    return false;
                });
            }
        },

        /* Apply the maximum length for the date format. */
        _autoSize: function (inst) {
            if (this._get(inst, 'autoSize') && !inst.inline) {
                var findMax,
                    max,
                    maxI,
                    i,
                    date = new Date(2009, 12 - 1, 20), // Ensure double digits
                    dateFormat = this._get(inst, 'dateFormat');

                if (dateFormat.match(/[DM]/)) {
                    findMax = function (names) {
                        max = 0;
                        maxI = 0;
                        for (i = 0; i < names.length; i++) {
                            if (names[i].length > max) {
                                max = names[i].length;
                                maxI = i;
                            }
                        }
                        return maxI;
                    };
                    date.setMonth(findMax(this._get(inst, dateFormat.match(/MM/) ? 'monthNames' : 'monthNamesShort')));
                    date.setDate(
                        findMax(this._get(inst, dateFormat.match(/DD/) ? 'dayNames' : 'dayNamesShort')) + 20 - date.getDay()
                    );
                }
                inst.input.attr('size', this._formatDate(inst, date).length);
            }
        },

        /* Attach an inline date picker to a div. */
        _inlineDatepicker: function (target, inst) {
            var divSpan = $(target);
            if (divSpan.hasClass(this.markerClassName)) {
                return;
            }
            divSpan.addClass(this.markerClassName).append(inst.dpDiv);
            $.data(target, 'datepicker', inst);
            this._setDate(inst, this._getDefaultDate(inst), true);
            this._updateDatepicker(inst);
            this._updateAlternate(inst);

            //If disabled option is true, disable the datepicker before showing it (see ticket #5665)
            if (inst.settings.disabled) {
                this._disableDatepicker(target);
            }

            // Set display:block in place of inst.dpDiv.show() which won't work on disconnected elements
            // http://bugs.jqueryui.com/ticket/7552 - A Datepicker created on a detached div has zero height
            inst.dpDiv.css('display', 'block');
        },

        /* Pop-up the date picker in a "dialog" box.
         * @param  input element - ignored
         * @param  date	string or Date - the initial date to display
         * @param  onSelect  function - the function to call when a date is selected
         * @param  settings  object - update the dialog date picker instance's settings (anonymous object)
         * @param  pos int[2] - coordinates for the dialog's position within the screen or
         *					event - with x/y coordinates or
         *					leave empty for default (screen centre)
         * @return the manager object
         */
        _dialogDatepicker: function (input, date, onSelect, settings, pos) {
            var id,
                browserWidth,
                browserHeight,
                scrollX,
                scrollY,
                inst = this._dialogInst; // internal instance

            if (!inst) {
                this.uuid += 1;
                id = 'dp' + this.uuid;
                this._dialogInput = $(
                    "<input type='text' id='" + id + "' style='position: absolute; top: -100px; width: 0px;'/>"
                );
                this._dialogInput.on('keydown', this._doKeyDown);
                $('body').append(this._dialogInput);
                inst = this._dialogInst = this._newInst(this._dialogInput, false);
                inst.settings = {};
                $.data(this._dialogInput[0], 'datepicker', inst);
            }
            datepicker_extendRemove(inst.settings, settings || {});
            date = date && date.constructor === Date ? this._formatDate(inst, date) : date;
            this._dialogInput.val(date);

            this._pos = pos ? (pos.length ? pos : [pos.pageX, pos.pageY]) : null;
            if (!this._pos) {
                browserWidth = document.documentElement.clientWidth;
                browserHeight = document.documentElement.clientHeight;
                scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
                scrollY = document.documentElement.scrollTop || document.body.scrollTop;
                this._pos =
                    // should use actual width/height below
                    [browserWidth / 2 - 100 + scrollX, browserHeight / 2 - 150 + scrollY];
            }

            // Move input on screen for focus, but hidden behind dialog
            this._dialogInput.css('left', this._pos[0] + 20 + 'px').css('top', this._pos[1] + 'px');
            inst.settings.onSelect = onSelect;
            this._inDialog = true;
            this.dpDiv.addClass(this._dialogClass);
            this._showDatepicker(this._dialogInput[0]);
            if ($.blockUI) {
                $.blockUI(this.dpDiv);
            }
            $.data(this._dialogInput[0], 'datepicker', inst);
            return this;
        },

        /* Detach a datepicker from its control.
         * @param  target	element - the target input field or division or span
         */
        _destroyDatepicker: function (target) {
            var nodeName,
                $target = $(target),
                inst = $.data(target, 'datepicker');

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            $.removeData(target, 'datepicker');
            if (nodeName === 'input') {
                inst.append.remove();
                inst.trigger.remove();
                $target
                    .removeClass(this.markerClassName)
                    .off('focus', this._showDatepicker)
                    .off('keydown', this._doKeyDown)
                    .off('keypress', this._doKeyPress)
                    .off('keyup', this._doKeyUp);
            } else if (nodeName === 'div' || nodeName === 'span') {
                $target.removeClass(this.markerClassName).empty();
            }

            if (datepicker_instActive === inst) {
                datepicker_instActive = null;
            }
        },

        /* Enable the date picker to a jQuery selection.
         * @param  target	element - the target input field or division or span
         */
        _enableDatepicker: function (target) {
            var nodeName,
                inline,
                $target = $(target),
                inst = $.data(target, 'datepicker');

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            if (nodeName === 'input') {
                target.disabled = false;
                inst.trigger
                    .filter('button')
                    .each(function () {
                        this.disabled = false;
                    })
                    .end()
                    .filter('img')
                    .css({ opacity: '1.0', cursor: '' });
            } else if (nodeName === 'div' || nodeName === 'span') {
                inline = $target.children('.' + this._inlineClass);
                inline.children().removeClass('ui-state-disabled');
                inline.find('select.ui-datepicker-month, select.ui-datepicker-year').prop('disabled', false);
            }
            this._disabledInputs = $.map(this._disabledInputs, function (value) {
                return value === target ? null : value;
            }); // delete entry
        },

        /* Disable the date picker to a jQuery selection.
         * @param  target	element - the target input field or division or span
         */
        _disableDatepicker: function (target) {
            var nodeName,
                inline,
                $target = $(target),
                inst = $.data(target, 'datepicker');

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            if (nodeName === 'input') {
                target.disabled = true;
                inst.trigger
                    .filter('button')
                    .each(function () {
                        this.disabled = true;
                    })
                    .end()
                    .filter('img')
                    .css({ opacity: '0.5', cursor: 'default' });
            } else if (nodeName === 'div' || nodeName === 'span') {
                inline = $target.children('.' + this._inlineClass);
                inline.children().addClass('ui-state-disabled');
                inline.find('select.ui-datepicker-month, select.ui-datepicker-year').prop('disabled', true);
            }
            this._disabledInputs = $.map(this._disabledInputs, function (value) {
                return value === target ? null : value;
            }); // delete entry
            this._disabledInputs[this._disabledInputs.length] = target;
        },

        /* Is the first field in a jQuery collection disabled as a datepicker?
         * @param  target	element - the target input field or division or span
         * @return boolean - true if disabled, false if enabled
         */
        _isDisabledDatepicker: function (target) {
            if (!target) {
                return false;
            }
            for (var i = 0; i < this._disabledInputs.length; i++) {
                if (this._disabledInputs[i] === target) {
                    return true;
                }
            }
            return false;
        },

        /* Retrieve the instance data for the target control.
         * @param  target  element - the target input field or division or span
         * @return  object - the associated instance data
         * @throws  error if a jQuery problem getting data
         */
        _getInst: function (target) {
            try {
                return $.data(target, 'datepicker');
            } catch (err) {
                throw 'Missing instance data for this datepicker';
            }
        },

        /* Update or retrieve the settings for a date picker attached to an input field or division.
         * @param  target  element - the target input field or division or span
         * @param  name	object - the new settings to update or
         *				string - the name of the setting to change or retrieve,
         *				when retrieving also "all" for all instance settings or
         *				"defaults" for all global defaults
         * @param  value   any - the new value for the setting
         *				(omit if above is an object or to retrieve a value)
         */
        _optionDatepicker: function (target, name, value) {
            var settings,
                date,
                minDate,
                maxDate,
                inst = this._getInst(target);

            if (arguments.length === 2 && typeof name === 'string') {
                return name === 'defaults'
                    ? $.extend({}, $.datepicker._defaults)
                    : inst
                    ? name === 'all'
                        ? $.extend({}, inst.settings)
                        : this._get(inst, name)
                    : null;
            }

            settings = name || {};
            if (typeof name === 'string') {
                settings = {};
                settings[name] = value;
            }

            if (inst) {
                if (this._curInst === inst) {
                    this._hideDatepicker();
                }

                date = this._getDateDatepicker(target, true);
                minDate = this._getMinMaxDate(inst, 'min');
                maxDate = this._getMinMaxDate(inst, 'max');
                datepicker_extendRemove(inst.settings, settings);

                // reformat the old minDate/maxDate values if dateFormat changes and a new minDate/maxDate isn't provided
                if (minDate !== null && settings.dateFormat !== undefined && settings.minDate === undefined) {
                    inst.settings.minDate = this._formatDate(inst, minDate);
                }
                if (maxDate !== null && settings.dateFormat !== undefined && settings.maxDate === undefined) {
                    inst.settings.maxDate = this._formatDate(inst, maxDate);
                }
                if ('disabled' in settings) {
                    if (settings.disabled) {
                        this._disableDatepicker(target);
                    } else {
                        this._enableDatepicker(target);
                    }
                }
                this._attachments($(target), inst);
                this._autoSize(inst);
                this._setDate(inst, date);
                this._updateAlternate(inst);
                this._updateDatepicker(inst);
            }
        },

        // Change method deprecated
        _changeDatepicker: function (target, name, value) {
            this._optionDatepicker(target, name, value);
        },

        /* Redraw the date picker attached to an input field or division.
         * @param  target  element - the target input field or division or span
         */
        _refreshDatepicker: function (target) {
            var inst = this._getInst(target);
            if (inst) {
                this._updateDatepicker(inst);
            }
        },

        /* Set the dates for a jQuery selection.
         * @param  target element - the target input field or division or span
         * @param  date	Date - the new date
         */
        _setDateDatepicker: function (target, date) {
            var inst = this._getInst(target);
            if (inst) {
                this._setDate(inst, date);
                this._updateDatepicker(inst);
                this._updateAlternate(inst);
            }
        },

        /* Get the date(s) for the first entry in a jQuery selection.
         * @param  target element - the target input field or division or span
         * @param  noDefault boolean - true if no default date is to be used
         * @return Date - the current date
         */
        _getDateDatepicker: function (target, noDefault) {
            var inst = this._getInst(target);
            if (inst && !inst.inline) {
                this._setDateFromField(inst, noDefault);
            }
            return inst ? this._getDate(inst) : null;
        },

        /* Handle keystrokes. */
        _doKeyDown: function (event) {
            var onSelect,
                dateStr,
                sel,
                inst = $.datepicker._getInst(event.target),
                handled = true,
                isRTL = inst.dpDiv.is('.ui-datepicker-rtl');

            inst._keyEvent = true;
            if ($.datepicker._datepickerShowing) {
                switch (event.keyCode) {
                    case 9:
                        $.datepicker._hideDatepicker();
                        handled = false;
                        break; // hide on tab out
                    case 13:
                        sel = $('td.' + $.datepicker._dayOverClass + ':not(.' + $.datepicker._currentClass + ')', inst.dpDiv);
                        if (sel[0]) {
                            $.datepicker._selectDay(event.target, inst.selectedMonth, inst.selectedYear, sel[0]);
                        }

                        onSelect = $.datepicker._get(inst, 'onSelect');
                        if (onSelect) {
                            dateStr = $.datepicker._formatDate(inst);

                            // Trigger custom callback
                            onSelect.apply(inst.input ? inst.input[0] : null, [dateStr, inst]);
                        } else {
                            $.datepicker._hideDatepicker();
                        }

                        return false; // don't submit the form
                    case 27:
                        $.datepicker._hideDatepicker();
                        break; // hide on escape
                    case 33:
                        $.datepicker._adjustDate(
                            event.target,
                            event.ctrlKey ? -$.datepicker._get(inst, 'stepBigMonths') : -$.datepicker._get(inst, 'stepMonths'),
                            'M'
                        );
                        break; // previous month/year on page up/+ ctrl
                    case 34:
                        $.datepicker._adjustDate(
                            event.target,
                            event.ctrlKey ? +$.datepicker._get(inst, 'stepBigMonths') : +$.datepicker._get(inst, 'stepMonths'),
                            'M'
                        );
                        break; // next month/year on page down/+ ctrl
                    case 35:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._clearDate(event.target);
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // clear on ctrl or command +end
                    case 36:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._gotoToday(event.target);
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // current on ctrl or command +home
                    case 37:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, isRTL ? +1 : -1, 'D');
                        }
                        handled = event.ctrlKey || event.metaKey;

                        // -1 day on ctrl or command +left
                        if (event.originalEvent.altKey) {
                            $.datepicker._adjustDate(
                                event.target,
                                event.ctrlKey
                                    ? -$.datepicker._get(inst, 'stepBigMonths')
                                    : -$.datepicker._get(inst, 'stepMonths'),
                                'M'
                            );
                        }

                        // next month/year on alt +left on Mac
                        break;
                    case 38:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, -7, 'D');
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // -1 week on ctrl or command +up
                    case 39:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, isRTL ? -1 : +1, 'D');
                        }
                        handled = event.ctrlKey || event.metaKey;

                        // +1 day on ctrl or command +right
                        if (event.originalEvent.altKey) {
                            $.datepicker._adjustDate(
                                event.target,
                                event.ctrlKey
                                    ? +$.datepicker._get(inst, 'stepBigMonths')
                                    : +$.datepicker._get(inst, 'stepMonths'),
                                'M'
                            );
                        }

                        // next month/year on alt +right
                        break;
                    case 40:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, +7, 'D');
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // +1 week on ctrl or command +down
                    default:
                        handled = false;
                }
            } else if (event.keyCode === 36 && event.ctrlKey) {
                // display the date picker on ctrl+home
                $.datepicker._showDatepicker(this);
            } else {
                handled = false;
            }

            if (handled) {
                event.preventDefault();
                event.stopPropagation();
            }
        },

        /* Filter entered characters - based on date format. */
        _doKeyPress: function (event) {
            var chars,
                chr,
                inst = $.datepicker._getInst(event.target);

            if ($.datepicker._get(inst, 'constrainInput')) {
                chars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat'));
                chr = String.fromCharCode(event.charCode == null ? event.keyCode : event.charCode);
                return event.ctrlKey || event.metaKey || chr < ' ' || !chars || chars.indexOf(chr) > -1;
            }
        },

        /* Synchronise manual entry and field/alternate field. */
        _doKeyUp: function (event) {
            var date,
                inst = $.datepicker._getInst(event.target);

            if (inst.input.val() !== inst.lastVal) {
                try {
                    date = $.datepicker.parseDate(
                        $.datepicker._get(inst, 'dateFormat'),
                        inst.input ? inst.input.val() : null,
                        $.datepicker._getFormatConfig(inst)
                    );

                    if (date) {
                        // only if valid
                        $.datepicker._setDateFromField(inst);
                        $.datepicker._updateAlternate(inst);
                        $.datepicker._updateDatepicker(inst);
                    }
                } catch (err) {}
            }
            return true;
        },

        /* Pop-up the date picker for a given input field.
         * If false returned from beforeShow event handler do not show.
         * @param  input  element - the input field attached to the date picker or
         *					event - if triggered by focus
         */
        _showDatepicker: function (input) {
            input = input.target || input;
            if (input.nodeName.toLowerCase() !== 'input') {
                // find from button/image trigger
                input = $('input', input.parentNode)[0];
            }

            if ($.datepicker._isDisabledDatepicker(input) || $.datepicker._lastInput === input) {
                // already here
                return;
            }

            var inst, beforeShow, beforeShowSettings, isFixed, offset, showAnim, duration;

            inst = $.datepicker._getInst(input);
            if ($.datepicker._curInst && $.datepicker._curInst !== inst) {
                $.datepicker._curInst.dpDiv.stop(true, true);
                if (inst && $.datepicker._datepickerShowing) {
                    $.datepicker._hideDatepicker($.datepicker._curInst.input[0]);
                }
            }

            beforeShow = $.datepicker._get(inst, 'beforeShow');
            beforeShowSettings = beforeShow ? beforeShow.apply(input, [input, inst]) : {};
            if (beforeShowSettings === false) {
                return;
            }
            datepicker_extendRemove(inst.settings, beforeShowSettings);

            inst.lastVal = null;
            $.datepicker._lastInput = input;
            $.datepicker._setDateFromField(inst);

            if ($.datepicker._inDialog) {
                // hide cursor
                input.value = '';
            }
            if (!$.datepicker._pos) {
                // position below input
                $.datepicker._pos = $.datepicker._findPos(input);
                $.datepicker._pos[1] += input.offsetHeight; // add the height
            }

            isFixed = false;
            $(input)
                .parents()
                .each(function () {
                    isFixed |= $(this).css('position') === 'fixed';
                    return !isFixed;
                });

            offset = { left: $.datepicker._pos[0], top: $.datepicker._pos[1] };
            $.datepicker._pos = null;

            //to avoid flashes on Firefox
            inst.dpDiv.empty();

            // determine sizing offscreen
            inst.dpDiv.css({ position: 'absolute', display: 'block', top: '-1000px' });
            $.datepicker._updateDatepicker(inst);

            // fix width for dynamic number of date pickers
            // and adjust position before showing
            offset = $.datepicker._checkOffset(inst, offset, isFixed);
            inst.dpDiv.css({
                position: $.datepicker._inDialog && $.blockUI ? 'static' : isFixed ? 'fixed' : 'absolute',
                display: 'none',
                left: offset.left + 'px',
                top: offset.top + 'px',
            });

            if (!inst.inline) {
                showAnim = $.datepicker._get(inst, 'showAnim');
                duration = $.datepicker._get(inst, 'duration');
                inst.dpDiv.css('z-index', datepicker_getZindex($(input)) + 1);
                $.datepicker._datepickerShowing = true;

                if ($.effects && $.effects.effect[showAnim]) {
                    inst.dpDiv.show(showAnim, $.datepicker._get(inst, 'showOptions'), duration);
                } else {
                    inst.dpDiv[showAnim || 'show'](showAnim ? duration : null);
                }

                if ($.datepicker._shouldFocusInput(inst)) {
                    inst.input.trigger('focus');
                }

                $.datepicker._curInst = inst;
            }
        },

        /* Generate the date picker content. */
        _updateDatepicker: function (inst) {
            this.maxRows = 4; //Reset the max number of rows being displayed (see #7043)
            datepicker_instActive = inst; // for delegate hover events
            inst.dpDiv.empty().append(this._generateHTML(inst));
            this._attachHandlers(inst);

            var origyearshtml,
                numMonths = this._getNumberOfMonths(inst),
                cols = numMonths[1],
                width = 17,
                activeCell = inst.dpDiv.find('.' + this._dayOverClass + ' a');

            if (activeCell.length > 0) {
                datepicker_handleMouseover.apply(activeCell.get(0));
            }

            inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');
            if (cols > 1) {
                inst.dpDiv.addClass('ui-datepicker-multi-' + cols).css('width', width * cols + 'em');
            }
            inst.dpDiv[(numMonths[0] !== 1 || numMonths[1] !== 1 ? 'add' : 'remove') + 'Class']('ui-datepicker-multi');
            inst.dpDiv[(this._get(inst, 'isRTL') ? 'add' : 'remove') + 'Class']('ui-datepicker-rtl');

            if (inst === $.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput(inst)) {
                inst.input.trigger('focus');
            }

            // Deffered render of the years select (to avoid flashes on Firefox)
            if (inst.yearshtml) {
                origyearshtml = inst.yearshtml;
                setTimeout(function () {
                    //assure that inst.yearshtml didn't change.
                    if (origyearshtml === inst.yearshtml && inst.yearshtml) {
                        inst.dpDiv.find('select.ui-datepicker-year:first').replaceWith(inst.yearshtml);
                    }
                    origyearshtml = inst.yearshtml = null;
                }, 0);
            }
        },

        // #6694 - don't focus the input if it's already focused
        // this breaks the change event in IE
        // Support: IE and jQuery <1.9
        _shouldFocusInput: function (inst) {
            return inst.input && inst.input.is(':visible') && !inst.input.is(':disabled') && !inst.input.is(':focus');
        },

        /* Check positioning to remain on screen. */
        _checkOffset: function (inst, offset, isFixed) {
            var dpWidth = inst.dpDiv.outerWidth(),
                dpHeight = inst.dpDiv.outerHeight(),
                inputWidth = inst.input ? inst.input.outerWidth() : 0,
                inputHeight = inst.input ? inst.input.outerHeight() : 0,
                viewWidth = document.documentElement.clientWidth + (isFixed ? 0 : $(document).scrollLeft()),
                viewHeight = document.documentElement.clientHeight + (isFixed ? 0 : $(document).scrollTop());

            offset.left -= this._get(inst, 'isRTL') ? dpWidth - inputWidth : 0;
            offset.left -= isFixed && offset.left === inst.input.offset().left ? $(document).scrollLeft() : 0;
            offset.top -= isFixed && offset.top === inst.input.offset().top + inputHeight ? $(document).scrollTop() : 0;

            // Now check if datepicker is showing outside window viewport - move to a better place if so.
            offset.left -= Math.min(
                offset.left,
                offset.left + dpWidth > viewWidth && viewWidth > dpWidth ? Math.abs(offset.left + dpWidth - viewWidth) : 0
            );
            offset.top -= Math.min(
                offset.top,
                offset.top + dpHeight > viewHeight && viewHeight > dpHeight ? Math.abs(dpHeight + inputHeight) : 0
            );

            return offset;
        },

        /* Find an object's position on the screen. */
        _findPos: function (obj) {
            var position,
                inst = this._getInst(obj),
                isRTL = this._get(inst, 'isRTL');

            while (obj && (obj.type === 'hidden' || obj.nodeType !== 1 || $.expr.filters.hidden(obj))) {
                obj = obj[isRTL ? 'previousSibling' : 'nextSibling'];
            }

            position = $(obj).offset();
            return [position.left, position.top];
        },

        /* Hide the date picker from view.
         * @param  input  element - the input field attached to the date picker
         */
        _hideDatepicker: function (input) {
            var showAnim,
                duration,
                postProcess,
                onClose,
                inst = this._curInst;

            if (!inst || (input && inst !== $.data(input, 'datepicker'))) {
                return;
            }

            if (this._datepickerShowing) {
                showAnim = this._get(inst, 'showAnim');
                duration = this._get(inst, 'duration');
                postProcess = function () {
                    $.datepicker._tidyDialog(inst);
                };

                // DEPRECATED: after BC for 1.8.x $.effects[ showAnim ] is not needed
                if ($.effects && ($.effects.effect[showAnim] || $.effects[showAnim])) {
                    inst.dpDiv.hide(showAnim, $.datepicker._get(inst, 'showOptions'), duration, postProcess);
                } else {
                    inst.dpDiv[showAnim === 'slideDown' ? 'slideUp' : showAnim === 'fadeIn' ? 'fadeOut' : 'hide'](
                        showAnim ? duration : null,
                        postProcess
                    );
                }

                if (!showAnim) {
                    postProcess();
                }
                this._datepickerShowing = false;

                onClose = this._get(inst, 'onClose');
                if (onClose) {
                    onClose.apply(inst.input ? inst.input[0] : null, [inst.input ? inst.input.val() : '', inst]);
                }

                this._lastInput = null;
                if (this._inDialog) {
                    this._dialogInput.css({ position: 'absolute', left: '0', top: '-100px' });
                    if ($.blockUI) {
                        $.unblockUI();
                        $('body').append(this.dpDiv);
                    }
                }
                this._inDialog = false;
            }
        },

        /* Tidy up after a dialog display. */
        _tidyDialog: function (inst) {
            inst.dpDiv.removeClass(this._dialogClass).off('.ui-datepicker-calendar');
        },

        /* Close date picker if clicked elsewhere. */
        _checkExternalClick: function (event) {
            if (!$.datepicker._curInst) {
                return;
            }

            var $target = $(event.target),
                inst = $.datepicker._getInst($target[0]);

            if (
                ($target[0].id !== $.datepicker._mainDivId &&
                    $target.parents('#' + $.datepicker._mainDivId).length === 0 &&
                    !$target.hasClass($.datepicker.markerClassName) &&
                    !$target.closest('.' + $.datepicker._triggerClass).length &&
                    $.datepicker._datepickerShowing &&
                    !($.datepicker._inDialog && $.blockUI)) ||
                ($target.hasClass($.datepicker.markerClassName) && $.datepicker._curInst !== inst)
            ) {
                $.datepicker._hideDatepicker();
            }
        },

        /* Adjust one of the date sub-fields. */
        _adjustDate: function (id, offset, period) {
            var target = $(id),
                inst = this._getInst(target[0]);

            if (this._isDisabledDatepicker(target[0])) {
                return;
            }
            this._adjustInstDate(
                inst,
                offset + (period === 'M' ? this._get(inst, 'showCurrentAtPos') : 0), // undo positioning
                period
            );
            this._updateDatepicker(inst);
        },

        /* Action for current link. */
        _gotoToday: function (id) {
            var date,
                target = $(id),
                inst = this._getInst(target[0]);

            if (this._get(inst, 'gotoCurrent') && inst.currentDay) {
                inst.selectedDay = inst.currentDay;
                inst.drawMonth = inst.selectedMonth = inst.currentMonth;
                inst.drawYear = inst.selectedYear = inst.currentYear;
            } else {
                date = new Date();
                inst.selectedDay = date.getDate();
                inst.drawMonth = inst.selectedMonth = date.getMonth();
                inst.drawYear = inst.selectedYear = date.getFullYear();
            }
            this._notifyChange(inst);
            this._adjustDate(target);
        },

        /* Action for selecting a new month/year. */
        _selectMonthYear: function (id, select, period) {
            var target = $(id),
                inst = this._getInst(target[0]);

            inst['selected' + (period === 'M' ? 'Month' : 'Year')] = inst[
                'draw' + (period === 'M' ? 'Month' : 'Year')
            ] = parseInt(select.options[select.selectedIndex].value, 10);

            this._notifyChange(inst);
            this._adjustDate(target);
        },

        /* Action for selecting a day. */
        _selectDay: function (id, month, year, td) {
            var inst,
                target = $(id);

            if ($(td).hasClass(this._unselectableClass) || this._isDisabledDatepicker(target[0])) {
                return;
            }

            inst = this._getInst(target[0]);
            inst.selectedDay = inst.currentDay = $('a', td).html();
            inst.selectedMonth = inst.currentMonth = month;
            inst.selectedYear = inst.currentYear = year;
            this._selectDate(id, this._formatDate(inst, inst.currentDay, inst.currentMonth, inst.currentYear));
        },

        /* Erase the input field and hide the date picker. */
        _clearDate: function (id) {
            var target = $(id);
            this._selectDate(target, '');
        },

        /* Update the input field with the selected date. */
        _selectDate: function (id, dateStr) {
            var onSelect,
                target = $(id),
                inst = this._getInst(target[0]);

            dateStr = dateStr != null ? dateStr : this._formatDate(inst);
            if (inst.input) {
                inst.input.val(dateStr);
            }
            this._updateAlternate(inst);

            onSelect = this._get(inst, 'onSelect');
            if (onSelect) {
                onSelect.apply(inst.input ? inst.input[0] : null, [dateStr, inst]); // trigger custom callback
            } else if (inst.input) {
                inst.input.trigger('change'); // fire the change event
            }

            if (inst.inline) {
                this._updateDatepicker(inst);
            } else {
                this._hideDatepicker();
                this._lastInput = inst.input[0];
                if (typeof inst.input[0] !== 'object') {
                    inst.input.trigger('focus'); // restore focus
                }
                this._lastInput = null;
            }
        },

        /* Update any alternate field to synchronise with the main field. */
        _updateAlternate: function (inst) {
            var altFormat,
                date,
                dateStr,
                altField = this._get(inst, 'altField');

            if (altField) {
                // update alternate field too
                altFormat = this._get(inst, 'altFormat') || this._get(inst, 'dateFormat');
                date = this._getDate(inst);
                dateStr = this.formatDate(altFormat, date, this._getFormatConfig(inst));
                $(altField).val(dateStr);
            }
        },

        /* Set as beforeShowDay function to prevent selection of weekends.
         * @param  date  Date - the date to customise
         * @return [boolean, string] - is this date selectable?, what is its CSS class?
         */
        noWeekends: function (date) {
            var day = date.getDay();
            return [day > 0 && day < 6, ''];
        },

        /* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
         * @param  date  Date - the date to get the week for
         * @return  number - the number of the week within the year that contains this date
         */
        iso8601Week: function (date) {
            var time,
                checkDate = new Date(date.getTime());

            // Find Thursday of this week starting on Monday
            checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));

            time = checkDate.getTime();
            checkDate.setMonth(0); // Compare with Jan 1
            checkDate.setDate(1);
            return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;
        },

        /* Parse a string value into a date object.
         * See formatDate below for the possible formats.
         *
         * @param  format string - the expected format of the date
         * @param  value string - the date in the above format
         * @param  settings Object - attributes include:
         *					shortYearCutoff  number - the cutoff year for determining the century (optional)
         *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
         *					dayNames		string[7] - names of the days from Sunday (optional)
         *					monthNamesShort string[12] - abbreviated names of the months (optional)
         *					monthNames		string[12] - names of the months (optional)
         * @return  Date - the extracted date value or null if value is blank
         */
        parseDate: function (format, value, settings) {
            if (format == null || value == null) {
                throw 'Invalid arguments';
            }

            value = typeof value === 'object' ? value.toString() : value + '';
            if (value === '') {
                return null;
            }

            var iFormat,
                dim,
                extra,
                iValue = 0,
                shortYearCutoffTemp = (settings ? settings.shortYearCutoff : null) || this._defaults.shortYearCutoff,
                shortYearCutoff =
                    typeof shortYearCutoffTemp !== 'string'
                        ? shortYearCutoffTemp
                        : (new Date().getFullYear() % 100) + parseInt(shortYearCutoffTemp, 10),
                dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
                dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
                monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
                monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,
                year = -1,
                month = -1,
                day = -1,
                doy = -1,
                literal = false,
                date,
                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = iFormat + 1 < format.length && format.charAt(iFormat + 1) === match;
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                },
                // Extract a number from the string value
                getNumber = function (match) {
                    var isDoubled = lookAhead(match),
                        size = match === '@' ? 14 : match === '!' ? 20 : match === 'y' && isDoubled ? 4 : match === 'o' ? 3 : 2,
                        minSize = match === 'y' ? size : 1,
                        digits = new RegExp('^\\d{' + minSize + ',' + size + '}'),
                        num = value.substring(iValue).match(digits);
                    if (!num) {
                        throw 'Missing number at position ' + iValue;
                    }
                    iValue += num[0].length;
                    return parseInt(num[0], 10);
                },
                // Extract a name from the string value and convert to an index
                getName = function (match, shortNames, longNames) {
                    var index = -1,
                        names = $.map(lookAhead(match) ? longNames : shortNames, function (v, k) {
                            return [[k, v]];
                        }).sort(function (a, b) {
                            return -(a[1].length - b[1].length);
                        });

                    $.each(names, function (i, pair) {
                        var name = pair[1];
                        if (value.substr(iValue, name.length).toLowerCase() === name.toLowerCase()) {
                            index = pair[0];
                            iValue += name.length;
                            return false;
                        }
                    });
                    if (index !== -1) {
                        return index + 1;
                    } else {
                        throw 'Unknown name at position ' + iValue;
                    }
                },
                // Confirm that a literal character matches the string value
                checkLiteral = function () {
                    if (value.charAt(iValue) !== format.charAt(iFormat)) {
                        throw 'Unexpected literal at position ' + iValue;
                    }
                    iValue++;
                };

            for (iFormat = 0; iFormat < format.length; iFormat++) {
                if (literal) {
                    if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                        literal = false;
                    } else {
                        checkLiteral();
                    }
                } else {
                    switch (format.charAt(iFormat)) {
                        case 'd':
                            day = getNumber('d');
                            break;
                        case 'D':
                            getName('D', dayNamesShort, dayNames);
                            break;
                        case 'o':
                            doy = getNumber('o');
                            break;
                        case 'm':
                            month = getNumber('m');
                            break;
                        case 'M':
                            month = getName('M', monthNamesShort, monthNames);
                            break;
                        case 'y':
                            year = getNumber('y');
                            break;
                        case '@':
                            date = new Date(getNumber('@'));
                            year = date.getFullYear();
                            month = date.getMonth() + 1;
                            day = date.getDate();
                            break;
                        case '!':
                            date = new Date((getNumber('!') - this._ticksTo1970) / 10000);
                            year = date.getFullYear();
                            month = date.getMonth() + 1;
                            day = date.getDate();
                            break;
                        case "'":
                            if (lookAhead("'")) {
                                checkLiteral();
                            } else {
                                literal = true;
                            }
                            break;
                        default:
                            checkLiteral();
                    }
                }
            }

            if (iValue < value.length) {
                extra = value.substr(iValue);
                if (!/^\s+/.test(extra)) {
                    throw 'Extra/unparsed characters found in date: ' + extra;
                }
            }

            if (year === -1) {
                year = new Date().getFullYear();
            } else if (year < 100) {
                year += new Date().getFullYear() - (new Date().getFullYear() % 100) + (year <= shortYearCutoff ? 0 : -100);
            }

            if (doy > -1) {
                month = 1;
                day = doy;
                do {
                    dim = this._getDaysInMonth(year, month - 1);
                    if (day <= dim) {
                        break;
                    }
                    month++;
                    day -= dim;
                } while (true);
            }

            date = this._daylightSavingAdjust(new Date(year, month - 1, day));
            if (date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day) {
                throw 'Invalid date'; // E.g. 31/02/00
            }
            return date;
        },

        /* Standard date formats. */
        ATOM: 'yy-mm-dd', // RFC 3339 (ISO 8601)
        COOKIE: 'D, dd M yy',
        ISO_8601: 'yy-mm-dd',
        RFC_822: 'D, d M y',
        RFC_850: 'DD, dd-M-y',
        RFC_1036: 'D, d M y',
        RFC_1123: 'D, d M yy',
        RFC_2822: 'D, d M yy',
        RSS: 'D, d M y', // RFC 822
        TICKS: '!',
        TIMESTAMP: '@',
        W3C: 'yy-mm-dd', // ISO 8601

        _ticksTo1970:
            ((1970 - 1) * 365 + Math.floor(1970 / 4) - Math.floor(1970 / 100) + Math.floor(1970 / 400)) * 24 * 60 * 60 * 10000000,

        /* Format a date object into a string value.
         * The format can be combinations of the following:
         * d  - day of month (no leading zero)
         * dd - day of month (two digit)
         * o  - day of year (no leading zeros)
         * oo - day of year (three digit)
         * D  - day name short
         * DD - day name long
         * m  - month of year (no leading zero)
         * mm - month of year (two digit)
         * M  - month name short
         * MM - month name long
         * y  - year (two digit)
         * yy - year (four digit)
         * @ - Unix timestamp (ms since 01/01/1970)
         * ! - Windows ticks (100ns since 01/01/0001)
         * "..." - literal text
         * '' - single quote
         *
         * @param  format string - the desired format of the date
         * @param  date Date - the date value to format
         * @param  settings Object - attributes include:
         *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
         *					dayNames		string[7] - names of the days from Sunday (optional)
         *					monthNamesShort string[12] - abbreviated names of the months (optional)
         *					monthNames		string[12] - names of the months (optional)
         * @return  string - the date in the above format
         */
        formatDate: function (format, date, settings) {
            if (!date) {
                return '';
            }

            var iFormat,
                dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
                dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
                monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
                monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,
                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = iFormat + 1 < format.length && format.charAt(iFormat + 1) === match;
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                },
                // Format a number, with leading zero if necessary
                formatNumber = function (match, value, len) {
                    var num = '' + value;
                    if (lookAhead(match)) {
                        while (num.length < len) {
                            num = '0' + num;
                        }
                    }
                    return num;
                },
                // Format a name, short or long as requested
                formatName = function (match, value, shortNames, longNames) {
                    return lookAhead(match) ? longNames[value] : shortNames[value];
                },
                output = '',
                literal = false;

            if (date) {
                for (iFormat = 0; iFormat < format.length; iFormat++) {
                    if (literal) {
                        if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                            literal = false;
                        } else {
                            output += format.charAt(iFormat);
                        }
                    } else {
                        switch (format.charAt(iFormat)) {
                            case 'd':
                                output += formatNumber('d', date.getDate(), 2);
                                break;
                            case 'D':
                                output += formatName('D', date.getDay(), dayNamesShort, dayNames);
                                break;
                            case 'o':
                                output += formatNumber(
                                    'o',
                                    Math.round(
                                        (new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime() -
                                            new Date(date.getFullYear(), 0, 0).getTime()) /
                                            86400000
                                    ),
                                    3
                                );
                                break;
                            case 'm':
                                output += formatNumber('m', date.getMonth() + 1, 2);
                                break;
                            case 'M':
                                output += formatName('M', date.getMonth(), monthNamesShort, monthNames);
                                break;
                            case 'y':
                                output += lookAhead('y')
                                    ? date.getFullYear()
                                    : (date.getFullYear() % 100 < 10 ? '0' : '') + (date.getFullYear() % 100);
                                break;
                            case '@':
                                output += date.getTime();
                                break;
                            case '!':
                                output += date.getTime() * 10000 + this._ticksTo1970;
                                break;
                            case "'":
                                if (lookAhead("'")) {
                                    output += "'";
                                } else {
                                    literal = true;
                                }
                                break;
                            default:
                                output += format.charAt(iFormat);
                        }
                    }
                }
            }
            return output;
        },

        /* Extract all possible characters from the date format. */
        _possibleChars: function (format) {
            var iFormat,
                chars = '',
                literal = false,
                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = iFormat + 1 < format.length && format.charAt(iFormat + 1) === match;
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                };

            for (iFormat = 0; iFormat < format.length; iFormat++) {
                if (literal) {
                    if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                        literal = false;
                    } else {
                        chars += format.charAt(iFormat);
                    }
                } else {
                    switch (format.charAt(iFormat)) {
                        case 'd':
                        case 'm':
                        case 'y':
                        case '@':
                            chars += '0123456789';
                            break;
                        case 'D':
                        case 'M':
                            return null; // Accept anything
                        case "'":
                            if (lookAhead("'")) {
                                chars += "'";
                            } else {
                                literal = true;
                            }
                            break;
                        default:
                            chars += format.charAt(iFormat);
                    }
                }
            }
            return chars;
        },

        /* Get a setting value, defaulting if necessary. */
        _get: function (inst, name) {
            return inst.settings[name] !== undefined ? inst.settings[name] : this._defaults[name];
        },

        /* Parse existing date and initialise date picker. */
        _setDateFromField: function (inst, noDefault) {
            if (inst.input.val() === inst.lastVal) {
                return;
            }

            var dateFormat = this._get(inst, 'dateFormat'),
                dates = (inst.lastVal = inst.input ? inst.input.val() : null),
                defaultDate = this._getDefaultDate(inst),
                date = defaultDate,
                settings = this._getFormatConfig(inst);

            try {
                date = this.parseDate(dateFormat, dates, settings) || defaultDate;
            } catch (event) {
                dates = noDefault ? '' : dates;
            }
            inst.selectedDay = date.getDate();
            inst.drawMonth = inst.selectedMonth = date.getMonth();
            inst.drawYear = inst.selectedYear = date.getFullYear();
            inst.currentDay = dates ? date.getDate() : 0;
            inst.currentMonth = dates ? date.getMonth() : 0;
            inst.currentYear = dates ? date.getFullYear() : 0;
            this._adjustInstDate(inst);
        },

        /* Retrieve the default date shown on opening. */
        _getDefaultDate: function (inst) {
            return this._restrictMinMax(inst, this._determineDate(inst, this._get(inst, 'defaultDate'), new Date()));
        },

        /* A date may be specified as an exact value or a relative one. */
        _determineDate: function (inst, date, defaultDate) {
            var offsetNumeric = function (offset) {
                    var date = new Date();
                    date.setDate(date.getDate() + offset);
                    return date;
                },
                offsetString = function (offset) {
                    try {
                        return $.datepicker.parseDate(
                            $.datepicker._get(inst, 'dateFormat'),
                            offset,
                            $.datepicker._getFormatConfig(inst)
                        );
                    } catch (e) {
                        // Ignore
                    }

                    var date = (offset.toLowerCase().match(/^c/) ? $.datepicker._getDate(inst) : null) || new Date(),
                        year = date.getFullYear(),
                        month = date.getMonth(),
                        day = date.getDate(),
                        pattern = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
                        matches = pattern.exec(offset);

                    while (matches) {
                        switch (matches[2] || 'd') {
                            case 'd':
                            case 'D':
                                day += parseInt(matches[1], 10);
                                break;
                            case 'w':
                            case 'W':
                                day += parseInt(matches[1], 10) * 7;
                                break;
                            case 'm':
                            case 'M':
                                month += parseInt(matches[1], 10);
                                day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
                                break;
                            case 'y':
                            case 'Y':
                                year += parseInt(matches[1], 10);
                                day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
                                break;
                        }
                        matches = pattern.exec(offset);
                    }
                    return new Date(year, month, day);
                },
                newDate =
                    date == null || date === ''
                        ? defaultDate
                        : typeof date === 'string'
                        ? offsetString(date)
                        : typeof date === 'number'
                        ? isNaN(date)
                            ? defaultDate
                            : offsetNumeric(date)
                        : new Date(date.getTime());

            newDate = newDate && newDate.toString() === 'Invalid Date' ? defaultDate : newDate;
            if (newDate) {
                newDate.setHours(0);
                newDate.setMinutes(0);
                newDate.setSeconds(0);
                newDate.setMilliseconds(0);
            }
            return this._daylightSavingAdjust(newDate);
        },

        /* Handle switch to/from daylight saving.
         * Hours may be non-zero on daylight saving cut-over:
         * > 12 when midnight changeover, but then cannot generate
         * midnight datetime, so jump to 1AM, otherwise reset.
         * @param  date  (Date) the date to check
         * @return  (Date) the corrected date
         */
        _daylightSavingAdjust: function (date) {
            if (!date) {
                return null;
            }
            date.setHours(date.getHours() > 12 ? date.getHours() + 2 : 0);
            return date;
        },

        /* Set the date(s) directly. */
        _setDate: function (inst, date, noChange) {
            var clear = !date,
                origMonth = inst.selectedMonth,
                origYear = inst.selectedYear,
                newDate = this._restrictMinMax(inst, this._determineDate(inst, date, new Date()));

            inst.selectedDay = inst.currentDay = newDate.getDate();
            inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
            inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
            if ((origMonth !== inst.selectedMonth || origYear !== inst.selectedYear) && !noChange) {
                this._notifyChange(inst);
            }
            this._adjustInstDate(inst);
            if (inst.input) {
                inst.input.val(clear ? '' : this._formatDate(inst));
            }
        },

        /* Retrieve the date(s) directly. */
        _getDate: function (inst) {
            var startDate =
                !inst.currentYear || (inst.input && inst.input.val() === '')
                    ? null
                    : this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay));
            return startDate;
        },

        /* Attach the onxxx handlers.  These are declared statically so
         * they work with static code transformers like Caja.
         */
        _attachHandlers: function (inst) {
            var stepMonths = this._get(inst, 'stepMonths'),
                id = '#' + inst.id.replace(/\\\\/g, '\\');
            inst.dpDiv.find('[data-handler]').map(function () {
                var handler = {
                    prev: function () {
                        $.datepicker._adjustDate(id, -stepMonths, 'M');
                    },
                    next: function () {
                        $.datepicker._adjustDate(id, +stepMonths, 'M');
                    },
                    hide: function () {
                        $.datepicker._hideDatepicker();
                    },
                    today: function () {
                        $.datepicker._gotoToday(id);
                    },
                    selectDay: function () {
                        $.datepicker._selectDay(id, +this.getAttribute('data-month'), +this.getAttribute('data-year'), this);
                        return false;
                    },
                    selectMonth: function () {
                        $.datepicker._selectMonthYear(id, this, 'M');
                        return false;
                    },
                    selectYear: function () {
                        $.datepicker._selectMonthYear(id, this, 'Y');
                        return false;
                    },
                };
                $(this).on(this.getAttribute('data-event'), handler[this.getAttribute('data-handler')]);
            });
        },

        /* Generate the HTML for the current state of the date picker. */
        _generateHTML: function (inst) {
            var maxDraw,
                prevText,
                prev,
                nextText,
                next,
                currentText,
                gotoDate,
                controls,
                buttonPanel,
                firstDay,
                showWeek,
                dayNames,
                dayNamesMin,
                monthNames,
                monthNamesShort,
                beforeShowDay,
                showOtherMonths,
                selectOtherMonths,
                defaultDate,
                html,
                dow,
                row,
                group,
                col,
                selectedDate,
                cornerClass,
                calender,
                thead,
                day,
                daysInMonth,
                leadDays,
                curRows,
                numRows,
                printDate,
                dRow,
                tbody,
                daySettings,
                otherMonth,
                unselectable,
                tempDate = new Date(),
                today = this._daylightSavingAdjust(new Date(tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate())), // clear time
                isRTL = this._get(inst, 'isRTL'),
                showButtonPanel = this._get(inst, 'showButtonPanel'),
                hideIfNoPrevNext = this._get(inst, 'hideIfNoPrevNext'),
                navigationAsDateFormat = this._get(inst, 'navigationAsDateFormat'),
                numMonths = this._getNumberOfMonths(inst),
                showCurrentAtPos = this._get(inst, 'showCurrentAtPos'),
                stepMonths = this._get(inst, 'stepMonths'),
                isMultiMonth = numMonths[0] !== 1 || numMonths[1] !== 1,
                currentDate = this._daylightSavingAdjust(
                    !inst.currentDay ? new Date(9999, 9, 9) : new Date(inst.currentYear, inst.currentMonth, inst.currentDay)
                ),
                minDate = this._getMinMaxDate(inst, 'min'),
                maxDate = this._getMinMaxDate(inst, 'max'),
                drawMonth = inst.drawMonth - showCurrentAtPos,
                drawYear = inst.drawYear;

            if (drawMonth < 0) {
                drawMonth += 12;
                drawYear--;
            }
            if (maxDate) {
                maxDraw = this._daylightSavingAdjust(
                    new Date(maxDate.getFullYear(), maxDate.getMonth() - numMonths[0] * numMonths[1] + 1, maxDate.getDate())
                );
                maxDraw = minDate && maxDraw < minDate ? minDate : maxDraw;
                while (this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1)) > maxDraw) {
                    drawMonth--;
                    if (drawMonth < 0) {
                        drawMonth = 11;
                        drawYear--;
                    }
                }
            }
            inst.drawMonth = drawMonth;
            inst.drawYear = drawYear;

            prevText = this._get(inst, 'prevText');
            prevText = !navigationAsDateFormat
                ? prevText
                : this.formatDate(
                      prevText,
                      this._daylightSavingAdjust(new Date(drawYear, drawMonth - stepMonths, 1)),
                      this._getFormatConfig(inst)
                  );

            prev = this._canAdjustMonth(inst, -1, drawYear, drawMonth)
                ? "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'" +
                  " title='" +
                  prevText +
                  "'><span class='ui-icon ui-icon-circle-triangle-" +
                  (isRTL ? 'e' : 'w') +
                  "'>" +
                  prevText +
                  '</span></a>'
                : hideIfNoPrevNext
                ? ''
                : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" +
                  prevText +
                  "'><span class='ui-icon ui-icon-circle-triangle-" +
                  (isRTL ? 'e' : 'w') +
                  "'>" +
                  prevText +
                  '</span></a>';

            nextText = this._get(inst, 'nextText');
            nextText = !navigationAsDateFormat
                ? nextText
                : this.formatDate(
                      nextText,
                      this._daylightSavingAdjust(new Date(drawYear, drawMonth + stepMonths, 1)),
                      this._getFormatConfig(inst)
                  );

            next = this._canAdjustMonth(inst, +1, drawYear, drawMonth)
                ? "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'" +
                  " title='" +
                  nextText +
                  "'><span class='ui-icon ui-icon-circle-triangle-" +
                  (isRTL ? 'w' : 'e') +
                  "'>" +
                  nextText +
                  '</span></a>'
                : hideIfNoPrevNext
                ? ''
                : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" +
                  nextText +
                  "'><span class='ui-icon ui-icon-circle-triangle-" +
                  (isRTL ? 'w' : 'e') +
                  "'>" +
                  nextText +
                  '</span></a>';

            currentText = this._get(inst, 'currentText');
            gotoDate = this._get(inst, 'gotoCurrent') && inst.currentDay ? currentDate : today;
            currentText = !navigationAsDateFormat
                ? currentText
                : this.formatDate(currentText, gotoDate, this._getFormatConfig(inst));

            controls = !inst.inline
                ? "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" +
                  this._get(inst, 'closeText') +
                  '</button>'
                : '';

            buttonPanel = showButtonPanel
                ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" +
                  (isRTL ? controls : '') +
                  (this._isInRange(inst, gotoDate)
                      ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'" +
                        '>' +
                        currentText +
                        '</button>'
                      : '') +
                  (isRTL ? '' : controls) +
                  '</div>'
                : '';

            firstDay = parseInt(this._get(inst, 'firstDay'), 10);
            firstDay = isNaN(firstDay) ? 0 : firstDay;

            showWeek = this._get(inst, 'showWeek');
            dayNames = this._get(inst, 'dayNames');
            dayNamesMin = this._get(inst, 'dayNamesMin');
            monthNames = this._get(inst, 'monthNames');
            monthNamesShort = this._get(inst, 'monthNamesShort');
            beforeShowDay = this._get(inst, 'beforeShowDay');
            showOtherMonths = this._get(inst, 'showOtherMonths');
            selectOtherMonths = this._get(inst, 'selectOtherMonths');
            defaultDate = this._getDefaultDate(inst);
            html = '';

            for (row = 0; row < numMonths[0]; row++) {
                group = '';
                this.maxRows = 4;
                for (col = 0; col < numMonths[1]; col++) {
                    selectedDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, inst.selectedDay));
                    cornerClass = ' ui-corner-all';
                    calender = '';
                    if (isMultiMonth) {
                        calender += "<div class='ui-datepicker-group";
                        if (numMonths[1] > 1) {
                            switch (col) {
                                case 0:
                                    calender += ' ui-datepicker-group-first';
                                    cornerClass = ' ui-corner-' + (isRTL ? 'right' : 'left');
                                    break;
                                case numMonths[1] - 1:
                                    calender += ' ui-datepicker-group-last';
                                    cornerClass = ' ui-corner-' + (isRTL ? 'left' : 'right');
                                    break;
                                default:
                                    calender += ' ui-datepicker-group-middle';
                                    cornerClass = '';
                                    break;
                            }
                        }
                        calender += "'>";
                    }
                    calender +=
                        "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" +
                        cornerClass +
                        "'>" +
                        (/all|left/.test(cornerClass) && row === 0 ? (isRTL ? next : prev) : '') +
                        (/all|right/.test(cornerClass) && row === 0 ? (isRTL ? prev : next) : '') +
                        this._generateMonthYearHeader(
                            inst,
                            drawMonth,
                            drawYear,
                            minDate,
                            maxDate,
                            row > 0 || col > 0,
                            monthNames,
                            monthNamesShort
                        ) + // draw month headers
                        "</div><table class='ui-datepicker-calendar'><thead>" +
                        '<tr>';
                    thead = showWeek ? "<th class='ui-datepicker-week-col'>" + this._get(inst, 'weekHeader') + '</th>' : '';
                    for (dow = 0; dow < 7; dow++) {
                        // days of the week
                        day = (dow + firstDay) % 7;
                        thead +=
                            "<th scope='col'" +
                            ((dow + firstDay + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : '') +
                            '>' +
                            "<span title='" +
                            dayNames[day] +
                            "'>" +
                            dayNamesMin[day] +
                            '</span></th>';
                    }
                    calender += thead + '</tr></thead><tbody>';
                    daysInMonth = this._getDaysInMonth(drawYear, drawMonth);
                    if (drawYear === inst.selectedYear && drawMonth === inst.selectedMonth) {
                        inst.selectedDay = Math.min(inst.selectedDay, daysInMonth);
                    }
                    leadDays = (this._getFirstDayOfMonth(drawYear, drawMonth) - firstDay + 7) % 7;
                    curRows = Math.ceil((leadDays + daysInMonth) / 7); // calculate the number of rows to generate
                    numRows = isMultiMonth ? (this.maxRows > curRows ? this.maxRows : curRows) : curRows; //If multiple months, use the higher number of rows (see #7043)
                    this.maxRows = numRows;
                    printDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1 - leadDays));
                    for (dRow = 0; dRow < numRows; dRow++) {
                        // create date picker rows
                        calender += '<tr>';
                        tbody = !showWeek
                            ? ''
                            : "<td class='ui-datepicker-week-col'>" + this._get(inst, 'calculateWeek')(printDate) + '</td>';
                        for (dow = 0; dow < 7; dow++) {
                            // create date picker days
                            daySettings = beforeShowDay
                                ? beforeShowDay.apply(inst.input ? inst.input[0] : null, [printDate])
                                : [true, ''];
                            otherMonth = printDate.getMonth() !== drawMonth;
                            unselectable =
                                (otherMonth && !selectOtherMonths) ||
                                !daySettings[0] ||
                                (minDate && printDate < minDate) ||
                                (maxDate && printDate > maxDate);
                            tbody +=
                                "<td class='" +
                                ((dow + firstDay + 6) % 7 >= 5 ? ' ui-datepicker-week-end' : '') + // highlight weekends
                                (otherMonth ? ' ui-datepicker-other-month' : '') + // highlight days from other months
                                ((printDate.getTime() === selectedDate.getTime() &&
                                    drawMonth === inst.selectedMonth &&
                                    inst._keyEvent) || // user pressed key
                                (defaultDate.getTime() === printDate.getTime() &&
                                    defaultDate.getTime() === selectedDate.getTime())
                                    ? // or defaultDate is current printedDate and defaultDate is selectedDate
                                      ' ' + this._dayOverClass
                                    : '') + // highlight selected day
                                (unselectable ? ' ' + this._unselectableClass + ' ui-state-disabled' : '') + // highlight unselectable days
                                (otherMonth && !showOtherMonths
                                    ? ''
                                    : ' ' +
                                      daySettings[1] + // highlight custom dates
                                      (printDate.getTime() === currentDate.getTime() ? ' ' + this._currentClass : '') + // highlight selected day
                                      (printDate.getTime() === today.getTime() ? ' ui-datepicker-today' : '')) +
                                "'" + // highlight today (if different)
                                ((!otherMonth || showOtherMonths) && daySettings[2]
                                    ? " title='" + daySettings[2].replace(/'/g, '&#39;') + "'"
                                    : '') + // cell title
                                (unselectable
                                    ? ''
                                    : " data-handler='selectDay' data-event='click' data-month='" +
                                      printDate.getMonth() +
                                      "' data-year='" +
                                      printDate.getFullYear() +
                                      "'") +
                                '>' + // actions
                                (otherMonth && !showOtherMonths
                                    ? '&#xa0;' // display for other months
                                    : unselectable
                                    ? "<span class='ui-state-default'>" + printDate.getDate() + '</span>'
                                    : "<a class='ui-state-default" +
                                      (printDate.getTime() === today.getTime() ? ' ui-state-highlight' : '') +
                                      (printDate.getTime() === currentDate.getTime() ? ' ui-state-active' : '') + // highlight selected day
                                      (otherMonth ? ' ui-priority-secondary' : '') + // distinguish dates from other months
                                      "' href='javascript:void(0);'>" +
                                      printDate.getDate() +
                                      '</a>') +
                                '</td>'; // display selectable date
                            printDate.setDate(printDate.getDate() + 1);
                            printDate = this._daylightSavingAdjust(printDate);
                        }
                        calender += tbody + '</tr>';
                    }
                    drawMonth++;
                    if (drawMonth > 11) {
                        drawMonth = 0;
                        drawYear++;
                    }
                    calender +=
                        '</tbody></table>' +
                        (isMultiMonth
                            ? '</div>' +
                              (numMonths[0] > 0 && col === numMonths[1] - 1 ? "<div class='ui-datepicker-row-break'></div>" : '')
                            : '');
                    group += calender;
                }
                html += group;
            }
            html += buttonPanel;
            inst._keyEvent = false;
            return html;
        },

        /* Generate the month and year header. */
        _generateMonthYearHeader: function (inst, drawMonth, drawYear, minDate, maxDate, secondary, monthNames, monthNamesShort) {
            var inMinYear,
                inMaxYear,
                month,
                years,
                thisYear,
                determineYear,
                year,
                endYear,
                changeMonth = this._get(inst, 'changeMonth'),
                changeYear = this._get(inst, 'changeYear'),
                showMonthAfterYear = this._get(inst, 'showMonthAfterYear'),
                html = "<div class='ui-datepicker-title'>",
                monthHtml = '';

            // Month selection
            if (secondary || !changeMonth) {
                monthHtml += "<span class='ui-datepicker-month'>" + monthNames[drawMonth] + '</span>';
            } else {
                inMinYear = minDate && minDate.getFullYear() === drawYear;
                inMaxYear = maxDate && maxDate.getFullYear() === drawYear;
                monthHtml += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";
                for (month = 0; month < 12; month++) {
                    if ((!inMinYear || month >= minDate.getMonth()) && (!inMaxYear || month <= maxDate.getMonth())) {
                        monthHtml +=
                            "<option value='" +
                            month +
                            "'" +
                            (month === drawMonth ? " selected='selected'" : '') +
                            '>' +
                            monthNamesShort[month] +
                            '</option>';
                    }
                }
                monthHtml += '</select>';
            }

            if (!showMonthAfterYear) {
                html += monthHtml + (secondary || !(changeMonth && changeYear) ? '&#xa0;' : '');
            }

            // Year selection
            if (!inst.yearshtml) {
                inst.yearshtml = '';
                if (secondary || !changeYear) {
                    html += "<span class='ui-datepicker-year'>" + drawYear + '</span>';
                } else {
                    // determine range of years to display
                    years = this._get(inst, 'yearRange').split(':');
                    thisYear = new Date().getFullYear();
                    determineYear = function (value) {
                        var year = value.match(/c[+\-].*/)
                            ? drawYear + parseInt(value.substring(1), 10)
                            : value.match(/[+\-].*/)
                            ? thisYear + parseInt(value, 10)
                            : parseInt(value, 10);
                        return isNaN(year) ? thisYear : year;
                    };
                    year = determineYear(years[0]);
                    endYear = Math.max(year, determineYear(years[1] || ''));
                    year = minDate ? Math.max(year, minDate.getFullYear()) : year;
                    endYear = maxDate ? Math.min(endYear, maxDate.getFullYear()) : endYear;
                    inst.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";
                    for (; year <= endYear; year++) {
                        inst.yearshtml +=
                            "<option value='" +
                            year +
                            "'" +
                            (year === drawYear ? " selected='selected'" : '') +
                            '>' +
                            year +
                            '</option>';
                    }
                    inst.yearshtml += '</select>';

                    html += inst.yearshtml;
                    inst.yearshtml = null;
                }
            }

            html += this._get(inst, 'yearSuffix');
            if (showMonthAfterYear) {
                html += (secondary || !(changeMonth && changeYear) ? '&#xa0;' : '') + monthHtml;
            }
            html += '</div>'; // Close datepicker_header
            return html;
        },

        /* Adjust one of the date sub-fields. */
        _adjustInstDate: function (inst, offset, period) {
            var year = inst.selectedYear + (period === 'Y' ? offset : 0),
                month = inst.selectedMonth + (period === 'M' ? offset : 0),
                day = Math.min(inst.selectedDay, this._getDaysInMonth(year, month)) + (period === 'D' ? offset : 0),
                date = this._restrictMinMax(inst, this._daylightSavingAdjust(new Date(year, month, day)));

            inst.selectedDay = date.getDate();
            inst.drawMonth = inst.selectedMonth = date.getMonth();
            inst.drawYear = inst.selectedYear = date.getFullYear();
            if (period === 'M' || period === 'Y') {
                this._notifyChange(inst);
            }
        },

        /* Ensure a date is within any min/max bounds. */
        _restrictMinMax: function (inst, date) {
            var minDate = this._getMinMaxDate(inst, 'min'),
                maxDate = this._getMinMaxDate(inst, 'max'),
                newDate = minDate && date < minDate ? minDate : date;
            return maxDate && newDate > maxDate ? maxDate : newDate;
        },

        /* Notify change of month/year. */
        _notifyChange: function (inst) {
            var onChange = this._get(inst, 'onChangeMonthYear');
            if (onChange) {
                onChange.apply(inst.input ? inst.input[0] : null, [inst.selectedYear, inst.selectedMonth + 1, inst]);
            }
        },

        /* Determine the number of months to show. */
        _getNumberOfMonths: function (inst) {
            var numMonths = this._get(inst, 'numberOfMonths');
            return numMonths == null ? [1, 1] : typeof numMonths === 'number' ? [1, numMonths] : numMonths;
        },

        /* Determine the current maximum date - ensure no time components are set. */
        _getMinMaxDate: function (inst, minMax) {
            return this._determineDate(inst, this._get(inst, minMax + 'Date'), null);
        },

        /* Find the number of days in a given month. */
        _getDaysInMonth: function (year, month) {
            return 32 - this._daylightSavingAdjust(new Date(year, month, 32)).getDate();
        },

        /* Find the day of the week of the first of a month. */
        _getFirstDayOfMonth: function (year, month) {
            return new Date(year, month, 1).getDay();
        },

        /* Determines if we should allow a "next/prev" month display change. */
        _canAdjustMonth: function (inst, offset, curYear, curMonth) {
            var numMonths = this._getNumberOfMonths(inst),
                date = this._daylightSavingAdjust(
                    new Date(curYear, curMonth + (offset < 0 ? offset : numMonths[0] * numMonths[1]), 1)
                );

            if (offset < 0) {
                date.setDate(this._getDaysInMonth(date.getFullYear(), date.getMonth()));
            }
            return this._isInRange(inst, date);
        },

        /* Is the given date in the accepted range? */
        _isInRange: function (inst, date) {
            var yearSplit,
                currentYear,
                minDate = this._getMinMaxDate(inst, 'min'),
                maxDate = this._getMinMaxDate(inst, 'max'),
                minYear = null,
                maxYear = null,
                years = this._get(inst, 'yearRange');
            if (years) {
                yearSplit = years.split(':');
                currentYear = new Date().getFullYear();
                minYear = parseInt(yearSplit[0], 10);
                maxYear = parseInt(yearSplit[1], 10);
                if (yearSplit[0].match(/[+\-].*/)) {
                    minYear += currentYear;
                }
                if (yearSplit[1].match(/[+\-].*/)) {
                    maxYear += currentYear;
                }
            }

            return (
                (!minDate || date.getTime() >= minDate.getTime()) &&
                (!maxDate || date.getTime() <= maxDate.getTime()) &&
                (!minYear || date.getFullYear() >= minYear) &&
                (!maxYear || date.getFullYear() <= maxYear)
            );
        },

        /* Provide the configuration settings for formatting/parsing. */
        _getFormatConfig: function (inst) {
            var shortYearCutoff = this._get(inst, 'shortYearCutoff');
            shortYearCutoff =
                typeof shortYearCutoff !== 'string'
                    ? shortYearCutoff
                    : (new Date().getFullYear() % 100) + parseInt(shortYearCutoff, 10);
            return {
                shortYearCutoff: shortYearCutoff,
                dayNamesShort: this._get(inst, 'dayNamesShort'),
                dayNames: this._get(inst, 'dayNames'),
                monthNamesShort: this._get(inst, 'monthNamesShort'),
                monthNames: this._get(inst, 'monthNames'),
            };
        },

        /* Format the given date for display. */
        _formatDate: function (inst, day, month, year) {
            if (!day) {
                inst.currentDay = inst.selectedDay;
                inst.currentMonth = inst.selectedMonth;
                inst.currentYear = inst.selectedYear;
            }
            var date = day
                ? typeof day === 'object'
                    ? day
                    : this._daylightSavingAdjust(new Date(year, month, day))
                : this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay));
            return this.formatDate(this._get(inst, 'dateFormat'), date, this._getFormatConfig(inst));
        },
    });

    /*
     * Bind hover events for datepicker elements.
     * Done via delegate so the binding only occurs once in the lifetime of the parent div.
     * Global datepicker_instActive, set by _updateDatepicker allows the handlers to find their way back to the active picker.
     */
    function datepicker_bindHover(dpDiv) {
        var selector = 'button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a';
        return dpDiv
            .on('mouseout', selector, function () {
                $(this).removeClass('ui-state-hover');
                if (this.className.indexOf('ui-datepicker-prev') !== -1) {
                    $(this).removeClass('ui-datepicker-prev-hover');
                }
                if (this.className.indexOf('ui-datepicker-next') !== -1) {
                    $(this).removeClass('ui-datepicker-next-hover');
                }
            })
            .on('mouseover', selector, datepicker_handleMouseover);
    }

    function datepicker_handleMouseover() {
        if (
            !$.datepicker._isDisabledDatepicker(
                datepicker_instActive.inline ? datepicker_instActive.dpDiv.parent()[0] : datepicker_instActive.input[0]
            )
        ) {
            $(this).parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');
            $(this).addClass('ui-state-hover');
            if (this.className.indexOf('ui-datepicker-prev') !== -1) {
                $(this).addClass('ui-datepicker-prev-hover');
            }
            if (this.className.indexOf('ui-datepicker-next') !== -1) {
                $(this).addClass('ui-datepicker-next-hover');
            }
        }
    }

    /* jQuery extend now ignores nulls! */
    function datepicker_extendRemove(target, props) {
        $.extend(target, props);
        for (var name in props) {
            if (props[name] == null) {
                target[name] = props[name];
            }
        }
        return target;
    }

    /* Invoke the datepicker functionality.
   @param  options  string - a command, optionally followed by additional parameters or
					Object - settings for attaching new datepicker functionality
   @return  jQuery object */
    $.fn.datepicker = function (options) {
        /* Verify an empty collection wasn't passed - Fixes #6976 */
        if (!this.length) {
            return this;
        }

        /* Initialise the date picker. */
        if (!$.datepicker.initialized) {
            $(document).on('mousedown', $.datepicker._checkExternalClick);
            $.datepicker.initialized = true;
        }

        /* Append datepicker main container to body if not exist. */
        if ($('#' + $.datepicker._mainDivId).length === 0) {
            $('body').append($.datepicker.dpDiv);
        }

        var otherArgs = Array.prototype.slice.call(arguments, 1);
        if (typeof options === 'string' && (options === 'isDisabled' || options === 'getDate' || options === 'widget')) {
            return $.datepicker['_' + options + 'Datepicker'].apply($.datepicker, [this[0]].concat(otherArgs));
        }
        if (options === 'option' && arguments.length === 2 && typeof arguments[1] === 'string') {
            return $.datepicker['_' + options + 'Datepicker'].apply($.datepicker, [this[0]].concat(otherArgs));
        }
        return this.each(function () {
            typeof options === 'string'
                ? $.datepicker['_' + options + 'Datepicker'].apply($.datepicker, [this].concat(otherArgs))
                : $.datepicker._attachDatepicker(this, options);
        });
    };

    $.datepicker = new Datepicker(); // singleton instance
    $.datepicker.initialized = false;
    $.datepicker.uuid = new Date().getTime();
    $.datepicker.version = '1.12.1';

    var widgetsDatepicker = $.datepicker;
});

/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.6.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
!(function (a) {
    'use strict';
    'function' == typeof define && define.amd
        ? define(['jquery'], a)
        : 'undefined' != typeof exports
        ? (module.exports = a(require('jquery')))
        : a(jQuery);
})(function (a) {
    'use strict';
    var b = window.Slick || {};
    (b = (function () {
        function c(c, d) {
            var f,
                e = this;
            (e.defaults = {
                accessibility: !0,
                adaptiveHeight: !1,
                appendArrows: a(c),
                appendDots: a(c),
                arrows: !0,
                asNavFor: null,
                prevArrow: '<button type="button" class="slick-prev" aria-label="Previous Page"></button>',
                nextArrow: '<button type="button" class="slick-next" aria-label="Next Page"></button>',
                autoplay: !1,
                autoplaySpeed: 3e3,
                centerMode: !1,
                centerPadding: '50px',
                cssEase: 'ease',
                customPaging: function (b, c) {
                    return a('<button type="button" tabindex="0" />').text('Go to page ' + (c + 1));
                },
                dots: !1,
                dotsClass: 'slick-dots',
                draggable: !0,
                easing: 'linear',
                edgeFriction: 0.35,
                fade: !1,
                focusOnSelect: !1,
                infinite: !0,
                initialSlide: 0,
                lazyLoad: 'ondemand',
                mobileFirst: !1,
                pauseOnHover: !0,
                pauseOnFocus: !0,
                pauseOnDotsHover: !1,
                respondTo: 'window',
                responsive: null,
                rows: 1,
                rtl: !1,
                slide: '',
                slidesPerRow: 1,
                slidesToShow: 1,
                slidesToScroll: 1,
                speed: 500,
                swipe: !0,
                swipeToSlide: !1,
                touchMove: !0,
                touchThreshold: 5,
                useCSS: !0,
                useTransform: !0,
                variableWidth: !1,
                vertical: !1,
                verticalSwiping: !1,
                waitForAnimate: !0,
                zIndex: 1e3,
            }),
                (e.initials = {
                    animating: !1,
                    dragging: !1,
                    autoPlayTimer: null,
                    currentDirection: 0,
                    currentLeft: null,
                    currentSlide: 0,
                    direction: 1,
                    $dots: null,
                    listWidth: null,
                    listHeight: null,
                    loadIndex: 0,
                    $nextArrow: null,
                    $prevArrow: null,
                    slideCount: null,
                    slideWidth: null,
                    $slideTrack: null,
                    $slides: null,
                    sliding: !1,
                    slideOffset: 0,
                    swipeLeft: null,
                    $list: null,
                    touchObject: {},
                    transformsEnabled: !1,
                    unslicked: !1,
                }),
                a.extend(e, e.initials),
                (e.activeBreakpoint = null),
                (e.animType = null),
                (e.animProp = null),
                (e.breakpoints = []),
                (e.breakpointSettings = []),
                (e.cssTransitions = !1),
                (e.focussed = !1),
                (e.interrupted = !1),
                (e.hidden = 'hidden'),
                (e.paused = !0),
                (e.positionProp = null),
                (e.respondTo = null),
                (e.rowCount = 1),
                (e.shouldClick = !0),
                (e.$slider = a(c)),
                (e.$slidesCache = null),
                (e.transformType = null),
                (e.transitionType = null),
                (e.visibilityChange = 'visibilitychange'),
                (e.windowWidth = 0),
                (e.windowTimer = null),
                (f = a(c).data('slick') || {}),
                (e.options = a.extend({}, e.defaults, d, f)),
                (e.currentSlide = e.options.initialSlide),
                (e.originalSettings = e.options),
                'undefined' != typeof document.mozHidden
                    ? ((e.hidden = 'mozHidden'), (e.visibilityChange = 'mozvisibilitychange'))
                    : 'undefined' != typeof document.webkitHidden &&
                      ((e.hidden = 'webkitHidden'), (e.visibilityChange = 'webkitvisibilitychange')),
                (e.autoPlay = a.proxy(e.autoPlay, e)),
                (e.autoPlayClear = a.proxy(e.autoPlayClear, e)),
                (e.autoPlayIterator = a.proxy(e.autoPlayIterator, e)),
                (e.changeSlide = a.proxy(e.changeSlide, e)),
                (e.clickHandler = a.proxy(e.clickHandler, e)),
                (e.selectHandler = a.proxy(e.selectHandler, e)),
                (e.setPosition = a.proxy(e.setPosition, e)),
                (e.swipeHandler = a.proxy(e.swipeHandler, e)),
                (e.dragHandler = a.proxy(e.dragHandler, e)),
                (e.keyHandler = a.proxy(e.keyHandler, e)),
                (e.instanceUid = b++),
                (e.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/),
                e.registerBreakpoints(),
                e.init(!0);
        }
        var b = 0;
        return c;
    })()),
        (b.prototype.activateADA = function () {
            var a = this;
            a.$slideTrack
                .find('.slick-active')
                .attr({ 'aria-hidden': 'false', tabindex: '0' })
                .find('a, input, button, select')
                .attr({ tabindex: '0' });
        }),
        (b.prototype.addSlide = b.prototype.slickAdd = function (b, c, d) {
            var e = this;
            if ('boolean' == typeof c) (d = c), (c = null);
            else if (0 > c || c >= e.slideCount) return !1;
            e.unload(),
                'number' == typeof c
                    ? 0 === c && 0 === e.$slides.length
                        ? a(b).appendTo(e.$slideTrack)
                        : d
                        ? a(b).insertBefore(e.$slides.eq(c))
                        : a(b).insertAfter(e.$slides.eq(c))
                    : d === !0
                    ? a(b).prependTo(e.$slideTrack)
                    : a(b).appendTo(e.$slideTrack),
                (e.$slides = e.$slideTrack.children(this.options.slide)),
                e.$slideTrack.children(this.options.slide).detach(),
                e.$slideTrack.append(e.$slides),
                e.$slides.each(function (b, c) {
                    a(c).attr('data-slick-index', b);
                }),
                (e.$slidesCache = e.$slides),
                e.reinit();
        }),
        (b.prototype.animateHeight = function () {
            var a = this;
            if (1 === a.options.slidesToShow && a.options.adaptiveHeight === !0 && a.options.vertical === !1) {
                var b = a.$slides.eq(a.currentSlide).outerHeight(!0);
                a.$list.animate({ height: b }, a.options.speed);
            }
        }),
        (b.prototype.animateSlide = function (b, c) {
            var d = {},
                e = this;
            e.animateHeight(),
                e.options.rtl === !0 && e.options.vertical === !1 && (b = -b),
                e.transformsEnabled === !1
                    ? e.options.vertical === !1
                        ? e.$slideTrack.animate({ left: b }, e.options.speed, e.options.easing, c)
                        : e.$slideTrack.animate({ top: b }, e.options.speed, e.options.easing, c)
                    : e.cssTransitions === !1
                    ? (e.options.rtl === !0 && (e.currentLeft = -e.currentLeft),
                      a({ animStart: e.currentLeft }).animate(
                          { animStart: b },
                          {
                              duration: e.options.speed,
                              easing: e.options.easing,
                              step: function (a) {
                                  (a = Math.ceil(a)),
                                      e.options.vertical === !1
                                          ? ((d[e.animType] = 'translate(' + a + 'px, 0px)'), e.$slideTrack.css(d))
                                          : ((d[e.animType] = 'translate(0px,' + a + 'px)'), e.$slideTrack.css(d));
                              },
                              complete: function () {
                                  c && c.call();
                              },
                          }
                      ))
                    : (e.applyTransition(),
                      (b = Math.ceil(b)),
                      e.options.vertical === !1
                          ? (d[e.animType] = 'translate3d(' + b + 'px, 0px, 0px)')
                          : (d[e.animType] = 'translate3d(0px,' + b + 'px, 0px)'),
                      e.$slideTrack.css(d),
                      c &&
                          setTimeout(function () {
                              e.disableTransition(), c.call();
                          }, e.options.speed));
        }),
        (b.prototype.getNavTarget = function () {
            var b = this,
                c = b.options.asNavFor;
            return c && null !== c && (c = a(c).not(b.$slider)), c;
        }),
        (b.prototype.asNavFor = function (b) {
            var c = this,
                d = c.getNavTarget();
            null !== d &&
                'object' == typeof d &&
                d.each(function () {
                    var c = a(this).slick('getSlick');
                    c.unslicked || c.slideHandler(b, !0);
                });
        }),
        (b.prototype.applyTransition = function (a) {
            var b = this,
                c = {};
            b.options.fade === !1
                ? (c[b.transitionType] = b.transformType + ' ' + b.options.speed + 'ms ' + b.options.cssEase)
                : (c[b.transitionType] = 'opacity ' + b.options.speed + 'ms ' + b.options.cssEase),
                b.options.fade === !1 ? b.$slideTrack.css(c) : b.$slides.eq(a).css(c);
        }),
        (b.prototype.autoPlay = function () {
            var a = this;
            a.autoPlayClear(),
                a.slideCount > a.options.slidesToShow &&
                    (a.autoPlayTimer = setInterval(a.autoPlayIterator, a.options.autoplaySpeed));
        }),
        (b.prototype.autoPlayClear = function () {
            var a = this;
            a.autoPlayTimer && clearInterval(a.autoPlayTimer);
        }),
        (b.prototype.autoPlayIterator = function () {
            var a = this,
                b = a.currentSlide + a.options.slidesToScroll;
            a.paused ||
                a.interrupted ||
                a.focussed ||
                (a.options.infinite === !1 &&
                    (1 === a.direction && a.currentSlide + 1 === a.slideCount - 1
                        ? (a.direction = 0)
                        : 0 === a.direction &&
                          ((b = a.currentSlide - a.options.slidesToScroll), a.currentSlide - 1 === 0 && (a.direction = 1))),
                a.slideHandler(b));
        }),
        (b.prototype.buildArrows = function () {
            var b = this;
            b.options.arrows === !0 &&
                ((b.$prevArrow = a(b.options.prevArrow).addClass('slick-arrow')),
                (b.$nextArrow = a(b.options.nextArrow).addClass('slick-arrow')),
                b.slideCount > b.options.slidesToShow
                    ? (b.$prevArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex'),
                      b.$nextArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex'),
                      b.htmlExpr.test(b.options.prevArrow) && b.$prevArrow.prependTo(b.options.appendArrows),
                      b.htmlExpr.test(b.options.nextArrow) && b.$nextArrow.appendTo(b.options.appendArrows),
                      b.options.infinite !== !0 && b.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true'))
                    : b.$prevArrow.add(b.$nextArrow).addClass('slick-hidden').attr({ 'aria-disabled': 'true', tabindex: '-1' }));
        }),
        (b.prototype.buildDots = function () {
            var c,
                d,
                b = this;
            if (b.options.dots === !0 && b.slideCount > b.options.slidesToShow) {
                for (
                    b.$slider.addClass('slick-dotted'), d = a('<ul />').addClass(b.options.dotsClass), c = 0;
                    c <= b.getDotCount();
                    c += 1
                )
                    d.append(a('<li />').append(b.options.customPaging.call(this, b, c)));
                (b.$dots = d.appendTo(b.options.appendDots)),
                    b.$dots.find('li').first().addClass('slick-active').attr('aria-hidden', 'false');
            }
        }),
        (b.prototype.buildOut = function () {
            var b = this;
            (b.$slides = b.$slider.children(b.options.slide + ':not(.slick-cloned)').addClass('slick-slide')),
                (b.slideCount = b.$slides.length),
                b.$slides.each(function (b, c) {
                    a(c)
                        .attr('data-slick-index', b)
                        .data('originalStyling', a(c).attr('style') || '');
                }),
                b.$slider.addClass('slick-slider'),
                (b.$slideTrack =
                    0 === b.slideCount
                        ? a('<div class="slick-track"/>').appendTo(b.$slider)
                        : b.$slides.wrapAll('<div class="slick-track"/>').parent()),
                (b.$list = b.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent()),
                b.$slideTrack.css('opacity', 0),
                (b.options.centerMode === !0 || b.options.swipeToSlide === !0) && (b.options.slidesToScroll = 1),
                a('img[data-lazy]', b.$slider).not('[src]').addClass('slick-loading'),
                b.setupInfinite(),
                b.buildArrows(),
                b.buildDots(),
                b.updateDots(),
                b.setSlideClasses('number' == typeof b.currentSlide ? b.currentSlide : 0),
                b.options.draggable === !0 && b.$list.addClass('draggable');
        }),
        (b.prototype.buildRows = function () {
            var b,
                c,
                d,
                e,
                f,
                g,
                h,
                a = this;
            if (((e = document.createDocumentFragment()), (g = a.$slider.children()), a.options.rows > 1)) {
                for (h = a.options.slidesPerRow * a.options.rows, f = Math.ceil(g.length / h), b = 0; f > b; b++) {
                    var i = document.createElement('div');
                    for (c = 0; c < a.options.rows; c++) {
                        var j = document.createElement('div');
                        for (d = 0; d < a.options.slidesPerRow; d++) {
                            var k = b * h + (c * a.options.slidesPerRow + d);
                            g.get(k) && j.appendChild(g.get(k));
                        }
                        i.appendChild(j);
                    }
                    e.appendChild(i);
                }
                a.$slider.empty().append(e),
                    a.$slider
                        .children()
                        .children()
                        .children()
                        .css({
                            width: 100 / a.options.slidesPerRow + '%',
                            display: 'inline-block',
                        });
            }
        }),
        (b.prototype.checkResponsive = function (b, c) {
            var e,
                f,
                g,
                d = this,
                h = !1,
                i = d.$slider.width(),
                j = window.innerWidth || a(window).width();
            if (
                ('window' === d.respondTo
                    ? (g = j)
                    : 'slider' === d.respondTo
                    ? (g = i)
                    : 'min' === d.respondTo && (g = Math.min(j, i)),
                d.options.responsive && d.options.responsive.length && null !== d.options.responsive)
            ) {
                f = null;
                for (e in d.breakpoints)
                    d.breakpoints.hasOwnProperty(e) &&
                        (d.originalSettings.mobileFirst === !1
                            ? g < d.breakpoints[e] && (f = d.breakpoints[e])
                            : g > d.breakpoints[e] && (f = d.breakpoints[e]));
                null !== f
                    ? null !== d.activeBreakpoint
                        ? (f !== d.activeBreakpoint || c) &&
                          ((d.activeBreakpoint = f),
                          'unslick' === d.breakpointSettings[f]
                              ? d.unslick(f)
                              : ((d.options = a.extend({}, d.originalSettings, d.breakpointSettings[f])),
                                b === !0 && (d.currentSlide = d.options.initialSlide),
                                d.refresh(b)),
                          (h = f))
                        : ((d.activeBreakpoint = f),
                          'unslick' === d.breakpointSettings[f]
                              ? d.unslick(f)
                              : ((d.options = a.extend({}, d.originalSettings, d.breakpointSettings[f])),
                                b === !0 && (d.currentSlide = d.options.initialSlide),
                                d.refresh(b)),
                          (h = f))
                    : null !== d.activeBreakpoint &&
                      ((d.activeBreakpoint = null),
                      (d.options = d.originalSettings),
                      b === !0 && (d.currentSlide = d.options.initialSlide),
                      d.refresh(b),
                      (h = f)),
                    b || h === !1 || d.$slider.trigger('breakpoint', [d, h]);
            }
        }),
        (b.prototype.changeSlide = function (b, c) {
            var f,
                g,
                h,
                d = this,
                e = a(b.currentTarget);
            switch (
                (e.is('a') && b.preventDefault(),
                e.is('li') || (e = e.closest('li')),
                (h = d.slideCount % d.options.slidesToScroll !== 0),
                (f = h ? 0 : (d.slideCount - d.currentSlide) % d.options.slidesToScroll),
                b.data.message)
            ) {
                case 'previous':
                    (g = 0 === f ? d.options.slidesToScroll : d.options.slidesToShow - f),
                        d.slideCount > d.options.slidesToShow && d.slideHandler(d.currentSlide - g, !1, c);
                    break;
                case 'next':
                    (g = 0 === f ? d.options.slidesToScroll : f),
                        d.slideCount > d.options.slidesToShow && d.slideHandler(d.currentSlide + g, !1, c);
                    break;
                case 'index':
                    var i = 0 === b.data.index ? 0 : b.data.index || e.index() * d.options.slidesToScroll;
                    d.slideHandler(d.checkNavigable(i), !1, c), e.children().trigger('focus');
                    break;
                default:
                    return;
            }
        }),
        (b.prototype.checkNavigable = function (a) {
            var c,
                d,
                b = this;
            if (((c = b.getNavigableIndexes()), (d = 0), a > c[c.length - 1])) a = c[c.length - 1];
            else
                for (var e in c) {
                    if (a < c[e]) {
                        a = d;
                        break;
                    }
                    d = c[e];
                }
            return a;
        }),
        (b.prototype.cleanUpEvents = function () {
            var b = this;
            b.options.dots &&
                null !== b.$dots &&
                a('li', b.$dots)
                    .off('click.slick', b.changeSlide)
                    .off('mouseenter.slick', a.proxy(b.interrupt, b, !0))
                    .off('mouseleave.slick', a.proxy(b.interrupt, b, !1)),
                b.$slider.off('focus.slick blur.slick'),
                b.options.arrows === !0 &&
                    b.slideCount > b.options.slidesToShow &&
                    (b.$prevArrow && b.$prevArrow.off('click.slick', b.changeSlide),
                    b.$nextArrow && b.$nextArrow.off('click.slick', b.changeSlide)),
                b.$list.off('touchstart.slick mousedown.slick', b.swipeHandler),
                b.$list.off('touchmove.slick mousemove.slick', b.swipeHandler),
                b.$list.off('touchend.slick mouseup.slick', b.swipeHandler),
                b.$list.off('touchcancel.slick mouseleave.slick', b.swipeHandler),
                b.$list.off('click.slick', b.clickHandler),
                a(document).off(b.visibilityChange, b.visibility),
                b.cleanUpSlideEvents(),
                b.options.accessibility === !0 && b.$list.off('keydown.slick', b.keyHandler),
                b.options.focusOnSelect === !0 && a(b.$slideTrack).children().off('click.slick', b.selectHandler),
                a(window).off('orientationchange.slick.slick-' + b.instanceUid, b.orientationChange),
                a(window).off('resize.slick.slick-' + b.instanceUid, b.resize),
                a('[draggable!=true]', b.$slideTrack).off('dragstart', b.preventDefault),
                a(window).off('load.slick.slick-' + b.instanceUid, b.setPosition),
                a(document).off('ready.slick.slick-' + b.instanceUid, b.setPosition);
        }),
        (b.prototype.cleanUpSlideEvents = function () {
            var b = this;
            b.$list.off('mouseenter.slick', a.proxy(b.interrupt, b, !0)),
                b.$list.off('mouseleave.slick', a.proxy(b.interrupt, b, !1));
        }),
        (b.prototype.cleanUpRows = function () {
            var b,
                a = this;
            a.options.rows > 1 && ((b = a.$slides.children().children()), b.removeAttr('style'), a.$slider.empty().append(b));
        }),
        (b.prototype.clickHandler = function (a) {
            var b = this;
            b.shouldClick === !1 && (a.stopImmediatePropagation(), a.stopPropagation(), a.preventDefault());
        }),
        (b.prototype.destroy = function (b) {
            var c = this;
            c.autoPlayClear(),
                (c.touchObject = {}),
                c.cleanUpEvents(),
                a('.slick-cloned', c.$slider).detach(),
                c.$dots && c.$dots.remove(),
                c.$prevArrow &&
                    c.$prevArrow.length &&
                    (c.$prevArrow
                        .removeClass('slick-disabled slick-arrow slick-hidden')
                        .removeAttr('aria-hidden aria-disabled tabindex')
                        .css('display', ''),
                    c.htmlExpr.test(c.options.prevArrow) && c.$prevArrow.remove()),
                c.$nextArrow &&
                    c.$nextArrow.length &&
                    (c.$nextArrow
                        .removeClass('slick-disabled slick-arrow slick-hidden')
                        .removeAttr('aria-hidden aria-disabled tabindex')
                        .css('display', ''),
                    c.htmlExpr.test(c.options.nextArrow) && c.$nextArrow.remove()),
                c.$slides &&
                    (c.$slides
                        .removeClass('slick-slide slick-active slick-center slick-visible slick-current')
                        .removeAttr('aria-hidden')
                        .removeAttr('data-slick-index')
                        .each(function () {
                            a(this).attr('style', a(this).data('originalStyling'));
                        }),
                    c.$slideTrack.children(this.options.slide).detach(),
                    c.$slideTrack.detach(),
                    c.$list.detach(),
                    c.$slider.append(c.$slides)),
                c.cleanUpRows(),
                c.$slider.removeClass('slick-slider'),
                c.$slider.removeClass('slick-initialized'),
                c.$slider.removeClass('slick-dotted'),
                (c.unslicked = !0),
                b || c.$slider.trigger('destroy', [c]);
        }),
        (b.prototype.disableTransition = function (a) {
            var b = this,
                c = {};
            (c[b.transitionType] = ''), b.options.fade === !1 ? b.$slideTrack.css(c) : b.$slides.eq(a).css(c);
        }),
        (b.prototype.fadeSlide = function (a, b) {
            var c = this;
            c.cssTransitions === !1
                ? (c.$slides.eq(a).css({ zIndex: c.options.zIndex }),
                  c.$slides.eq(a).animate({ opacity: 1 }, c.options.speed, c.options.easing, b))
                : (c.applyTransition(a),
                  c.$slides.eq(a).css({ opacity: 1, zIndex: c.options.zIndex }),
                  b &&
                      setTimeout(function () {
                          c.disableTransition(a), b.call();
                      }, c.options.speed));
        }),
        (b.prototype.fadeSlideOut = function (a) {
            var b = this;
            b.cssTransitions === !1
                ? b.$slides.eq(a).animate({ opacity: 0, zIndex: b.options.zIndex - 2 }, b.options.speed, b.options.easing)
                : (b.applyTransition(a), b.$slides.eq(a).css({ opacity: 0, zIndex: b.options.zIndex - 2 }));
        }),
        (b.prototype.filterSlides = b.prototype.slickFilter = function (a) {
            var b = this;
            null !== a &&
                ((b.$slidesCache = b.$slides),
                b.unload(),
                b.$slideTrack.children(this.options.slide).detach(),
                b.$slidesCache.filter(a).appendTo(b.$slideTrack),
                b.reinit());
        }),
        (b.prototype.focusHandler = function () {
            var b = this;
            b.$slider.off('focus.slick blur.slick').on('focus.slick blur.slick', '*:not(.slick-arrow)', function (c) {
                c.stopImmediatePropagation();
                var d = a(this);
                setTimeout(function () {
                    b.options.pauseOnFocus && ((b.focussed = d.is(':focus')), b.autoPlay());
                }, 0);
            });
        }),
        (b.prototype.getCurrent = b.prototype.slickCurrentSlide = function () {
            var a = this;
            return a.currentSlide;
        }),
        (b.prototype.getDotCount = function () {
            var a = this,
                b = 0,
                c = 0,
                d = 0;
            if (a.options.infinite === !0)
                for (; b < a.slideCount; )
                    ++d,
                        (b = c + a.options.slidesToScroll),
                        (c +=
                            a.options.slidesToScroll <= a.options.slidesToShow
                                ? a.options.slidesToScroll
                                : a.options.slidesToShow);
            else if (a.options.centerMode === !0) d = a.slideCount;
            else if (a.options.asNavFor)
                for (; b < a.slideCount; )
                    ++d,
                        (b = c + a.options.slidesToScroll),
                        (c +=
                            a.options.slidesToScroll <= a.options.slidesToShow
                                ? a.options.slidesToScroll
                                : a.options.slidesToShow);
            else d = 1 + Math.ceil((a.slideCount - a.options.slidesToShow) / a.options.slidesToScroll);
            return d - 1;
        }),
        (b.prototype.getLeft = function (a) {
            var c,
                d,
                f,
                b = this,
                e = 0;
            return (
                (b.slideOffset = 0),
                (d = b.$slides.first().outerHeight(!0)),
                b.options.infinite === !0
                    ? (b.slideCount > b.options.slidesToShow &&
                          ((b.slideOffset = b.slideWidth * b.options.slidesToShow * -1), (e = d * b.options.slidesToShow * -1)),
                      b.slideCount % b.options.slidesToScroll !== 0 &&
                          a + b.options.slidesToScroll > b.slideCount &&
                          b.slideCount > b.options.slidesToShow &&
                          (a > b.slideCount
                              ? ((b.slideOffset = (b.options.slidesToShow - (a - b.slideCount)) * b.slideWidth * -1),
                                (e = (b.options.slidesToShow - (a - b.slideCount)) * d * -1))
                              : ((b.slideOffset = (b.slideCount % b.options.slidesToScroll) * b.slideWidth * -1),
                                (e = (b.slideCount % b.options.slidesToScroll) * d * -1))))
                    : a + b.options.slidesToShow > b.slideCount &&
                      ((b.slideOffset = (a + b.options.slidesToShow - b.slideCount) * b.slideWidth),
                      (e = (a + b.options.slidesToShow - b.slideCount) * d)),
                b.slideCount <= b.options.slidesToShow && ((b.slideOffset = 0), (e = 0)),
                b.options.centerMode === !0 && b.options.infinite === !0
                    ? (b.slideOffset += b.slideWidth * Math.floor(b.options.slidesToShow / 2) - b.slideWidth)
                    : b.options.centerMode === !0 &&
                      ((b.slideOffset = 0), (b.slideOffset += b.slideWidth * Math.floor(b.options.slidesToShow / 2))),
                (c = b.options.vertical === !1 ? a * b.slideWidth * -1 + b.slideOffset : a * d * -1 + e),
                b.options.variableWidth === !0 &&
                    ((f =
                        b.slideCount <= b.options.slidesToShow || b.options.infinite === !1
                            ? b.$slideTrack.children('.slick-slide').eq(a)
                            : b.$slideTrack.children('.slick-slide').eq(a + b.options.slidesToShow)),
                    (c =
                        b.options.rtl === !0
                            ? f[0]
                                ? -1 * (b.$slideTrack.width() - f[0].offsetLeft - f.width())
                                : 0
                            : f[0]
                            ? -1 * f[0].offsetLeft
                            : 0),
                    b.options.centerMode === !0 &&
                        ((f =
                            b.slideCount <= b.options.slidesToShow || b.options.infinite === !1
                                ? b.$slideTrack.children('.slick-slide').eq(a)
                                : b.$slideTrack.children('.slick-slide').eq(a + b.options.slidesToShow + 1)),
                        (c =
                            b.options.rtl === !0
                                ? f[0]
                                    ? -1 * (b.$slideTrack.width() - f[0].offsetLeft - f.width())
                                    : 0
                                : f[0]
                                ? -1 * f[0].offsetLeft
                                : 0),
                        (c += (b.$list.width() - f.outerWidth()) / 2))),
                c
            );
        }),
        (b.prototype.getOption = b.prototype.slickGetOption = function (a) {
            var b = this;
            return b.options[a];
        }),
        (b.prototype.getNavigableIndexes = function () {
            var e,
                a = this,
                b = 0,
                c = 0,
                d = [];
            for (
                a.options.infinite === !1
                    ? (e = a.slideCount)
                    : ((b = -1 * a.options.slidesToScroll), (c = -1 * a.options.slidesToScroll), (e = 2 * a.slideCount));
                e > b;

            )
                d.push(b),
                    (b = c + a.options.slidesToScroll),
                    (c += a.options.slidesToScroll <= a.options.slidesToShow ? a.options.slidesToScroll : a.options.slidesToShow);
            return d;
        }),
        (b.prototype.getSlick = function () {
            return this;
        }),
        (b.prototype.getSlideCount = function () {
            var c,
                d,
                e,
                b = this;
            return (
                (e = b.options.centerMode === !0 ? b.slideWidth * Math.floor(b.options.slidesToShow / 2) : 0),
                b.options.swipeToSlide === !0
                    ? (b.$slideTrack.find('.slick-slide').each(function (c, f) {
                          return f.offsetLeft - e + a(f).outerWidth() / 2 > -1 * b.swipeLeft ? ((d = f), !1) : void 0;
                      }),
                      (c = Math.abs(a(d).attr('data-slick-index') - b.currentSlide) || 1))
                    : b.options.slidesToScroll
            );
        }),
        (b.prototype.goTo = b.prototype.slickGoTo = function (a, b) {
            var c = this;
            c.changeSlide({ data: { message: 'index', index: parseInt(a) } }, b);
        }),
        (b.prototype.init = function (b) {
            var c = this;
            a(c.$slider).hasClass('slick-initialized') ||
                (a(c.$slider).addClass('slick-initialized'),
                c.addSrOnlyMessage(),
                c.buildRows(),
                c.buildOut(),
                c.setProps(),
                c.startLoad(),
                c.loadSlider(),
                c.initializeEvents(),
                c.updateArrows(),
                c.updateDots(),
                c.checkResponsive(!0),
                c.focusHandler()),
                b && c.$slider.trigger('init', [c]),
                c.options.accessibility === !0 && c.initADA(),
                c.options.autoplay && ((c.paused = !1), c.autoPlay());
        }),
        (b.prototype.initADA = function () {
            var b = this;
            b.$slides
                .add(b.$slideTrack.find('.slick-cloned'))
                .attr({ 'aria-hidden': 'true', tabindex: '-1' })
                .find('a, input, button, select')
                .attr({ tabindex: '-1' }),
                b.$slideTrack.attr('role', 'list'),
                b.$slides.not(b.$slideTrack.find('.slick-cloned')).each(function (c) {
                    a(this).attr({
                        role: 'listitem',
                    });
                }),
                null !== b.$dots &&
                    b.$dots
                        .find('li')
                        .each(function (c) {
                            a(this).attr({
                                id: 'slick-slide' + b.instanceUid + c,
                            });
                        })
                        .first()
                        .attr('aria-selected', 'true')
                        .end()
                        .find('button')
                        .end(),
                b.activateADA();
        }),
        (b.prototype.addSrOnlyMessage = function () {
            var b = this;

            if (!b.$slider.prev().hasClass('u-sr-only')) {
                $('<div>')
                    .addClass('u-sr-only')
                    .text(
                        'A slider having ' +
                            b.options.slidesToShow +
                            ' slides per page and moves ' +
                            b.options.slidesToScroll +
                            ' slides when goes to next or previous page.'
                    )
                    .insertBefore(b.$slider);
            }
        }),
        (b.prototype.initArrowEvents = function () {
            var a = this;
            a.options.arrows === !0 &&
                a.slideCount > a.options.slidesToShow &&
                (a.$prevArrow.off('click.slick').on('click.slick', { message: 'previous' }, a.changeSlide),
                a.$nextArrow.off('click.slick').on('click.slick', { message: 'next' }, a.changeSlide));
        }),
        (b.prototype.initDotEvents = function () {
            var b = this;
            b.options.dots === !0 &&
                b.slideCount > b.options.slidesToShow &&
                a('li', b.$dots).on('click.slick', { message: 'index' }, b.changeSlide),
                b.options.dots === !0 &&
                    b.options.pauseOnDotsHover === !0 &&
                    a('li', b.$dots)
                        .on('mouseenter.slick', a.proxy(b.interrupt, b, !0))
                        .on('mouseleave.slick', a.proxy(b.interrupt, b, !1));
        }),
        (b.prototype.initSlideEvents = function () {
            var b = this;
            b.options.pauseOnHover &&
                (b.$list.on('mouseenter.slick', a.proxy(b.interrupt, b, !0)),
                b.$list.on('mouseleave.slick', a.proxy(b.interrupt, b, !1)));
        }),
        (b.prototype.initializeEvents = function () {
            var b = this;
            b.initArrowEvents(),
                b.initDotEvents(),
                b.initSlideEvents(),
                b.$list.on('touchstart.slick mousedown.slick', { action: 'start' }, b.swipeHandler),
                b.$list.on('touchmove.slick mousemove.slick', { action: 'move' }, b.swipeHandler),
                b.$list.on('touchend.slick mouseup.slick', { action: 'end' }, b.swipeHandler),
                b.$list.on('touchcancel.slick mouseleave.slick', { action: 'end' }, b.swipeHandler),
                b.$list.on('click.slick', b.clickHandler),
                a(document).on(b.visibilityChange, a.proxy(b.visibility, b)),
                b.options.accessibility === !0 && b.$list.on('keydown.slick', b.keyHandler),
                b.options.focusOnSelect === !0 && a(b.$slideTrack).children().on('click.slick', b.selectHandler),
                a(window).on('orientationchange.slick.slick-' + b.instanceUid, a.proxy(b.orientationChange, b)),
                a(window).on('resize.slick.slick-' + b.instanceUid, a.proxy(b.resize, b)),
                a('[draggable!=true]', b.$slideTrack).on('dragstart', b.preventDefault),
                a(window).on('load.slick.slick-' + b.instanceUid, b.setPosition),
                a(document).on('ready.slick.slick-' + b.instanceUid, b.setPosition);
        }),
        (b.prototype.initUI = function () {
            var a = this;
            a.options.arrows === !0 && a.slideCount > a.options.slidesToShow && (a.$prevArrow.show(), a.$nextArrow.show()),
                a.options.dots === !0 && a.slideCount > a.options.slidesToShow && a.$dots.show();
        }),
        (b.prototype.keyHandler = function (a) {
            var b = this;
            a.target.tagName.match('TEXTAREA|INPUT|SELECT') ||
                (37 === a.keyCode && b.options.accessibility === !0
                    ? b.changeSlide({
                          data: { message: b.options.rtl === !0 ? 'next' : 'previous' },
                      })
                    : 39 === a.keyCode &&
                      b.options.accessibility === !0 &&
                      b.changeSlide({
                          data: { message: b.options.rtl === !0 ? 'previous' : 'next' },
                      }));
        }),
        (b.prototype.lazyLoad = function () {
            function g(c) {
                a('img[data-lazy]', c).each(function () {
                    var c = a(this),
                        d = a(this).attr('data-lazy'),
                        e = document.createElement('img');
                    (e.onload = function () {
                        c.animate({ opacity: 0 }, 100, function () {
                            c.attr('src', d).animate({ opacity: 1 }, 200, function () {
                                c.removeAttr('data-lazy').removeClass('slick-loading');
                            }),
                                b.$slider.trigger('lazyLoaded', [b, c, d]);
                        });
                    }),
                        (e.onerror = function () {
                            c.removeAttr('data-lazy').removeClass('slick-loading').addClass('slick-lazyload-error'),
                                b.$slider.trigger('lazyLoadError', [b, c, d]);
                        }),
                        (e.src = d);
                });
            }
            var c,
                d,
                e,
                f,
                b = this;
            b.options.centerMode === !0
                ? b.options.infinite === !0
                    ? ((e = b.currentSlide + (b.options.slidesToShow / 2 + 1)), (f = e + b.options.slidesToShow + 2))
                    : ((e = Math.max(0, b.currentSlide - (b.options.slidesToShow / 2 + 1))),
                      (f = 2 + (b.options.slidesToShow / 2 + 1) + b.currentSlide))
                : ((e = b.options.infinite ? b.options.slidesToShow + b.currentSlide : b.currentSlide),
                  (f = Math.ceil(e + b.options.slidesToShow)),
                  b.options.fade === !0 && (e > 0 && e--, f <= b.slideCount && f++)),
                (c = b.$slider.find('.slick-slide').slice(e, f)),
                g(c),
                b.slideCount <= b.options.slidesToShow
                    ? ((d = b.$slider.find('.slick-slide')), g(d))
                    : b.currentSlide >= b.slideCount - b.options.slidesToShow
                    ? ((d = b.$slider.find('.slick-cloned').slice(0, b.options.slidesToShow)), g(d))
                    : 0 === b.currentSlide && ((d = b.$slider.find('.slick-cloned').slice(-1 * b.options.slidesToShow)), g(d));
        }),
        (b.prototype.loadSlider = function () {
            var a = this;
            a.setPosition(),
                a.$slideTrack.css({ opacity: 1 }),
                a.$slider.removeClass('slick-loading'),
                a.initUI(),
                'progressive' === a.options.lazyLoad && a.progressiveLazyLoad();
        }),
        (b.prototype.next = b.prototype.slickNext = function () {
            var a = this;
            a.changeSlide({ data: { message: 'next' } });
        }),
        (b.prototype.orientationChange = function () {
            var a = this;
            a.checkResponsive(), a.setPosition();
        }),
        (b.prototype.pause = b.prototype.slickPause = function () {
            var a = this;
            a.autoPlayClear(), (a.paused = !0);
        }),
        (b.prototype.play = b.prototype.slickPlay = function () {
            var a = this;
            a.autoPlay(), (a.options.autoplay = !0), (a.paused = !1), (a.focussed = !1), (a.interrupted = !1);
        }),
        (b.prototype.postSlide = function (a) {
            var b = this;
            b.unslicked ||
                (b.$slider.trigger('afterChange', [b, a]),
                (b.animating = !1),
                b.setPosition(),
                (b.swipeLeft = null),
                b.options.autoplay && b.autoPlay(),
                b.options.accessibility === !0 && b.initADA());
        }),
        (b.prototype.prev = b.prototype.slickPrev = function () {
            var a = this;
            a.changeSlide({ data: { message: 'previous' } });
        }),
        (b.prototype.preventDefault = function (a) {
            a.preventDefault();
        }),
        (b.prototype.progressiveLazyLoad = function (b) {
            b = b || 1;
            var e,
                f,
                g,
                c = this,
                d = a('img[data-lazy]', c.$slider);
            d.length
                ? ((e = d.first()),
                  (f = e.attr('data-lazy')),
                  (g = document.createElement('img')),
                  (g.onload = function () {
                      e.attr('src', f).removeAttr('data-lazy').removeClass('slick-loading'),
                          c.options.adaptiveHeight === !0 && c.setPosition(),
                          c.$slider.trigger('lazyLoaded', [c, e, f]),
                          c.progressiveLazyLoad();
                  }),
                  (g.onerror = function () {
                      3 > b
                          ? setTimeout(function () {
                                c.progressiveLazyLoad(b + 1);
                            }, 500)
                          : (e.removeAttr('data-lazy').removeClass('slick-loading').addClass('slick-lazyload-error'),
                            c.$slider.trigger('lazyLoadError', [c, e, f]),
                            c.progressiveLazyLoad());
                  }),
                  (g.src = f))
                : c.$slider.trigger('allImagesLoaded', [c]);
        }),
        (b.prototype.refresh = function (b) {
            var d,
                e,
                c = this;
            (e = c.slideCount - c.options.slidesToShow),
                !c.options.infinite && c.currentSlide > e && (c.currentSlide = e),
                c.slideCount <= c.options.slidesToShow && (c.currentSlide = 0),
                (d = c.currentSlide),
                c.destroy(!0),
                a.extend(c, c.initials, { currentSlide: d }),
                c.init(),
                b || c.changeSlide({ data: { message: 'index', index: d } }, !1);
        }),
        (b.prototype.registerBreakpoints = function () {
            var c,
                d,
                e,
                b = this,
                f = b.options.responsive || null;
            if ('array' === a.type(f) && f.length) {
                b.respondTo = b.options.respondTo || 'window';
                for (c in f)
                    if (((e = b.breakpoints.length - 1), (d = f[c].breakpoint), f.hasOwnProperty(c))) {
                        for (; e >= 0; ) b.breakpoints[e] && b.breakpoints[e] === d && b.breakpoints.splice(e, 1), e--;
                        b.breakpoints.push(d), (b.breakpointSettings[d] = f[c].settings);
                    }
                b.breakpoints.sort(function (a, c) {
                    return b.options.mobileFirst ? a - c : c - a;
                });
            }
        }),
        (b.prototype.reinit = function () {
            var b = this;
            (b.$slides = b.$slideTrack.children(b.options.slide).addClass('slick-slide')),
                (b.slideCount = b.$slides.length),
                b.currentSlide >= b.slideCount &&
                    0 !== b.currentSlide &&
                    (b.currentSlide = b.currentSlide - b.options.slidesToScroll),
                b.slideCount <= b.options.slidesToShow && (b.currentSlide = 0),
                b.registerBreakpoints(),
                b.setProps(),
                b.setupInfinite(),
                b.buildArrows(),
                b.updateArrows(),
                b.initArrowEvents(),
                b.buildDots(),
                b.updateDots(),
                b.initDotEvents(),
                b.cleanUpSlideEvents(),
                b.initSlideEvents(),
                b.checkResponsive(!1, !0),
                b.options.focusOnSelect === !0 && a(b.$slideTrack).children().on('click.slick', b.selectHandler),
                b.setSlideClasses('number' == typeof b.currentSlide ? b.currentSlide : 0),
                b.setPosition(),
                b.focusHandler(),
                (b.paused = !b.options.autoplay),
                b.autoPlay(),
                b.$slider.trigger('reInit', [b]);
        }),
        (b.prototype.resize = function () {
            var b = this;
            a(window).width() !== b.windowWidth &&
                (clearTimeout(b.windowDelay),
                (b.windowDelay = window.setTimeout(function () {
                    (b.windowWidth = a(window).width()), b.checkResponsive(), b.unslicked || b.setPosition();
                }, 50)));
        }),
        (b.prototype.removeSlide = b.prototype.slickRemove = function (a, b, c) {
            var d = this;
            return (
                'boolean' == typeof a ? ((b = a), (a = b === !0 ? 0 : d.slideCount - 1)) : (a = b === !0 ? --a : a),
                d.slideCount < 1 || 0 > a || a > d.slideCount - 1
                    ? !1
                    : (d.unload(),
                      c === !0 ? d.$slideTrack.children().remove() : d.$slideTrack.children(this.options.slide).eq(a).remove(),
                      (d.$slides = d.$slideTrack.children(this.options.slide)),
                      d.$slideTrack.children(this.options.slide).detach(),
                      d.$slideTrack.append(d.$slides),
                      (d.$slidesCache = d.$slides),
                      void d.reinit())
            );
        }),
        (b.prototype.setCSS = function (a) {
            var d,
                e,
                b = this,
                c = {};
            b.options.rtl === !0 && (a = -a),
                (d = 'left' == b.positionProp ? Math.ceil(a) + 'px' : '0px'),
                (e = 'top' == b.positionProp ? Math.ceil(a) + 'px' : '0px'),
                (c[b.positionProp] = a),
                b.transformsEnabled === !1
                    ? b.$slideTrack.css(c)
                    : ((c = {}),
                      b.cssTransitions === !1
                          ? ((c[b.animType] = 'translate(' + d + ', ' + e + ')'), b.$slideTrack.css(c))
                          : ((c[b.animType] = 'translate3d(' + d + ', ' + e + ', 0px)'), b.$slideTrack.css(c)));
        }),
        (b.prototype.setDimensions = function () {
            var a = this;
            a.options.vertical === !1
                ? a.options.centerMode === !0 && a.$list.css({ padding: '0px ' + a.options.centerPadding })
                : (a.$list.height(a.$slides.first().outerHeight(!0) * a.options.slidesToShow),
                  a.options.centerMode === !0 && a.$list.css({ padding: a.options.centerPadding + ' 0px' })),
                (a.listWidth = a.$list.width()),
                (a.listHeight = a.$list.height()),
                a.options.vertical === !1 && a.options.variableWidth === !1
                    ? ((a.slideWidth = Math.ceil(a.listWidth / a.options.slidesToShow)),
                      a.$slideTrack.width(Math.ceil(a.slideWidth * a.$slideTrack.children('.slick-slide').length)))
                    : a.options.variableWidth === !0
                    ? a.$slideTrack.width(5e3 * a.slideCount)
                    : ((a.slideWidth = Math.ceil(a.listWidth)),
                      a.$slideTrack.height(
                          Math.ceil(a.$slides.first().outerHeight(!0) * a.$slideTrack.children('.slick-slide').length)
                      ));
            var b = a.$slides.first().outerWidth(!0) - a.$slides.first().width();
            a.options.variableWidth === !1 && a.$slideTrack.children('.slick-slide').width(a.slideWidth - b);
        }),
        (b.prototype.setFade = function () {
            var c,
                b = this;
            b.$slides.each(function (d, e) {
                (c = b.slideWidth * d * -1),
                    b.options.rtl === !0
                        ? a(e).css({
                              position: 'relative',
                              right: c,
                              top: 0,
                              zIndex: b.options.zIndex - 2,
                              opacity: 0,
                          })
                        : a(e).css({
                              position: 'relative',
                              left: c,
                              top: 0,
                              zIndex: b.options.zIndex - 2,
                              opacity: 0,
                          });
            }),
                b.$slides.eq(b.currentSlide).css({ zIndex: b.options.zIndex - 1, opacity: 1 });
        }),
        (b.prototype.setHeight = function () {
            var a = this;
            if (1 === a.options.slidesToShow && a.options.adaptiveHeight === !0 && a.options.vertical === !1) {
                var b = a.$slides.eq(a.currentSlide).outerHeight(!0);
                a.$list.css('height', b);
            }
        }),
        (b.prototype.setOption = b.prototype.slickSetOption = function () {
            var c,
                d,
                e,
                f,
                h,
                b = this,
                g = !1;
            if (
                ('object' === a.type(arguments[0])
                    ? ((e = arguments[0]), (g = arguments[1]), (h = 'multiple'))
                    : 'string' === a.type(arguments[0]) &&
                      ((e = arguments[0]),
                      (f = arguments[1]),
                      (g = arguments[2]),
                      'responsive' === arguments[0] && 'array' === a.type(arguments[1])
                          ? (h = 'responsive')
                          : 'undefined' != typeof arguments[1] && (h = 'single')),
                'single' === h)
            )
                b.options[e] = f;
            else if ('multiple' === h)
                a.each(e, function (a, c) {
                    b.options[a] = c;
                });
            else if ('responsive' === h)
                for (d in f)
                    if ('array' !== a.type(b.options.responsive)) b.options.responsive = [f[d]];
                    else {
                        for (c = b.options.responsive.length - 1; c >= 0; )
                            b.options.responsive[c].breakpoint === f[d].breakpoint && b.options.responsive.splice(c, 1), c--;
                        b.options.responsive.push(f[d]);
                    }
            g && (b.unload(), b.reinit());
        }),
        (b.prototype.setPosition = function () {
            var a = this;
            a.setDimensions(),
                a.setHeight(),
                a.options.fade === !1 ? a.setCSS(a.getLeft(a.currentSlide)) : a.setFade(),
                a.$slider.trigger('setPosition', [a]);
        }),
        (b.prototype.setProps = function () {
            var a = this,
                b = document.body.style;
            (a.positionProp = a.options.vertical === !0 ? 'top' : 'left'),
                'top' === a.positionProp ? a.$slider.addClass('slick-vertical') : a.$slider.removeClass('slick-vertical'),
                (void 0 !== b.WebkitTransition || void 0 !== b.MozTransition || void 0 !== b.msTransition) &&
                    a.options.useCSS === !0 &&
                    (a.cssTransitions = !0),
                a.options.fade &&
                    ('number' == typeof a.options.zIndex
                        ? a.options.zIndex < 3 && (a.options.zIndex = 3)
                        : (a.options.zIndex = a.defaults.zIndex)),
                void 0 !== b.OTransform &&
                    ((a.animType = 'OTransform'),
                    (a.transformType = '-o-transform'),
                    (a.transitionType = 'OTransition'),
                    void 0 === b.perspectiveProperty && void 0 === b.webkitPerspective && (a.animType = !1)),
                void 0 !== b.MozTransform &&
                    ((a.animType = 'MozTransform'),
                    (a.transformType = '-moz-transform'),
                    (a.transitionType = 'MozTransition'),
                    void 0 === b.perspectiveProperty && void 0 === b.MozPerspective && (a.animType = !1)),
                void 0 !== b.webkitTransform &&
                    ((a.animType = 'webkitTransform'),
                    (a.transformType = '-webkit-transform'),
                    (a.transitionType = 'webkitTransition'),
                    void 0 === b.perspectiveProperty && void 0 === b.webkitPerspective && (a.animType = !1)),
                void 0 !== b.msTransform &&
                    ((a.animType = 'msTransform'),
                    (a.transformType = '-ms-transform'),
                    (a.transitionType = 'msTransition'),
                    void 0 === b.msTransform && (a.animType = !1)),
                void 0 !== b.transform &&
                    a.animType !== !1 &&
                    ((a.animType = 'transform'), (a.transformType = 'transform'), (a.transitionType = 'transition')),
                (a.transformsEnabled = a.options.useTransform && null !== a.animType && a.animType !== !1);
        }),
        (b.prototype.setSlideClasses = function (a) {
            var c,
                d,
                e,
                f,
                b = this;
            (d = b.$slider
                .find('.slick-slide')
                .removeClass('slick-active slick-center slick-current')
                .attr('aria-hidden', 'true')),
                b.$slides.eq(a).addClass('slick-current').focus();
            b.options.centerMode === !0
                ? ((c = Math.floor(b.options.slidesToShow / 2)),
                  b.options.infinite === !0 &&
                      (a >= c && a <= b.slideCount - 1 - c
                          ? b.$slides
                                .slice(a - c, a + c + 1)
                                .addClass('slick-active')
                                .attr('aria-hidden', 'false')
                          : ((e = b.options.slidesToShow + a),
                            d
                                .slice(e - c + 1, e + c + 2)
                                .addClass('slick-active')
                                .attr('aria-hidden', 'false')),
                      0 === a
                          ? d.eq(d.length - 1 - b.options.slidesToShow).addClass('slick-center')
                          : a === b.slideCount - 1 && d.eq(b.options.slidesToShow).addClass('slick-center')),
                  b.$slides.eq(a).addClass('slick-center'))
                : a >= 0 && a <= b.slideCount - b.options.slidesToShow
                ? b.$slides
                      .slice(a, a + b.options.slidesToShow)
                      .addClass('slick-active')
                      .attr('aria-hidden', 'false')
                : d.length <= b.options.slidesToShow
                ? d.addClass('slick-active').attr('aria-hidden', 'false')
                : ((f = b.slideCount % b.options.slidesToShow),
                  (e = b.options.infinite === !0 ? b.options.slidesToShow + a : a),
                  b.options.slidesToShow == b.options.slidesToScroll && b.slideCount - a < b.options.slidesToShow
                      ? d
                            .slice(e - (b.options.slidesToShow - f), e + f)
                            .addClass('slick-active')
                            .attr('aria-hidden', 'false')
                      : d
                            .slice(e, e + b.options.slidesToShow)
                            .addClass('slick-active')
                            .attr('aria-hidden', 'false')),
                'ondemand' === b.options.lazyLoad && b.lazyLoad();
        }),
        (b.prototype.setupInfinite = function () {
            var c,
                d,
                e,
                b = this;
            if (
                (b.options.fade === !0 && (b.options.centerMode = !1),
                b.options.infinite === !0 && b.options.fade === !1 && ((d = null), b.slideCount > b.options.slidesToShow))
            ) {
                for (
                    e = b.options.centerMode === !0 ? b.options.slidesToShow + 1 : b.options.slidesToShow, c = b.slideCount;
                    c > b.slideCount - e;
                    c -= 1
                )
                    (d = c - 1),
                        a(b.$slides[d])
                            .clone(!0)
                            .attr('id', '')
                            .attr('data-slick-index', d - b.slideCount)
                            .prependTo(b.$slideTrack)
                            .addClass('slick-cloned');
                for (c = 0; e > c; c += 1)
                    (d = c),
                        a(b.$slides[d])
                            .clone(!0)
                            .attr('id', '')
                            .attr('data-slick-index', d + b.slideCount)
                            .appendTo(b.$slideTrack)
                            .addClass('slick-cloned');
                b.$slideTrack
                    .find('.slick-cloned')
                    .find('[id]')
                    .each(function () {
                        a(this).attr('id', '');
                    });
            }
        }),
        (b.prototype.interrupt = function (a) {
            var b = this;
            a || b.autoPlay(), (b.interrupted = a);
        }),
        (b.prototype.selectHandler = function (b) {
            var c = this,
                d = a(b.target).is('.slick-slide') ? a(b.target) : a(b.target).parents('.slick-slide'),
                e = parseInt(d.attr('data-slick-index'));
            return (
                e || (e = 0),
                c.slideCount <= c.options.slidesToShow ? (c.setSlideClasses(e), void c.asNavFor(e)) : void c.slideHandler(e)
            );
        }),
        (b.prototype.slideHandler = function (a, b, c) {
            var d,
                e,
                f,
                g,
                j,
                h = null,
                i = this;
            return (
                (b = b || !1),
                (i.animating === !0 && i.options.waitForAnimate === !0) ||
                (i.options.fade === !0 && i.currentSlide === a) ||
                i.slideCount <= i.options.slidesToShow
                    ? void 0
                    : (b === !1 && i.asNavFor(a),
                      (d = a),
                      (h = i.getLeft(d)),
                      (g = i.getLeft(i.currentSlide)),
                      (i.currentLeft = null === i.swipeLeft ? g : i.swipeLeft),
                      i.options.infinite === !1 &&
                      i.options.centerMode === !1 &&
                      (0 > a || a > i.getDotCount() * i.options.slidesToScroll)
                          ? void (
                                i.options.fade === !1 &&
                                ((d = i.currentSlide),
                                c !== !0
                                    ? i.animateSlide(g, function () {
                                          i.postSlide(d);
                                      })
                                    : i.postSlide(d))
                            )
                          : i.options.infinite === !1 &&
                            i.options.centerMode === !0 &&
                            (0 > a || a > i.slideCount - i.options.slidesToScroll)
                          ? void (
                                i.options.fade === !1 &&
                                ((d = i.currentSlide),
                                c !== !0
                                    ? i.animateSlide(g, function () {
                                          i.postSlide(d);
                                      })
                                    : i.postSlide(d))
                            )
                          : (i.options.autoplay && clearInterval(i.autoPlayTimer),
                            (e =
                                0 > d
                                    ? i.slideCount % i.options.slidesToScroll !== 0
                                        ? i.slideCount - (i.slideCount % i.options.slidesToScroll)
                                        : i.slideCount + d
                                    : d >= i.slideCount
                                    ? i.slideCount % i.options.slidesToScroll !== 0
                                        ? 0
                                        : d - i.slideCount
                                    : d),
                            (i.animating = !0),
                            i.$slider.trigger('beforeChange', [i, i.currentSlide, e]),
                            (f = i.currentSlide),
                            (i.currentSlide = e),
                            i.setSlideClasses(i.currentSlide),
                            i.options.asNavFor &&
                                ((j = i.getNavTarget()),
                                (j = j.slick('getSlick')),
                                j.slideCount <= j.options.slidesToShow && j.setSlideClasses(i.currentSlide)),
                            i.updateDots(),
                            i.updateArrows(),
                            i.options.fade === !0
                                ? (c !== !0
                                      ? (i.fadeSlideOut(f),
                                        i.fadeSlide(e, function () {
                                            i.postSlide(e);
                                        }))
                                      : i.postSlide(e),
                                  void i.animateHeight())
                                : void (c !== !0
                                      ? i.animateSlide(h, function () {
                                            i.postSlide(e);
                                        })
                                      : i.postSlide(e))))
            );
        }),
        (b.prototype.startLoad = function () {
            var a = this;
            a.options.arrows === !0 && a.slideCount > a.options.slidesToShow && (a.$prevArrow.hide(), a.$nextArrow.hide()),
                a.options.dots === !0 && a.slideCount > a.options.slidesToShow && a.$dots.hide(),
                a.$slider.addClass('slick-loading');
        }),
        (b.prototype.swipeDirection = function () {
            var a,
                b,
                c,
                d,
                e = this;
            return (
                (a = e.touchObject.startX - e.touchObject.curX),
                (b = e.touchObject.startY - e.touchObject.curY),
                (c = Math.atan2(b, a)),
                (d = Math.round((180 * c) / Math.PI)),
                0 > d && (d = 360 - Math.abs(d)),
                45 >= d && d >= 0
                    ? e.options.rtl === !1
                        ? 'left'
                        : 'right'
                    : 360 >= d && d >= 315
                    ? e.options.rtl === !1
                        ? 'left'
                        : 'right'
                    : d >= 135 && 225 >= d
                    ? e.options.rtl === !1
                        ? 'right'
                        : 'left'
                    : e.options.verticalSwiping === !0
                    ? d >= 35 && 135 >= d
                        ? 'down'
                        : 'up'
                    : 'vertical'
            );
        }),
        (b.prototype.swipeEnd = function (a) {
            var c,
                d,
                b = this;
            if (
                ((b.dragging = !1),
                (b.interrupted = !1),
                (b.shouldClick = b.touchObject.swipeLength > 10 ? !1 : !0),
                void 0 === b.touchObject.curX)
            )
                return !1;
            if (
                (b.touchObject.edgeHit === !0 && b.$slider.trigger('edge', [b, b.swipeDirection()]),
                b.touchObject.swipeLength >= b.touchObject.minSwipe)
            ) {
                switch ((d = b.swipeDirection())) {
                    case 'left':
                    case 'down':
                        (c = b.options.swipeToSlide
                            ? b.checkNavigable(b.currentSlide + b.getSlideCount())
                            : b.currentSlide + b.getSlideCount()),
                            (b.currentDirection = 0);
                        break;
                    case 'right':
                    case 'up':
                        (c = b.options.swipeToSlide
                            ? b.checkNavigable(b.currentSlide - b.getSlideCount())
                            : b.currentSlide - b.getSlideCount()),
                            (b.currentDirection = 1);
                }
                'vertical' != d && (b.slideHandler(c), (b.touchObject = {}), b.$slider.trigger('swipe', [b, d]));
            } else b.touchObject.startX !== b.touchObject.curX && (b.slideHandler(b.currentSlide), (b.touchObject = {}));
        }),
        (b.prototype.swipeHandler = function (a) {
            var b = this;
            if (
                !(
                    b.options.swipe === !1 ||
                    ('ontouchend' in document && b.options.swipe === !1) ||
                    (b.options.draggable === !1 && -1 !== a.type.indexOf('mouse'))
                )
            )
                switch (
                    ((b.touchObject.fingerCount =
                        a.originalEvent && void 0 !== a.originalEvent.touches ? a.originalEvent.touches.length : 1),
                    (b.touchObject.minSwipe = b.listWidth / b.options.touchThreshold),
                    b.options.verticalSwiping === !0 && (b.touchObject.minSwipe = b.listHeight / b.options.touchThreshold),
                    a.data.action)
                ) {
                    case 'start':
                        b.swipeStart(a);
                        break;
                    case 'move':
                        b.swipeMove(a);
                        break;
                    case 'end':
                        b.swipeEnd(a);
                }
        }),
        (b.prototype.swipeMove = function (a) {
            var d,
                e,
                f,
                g,
                h,
                b = this;
            return (
                (h = void 0 !== a.originalEvent ? a.originalEvent.touches : null),
                !b.dragging || (h && 1 !== h.length)
                    ? !1
                    : ((d = b.getLeft(b.currentSlide)),
                      (b.touchObject.curX = void 0 !== h ? h[0].pageX : a.clientX),
                      (b.touchObject.curY = void 0 !== h ? h[0].pageY : a.clientY),
                      (b.touchObject.swipeLength = Math.round(Math.sqrt(Math.pow(b.touchObject.curX - b.touchObject.startX, 2)))),
                      b.options.verticalSwiping === !0 &&
                          (b.touchObject.swipeLength = Math.round(
                              Math.sqrt(Math.pow(b.touchObject.curY - b.touchObject.startY, 2))
                          )),
                      (e = b.swipeDirection()),
                      'vertical' !== e
                          ? (void 0 !== a.originalEvent && b.touchObject.swipeLength > 4 && a.preventDefault(),
                            (g = (b.options.rtl === !1 ? 1 : -1) * (b.touchObject.curX > b.touchObject.startX ? 1 : -1)),
                            b.options.verticalSwiping === !0 && (g = b.touchObject.curY > b.touchObject.startY ? 1 : -1),
                            (f = b.touchObject.swipeLength),
                            (b.touchObject.edgeHit = !1),
                            b.options.infinite === !1 &&
                                ((0 === b.currentSlide && 'right' === e) ||
                                    (b.currentSlide >= b.getDotCount() && 'left' === e)) &&
                                ((f = b.touchObject.swipeLength * b.options.edgeFriction), (b.touchObject.edgeHit = !0)),
                            b.options.vertical === !1
                                ? (b.swipeLeft = d + f * g)
                                : (b.swipeLeft = d + f * (b.$list.height() / b.listWidth) * g),
                            b.options.verticalSwiping === !0 && (b.swipeLeft = d + f * g),
                            b.options.fade === !0 || b.options.touchMove === !1
                                ? !1
                                : b.animating === !0
                                ? ((b.swipeLeft = null), !1)
                                : void b.setCSS(b.swipeLeft))
                          : void 0)
            );
        }),
        (b.prototype.swipeStart = function (a) {
            var c,
                b = this;
            return (
                (b.interrupted = !0),
                1 !== b.touchObject.fingerCount || b.slideCount <= b.options.slidesToShow
                    ? ((b.touchObject = {}), !1)
                    : (void 0 !== a.originalEvent && void 0 !== a.originalEvent.touches && (c = a.originalEvent.touches[0]),
                      (b.touchObject.startX = b.touchObject.curX = void 0 !== c ? c.pageX : a.clientX),
                      (b.touchObject.startY = b.touchObject.curY = void 0 !== c ? c.pageY : a.clientY),
                      void (b.dragging = !0))
            );
        }),
        (b.prototype.unfilterSlides = b.prototype.slickUnfilter = function () {
            var a = this;
            null !== a.$slidesCache &&
                (a.unload(),
                a.$slideTrack.children(this.options.slide).detach(),
                a.$slidesCache.appendTo(a.$slideTrack),
                a.reinit());
        }),
        (b.prototype.unload = function () {
            var b = this;
            a('.slick-cloned', b.$slider).remove(),
                b.$dots && b.$dots.remove(),
                b.$prevArrow && b.htmlExpr.test(b.options.prevArrow) && b.$prevArrow.remove(),
                b.$nextArrow && b.htmlExpr.test(b.options.nextArrow) && b.$nextArrow.remove(),
                b.$slides
                    .removeClass('slick-slide slick-active slick-visible slick-current')
                    .attr('aria-hidden', 'true')
                    .css('width', '');
        }),
        (b.prototype.unslick = function (a) {
            var b = this;
            b.$slider.trigger('unslick', [b, a]), b.destroy();
        }),
        (b.prototype.updateArrows = function () {
            var b,
                a = this;
            (b = Math.floor(a.options.slidesToShow / 2)),
                a.options.arrows === !0 &&
                    a.slideCount > a.options.slidesToShow &&
                    !a.options.infinite &&
                    (a.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false'),
                    a.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false'),
                    0 === a.currentSlide
                        ? (a.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true'),
                          a.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false'))
                        : a.currentSlide >= a.slideCount - a.options.slidesToShow && a.options.centerMode === !1
                        ? (a.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true'),
                          a.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false'))
                        : a.currentSlide >= a.slideCount - 1 &&
                          a.options.centerMode === !0 &&
                          (a.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true'),
                          a.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false')));
        }),
        (b.prototype.updateDots = function () {
            var a = this;
            null !== a.$dots &&
                (a.$dots.find('li').removeClass('slick-active').attr('aria-hidden', 'true'),
                a.$dots
                    .find('li')
                    .eq(Math.floor(a.currentSlide / a.options.slidesToScroll))
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false'));
        }),
        (b.prototype.visibility = function () {
            var a = this;
            a.options.autoplay && (document[a.hidden] ? (a.interrupted = !0) : (a.interrupted = !1));
        }),
        (a.fn.slick = function () {
            var f,
                g,
                a = this,
                c = arguments[0],
                d = Array.prototype.slice.call(arguments, 1),
                e = a.length;
            for (f = 0; e > f; f++)
                if (
                    ('object' == typeof c || 'undefined' == typeof c
                        ? (a[f].slick = new b(a[f], c))
                        : (g = a[f].slick[c].apply(a[f].slick, d)),
                    'undefined' != typeof g)
                )
                    return g;
            return a;
        });
});

// Generated by CoffeeScript 1.8.0

/*
jQuery Credit Card Validator 1.0

Copyright 2012-2015 Pawel Decowski

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software
is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
IN THE SOFTWARE.
 */

(function() {
  var $,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  $ = jQuery;

  $.fn.validateCreditCard = function(callback, options) {
    var bind, card, card_type, card_types, get_card_type, is_valid_length, is_valid_luhn, normalize, validate, validate_number, _i, _len, _ref;
    card_types = [
      {
        name: 'amex',
        pattern: /^3[47]/,
        valid_length: [15]
      }, {
        name: 'diners_club_carte_blanche',
        pattern: /^30[0-5]/,
        valid_length: [14]
      }, {
        name: 'diners_club_international',
        pattern: /^(36|38|39)/,
        valid_length: [14]
      }, {
        name: 'jcb',
        pattern: /^35(2[89]|[3-8][0-9])/,
        valid_length: [16]
      }, {
        name: 'laser',
        pattern: /^(6304|670[69]|6771)/,
        valid_length: [16, 17, 18, 19]
      }, {
        name: 'visa_electron',
        pattern: /^(4026|417500|4508|4844|491(3|7))/,
        valid_length: [16]
      }, {
        name: 'visa',
        pattern: /^4/,
        valid_length: [16]
      }, {
        name: 'mastercard',
        pattern: /^5[1-5]|^2(?:2(?:2[1-9]|[3-9]\d)|[3-6]\d\d|7(?:[01]\d|20))/,
        valid_length: [16]
      }, {
        name: 'maestro',
        pattern: /^(5018|5020|5038|6304|6759|676[1-3])/,
        valid_length: [12, 13, 14, 15, 16, 17, 18, 19]
      }, {
        name: 'discover',
        pattern: /^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,
        valid_length: [16]
      }
    ];
    bind = false;
    if (callback) {
      if (typeof callback === 'object') {
        options = callback;
        bind = false;
        callback = null;
      } else if (typeof callback === 'function') {
        bind = true;
      }
    }
    if (options == null) {
      options = {};
    }
    if (options.accept == null) {
      options.accept = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = card_types.length; _i < _len; _i++) {
          card = card_types[_i];
          _results.push(card.name);
        }
        return _results;
      })();
    }
    _ref = options.accept;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      card_type = _ref[_i];
      if (__indexOf.call((function() {
        var _j, _len1, _results;
        _results = [];
        for (_j = 0, _len1 = card_types.length; _j < _len1; _j++) {
          card = card_types[_j];
          _results.push(card.name);
        }
        return _results;
      })(), card_type) < 0) {
        throw "Credit card type '" + card_type + "' is not supported";
      }
    }
    get_card_type = function(number) {
      var _j, _len1, _ref1;
      _ref1 = (function() {
        var _k, _len1, _ref1, _results;
        _results = [];
        for (_k = 0, _len1 = card_types.length; _k < _len1; _k++) {
          card = card_types[_k];
          if (_ref1 = card.name, __indexOf.call(options.accept, _ref1) >= 0) {
            _results.push(card);
          }
        }
        return _results;
      })();
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        card_type = _ref1[_j];
        if (number.match(card_type.pattern)) {
          return card_type;
        }
      }
      return null;
    };
    is_valid_luhn = function(number) {
      var digit, n, sum, _j, _len1, _ref1;
      sum = 0;
      _ref1 = number.split('').reverse();
      for (n = _j = 0, _len1 = _ref1.length; _j < _len1; n = ++_j) {
        digit = _ref1[n];
        digit = +digit;
        if (n % 2) {
          digit *= 2;
          if (digit < 10) {
            sum += digit;
          } else {
            sum += digit - 9;
          }
        } else {
          sum += digit;
        }
      }
      return sum % 10 === 0;
    };
    is_valid_length = function(number, card_type) {
      var _ref1;
      return _ref1 = number.length, __indexOf.call(card_type.valid_length, _ref1) >= 0;
    };
    validate_number = (function(_this) {
      return function(number) {
        var length_valid, luhn_valid;
        card_type = get_card_type(number);
        luhn_valid = false;
        length_valid = false;
        if (card_type != null) {
          luhn_valid = is_valid_luhn(number);
          length_valid = is_valid_length(number, card_type);
        }
        return {
          card_type: card_type,
          valid: luhn_valid && length_valid,
          luhn_valid: luhn_valid,
          length_valid: length_valid
        };
      };
    })(this);
    validate = (function(_this) {
      return function() {
        var number;
        number = normalize($(_this).val());
        return validate_number(number);
      };
    })(this);
    normalize = function(number) {
      return number.replace(/[ -]/g, '');
    };
    if (!bind) {
      return validate();
    }
    this.on('input.jccv', (function(_this) {
      return function() {
        $(_this).off('keyup.jccv');
        return callback.call(_this, validate());
      };
    })(this));
    this.on('keyup.jccv', (function(_this) {
      return function() {
        return callback.call(_this, validate());
      };
    })(this));
    callback.call(this, validate());
    return this;
  };

}).call(this);

/*
 * pagination.js 2.0.7
 * A jQuery plugin to provide simple yet fully customisable pagination.
 * https://github.com/superRaytin/paginationjs
 *
 * Homepage: http://paginationjs.com
 *
 * Copyright 2014-2100, superRaytin
 * Released under the MIT license.
 */

(function(global, $) {

    if (typeof $ === 'undefined') {
        throwError('Pagination requires jQuery.');
    }

    var pluginName = 'pagination';

    var pluginHookMethod = 'addHook';

    var eventPrefix = '__pagination-';

    // Conflict, use backup
    if ($.fn.pagination) {
        pluginName = 'pagination2';
    }

    $.fn[pluginName] = function(options) {

        if (typeof options === 'undefined') {
            return this;
        }

        var container = $(this);

        var pagination = {

            initialize: function() {
                var self = this;

                // Save attributes of current instance
                if (!container.data('pagination')) {
                    container.data('pagination', {});
                }

                // Before initialize
                if (self.callHook('beforeInit') === false) return;

                // If pagination has been initialized, destroy it
                if (container.data('pagination').initialized) {
                    $('.paginationjs', container).remove();
                }

                // Whether to disable Pagination at the initialization
                self.disabled = !!attributes.disabled;

                // Passed to the callback function
                var model = self.model = {
                    pageRange: attributes.pageRange,
                    pageSize: attributes.pageSize
                };

                // "dataSource"`s type is unknown, parse it to find true data
                self.parseDataSource(attributes.dataSource, function(dataSource) {

                    // Whether pagination is sync mode
                    self.sync = Helpers.isArray(dataSource);
                    if (self.sync) {
                        model.totalNumber = attributes.totalNumber = dataSource.length;
                    }

                    // Obtain the total number of pages
                    model.totalPage = self.getTotalPage();

                    // Less than one page
                    if (attributes.hideWhenLessThanOnePage) {
                        if (model.totalPage <= 1) return;
                    }

                    var el = self.render(true);

                    // Extra className
                    if (attributes.className) {
                        el.addClass(attributes.className);
                    }

                    model.el = el;

                    // Load template
                    container[attributes.position === 'bottom' ? 'append' : 'prepend'](el);

                    // Binding events
                    self.observer();

                    // initialized flag
                    container.data('pagination').initialized = true;

                    // After initialized
                    self.callHook('afterInit', el);

                });

            },

            render: function(isBoot) {

                var self = this;
                var model = self.model;
                var el = model.el || $('<div class="paginationjs"></div>');
                var isForced = isBoot !== true;

                // Before render
                self.callHook('beforeRender', isForced);

                var currentPage = model.pageNumber || attributes.pageNumber;
                var pageRange = attributes.pageRange;
                var totalPage = model.totalPage;

                var rangeStart = currentPage - pageRange;
                var rangeEnd = currentPage + pageRange;

                if (rangeEnd > totalPage) {
                    rangeEnd = totalPage;
                    rangeStart = totalPage - pageRange * 2;
                    rangeStart = rangeStart < 1 ? 1 : rangeStart;
                }

                if (rangeStart <= 1) {
                    rangeStart = 1;

                    rangeEnd = Math.min(pageRange * 2 + 1, totalPage);
                }

                el.html(self.createTemplate({
                    currentPage: currentPage,
                    pageRange: pageRange,
                    totalPage: totalPage,
                    rangeStart: rangeStart,
                    rangeEnd: rangeEnd
                }));

                // After render
                self.callHook('afterRender', isForced);

                return el;
            },

            // Create template
            createTemplate: function(args) {

                var self = this;
                var currentPage = args.currentPage;
                var totalPage = args.totalPage;
                var rangeStart = args.rangeStart;
                var rangeEnd = args.rangeEnd;

                var totalNumber = attributes.totalNumber;

                var showPrevious = attributes.showPrevious;
                var showNext = attributes.showNext;
                var showPageNumbers = attributes.showPageNumbers;
                var showNavigator = attributes.showNavigator;
                var showGoInput = attributes.showGoInput;
                var showGoButton = attributes.showGoButton;

                var pageLink = attributes.pageLink;
                var prevText = attributes.prevText;
                var nextText = attributes.nextText;
                var ellipsisText = attributes.ellipsisText;
                var goButtonText = attributes.goButtonText;

                var classPrefix = attributes.classPrefix;
                var activeClassName = attributes.activeClassName;
                var disableClassName = attributes.disableClassName;
                var ulClassName = attributes.ulClassName;

                var formatNavigator = $.isFunction(attributes.formatNavigator) ? attributes.formatNavigator() : attributes.formatNavigator;
                var formatGoInput = $.isFunction(attributes.formatGoInput) ? attributes.formatGoInput() : attributes.formatGoInput;
                var formatGoButton = $.isFunction(attributes.formatGoButton) ? attributes.formatGoButton() : attributes.formatGoButton;

                var autoHidePrevious = $.isFunction(attributes.autoHidePrevious) ? attributes.autoHidePrevious() : attributes.autoHidePrevious;
                var autoHideNext = $.isFunction(attributes.autoHideNext) ? attributes.autoHideNext() : attributes.autoHideNext;

                var header = $.isFunction(attributes.header) ? attributes.header() : attributes.header;
                var footer = $.isFunction(attributes.footer) ? attributes.footer() : attributes.footer;

                var html = '';
                var goInput = '<input type="text" class="J-paginationjs-go-pagenumber">';
                var goButton = '<input type="button" class="J-paginationjs-go-button" value="'+ goButtonText +'">';
                var formattedString;
                var i;

                if (header) {

                    formattedString = self.replaceVariables(header, {
                        currentPage: currentPage,
                        totalPage: totalPage,
                        totalNumber: totalNumber
                    });

                    html += formattedString;
                }

                if (showPrevious || showPageNumbers || showNext) {

                    html += '<div class="paginationjs-pages">';

                    if (ulClassName) {
                        html += '<ul class="'+ ulClassName +'">';
                    }
                    else{
                        html += '<ul>';
                    }

                    // Previous page button
                    if (showPrevious) {
                        if (currentPage === 1) {
                            if (!autoHidePrevious) {
                                html += '<li class="'+ classPrefix +'-prev '+ disableClassName +'"><a>'+ prevText +'<\/a><\/li>';
                            }
                        }
                        else{
                            html += '<li class="'+ classPrefix +'-prev J-paginationjs-previous" data-num="'+ (currentPage - 1) +'" title="Previous page"><a href="'+ pageLink +'">'+ prevText +'<\/a><\/li>';
                        }
                    }

                    // Page numbers
                    if (showPageNumbers) {
                        if (rangeStart <= 3) {
                            for(i = 1; i < rangeStart; i++) {
                                if (i == currentPage) {
                                    html += '<li class="'+ classPrefix +'-page J-paginationjs-page '+ activeClassName +'" data-num="'+ i +'"><a>'+ i +'<\/a><\/li>';
                                }
                                else{
                                    html += '<li class="'+ classPrefix +'-page J-paginationjs-page" data-num="'+ i +'"><a href="'+ pageLink +'">'+ i +'<\/a><\/li>';
                                }
                            }
                        }
                        else{
                            if (attributes.showFirstOnEllipsisShow) {
                                html += '<li class="'+ classPrefix +'-page '+ classPrefix +'-first J-paginationjs-page" data-num="1"><a href="'+ pageLink +'">1<\/a><\/li>';
                            }

                            html += '<li class="'+ classPrefix +'-ellipsis '+ disableClassName +'"><a>'+ ellipsisText +'<\/a><\/li>';
                        }

                        // Main loop
                        for(i = rangeStart; i <= rangeEnd; i++) {
                            if (i == currentPage) {
                                html += '<li class="'+ classPrefix +'-page J-paginationjs-page '+ activeClassName +'" data-num="'+ i +'"><a>'+ i +'<\/a><\/li>';
                            }
                            else{
                                html += '<li class="'+ classPrefix +'-page J-paginationjs-page" data-num="'+ i +'"><a href="'+ pageLink +'">'+ i +'<\/a><\/li>';
                            }
                        }

                        if (rangeEnd >= totalPage - 2) {
                            for(i = rangeEnd + 1; i <= totalPage; i++) {
                                html += '<li class="'+ classPrefix +'-page J-paginationjs-page" data-num="'+ i +'"><a href="'+ pageLink +'">'+ i +'<\/a><\/li>';
                            }
                        }
                        else{
                            html += '<li class="'+ classPrefix +'-ellipsis '+ disableClassName +'"><a>'+ ellipsisText +'<\/a><\/li>';

                            if (attributes.showLastOnEllipsisShow) {
                                html += '<li class="'+ classPrefix +'-page '+ classPrefix +'-last J-paginationjs-page" data-num="'+ totalPage +'"><a href="'+ pageLink +'">'+ totalPage +'<\/a><\/li>';
                            }
                        }
                    }

                    // Next page button
                    if (showNext) {
                        if (currentPage == totalPage) {
                            if (!autoHideNext) {
                                html += '<li class="'+ classPrefix +'-next '+ disableClassName +'"><a>'+ nextText +'<\/a><\/li>';
                            }
                        }
                        else{
                            html += '<li class="'+ classPrefix +'-next J-paginationjs-next" data-num="'+ (currentPage + 1) +'" title="Next page"><a href="'+ pageLink +'">'+ nextText +'<\/a><\/li>';
                        }
                    }

                    html += '<\/ul><\/div>';

                }

                // Navigator
                if (showNavigator) {

                    if (formatNavigator) {

                        formattedString = self.replaceVariables(formatNavigator, {
                            currentPage: currentPage,
                            totalPage: totalPage,
                            totalNumber: totalNumber
                        });

                        html += '<div class="'+ classPrefix +'-nav J-paginationjs-nav">'+ formattedString +'<\/div>';
                    }
                }

                // Go input
                if (showGoInput) {

                    if (formatGoInput) {

                        formattedString = self.replaceVariables(formatGoInput, {
                            currentPage: currentPage,
                            totalPage: totalPage,
                            totalNumber: totalNumber,
                            input: goInput
                        });

                        html += '<div class="'+ classPrefix +'-go-input">'+ formattedString +'</div>';
                    }
                }

                // Go button
                if (showGoButton) {

                    if (formatGoButton) {

                        formattedString = self.replaceVariables(formatGoButton, {
                            currentPage: currentPage,
                            totalPage: totalPage,
                            totalNumber: totalNumber,
                            button: goButton
                        });

                        html += '<div class="'+ classPrefix +'-go-button">'+ formattedString +'</div>';
                    }
                }

                if (footer) {

                    formattedString = self.replaceVariables(footer, {
                        currentPage: currentPage,
                        totalPage: totalPage,
                        totalNumber: totalNumber
                    });

                    html += formattedString;
                }

                return html;
            },

            // Go to the specified page
            go: function(number, callback) {

                var self = this;
                var model = self.model;

                if (self.disabled) return;

                var pageNumber = number;
                var pageSize = attributes.pageSize;
                var totalPage = model.totalPage;

                pageNumber = parseInt(pageNumber);

                // Page number out of bounds
                if (!pageNumber || pageNumber < 1 || pageNumber > totalPage) return;

                // Sync mode
                if (self.sync) {
                    render(self.getDataSegment(pageNumber));
                    return;
                }

                var postData = {};
                var alias = attributes.alias || {};

                postData[alias.pageSize ? alias.pageSize : 'pageSize'] = pageSize;
                postData[alias.pageNumber ? alias.pageNumber : 'pageNumber'] = pageNumber;

                var formatAjaxParams = {
                    type: 'get',
                    cache: false,
                    data: {},
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    dataType: 'json',
                    async: true
                };

                $.extend(true, formatAjaxParams, attributes.ajax);
                $.extend(formatAjaxParams.data || {}, postData);

                formatAjaxParams.url = attributes.dataSource;
                formatAjaxParams.success = function(response) {
                    render(self.filterDataByLocator(response));
                };
                formatAjaxParams.error = function(jqXHR, textStatus, errorThrown) {
                    attributes.formatAjaxError && attributes.formatAjaxError(jqXHR, textStatus, errorThrown);
                    self.enable();
                };

                self.disable();

                $.ajax(formatAjaxParams);

                function render(data) {

                    // Before paging
                    if (self.callHook('beforePaging', pageNumber) === false) return false;

                    // Pagination direction
                    model.direction = typeof model.pageNumber === 'undefined' ? 0 : (pageNumber > model.pageNumber ? 1 : -1);

                    model.pageNumber = pageNumber;

                    self.render();

                    if (self.disabled && !self.sync) {
                        // enable
                        self.enable();
                    }

                    // cache model data
                    container.data('pagination').model = model;

                    // format result before execute callback
                    if ($.isFunction(attributes.formatResult)) {
                        var cloneData = $.extend(true, [], data);
                        if (!Helpers.isArray(data = attributes.formatResult(cloneData))) {
                            data = cloneData;
                        }
                    }

                    container.data('pagination').currentPageData = data;

                    // callback
                    self.doCallback(data, callback);

                    // After pageing
                    self.callHook('afterPaging', pageNumber);

                    // Already the first page
                    if (pageNumber == 1) {
                        self.callHook('afterIsFirstPage');
                    }

                    // Already the last page
                    if (pageNumber == model.totalPage) {
                        self.callHook('afterIsLastPage');
                    }

                }
            },

            doCallback: function(data, customCallback) {
                var self = this;
                var model = self.model;

                if ($.isFunction(customCallback)) {
                    customCallback(data, model);
                }
                else if ($.isFunction(attributes.callback)) {
                    attributes.callback(data, model);
                }
            },

            destroy: function() {

                // Before destroy
                if (this.callHook('beforeDestroy') === false) return;

                this.model.el.remove();
                container.off();

                // Remove style element
                $('#paginationjs-style').remove();

                // After destroy
                this.callHook('afterDestroy');
            },

            previous: function(callback) {
                this.go(this.model.pageNumber - 1, callback);
            },

            next: function(callback) {
                this.go(this.model.pageNumber + 1, callback);
            },

            disable: function() {
                var self = this;
                var source = self.sync ? 'sync' : 'async';

                // Before disable
                if (self.callHook('beforeDisable', source) === false) return;

                self.disabled = true;
                self.model.disabled = true;

                // After disable
                self.callHook('afterDisable', source);
            },

            enable: function() {
                var self = this;
                var source = self.sync ? 'sync' : 'async';

                // Before enable
                if (self.callHook('beforeEnable', source) === false) return;

                self.disabled = false;
                self.model.disabled = false;

                // After enable
                self.callHook('afterEnable', source);
            },

            refresh: function(callback) {
                this.go(this.model.pageNumber, callback);
            },

            show: function() {
                var self = this;

                if (self.model.el.is(':visible')) return;

                self.model.el.show();
            },

            hide: function() {
                var self = this;

                if (!self.model.el.is(':visible')) return;

                self.model.el.hide();
            },

            // Replace the variables of template
            replaceVariables: function(template, variables) {

                var formattedString;

                for(var key in variables) {
                    var value = variables[key];
                    var regexp = new RegExp('<%=\\s*'+ key +'\\s*%>', 'img');

                    formattedString = (formattedString || template).replace(regexp, value);
                }

                return formattedString;
            },

            // Get data segments
            getDataSegment: function(number) {
                var pageSize = attributes.pageSize;
                var dataSource = attributes.dataSource;
                var totalNumber = attributes.totalNumber;

                var start = pageSize * (number - 1) + 1;
                var end = Math.min(number * pageSize, totalNumber);

                return dataSource.slice(start - 1, end);
            },

            // Get total page
            getTotalPage: function() {
                return Math.ceil(attributes.totalNumber / attributes.pageSize);
            },

            // Get locator
            getLocator: function(locator) {
                var result;

                if (typeof locator === 'string') {
                    result = locator;
                }
                else if ($.isFunction(locator)) {
                    result = locator();
                }
                else{
                    throwError('"locator" is incorrect. (String | Function)');
                }

                return result;
            },

            // Filter data by "locator"
            filterDataByLocator: function(dataSource) {

                var locator = this.getLocator(attributes.locator);
                var filteredData;

                // Data source is an Object, use "locator" to locate the true data
                if (Helpers.isObject(dataSource)) {
                    try{
                        $.each(locator.split('.'), function(index, item) {
                            filteredData = (filteredData ? filteredData : dataSource)[item];
                        });
                    }
                    catch(e) {}

                    if (!filteredData) {
                        throwError('dataSource.'+ locator +' is undefined.');
                    }
                    else if (!Helpers.isArray(filteredData)) {
                        throwError('dataSource.'+ locator +' must be an Array.');
                    }
                }

                return filteredData || dataSource;
            },

            // Parse dataSource
            parseDataSource: function(dataSource, callback) {

                var self = this;
                var args = arguments;

                if (Helpers.isObject(dataSource)) {
                    callback(attributes.dataSource = self.filterDataByLocator(dataSource));
                }
                else if (Helpers.isArray(dataSource)) {
                    callback(attributes.dataSource = dataSource);
                }
                else if ($.isFunction(dataSource)) {
                    attributes.dataSource(function(data) {
                        if ($.isFunction(data)) {
                            throwError('Unexpect parameter of the "done" Function.');
                        }

                        args.callee.call(self, data, callback);
                    });
                }
                else if (typeof dataSource === 'string') {
                    if (/^https?|file:/.test(dataSource)) {
                        attributes.ajaxDataType = 'jsonp';
                    }

                    callback(dataSource);
                }
                else{
                    throwError('Unexpect data type of the "dataSource".');
                }
            },

            callHook: function(hook) {
                var paginationData = container.data('pagination');
                var result;

                var args = Array.prototype.slice.apply(arguments);
                args.shift();

                if (attributes[hook] && $.isFunction(attributes[hook])) {
                    if (attributes[hook].apply(global, args) === false) {
                        result = false;
                    }
                }

                if (paginationData.hooks && paginationData.hooks[hook]) {
                    $.each(paginationData.hooks[hook], function(index, item) {
                        if (item.apply(global, args) === false) {
                            result = false;
                        }
                    });
                }

                return result !== false;
            },

            observer: function() {

                var self = this;
                var el = self.model.el;

                // Go to page
                container.on(eventPrefix + 'go', function(event, pageNumber, done) {

                    pageNumber = parseInt($.trim(pageNumber));

                    if (!pageNumber) return;

                    if (!$.isNumeric(pageNumber)) {
                        throwError('"pageNumber" is incorrect. (Number)');
                    }

                    self.go(pageNumber, done);
                });

                // Page click
                el.delegate('.J-paginationjs-page', 'click', function(event) {
                    var current = $(event.currentTarget);
                    var pageNumber = $.trim(current.attr('data-num'));

                    if (!pageNumber || current.hasClass(attributes.disableClassName) || current.hasClass(attributes.activeClassName)) return;

                    // Before page button clicked
                    if (self.callHook('beforePageOnClick', event, pageNumber) === false) return false;

                    self.go(pageNumber);

                    // After page button clicked
                    self.callHook('afterPageOnClick', event, pageNumber);

                    if (!attributes.pageLink) return false;
                });

                // Previous click
                el.delegate('.J-paginationjs-previous', 'click', function(event) {
                    var current = $(event.currentTarget);
                    var pageNumber = $.trim(current.attr('data-num'));

                    if (!pageNumber || current.hasClass(attributes.disableClassName)) return;

                    // Before previous clicked
                    if (self.callHook('beforePreviousOnClick', event, pageNumber) === false) return false;

                    self.go(pageNumber);

                    // After previous clicked
                    self.callHook('afterPreviousOnClick', event, pageNumber);

                    if (!attributes.pageLink) return false;
                });

                // Next click
                el.delegate('.J-paginationjs-next', 'click', function(event) {
                    var current = $(event.currentTarget);
                    var pageNumber = $.trim(current.attr('data-num'));

                    if (!pageNumber || current.hasClass(attributes.disableClassName)) return;

                    // Before next clicked
                    if (self.callHook('beforeNextOnClick', event, pageNumber) === false) return false;

                    self.go(pageNumber);

                    // After next clicked
                    self.callHook('afterNextOnClick', event, pageNumber);

                    if (!attributes.pageLink) return false;
                });

                // Go button click
                el.delegate('.J-paginationjs-go-button', 'click', function() {
                    var pageNumber = $('.J-paginationjs-go-pagenumber', el).val();

                    // Before Go button clicked
                    if (self.callHook('beforeGoButtonOnClick', event, pageNumber) === false) return false;

                    container.trigger(eventPrefix + 'go', pageNumber);

                    // After Go button clicked
                    self.callHook('afterGoButtonOnClick', event, pageNumber);
                });

                // go input enter
                el.delegate('.J-paginationjs-go-pagenumber', 'keyup', function(event) {
                    if (event.which === 13) {
                        var pageNumber = $(event.currentTarget).val();

                        // Before Go input enter
                        if (self.callHook('beforeGoInputOnEnter', event, pageNumber) === false) return false;

                        container.trigger(eventPrefix + 'go', pageNumber);

                        // Regains focus
                        $('.J-paginationjs-go-pagenumber', el).focus();

                        // After Go input enter
                        self.callHook('afterGoInputOnEnter', event, pageNumber);
                    }
                });

                // Previous page
                container.on(eventPrefix + 'previous', function(event, done) {
                    self.previous(done);
                });

                // Next page
                container.on(eventPrefix + 'next', function(event, done) {
                    self.next(done);
                });

                // Disable
                container.on(eventPrefix + 'disable', function() {
                    self.disable();
                });

                // Enable
                container.on(eventPrefix + 'enable', function() {
                    self.enable();
                });

                // Refresh
                container.on(eventPrefix + 'refresh', function(event, done) {
                    self.refresh(done);
                });

                // Show
                container.on(eventPrefix + 'show', function() {
                    self.show();
                });

                // Hide
                container.on(eventPrefix + 'hide', function() {
                    self.hide();
                });

                // Destroy
                container.on(eventPrefix + 'destroy', function() {
                    self.destroy();
                });

                // Whether to load the default page
                if (attributes.triggerPagingOnInit) {
                    container.trigger(eventPrefix + 'go', Math.min(attributes.pageNumber, self.model.totalPage));
                }
            }
        };


        // If initial
        if (container.data('pagination') && container.data('pagination').initialized === true) {

            // Handling events
            if ($.isNumeric(options)) {
                // container.pagination(5)
                container.trigger.call(this, eventPrefix + 'go', options, arguments[1]);
                return this;
            }
            else if (typeof options === 'string') {

                var args = Array.prototype.slice.apply(arguments);
                args[0] = eventPrefix + args[0];

                switch(options) {
                    case 'previous':
                    case 'next':
                    case 'go':
                    case 'disable':
                    case 'enable':
                    case 'refresh':
                    case 'show':
                    case 'hide':
                    case 'destroy':
                        container.trigger.apply(this, args);
                        break;

                    // Get selected page number
                    case 'getSelectedPageNum':
                        if (container.data('pagination').model) {
                            return container.data('pagination').model.pageNumber;
                        }
                        else{
                            return container.data('pagination').attributes.pageNumber;
                        }

                    // Get total page
                    case 'getTotalPage':
                        return container.data('pagination').model.totalPage;

                    // Get selected page data
                    case 'getSelectedPageData':
                        return container.data('pagination').currentPageData;

                    // Whether pagination was be disabled
                    case 'isDisabled':
                        return container.data('pagination').model.disabled === true;

                    default:
                        throwError('Pagination do not provide action: ' + options);
                }

                return this;
            } else {
                // Uninstall the old instance before initialize a new one
                uninstallPlugin(container);
            }
        }
        else{
            if (!Helpers.isObject(options)) {
                throwError('Illegal options');
            }
        }


        // Attributes
        var attributes = $.extend({}, arguments.callee.defaults, options);

        // Check parameters
        parameterChecker(attributes);

        pagination.initialize();

        return this;
    };

    // Instance defaults
    $.fn[pluginName].defaults = {

        // Data source
        // Array | String | Function | Object
        //dataSource: '',

        // String | Function
        //locator: 'data',

        // Total entries, must be specified when the pagination is asynchronous
        totalNumber: 1,

        // Default page
        pageNumber: 1,

        // entries of per page
        pageSize: 10,

        // Page range (pages on both sides of the current page)
        pageRange: 2,

        // Whether to display the 'Previous' button
        showPrevious: true,

        // Whether to display the 'Next' button
        showNext: true,

        // Whether to display the page buttons
        showPageNumbers: true,

        showNavigator: false,

        // Whether to display the 'Go' input
        showGoInput: false,

        // Whether to display the 'Go' button
        showGoButton: false,

        // Page link
        pageLink: '',

        // 'Previous' text
        prevText: '&laquo;',

        // 'Next' text
        nextText: '&raquo;',

        // Ellipsis text
        ellipsisText: '...',

        // 'Go' button text
        goButtonText: 'Go',

        // Additional className for Pagination element
        //className: '',

        classPrefix: 'paginationjs',

        // Default active class
        activeClassName: 'active',

        // Default disable class
        disableClassName: 'disabled',

        //ulClassName: '',

        // Whether to insert inline style
        inlineStyle: true,

        formatNavigator: '<%= currentPage %> / <%= totalPage %>',

        formatGoInput: '<%= input %>',

        formatGoButton: '<%= button %>',

        // Pagination element's position in the container
        position: 'bottom',

        // Auto hide previous button when current page is the first page
        autoHidePrevious: false,

        // Auto hide next button when current page is the last page
        autoHideNext: false,

        //header: '',

        //footer: '',

        // Aliases for custom pagination parameters
        //alias: {},

        // Whether to trigger pagination at initialization
        triggerPagingOnInit: true,

        // Whether to hide pagination when less than one page
        hideWhenLessThanOnePage: false,

        showFirstOnEllipsisShow: true,

        showLastOnEllipsisShow: true,

        // Pagging callback
        callback: function() {}
    };

    // Hook register
    $.fn[pluginHookMethod] = function(hook, callback) {

        if (arguments.length < 2) {
            throwError('Missing argument.');
        }

        if (!$.isFunction(callback)) {
            throwError('callback must be a function.');
        }

        var container = $(this);
        var paginationData = container.data('pagination');

        if (!paginationData) {
            container.data('pagination', {});
            paginationData = container.data('pagination');
        }

        !paginationData.hooks && (paginationData.hooks = {});

        //paginationData.hooks[hook] = callback;
        paginationData.hooks[hook] = paginationData.hooks[hook] || [];
        paginationData.hooks[hook].push(callback);

    };

    // Static method
    $[pluginName] = function(selector, options) {

        if (arguments.length < 2) {
            throwError('Requires two parameters.');
        }

        var container;

        // 'selector' is a jQuery object
        if (typeof selector !== 'string' && selector instanceof jQuery) {
            container = selector;
        }
        else{
            container = $(selector);
        }

        if (!container.length) return;

        container.pagination(options);

        return container;

    };

    // ============================================================
    // helpers
    // ============================================================

    var Helpers = {};

    // Throw error
    function throwError(content) {
        throw new Error('Pagination: '+ content);
    }

    // Check parameters
    function parameterChecker(args) {

        if (!args.dataSource) {
            throwError('"dataSource" is required.');
        }

        if (typeof args.dataSource === 'string') {
            if (typeof args.totalNumber === 'undefined') {
                throwError('"totalNumber" is required.');
            }
            else if (!$.isNumeric(args.totalNumber)) {
                throwError('"totalNumber" is incorrect. (Number)');
            }
        }
        else if (Helpers.isObject(args.dataSource)) {
            if (typeof args.locator === 'undefined') {
                throwError('"dataSource" is an Object, please specify "locator".');
            }
            else if (typeof args.locator !== 'string' && !$.isFunction(args.locator)) {
                throwError(''+ args.locator +' is incorrect. (String | Function)');
            }
        }
    }

    // uninstall plugin
    function uninstallPlugin(target) {
        var events = ['go', 'previous', 'next', 'disable', 'enable', 'refresh', 'show', 'hide', 'destroy'];

        // off events of old instance
        $.each(events, function(index, value) {
            target.off(eventPrefix + value);
        });

        // reset pagination data
        target.data('pagination', {});

        // remove old
        $('.paginationjs', target).remove();
    }

    // Object type detection
    function getObjectType(object, tmp) {
        return ( (tmp = typeof(object)) == "object" ? object == null && "null" || Object.prototype.toString.call(object).slice(8, -1) : tmp ).toLowerCase();
    }
    $.each(['Object', 'Array'], function(index, name) {
        Helpers['is' + name] = function(object) {
            return getObjectType(object) === name.toLowerCase();
        };
    });

    /*
     * export via AMD or CommonJS
     * */
    if (typeof define === 'function' && define.amd) {
        define(function() {
            return $;
        });
    }

})(this, window.jQuery);
/*!
 * Vue.js v2.6.12
 * (c) 2014-2020 Evan You
 * Released under the MIT License.
 */
!(function (e, t) {
    'object' == typeof exports && 'undefined' != typeof module
        ? (module.exports = t())
        : 'function' == typeof define && define.amd
        ? define(t)
        : ((e = e || self).Vue = t());
})(this, function () {
    'use strict';
    var e = Object.freeze({});
    function t(e) {
        return null == e;
    }
    function n(e) {
        return null != e;
    }
    function r(e) {
        return !0 === e;
    }
    function i(e) {
        return 'string' == typeof e || 'number' == typeof e || 'symbol' == typeof e || 'boolean' == typeof e;
    }
    function o(e) {
        return null !== e && 'object' == typeof e;
    }
    var a = Object.prototype.toString;
    function s(e) {
        return '[object Object]' === a.call(e);
    }
    function c(e) {
        var t = parseFloat(String(e));
        return t >= 0 && Math.floor(t) === t && isFinite(e);
    }
    function u(e) {
        return n(e) && 'function' == typeof e.then && 'function' == typeof e.catch;
    }
    function l(e) {
        return null == e ? '' : Array.isArray(e) || (s(e) && e.toString === a) ? JSON.stringify(e, null, 2) : String(e);
    }
    function f(e) {
        var t = parseFloat(e);
        return isNaN(t) ? e : t;
    }
    function p(e, t) {
        for (var n = Object.create(null), r = e.split(','), i = 0; i < r.length; i++) n[r[i]] = !0;
        return t
            ? function (e) {
                  return n[e.toLowerCase()];
              }
            : function (e) {
                  return n[e];
              };
    }
    var d = p('slot,component', !0),
        v = p('key,ref,slot,slot-scope,is');
    function h(e, t) {
        if (e.length) {
            var n = e.indexOf(t);
            if (n > -1) return e.splice(n, 1);
        }
    }
    var m = Object.prototype.hasOwnProperty;
    function y(e, t) {
        return m.call(e, t);
    }
    function g(e) {
        var t = Object.create(null);
        return function (n) {
            return t[n] || (t[n] = e(n));
        };
    }
    var _ = /-(\w)/g,
        b = g(function (e) {
            return e.replace(_, function (e, t) {
                return t ? t.toUpperCase() : '';
            });
        }),
        $ = g(function (e) {
            return e.charAt(0).toUpperCase() + e.slice(1);
        }),
        w = /\B([A-Z])/g,
        C = g(function (e) {
            return e.replace(w, '-$1').toLowerCase();
        });
    var x = Function.prototype.bind
        ? function (e, t) {
              return e.bind(t);
          }
        : function (e, t) {
              function n(n) {
                  var r = arguments.length;
                  return r ? (r > 1 ? e.apply(t, arguments) : e.call(t, n)) : e.call(t);
              }
              return (n._length = e.length), n;
          };
    function k(e, t) {
        t = t || 0;
        for (var n = e.length - t, r = new Array(n); n--; ) r[n] = e[n + t];
        return r;
    }
    function A(e, t) {
        for (var n in t) e[n] = t[n];
        return e;
    }
    function O(e) {
        for (var t = {}, n = 0; n < e.length; n++) e[n] && A(t, e[n]);
        return t;
    }
    function S(e, t, n) {}
    var T = function (e, t, n) {
            return !1;
        },
        E = function (e) {
            return e;
        };
    function N(e, t) {
        if (e === t) return !0;
        var n = o(e),
            r = o(t);
        if (!n || !r) return !n && !r && String(e) === String(t);
        try {
            var i = Array.isArray(e),
                a = Array.isArray(t);
            if (i && a)
                return (
                    e.length === t.length &&
                    e.every(function (e, n) {
                        return N(e, t[n]);
                    })
                );
            if (e instanceof Date && t instanceof Date) return e.getTime() === t.getTime();
            if (i || a) return !1;
            var s = Object.keys(e),
                c = Object.keys(t);
            return (
                s.length === c.length &&
                s.every(function (n) {
                    return N(e[n], t[n]);
                })
            );
        } catch (e) {
            return !1;
        }
    }
    function j(e, t) {
        for (var n = 0; n < e.length; n++) if (N(e[n], t)) return n;
        return -1;
    }
    function D(e) {
        var t = !1;
        return function () {
            t || ((t = !0), e.apply(this, arguments));
        };
    }
    var L = 'data-server-rendered',
        M = ['component', 'directive', 'filter'],
        I = [
            'beforeCreate',
            'created',
            'beforeMount',
            'mounted',
            'beforeUpdate',
            'updated',
            'beforeDestroy',
            'destroyed',
            'activated',
            'deactivated',
            'errorCaptured',
            'serverPrefetch',
        ],
        F = {
            optionMergeStrategies: Object.create(null),
            silent: !1,
            productionTip: !1,
            devtools: !1,
            performance: !1,
            errorHandler: null,
            warnHandler: null,
            ignoredElements: [],
            keyCodes: Object.create(null),
            isReservedTag: T,
            isReservedAttr: T,
            isUnknownElement: T,
            getTagNamespace: S,
            parsePlatformTagName: E,
            mustUseProp: T,
            async: !0,
            _lifecycleHooks: I,
        },
        P =
            /a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;
    function R(e, t, n, r) {
        Object.defineProperty(e, t, { value: n, enumerable: !!r, writable: !0, configurable: !0 });
    }
    var H = new RegExp('[^' + P.source + '.$_\\d]');
    var B,
        U = '__proto__' in {},
        z = 'undefined' != typeof window,
        V = 'undefined' != typeof WXEnvironment && !!WXEnvironment.platform,
        K = V && WXEnvironment.platform.toLowerCase(),
        J = z && window.navigator.userAgent.toLowerCase(),
        q = J && /msie|trident/.test(J),
        W = J && J.indexOf('msie 9.0') > 0,
        Z = J && J.indexOf('edge/') > 0,
        G = (J && J.indexOf('android'), (J && /iphone|ipad|ipod|ios/.test(J)) || 'ios' === K),
        X = (J && /chrome\/\d+/.test(J), J && /phantomjs/.test(J), J && J.match(/firefox\/(\d+)/)),
        Y = {}.watch,
        Q = !1;
    if (z)
        try {
            var ee = {};
            Object.defineProperty(ee, 'passive', {
                get: function () {
                    Q = !0;
                },
            }),
                window.addEventListener('test-passive', null, ee);
        } catch (e) {}
    var te = function () {
            return void 0 === B && (B = !z && !V && 'undefined' != typeof global && global.process && 'server' === global.process.env.VUE_ENV), B;
        },
        ne = z && window.__VUE_DEVTOOLS_GLOBAL_HOOK__;
    function re(e) {
        return 'function' == typeof e && /native code/.test(e.toString());
    }
    var ie,
        oe = 'undefined' != typeof Symbol && re(Symbol) && 'undefined' != typeof Reflect && re(Reflect.ownKeys);
    ie =
        'undefined' != typeof Set && re(Set)
            ? Set
            : (function () {
                  function e() {
                      this.set = Object.create(null);
                  }
                  return (
                      (e.prototype.has = function (e) {
                          return !0 === this.set[e];
                      }),
                      (e.prototype.add = function (e) {
                          this.set[e] = !0;
                      }),
                      (e.prototype.clear = function () {
                          this.set = Object.create(null);
                      }),
                      e
                  );
              })();
    var ae = S,
        se = 0,
        ce = function () {
            (this.id = se++), (this.subs = []);
        };
    (ce.prototype.addSub = function (e) {
        this.subs.push(e);
    }),
        (ce.prototype.removeSub = function (e) {
            h(this.subs, e);
        }),
        (ce.prototype.depend = function () {
            ce.target && ce.target.addDep(this);
        }),
        (ce.prototype.notify = function () {
            for (var e = this.subs.slice(), t = 0, n = e.length; t < n; t++) e[t].update();
        }),
        (ce.target = null);
    var ue = [];
    function le(e) {
        ue.push(e), (ce.target = e);
    }
    function fe() {
        ue.pop(), (ce.target = ue[ue.length - 1]);
    }
    var pe = function (e, t, n, r, i, o, a, s) {
            (this.tag = e),
                (this.data = t),
                (this.children = n),
                (this.text = r),
                (this.elm = i),
                (this.ns = void 0),
                (this.context = o),
                (this.fnContext = void 0),
                (this.fnOptions = void 0),
                (this.fnScopeId = void 0),
                (this.key = t && t.key),
                (this.componentOptions = a),
                (this.componentInstance = void 0),
                (this.parent = void 0),
                (this.raw = !1),
                (this.isStatic = !1),
                (this.isRootInsert = !0),
                (this.isComment = !1),
                (this.isCloned = !1),
                (this.isOnce = !1),
                (this.asyncFactory = s),
                (this.asyncMeta = void 0),
                (this.isAsyncPlaceholder = !1);
        },
        de = { child: { configurable: !0 } };
    (de.child.get = function () {
        return this.componentInstance;
    }),
        Object.defineProperties(pe.prototype, de);
    var ve = function (e) {
        void 0 === e && (e = '');
        var t = new pe();
        return (t.text = e), (t.isComment = !0), t;
    };
    function he(e) {
        return new pe(void 0, void 0, void 0, String(e));
    }
    function me(e) {
        var t = new pe(e.tag, e.data, e.children && e.children.slice(), e.text, e.elm, e.context, e.componentOptions, e.asyncFactory);
        return (
            (t.ns = e.ns),
            (t.isStatic = e.isStatic),
            (t.key = e.key),
            (t.isComment = e.isComment),
            (t.fnContext = e.fnContext),
            (t.fnOptions = e.fnOptions),
            (t.fnScopeId = e.fnScopeId),
            (t.asyncMeta = e.asyncMeta),
            (t.isCloned = !0),
            t
        );
    }
    var ye = Array.prototype,
        ge = Object.create(ye);
    ['push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse'].forEach(function (e) {
        var t = ye[e];
        R(ge, e, function () {
            for (var n = [], r = arguments.length; r--; ) n[r] = arguments[r];
            var i,
                o = t.apply(this, n),
                a = this.__ob__;
            switch (e) {
                case 'push':
                case 'unshift':
                    i = n;
                    break;
                case 'splice':
                    i = n.slice(2);
            }
            return i && a.observeArray(i), a.dep.notify(), o;
        });
    });
    var _e = Object.getOwnPropertyNames(ge),
        be = !0;
    function $e(e) {
        be = e;
    }
    var we = function (e) {
        var t;
        (this.value = e),
            (this.dep = new ce()),
            (this.vmCount = 0),
            R(e, '__ob__', this),
            Array.isArray(e)
                ? (U
                      ? ((t = ge), (e.__proto__ = t))
                      : (function (e, t, n) {
                            for (var r = 0, i = n.length; r < i; r++) {
                                var o = n[r];
                                R(e, o, t[o]);
                            }
                        })(e, ge, _e),
                  this.observeArray(e))
                : this.walk(e);
    };
    function Ce(e, t) {
        var n;
        if (o(e) && !(e instanceof pe))
            return (
                y(e, '__ob__') && e.__ob__ instanceof we
                    ? (n = e.__ob__)
                    : be && !te() && (Array.isArray(e) || s(e)) && Object.isExtensible(e) && !e._isVue && (n = new we(e)),
                t && n && n.vmCount++,
                n
            );
    }
    function xe(e, t, n, r, i) {
        var o = new ce(),
            a = Object.getOwnPropertyDescriptor(e, t);
        if (!a || !1 !== a.configurable) {
            var s = a && a.get,
                c = a && a.set;
            (s && !c) || 2 !== arguments.length || (n = e[t]);
            var u = !i && Ce(n);
            Object.defineProperty(e, t, {
                enumerable: !0,
                configurable: !0,
                get: function () {
                    var t = s ? s.call(e) : n;
                    return (
                        ce.target &&
                            (o.depend(),
                            u &&
                                (u.dep.depend(),
                                Array.isArray(t) &&
                                    (function e(t) {
                                        for (var n = void 0, r = 0, i = t.length; r < i; r++)
                                            (n = t[r]) && n.__ob__ && n.__ob__.dep.depend(), Array.isArray(n) && e(n);
                                    })(t))),
                        t
                    );
                },
                set: function (t) {
                    var r = s ? s.call(e) : n;
                    t === r || (t != t && r != r) || (s && !c) || (c ? c.call(e, t) : (n = t), (u = !i && Ce(t)), o.notify());
                },
            });
        }
    }
    function ke(e, t, n) {
        if (Array.isArray(e) && c(t)) return (e.length = Math.max(e.length, t)), e.splice(t, 1, n), n;
        if (t in e && !(t in Object.prototype)) return (e[t] = n), n;
        var r = e.__ob__;
        return e._isVue || (r && r.vmCount) ? n : r ? (xe(r.value, t, n), r.dep.notify(), n) : ((e[t] = n), n);
    }
    function Ae(e, t) {
        if (Array.isArray(e) && c(t)) e.splice(t, 1);
        else {
            var n = e.__ob__;
            e._isVue || (n && n.vmCount) || (y(e, t) && (delete e[t], n && n.dep.notify()));
        }
    }
    (we.prototype.walk = function (e) {
        for (var t = Object.keys(e), n = 0; n < t.length; n++) xe(e, t[n]);
    }),
        (we.prototype.observeArray = function (e) {
            for (var t = 0, n = e.length; t < n; t++) Ce(e[t]);
        });
    var Oe = F.optionMergeStrategies;
    function Se(e, t) {
        if (!t) return e;
        for (var n, r, i, o = oe ? Reflect.ownKeys(t) : Object.keys(t), a = 0; a < o.length; a++)
            '__ob__' !== (n = o[a]) && ((r = e[n]), (i = t[n]), y(e, n) ? r !== i && s(r) && s(i) && Se(r, i) : ke(e, n, i));
        return e;
    }
    function Te(e, t, n) {
        return n
            ? function () {
                  var r = 'function' == typeof t ? t.call(n, n) : t,
                      i = 'function' == typeof e ? e.call(n, n) : e;
                  return r ? Se(r, i) : i;
              }
            : t
            ? e
                ? function () {
                      return Se('function' == typeof t ? t.call(this, this) : t, 'function' == typeof e ? e.call(this, this) : e);
                  }
                : t
            : e;
    }
    function Ee(e, t) {
        var n = t ? (e ? e.concat(t) : Array.isArray(t) ? t : [t]) : e;
        return n
            ? (function (e) {
                  for (var t = [], n = 0; n < e.length; n++) -1 === t.indexOf(e[n]) && t.push(e[n]);
                  return t;
              })(n)
            : n;
    }
    function Ne(e, t, n, r) {
        var i = Object.create(e || null);
        return t ? A(i, t) : i;
    }
    (Oe.data = function (e, t, n) {
        return n ? Te(e, t, n) : t && 'function' != typeof t ? e : Te(e, t);
    }),
        I.forEach(function (e) {
            Oe[e] = Ee;
        }),
        M.forEach(function (e) {
            Oe[e + 's'] = Ne;
        }),
        (Oe.watch = function (e, t, n, r) {
            if ((e === Y && (e = void 0), t === Y && (t = void 0), !t)) return Object.create(e || null);
            if (!e) return t;
            var i = {};
            for (var o in (A(i, e), t)) {
                var a = i[o],
                    s = t[o];
                a && !Array.isArray(a) && (a = [a]), (i[o] = a ? a.concat(s) : Array.isArray(s) ? s : [s]);
            }
            return i;
        }),
        (Oe.props =
            Oe.methods =
            Oe.inject =
            Oe.computed =
                function (e, t, n, r) {
                    if (!e) return t;
                    var i = Object.create(null);
                    return A(i, e), t && A(i, t), i;
                }),
        (Oe.provide = Te);
    var je = function (e, t) {
        return void 0 === t ? e : t;
    };
    function De(e, t, n) {
        if (
            ('function' == typeof t && (t = t.options),
            (function (e, t) {
                var n = e.props;
                if (n) {
                    var r,
                        i,
                        o = {};
                    if (Array.isArray(n)) for (r = n.length; r--; ) 'string' == typeof (i = n[r]) && (o[b(i)] = { type: null });
                    else if (s(n)) for (var a in n) (i = n[a]), (o[b(a)] = s(i) ? i : { type: i });
                    e.props = o;
                }
            })(t),
            (function (e, t) {
                var n = e.inject;
                if (n) {
                    var r = (e.inject = {});
                    if (Array.isArray(n)) for (var i = 0; i < n.length; i++) r[n[i]] = { from: n[i] };
                    else if (s(n))
                        for (var o in n) {
                            var a = n[o];
                            r[o] = s(a) ? A({ from: o }, a) : { from: a };
                        }
                }
            })(t),
            (function (e) {
                var t = e.directives;
                if (t)
                    for (var n in t) {
                        var r = t[n];
                        'function' == typeof r && (t[n] = { bind: r, update: r });
                    }
            })(t),
            !t._base && (t.extends && (e = De(e, t.extends, n)), t.mixins))
        )
            for (var r = 0, i = t.mixins.length; r < i; r++) e = De(e, t.mixins[r], n);
        var o,
            a = {};
        for (o in e) c(o);
        for (o in t) y(e, o) || c(o);
        function c(r) {
            var i = Oe[r] || je;
            a[r] = i(e[r], t[r], n, r);
        }
        return a;
    }
    function Le(e, t, n, r) {
        if ('string' == typeof n) {
            var i = e[t];
            if (y(i, n)) return i[n];
            var o = b(n);
            if (y(i, o)) return i[o];
            var a = $(o);
            return y(i, a) ? i[a] : i[n] || i[o] || i[a];
        }
    }
    function Me(e, t, n, r) {
        var i = t[e],
            o = !y(n, e),
            a = n[e],
            s = Pe(Boolean, i.type);
        if (s > -1)
            if (o && !y(i, 'default')) a = !1;
            else if ('' === a || a === C(e)) {
                var c = Pe(String, i.type);
                (c < 0 || s < c) && (a = !0);
            }
        if (void 0 === a) {
            a = (function (e, t, n) {
                if (!y(t, 'default')) return;
                var r = t.default;
                if (e && e.$options.propsData && void 0 === e.$options.propsData[n] && void 0 !== e._props[n]) return e._props[n];
                return 'function' == typeof r && 'Function' !== Ie(t.type) ? r.call(e) : r;
            })(r, i, e);
            var u = be;
            $e(!0), Ce(a), $e(u);
        }
        return a;
    }
    function Ie(e) {
        var t = e && e.toString().match(/^\s*function (\w+)/);
        return t ? t[1] : '';
    }
    function Fe(e, t) {
        return Ie(e) === Ie(t);
    }
    function Pe(e, t) {
        if (!Array.isArray(t)) return Fe(t, e) ? 0 : -1;
        for (var n = 0, r = t.length; n < r; n++) if (Fe(t[n], e)) return n;
        return -1;
    }
    function Re(e, t, n) {
        le();
        try {
            if (t)
                for (var r = t; (r = r.$parent); ) {
                    var i = r.$options.errorCaptured;
                    if (i)
                        for (var o = 0; o < i.length; o++)
                            try {
                                if (!1 === i[o].call(r, e, t, n)) return;
                            } catch (e) {
                                Be(e, r, 'errorCaptured hook');
                            }
                }
            Be(e, t, n);
        } finally {
            fe();
        }
    }
    function He(e, t, n, r, i) {
        var o;
        try {
            (o = n ? e.apply(t, n) : e.call(t)) &&
                !o._isVue &&
                u(o) &&
                !o._handled &&
                (o.catch(function (e) {
                    return Re(e, r, i + ' (Promise/async)');
                }),
                (o._handled = !0));
        } catch (e) {
            Re(e, r, i);
        }
        return o;
    }
    function Be(e, t, n) {
        if (F.errorHandler)
            try {
                return F.errorHandler.call(null, e, t, n);
            } catch (t) {
                t !== e && Ue(t, null, 'config.errorHandler');
            }
        Ue(e, t, n);
    }
    function Ue(e, t, n) {
        if ((!z && !V) || 'undefined' == typeof console) throw e;
        console.error(e);
    }
    var ze,
        Ve = !1,
        Ke = [],
        Je = !1;
    function qe() {
        Je = !1;
        var e = Ke.slice(0);
        Ke.length = 0;
        for (var t = 0; t < e.length; t++) e[t]();
    }
    if ('undefined' != typeof Promise && re(Promise)) {
        var We = Promise.resolve();
        (ze = function () {
            We.then(qe), G && setTimeout(S);
        }),
            (Ve = !0);
    } else if (
        q ||
        'undefined' == typeof MutationObserver ||
        (!re(MutationObserver) && '[object MutationObserverConstructor]' !== MutationObserver.toString())
    )
        ze =
            'undefined' != typeof setImmediate && re(setImmediate)
                ? function () {
                      setImmediate(qe);
                  }
                : function () {
                      setTimeout(qe, 0);
                  };
    else {
        var Ze = 1,
            Ge = new MutationObserver(qe),
            Xe = document.createTextNode(String(Ze));
        Ge.observe(Xe, { characterData: !0 }),
            (ze = function () {
                (Ze = (Ze + 1) % 2), (Xe.data = String(Ze));
            }),
            (Ve = !0);
    }
    function Ye(e, t) {
        var n;
        if (
            (Ke.push(function () {
                if (e)
                    try {
                        e.call(t);
                    } catch (e) {
                        Re(e, t, 'nextTick');
                    }
                else n && n(t);
            }),
            Je || ((Je = !0), ze()),
            !e && 'undefined' != typeof Promise)
        )
            return new Promise(function (e) {
                n = e;
            });
    }
    var Qe = new ie();
    function et(e) {
        !(function e(t, n) {
            var r, i;
            var a = Array.isArray(t);
            if ((!a && !o(t)) || Object.isFrozen(t) || t instanceof pe) return;
            if (t.__ob__) {
                var s = t.__ob__.dep.id;
                if (n.has(s)) return;
                n.add(s);
            }
            if (a) for (r = t.length; r--; ) e(t[r], n);
            else for (i = Object.keys(t), r = i.length; r--; ) e(t[i[r]], n);
        })(e, Qe),
            Qe.clear();
    }
    var tt = g(function (e) {
        var t = '&' === e.charAt(0),
            n = '~' === (e = t ? e.slice(1) : e).charAt(0),
            r = '!' === (e = n ? e.slice(1) : e).charAt(0);
        return { name: (e = r ? e.slice(1) : e), once: n, capture: r, passive: t };
    });
    function nt(e, t) {
        function n() {
            var e = arguments,
                r = n.fns;
            if (!Array.isArray(r)) return He(r, null, arguments, t, 'v-on handler');
            for (var i = r.slice(), o = 0; o < i.length; o++) He(i[o], null, e, t, 'v-on handler');
        }
        return (n.fns = e), n;
    }
    function rt(e, n, i, o, a, s) {
        var c, u, l, f;
        for (c in e)
            (u = e[c]),
                (l = n[c]),
                (f = tt(c)),
                t(u) ||
                    (t(l)
                        ? (t(u.fns) && (u = e[c] = nt(u, s)),
                          r(f.once) && (u = e[c] = a(f.name, u, f.capture)),
                          i(f.name, u, f.capture, f.passive, f.params))
                        : u !== l && ((l.fns = u), (e[c] = l)));
        for (c in n) t(e[c]) && o((f = tt(c)).name, n[c], f.capture);
    }
    function it(e, i, o) {
        var a;
        e instanceof pe && (e = e.data.hook || (e.data.hook = {}));
        var s = e[i];
        function c() {
            o.apply(this, arguments), h(a.fns, c);
        }
        t(s) ? (a = nt([c])) : n(s.fns) && r(s.merged) ? (a = s).fns.push(c) : (a = nt([s, c])), (a.merged = !0), (e[i] = a);
    }
    function ot(e, t, r, i, o) {
        if (n(t)) {
            if (y(t, r)) return (e[r] = t[r]), o || delete t[r], !0;
            if (y(t, i)) return (e[r] = t[i]), o || delete t[i], !0;
        }
        return !1;
    }
    function at(e) {
        return i(e)
            ? [he(e)]
            : Array.isArray(e)
            ? (function e(o, a) {
                  var s = [];
                  var c, u, l, f;
                  for (c = 0; c < o.length; c++)
                      t((u = o[c])) ||
                          'boolean' == typeof u ||
                          ((l = s.length - 1),
                          (f = s[l]),
                          Array.isArray(u)
                              ? u.length > 0 &&
                                (st((u = e(u, (a || '') + '_' + c))[0]) && st(f) && ((s[l] = he(f.text + u[0].text)), u.shift()), s.push.apply(s, u))
                              : i(u)
                              ? st(f)
                                  ? (s[l] = he(f.text + u))
                                  : '' !== u && s.push(he(u))
                              : st(u) && st(f)
                              ? (s[l] = he(f.text + u.text))
                              : (r(o._isVList) && n(u.tag) && t(u.key) && n(a) && (u.key = '__vlist' + a + '_' + c + '__'), s.push(u)));
                  return s;
              })(e)
            : void 0;
    }
    function st(e) {
        return n(e) && n(e.text) && !1 === e.isComment;
    }
    function ct(e, t) {
        if (e) {
            for (var n = Object.create(null), r = oe ? Reflect.ownKeys(e) : Object.keys(e), i = 0; i < r.length; i++) {
                var o = r[i];
                if ('__ob__' !== o) {
                    for (var a = e[o].from, s = t; s; ) {
                        if (s._provided && y(s._provided, a)) {
                            n[o] = s._provided[a];
                            break;
                        }
                        s = s.$parent;
                    }
                    if (!s && 'default' in e[o]) {
                        var c = e[o].default;
                        n[o] = 'function' == typeof c ? c.call(t) : c;
                    }
                }
            }
            return n;
        }
    }
    function ut(e, t) {
        if (!e || !e.length) return {};
        for (var n = {}, r = 0, i = e.length; r < i; r++) {
            var o = e[r],
                a = o.data;
            if ((a && a.attrs && a.attrs.slot && delete a.attrs.slot, (o.context !== t && o.fnContext !== t) || !a || null == a.slot))
                (n.default || (n.default = [])).push(o);
            else {
                var s = a.slot,
                    c = n[s] || (n[s] = []);
                'template' === o.tag ? c.push.apply(c, o.children || []) : c.push(o);
            }
        }
        for (var u in n) n[u].every(lt) && delete n[u];
        return n;
    }
    function lt(e) {
        return (e.isComment && !e.asyncFactory) || ' ' === e.text;
    }
    function ft(t, n, r) {
        var i,
            o = Object.keys(n).length > 0,
            a = t ? !!t.$stable : !o,
            s = t && t.$key;
        if (t) {
            if (t._normalized) return t._normalized;
            if (a && r && r !== e && s === r.$key && !o && !r.$hasNormal) return r;
            for (var c in ((i = {}), t)) t[c] && '$' !== c[0] && (i[c] = pt(n, c, t[c]));
        } else i = {};
        for (var u in n) u in i || (i[u] = dt(n, u));
        return t && Object.isExtensible(t) && (t._normalized = i), R(i, '$stable', a), R(i, '$key', s), R(i, '$hasNormal', o), i;
    }
    function pt(e, t, n) {
        var r = function () {
            var e = arguments.length ? n.apply(null, arguments) : n({});
            return (e = e && 'object' == typeof e && !Array.isArray(e) ? [e] : at(e)) && (0 === e.length || (1 === e.length && e[0].isComment))
                ? void 0
                : e;
        };
        return n.proxy && Object.defineProperty(e, t, { get: r, enumerable: !0, configurable: !0 }), r;
    }
    function dt(e, t) {
        return function () {
            return e[t];
        };
    }
    function vt(e, t) {
        var r, i, a, s, c;
        if (Array.isArray(e) || 'string' == typeof e) for (r = new Array(e.length), i = 0, a = e.length; i < a; i++) r[i] = t(e[i], i);
        else if ('number' == typeof e) for (r = new Array(e), i = 0; i < e; i++) r[i] = t(i + 1, i);
        else if (o(e))
            if (oe && e[Symbol.iterator]) {
                r = [];
                for (var u = e[Symbol.iterator](), l = u.next(); !l.done; ) r.push(t(l.value, r.length)), (l = u.next());
            } else for (s = Object.keys(e), r = new Array(s.length), i = 0, a = s.length; i < a; i++) (c = s[i]), (r[i] = t(e[c], c, i));
        return n(r) || (r = []), (r._isVList = !0), r;
    }
    function ht(e, t, n, r) {
        var i,
            o = this.$scopedSlots[e];
        o ? ((n = n || {}), r && (n = A(A({}, r), n)), (i = o(n) || t)) : (i = this.$slots[e] || t);
        var a = n && n.slot;
        return a ? this.$createElement('template', { slot: a }, i) : i;
    }
    function mt(e) {
        return Le(this.$options, 'filters', e) || E;
    }
    function yt(e, t) {
        return Array.isArray(e) ? -1 === e.indexOf(t) : e !== t;
    }
    function gt(e, t, n, r, i) {
        var o = F.keyCodes[t] || n;
        return i && r && !F.keyCodes[t] ? yt(i, r) : o ? yt(o, e) : r ? C(r) !== t : void 0;
    }
    function _t(e, t, n, r, i) {
        if (n)
            if (o(n)) {
                var a;
                Array.isArray(n) && (n = O(n));
                var s = function (o) {
                    if ('class' === o || 'style' === o || v(o)) a = e;
                    else {
                        var s = e.attrs && e.attrs.type;
                        a = r || F.mustUseProp(t, s, o) ? e.domProps || (e.domProps = {}) : e.attrs || (e.attrs = {});
                    }
                    var c = b(o),
                        u = C(o);
                    c in a ||
                        u in a ||
                        ((a[o] = n[o]),
                        i &&
                            ((e.on || (e.on = {}))['update:' + o] = function (e) {
                                n[o] = e;
                            }));
                };
                for (var c in n) s(c);
            } else;
        return e;
    }
    function bt(e, t) {
        var n = this._staticTrees || (this._staticTrees = []),
            r = n[e];
        return r && !t ? r : (wt((r = n[e] = this.$options.staticRenderFns[e].call(this._renderProxy, null, this)), '__static__' + e, !1), r);
    }
    function $t(e, t, n) {
        return wt(e, '__once__' + t + (n ? '_' + n : ''), !0), e;
    }
    function wt(e, t, n) {
        if (Array.isArray(e)) for (var r = 0; r < e.length; r++) e[r] && 'string' != typeof e[r] && Ct(e[r], t + '_' + r, n);
        else Ct(e, t, n);
    }
    function Ct(e, t, n) {
        (e.isStatic = !0), (e.key = t), (e.isOnce = n);
    }
    function xt(e, t) {
        if (t)
            if (s(t)) {
                var n = (e.on = e.on ? A({}, e.on) : {});
                for (var r in t) {
                    var i = n[r],
                        o = t[r];
                    n[r] = i ? [].concat(i, o) : o;
                }
            } else;
        return e;
    }
    function kt(e, t, n, r) {
        t = t || { $stable: !n };
        for (var i = 0; i < e.length; i++) {
            var o = e[i];
            Array.isArray(o) ? kt(o, t, n) : o && (o.proxy && (o.fn.proxy = !0), (t[o.key] = o.fn));
        }
        return r && (t.$key = r), t;
    }
    function At(e, t) {
        for (var n = 0; n < t.length; n += 2) {
            var r = t[n];
            'string' == typeof r && r && (e[t[n]] = t[n + 1]);
        }
        return e;
    }
    function Ot(e, t) {
        return 'string' == typeof e ? t + e : e;
    }
    function St(e) {
        (e._o = $t),
            (e._n = f),
            (e._s = l),
            (e._l = vt),
            (e._t = ht),
            (e._q = N),
            (e._i = j),
            (e._m = bt),
            (e._f = mt),
            (e._k = gt),
            (e._b = _t),
            (e._v = he),
            (e._e = ve),
            (e._u = kt),
            (e._g = xt),
            (e._d = At),
            (e._p = Ot);
    }
    function Tt(t, n, i, o, a) {
        var s,
            c = this,
            u = a.options;
        y(o, '_uid') ? ((s = Object.create(o))._original = o) : ((s = o), (o = o._original));
        var l = r(u._compiled),
            f = !l;
        (this.data = t),
            (this.props = n),
            (this.children = i),
            (this.parent = o),
            (this.listeners = t.on || e),
            (this.injections = ct(u.inject, o)),
            (this.slots = function () {
                return c.$slots || ft(t.scopedSlots, (c.$slots = ut(i, o))), c.$slots;
            }),
            Object.defineProperty(this, 'scopedSlots', {
                enumerable: !0,
                get: function () {
                    return ft(t.scopedSlots, this.slots());
                },
            }),
            l && ((this.$options = u), (this.$slots = this.slots()), (this.$scopedSlots = ft(t.scopedSlots, this.$slots))),
            u._scopeId
                ? (this._c = function (e, t, n, r) {
                      var i = Pt(s, e, t, n, r, f);
                      return i && !Array.isArray(i) && ((i.fnScopeId = u._scopeId), (i.fnContext = o)), i;
                  })
                : (this._c = function (e, t, n, r) {
                      return Pt(s, e, t, n, r, f);
                  });
    }
    function Et(e, t, n, r, i) {
        var o = me(e);
        return (o.fnContext = n), (o.fnOptions = r), t.slot && ((o.data || (o.data = {})).slot = t.slot), o;
    }
    function Nt(e, t) {
        for (var n in t) e[b(n)] = t[n];
    }
    St(Tt.prototype);
    var jt = {
            init: function (e, t) {
                if (e.componentInstance && !e.componentInstance._isDestroyed && e.data.keepAlive) {
                    var r = e;
                    jt.prepatch(r, r);
                } else {
                    (e.componentInstance = (function (e, t) {
                        var r = { _isComponent: !0, _parentVnode: e, parent: t },
                            i = e.data.inlineTemplate;
                        n(i) && ((r.render = i.render), (r.staticRenderFns = i.staticRenderFns));
                        return new e.componentOptions.Ctor(r);
                    })(e, Wt)).$mount(t ? e.elm : void 0, t);
                }
            },
            prepatch: function (t, n) {
                var r = n.componentOptions;
                !(function (t, n, r, i, o) {
                    var a = i.data.scopedSlots,
                        s = t.$scopedSlots,
                        c = !!((a && !a.$stable) || (s !== e && !s.$stable) || (a && t.$scopedSlots.$key !== a.$key)),
                        u = !!(o || t.$options._renderChildren || c);
                    (t.$options._parentVnode = i), (t.$vnode = i), t._vnode && (t._vnode.parent = i);
                    if (((t.$options._renderChildren = o), (t.$attrs = i.data.attrs || e), (t.$listeners = r || e), n && t.$options.props)) {
                        $e(!1);
                        for (var l = t._props, f = t.$options._propKeys || [], p = 0; p < f.length; p++) {
                            var d = f[p],
                                v = t.$options.props;
                            l[d] = Me(d, v, n, t);
                        }
                        $e(!0), (t.$options.propsData = n);
                    }
                    r = r || e;
                    var h = t.$options._parentListeners;
                    (t.$options._parentListeners = r), qt(t, r, h), u && ((t.$slots = ut(o, i.context)), t.$forceUpdate());
                })((n.componentInstance = t.componentInstance), r.propsData, r.listeners, n, r.children);
            },
            insert: function (e) {
                var t,
                    n = e.context,
                    r = e.componentInstance;
                r._isMounted || ((r._isMounted = !0), Yt(r, 'mounted')),
                    e.data.keepAlive && (n._isMounted ? (((t = r)._inactive = !1), en.push(t)) : Xt(r, !0));
            },
            destroy: function (e) {
                var t = e.componentInstance;
                t._isDestroyed ||
                    (e.data.keepAlive
                        ? (function e(t, n) {
                              if (n && ((t._directInactive = !0), Gt(t))) return;
                              if (!t._inactive) {
                                  t._inactive = !0;
                                  for (var r = 0; r < t.$children.length; r++) e(t.$children[r]);
                                  Yt(t, 'deactivated');
                              }
                          })(t, !0)
                        : t.$destroy());
            },
        },
        Dt = Object.keys(jt);
    function Lt(i, a, s, c, l) {
        if (!t(i)) {
            var f = s.$options._base;
            if ((o(i) && (i = f.extend(i)), 'function' == typeof i)) {
                var p;
                if (
                    t(i.cid) &&
                    void 0 ===
                        (i = (function (e, i) {
                            if (r(e.error) && n(e.errorComp)) return e.errorComp;
                            if (n(e.resolved)) return e.resolved;
                            var a = Ht;
                            a && n(e.owners) && -1 === e.owners.indexOf(a) && e.owners.push(a);
                            if (r(e.loading) && n(e.loadingComp)) return e.loadingComp;
                            if (a && !n(e.owners)) {
                                var s = (e.owners = [a]),
                                    c = !0,
                                    l = null,
                                    f = null;
                                a.$on('hook:destroyed', function () {
                                    return h(s, a);
                                });
                                var p = function (e) {
                                        for (var t = 0, n = s.length; t < n; t++) s[t].$forceUpdate();
                                        e &&
                                            ((s.length = 0),
                                            null !== l && (clearTimeout(l), (l = null)),
                                            null !== f && (clearTimeout(f), (f = null)));
                                    },
                                    d = D(function (t) {
                                        (e.resolved = Bt(t, i)), c ? (s.length = 0) : p(!0);
                                    }),
                                    v = D(function (t) {
                                        n(e.errorComp) && ((e.error = !0), p(!0));
                                    }),
                                    m = e(d, v);
                                return (
                                    o(m) &&
                                        (u(m)
                                            ? t(e.resolved) && m.then(d, v)
                                            : u(m.component) &&
                                              (m.component.then(d, v),
                                              n(m.error) && (e.errorComp = Bt(m.error, i)),
                                              n(m.loading) &&
                                                  ((e.loadingComp = Bt(m.loading, i)),
                                                  0 === m.delay
                                                      ? (e.loading = !0)
                                                      : (l = setTimeout(function () {
                                                            (l = null), t(e.resolved) && t(e.error) && ((e.loading = !0), p(!1));
                                                        }, m.delay || 200))),
                                              n(m.timeout) &&
                                                  (f = setTimeout(function () {
                                                      (f = null), t(e.resolved) && v(null);
                                                  }, m.timeout)))),
                                    (c = !1),
                                    e.loading ? e.loadingComp : e.resolved
                                );
                            }
                        })((p = i), f))
                )
                    return (function (e, t, n, r, i) {
                        var o = ve();
                        return (o.asyncFactory = e), (o.asyncMeta = { data: t, context: n, children: r, tag: i }), o;
                    })(p, a, s, c, l);
                (a = a || {}),
                    $n(i),
                    n(a.model) &&
                        (function (e, t) {
                            var r = (e.model && e.model.prop) || 'value',
                                i = (e.model && e.model.event) || 'input';
                            (t.attrs || (t.attrs = {}))[r] = t.model.value;
                            var o = t.on || (t.on = {}),
                                a = o[i],
                                s = t.model.callback;
                            n(a) ? (Array.isArray(a) ? -1 === a.indexOf(s) : a !== s) && (o[i] = [s].concat(a)) : (o[i] = s);
                        })(i.options, a);
                var d = (function (e, r, i) {
                    var o = r.options.props;
                    if (!t(o)) {
                        var a = {},
                            s = e.attrs,
                            c = e.props;
                        if (n(s) || n(c))
                            for (var u in o) {
                                var l = C(u);
                                ot(a, c, u, l, !0) || ot(a, s, u, l, !1);
                            }
                        return a;
                    }
                })(a, i);
                if (r(i.options.functional))
                    return (function (t, r, i, o, a) {
                        var s = t.options,
                            c = {},
                            u = s.props;
                        if (n(u)) for (var l in u) c[l] = Me(l, u, r || e);
                        else n(i.attrs) && Nt(c, i.attrs), n(i.props) && Nt(c, i.props);
                        var f = new Tt(i, c, a, o, t),
                            p = s.render.call(null, f._c, f);
                        if (p instanceof pe) return Et(p, i, f.parent, s);
                        if (Array.isArray(p)) {
                            for (var d = at(p) || [], v = new Array(d.length), h = 0; h < d.length; h++) v[h] = Et(d[h], i, f.parent, s);
                            return v;
                        }
                    })(i, d, a, s, c);
                var v = a.on;
                if (((a.on = a.nativeOn), r(i.options.abstract))) {
                    var m = a.slot;
                    (a = {}), m && (a.slot = m);
                }
                !(function (e) {
                    for (var t = e.hook || (e.hook = {}), n = 0; n < Dt.length; n++) {
                        var r = Dt[n],
                            i = t[r],
                            o = jt[r];
                        i === o || (i && i._merged) || (t[r] = i ? Mt(o, i) : o);
                    }
                })(a);
                var y = i.options.name || l;
                return new pe(
                    'vue-component-' + i.cid + (y ? '-' + y : ''),
                    a,
                    void 0,
                    void 0,
                    void 0,
                    s,
                    { Ctor: i, propsData: d, listeners: v, tag: l, children: c },
                    p
                );
            }
        }
    }
    function Mt(e, t) {
        var n = function (n, r) {
            e(n, r), t(n, r);
        };
        return (n._merged = !0), n;
    }
    var It = 1,
        Ft = 2;
    function Pt(e, a, s, c, u, l) {
        return (
            (Array.isArray(s) || i(s)) && ((u = c), (c = s), (s = void 0)),
            r(l) && (u = Ft),
            (function (e, i, a, s, c) {
                if (n(a) && n(a.__ob__)) return ve();
                n(a) && n(a.is) && (i = a.is);
                if (!i) return ve();
                Array.isArray(s) && 'function' == typeof s[0] && (((a = a || {}).scopedSlots = { default: s[0] }), (s.length = 0));
                c === Ft
                    ? (s = at(s))
                    : c === It &&
                      (s = (function (e) {
                          for (var t = 0; t < e.length; t++) if (Array.isArray(e[t])) return Array.prototype.concat.apply([], e);
                          return e;
                      })(s));
                var u, l;
                if ('string' == typeof i) {
                    var f;
                    (l = (e.$vnode && e.$vnode.ns) || F.getTagNamespace(i)),
                        (u = F.isReservedTag(i)
                            ? new pe(F.parsePlatformTagName(i), a, s, void 0, void 0, e)
                            : (a && a.pre) || !n((f = Le(e.$options, 'components', i)))
                            ? new pe(i, a, s, void 0, void 0, e)
                            : Lt(f, a, e, s, i));
                } else u = Lt(i, a, e, s);
                return Array.isArray(u)
                    ? u
                    : n(u)
                    ? (n(l) &&
                          (function e(i, o, a) {
                              i.ns = o;
                              'foreignObject' === i.tag && ((o = void 0), (a = !0));
                              if (n(i.children))
                                  for (var s = 0, c = i.children.length; s < c; s++) {
                                      var u = i.children[s];
                                      n(u.tag) && (t(u.ns) || (r(a) && 'svg' !== u.tag)) && e(u, o, a);
                                  }
                          })(u, l),
                      n(a) &&
                          (function (e) {
                              o(e.style) && et(e.style);
                              o(e.class) && et(e.class);
                          })(a),
                      u)
                    : ve();
            })(e, a, s, c, u)
        );
    }
    var Rt,
        Ht = null;
    function Bt(e, t) {
        return (e.__esModule || (oe && 'Module' === e[Symbol.toStringTag])) && (e = e.default), o(e) ? t.extend(e) : e;
    }
    function Ut(e) {
        return e.isComment && e.asyncFactory;
    }
    function zt(e) {
        if (Array.isArray(e))
            for (var t = 0; t < e.length; t++) {
                var r = e[t];
                if (n(r) && (n(r.componentOptions) || Ut(r))) return r;
            }
    }
    function Vt(e, t) {
        Rt.$on(e, t);
    }
    function Kt(e, t) {
        Rt.$off(e, t);
    }
    function Jt(e, t) {
        var n = Rt;
        return function r() {
            null !== t.apply(null, arguments) && n.$off(e, r);
        };
    }
    function qt(e, t, n) {
        (Rt = e), rt(t, n || {}, Vt, Kt, Jt, e), (Rt = void 0);
    }
    var Wt = null;
    function Zt(e) {
        var t = Wt;
        return (
            (Wt = e),
            function () {
                Wt = t;
            }
        );
    }
    function Gt(e) {
        for (; e && (e = e.$parent); ) if (e._inactive) return !0;
        return !1;
    }
    function Xt(e, t) {
        if (t) {
            if (((e._directInactive = !1), Gt(e))) return;
        } else if (e._directInactive) return;
        if (e._inactive || null === e._inactive) {
            e._inactive = !1;
            for (var n = 0; n < e.$children.length; n++) Xt(e.$children[n]);
            Yt(e, 'activated');
        }
    }
    function Yt(e, t) {
        le();
        var n = e.$options[t],
            r = t + ' hook';
        if (n) for (var i = 0, o = n.length; i < o; i++) He(n[i], e, null, e, r);
        e._hasHookEvent && e.$emit('hook:' + t), fe();
    }
    var Qt = [],
        en = [],
        tn = {},
        nn = !1,
        rn = !1,
        on = 0;
    var an = 0,
        sn = Date.now;
    if (z && !q) {
        var cn = window.performance;
        cn &&
            'function' == typeof cn.now &&
            sn() > document.createEvent('Event').timeStamp &&
            (sn = function () {
                return cn.now();
            });
    }
    function un() {
        var e, t;
        for (
            an = sn(),
                rn = !0,
                Qt.sort(function (e, t) {
                    return e.id - t.id;
                }),
                on = 0;
            on < Qt.length;
            on++
        )
            (e = Qt[on]).before && e.before(), (t = e.id), (tn[t] = null), e.run();
        var n = en.slice(),
            r = Qt.slice();
        (on = Qt.length = en.length = 0),
            (tn = {}),
            (nn = rn = !1),
            (function (e) {
                for (var t = 0; t < e.length; t++) (e[t]._inactive = !0), Xt(e[t], !0);
            })(n),
            (function (e) {
                var t = e.length;
                for (; t--; ) {
                    var n = e[t],
                        r = n.vm;
                    r._watcher === n && r._isMounted && !r._isDestroyed && Yt(r, 'updated');
                }
            })(r),
            ne && F.devtools && ne.emit('flush');
    }
    var ln = 0,
        fn = function (e, t, n, r, i) {
            (this.vm = e),
                i && (e._watcher = this),
                e._watchers.push(this),
                r
                    ? ((this.deep = !!r.deep), (this.user = !!r.user), (this.lazy = !!r.lazy), (this.sync = !!r.sync), (this.before = r.before))
                    : (this.deep = this.user = this.lazy = this.sync = !1),
                (this.cb = n),
                (this.id = ++ln),
                (this.active = !0),
                (this.dirty = this.lazy),
                (this.deps = []),
                (this.newDeps = []),
                (this.depIds = new ie()),
                (this.newDepIds = new ie()),
                (this.expression = ''),
                'function' == typeof t
                    ? (this.getter = t)
                    : ((this.getter = (function (e) {
                          if (!H.test(e)) {
                              var t = e.split('.');
                              return function (e) {
                                  for (var n = 0; n < t.length; n++) {
                                      if (!e) return;
                                      e = e[t[n]];
                                  }
                                  return e;
                              };
                          }
                      })(t)),
                      this.getter || (this.getter = S)),
                (this.value = this.lazy ? void 0 : this.get());
        };
    (fn.prototype.get = function () {
        var e;
        le(this);
        var t = this.vm;
        try {
            e = this.getter.call(t, t);
        } catch (e) {
            if (!this.user) throw e;
            Re(e, t, 'getter for watcher "' + this.expression + '"');
        } finally {
            this.deep && et(e), fe(), this.cleanupDeps();
        }
        return e;
    }),
        (fn.prototype.addDep = function (e) {
            var t = e.id;
            this.newDepIds.has(t) || (this.newDepIds.add(t), this.newDeps.push(e), this.depIds.has(t) || e.addSub(this));
        }),
        (fn.prototype.cleanupDeps = function () {
            for (var e = this.deps.length; e--; ) {
                var t = this.deps[e];
                this.newDepIds.has(t.id) || t.removeSub(this);
            }
            var n = this.depIds;
            (this.depIds = this.newDepIds),
                (this.newDepIds = n),
                this.newDepIds.clear(),
                (n = this.deps),
                (this.deps = this.newDeps),
                (this.newDeps = n),
                (this.newDeps.length = 0);
        }),
        (fn.prototype.update = function () {
            this.lazy
                ? (this.dirty = !0)
                : this.sync
                ? this.run()
                : (function (e) {
                      var t = e.id;
                      if (null == tn[t]) {
                          if (((tn[t] = !0), rn)) {
                              for (var n = Qt.length - 1; n > on && Qt[n].id > e.id; ) n--;
                              Qt.splice(n + 1, 0, e);
                          } else Qt.push(e);
                          nn || ((nn = !0), Ye(un));
                      }
                  })(this);
        }),
        (fn.prototype.run = function () {
            if (this.active) {
                var e = this.get();
                if (e !== this.value || o(e) || this.deep) {
                    var t = this.value;
                    if (((this.value = e), this.user))
                        try {
                            this.cb.call(this.vm, e, t);
                        } catch (e) {
                            Re(e, this.vm, 'callback for watcher "' + this.expression + '"');
                        }
                    else this.cb.call(this.vm, e, t);
                }
            }
        }),
        (fn.prototype.evaluate = function () {
            (this.value = this.get()), (this.dirty = !1);
        }),
        (fn.prototype.depend = function () {
            for (var e = this.deps.length; e--; ) this.deps[e].depend();
        }),
        (fn.prototype.teardown = function () {
            if (this.active) {
                this.vm._isBeingDestroyed || h(this.vm._watchers, this);
                for (var e = this.deps.length; e--; ) this.deps[e].removeSub(this);
                this.active = !1;
            }
        });
    var pn = { enumerable: !0, configurable: !0, get: S, set: S };
    function dn(e, t, n) {
        (pn.get = function () {
            return this[t][n];
        }),
            (pn.set = function (e) {
                this[t][n] = e;
            }),
            Object.defineProperty(e, n, pn);
    }
    function vn(e) {
        e._watchers = [];
        var t = e.$options;
        t.props &&
            (function (e, t) {
                var n = e.$options.propsData || {},
                    r = (e._props = {}),
                    i = (e.$options._propKeys = []);
                e.$parent && $e(!1);
                var o = function (o) {
                    i.push(o);
                    var a = Me(o, t, n, e);
                    xe(r, o, a), o in e || dn(e, '_props', o);
                };
                for (var a in t) o(a);
                $e(!0);
            })(e, t.props),
            t.methods &&
                (function (e, t) {
                    e.$options.props;
                    for (var n in t) e[n] = 'function' != typeof t[n] ? S : x(t[n], e);
                })(e, t.methods),
            t.data
                ? (function (e) {
                      var t = e.$options.data;
                      s(
                          (t = e._data =
                              'function' == typeof t
                                  ? (function (e, t) {
                                        le();
                                        try {
                                            return e.call(t, t);
                                        } catch (e) {
                                            return Re(e, t, 'data()'), {};
                                        } finally {
                                            fe();
                                        }
                                    })(t, e)
                                  : t || {})
                      ) || (t = {});
                      var n = Object.keys(t),
                          r = e.$options.props,
                          i = (e.$options.methods, n.length);
                      for (; i--; ) {
                          var o = n[i];
                          (r && y(r, o)) || ((a = void 0), 36 !== (a = (o + '').charCodeAt(0)) && 95 !== a && dn(e, '_data', o));
                      }
                      var a;
                      Ce(t, !0);
                  })(e)
                : Ce((e._data = {}), !0),
            t.computed &&
                (function (e, t) {
                    var n = (e._computedWatchers = Object.create(null)),
                        r = te();
                    for (var i in t) {
                        var o = t[i],
                            a = 'function' == typeof o ? o : o.get;
                        r || (n[i] = new fn(e, a || S, S, hn)), i in e || mn(e, i, o);
                    }
                })(e, t.computed),
            t.watch &&
                t.watch !== Y &&
                (function (e, t) {
                    for (var n in t) {
                        var r = t[n];
                        if (Array.isArray(r)) for (var i = 0; i < r.length; i++) _n(e, n, r[i]);
                        else _n(e, n, r);
                    }
                })(e, t.watch);
    }
    var hn = { lazy: !0 };
    function mn(e, t, n) {
        var r = !te();
        'function' == typeof n
            ? ((pn.get = r ? yn(t) : gn(n)), (pn.set = S))
            : ((pn.get = n.get ? (r && !1 !== n.cache ? yn(t) : gn(n.get)) : S), (pn.set = n.set || S)),
            Object.defineProperty(e, t, pn);
    }
    function yn(e) {
        return function () {
            var t = this._computedWatchers && this._computedWatchers[e];
            if (t) return t.dirty && t.evaluate(), ce.target && t.depend(), t.value;
        };
    }
    function gn(e) {
        return function () {
            return e.call(this, this);
        };
    }
    function _n(e, t, n, r) {
        return s(n) && ((r = n), (n = n.handler)), 'string' == typeof n && (n = e[n]), e.$watch(t, n, r);
    }
    var bn = 0;
    function $n(e) {
        var t = e.options;
        if (e.super) {
            var n = $n(e.super);
            if (n !== e.superOptions) {
                e.superOptions = n;
                var r = (function (e) {
                    var t,
                        n = e.options,
                        r = e.sealedOptions;
                    for (var i in n) n[i] !== r[i] && (t || (t = {}), (t[i] = n[i]));
                    return t;
                })(e);
                r && A(e.extendOptions, r), (t = e.options = De(n, e.extendOptions)).name && (t.components[t.name] = e);
            }
        }
        return t;
    }
    function wn(e) {
        this._init(e);
    }
    function Cn(e) {
        e.cid = 0;
        var t = 1;
        e.extend = function (e) {
            e = e || {};
            var n = this,
                r = n.cid,
                i = e._Ctor || (e._Ctor = {});
            if (i[r]) return i[r];
            var o = e.name || n.options.name,
                a = function (e) {
                    this._init(e);
                };
            return (
                ((a.prototype = Object.create(n.prototype)).constructor = a),
                (a.cid = t++),
                (a.options = De(n.options, e)),
                (a.super = n),
                a.options.props &&
                    (function (e) {
                        var t = e.options.props;
                        for (var n in t) dn(e.prototype, '_props', n);
                    })(a),
                a.options.computed &&
                    (function (e) {
                        var t = e.options.computed;
                        for (var n in t) mn(e.prototype, n, t[n]);
                    })(a),
                (a.extend = n.extend),
                (a.mixin = n.mixin),
                (a.use = n.use),
                M.forEach(function (e) {
                    a[e] = n[e];
                }),
                o && (a.options.components[o] = a),
                (a.superOptions = n.options),
                (a.extendOptions = e),
                (a.sealedOptions = A({}, a.options)),
                (i[r] = a),
                a
            );
        };
    }
    function xn(e) {
        return e && (e.Ctor.options.name || e.tag);
    }
    function kn(e, t) {
        return Array.isArray(e)
            ? e.indexOf(t) > -1
            : 'string' == typeof e
            ? e.split(',').indexOf(t) > -1
            : ((n = e), '[object RegExp]' === a.call(n) && e.test(t));
        var n;
    }
    function An(e, t) {
        var n = e.cache,
            r = e.keys,
            i = e._vnode;
        for (var o in n) {
            var a = n[o];
            if (a) {
                var s = xn(a.componentOptions);
                s && !t(s) && On(n, o, r, i);
            }
        }
    }
    function On(e, t, n, r) {
        var i = e[t];
        !i || (r && i.tag === r.tag) || i.componentInstance.$destroy(), (e[t] = null), h(n, t);
    }
    !(function (t) {
        t.prototype._init = function (t) {
            var n = this;
            (n._uid = bn++),
                (n._isVue = !0),
                t && t._isComponent
                    ? (function (e, t) {
                          var n = (e.$options = Object.create(e.constructor.options)),
                              r = t._parentVnode;
                          (n.parent = t.parent), (n._parentVnode = r);
                          var i = r.componentOptions;
                          (n.propsData = i.propsData),
                              (n._parentListeners = i.listeners),
                              (n._renderChildren = i.children),
                              (n._componentTag = i.tag),
                              t.render && ((n.render = t.render), (n.staticRenderFns = t.staticRenderFns));
                      })(n, t)
                    : (n.$options = De($n(n.constructor), t || {}, n)),
                (n._renderProxy = n),
                (n._self = n),
                (function (e) {
                    var t = e.$options,
                        n = t.parent;
                    if (n && !t.abstract) {
                        for (; n.$options.abstract && n.$parent; ) n = n.$parent;
                        n.$children.push(e);
                    }
                    (e.$parent = n),
                        (e.$root = n ? n.$root : e),
                        (e.$children = []),
                        (e.$refs = {}),
                        (e._watcher = null),
                        (e._inactive = null),
                        (e._directInactive = !1),
                        (e._isMounted = !1),
                        (e._isDestroyed = !1),
                        (e._isBeingDestroyed = !1);
                })(n),
                (function (e) {
                    (e._events = Object.create(null)), (e._hasHookEvent = !1);
                    var t = e.$options._parentListeners;
                    t && qt(e, t);
                })(n),
                (function (t) {
                    (t._vnode = null), (t._staticTrees = null);
                    var n = t.$options,
                        r = (t.$vnode = n._parentVnode),
                        i = r && r.context;
                    (t.$slots = ut(n._renderChildren, i)),
                        (t.$scopedSlots = e),
                        (t._c = function (e, n, r, i) {
                            return Pt(t, e, n, r, i, !1);
                        }),
                        (t.$createElement = function (e, n, r, i) {
                            return Pt(t, e, n, r, i, !0);
                        });
                    var o = r && r.data;
                    xe(t, '$attrs', (o && o.attrs) || e, null, !0), xe(t, '$listeners', n._parentListeners || e, null, !0);
                })(n),
                Yt(n, 'beforeCreate'),
                (function (e) {
                    var t = ct(e.$options.inject, e);
                    t &&
                        ($e(!1),
                        Object.keys(t).forEach(function (n) {
                            xe(e, n, t[n]);
                        }),
                        $e(!0));
                })(n),
                vn(n),
                (function (e) {
                    var t = e.$options.provide;
                    t && (e._provided = 'function' == typeof t ? t.call(e) : t);
                })(n),
                Yt(n, 'created'),
                n.$options.el && n.$mount(n.$options.el);
        };
    })(wn),
        (function (e) {
            var t = {
                    get: function () {
                        return this._data;
                    },
                },
                n = {
                    get: function () {
                        return this._props;
                    },
                };
            Object.defineProperty(e.prototype, '$data', t),
                Object.defineProperty(e.prototype, '$props', n),
                (e.prototype.$set = ke),
                (e.prototype.$delete = Ae),
                (e.prototype.$watch = function (e, t, n) {
                    if (s(t)) return _n(this, e, t, n);
                    (n = n || {}).user = !0;
                    var r = new fn(this, e, t, n);
                    if (n.immediate)
                        try {
                            t.call(this, r.value);
                        } catch (e) {
                            Re(e, this, 'callback for immediate watcher "' + r.expression + '"');
                        }
                    return function () {
                        r.teardown();
                    };
                });
        })(wn),
        (function (e) {
            var t = /^hook:/;
            (e.prototype.$on = function (e, n) {
                var r = this;
                if (Array.isArray(e)) for (var i = 0, o = e.length; i < o; i++) r.$on(e[i], n);
                else (r._events[e] || (r._events[e] = [])).push(n), t.test(e) && (r._hasHookEvent = !0);
                return r;
            }),
                (e.prototype.$once = function (e, t) {
                    var n = this;
                    function r() {
                        n.$off(e, r), t.apply(n, arguments);
                    }
                    return (r.fn = t), n.$on(e, r), n;
                }),
                (e.prototype.$off = function (e, t) {
                    var n = this;
                    if (!arguments.length) return (n._events = Object.create(null)), n;
                    if (Array.isArray(e)) {
                        for (var r = 0, i = e.length; r < i; r++) n.$off(e[r], t);
                        return n;
                    }
                    var o,
                        a = n._events[e];
                    if (!a) return n;
                    if (!t) return (n._events[e] = null), n;
                    for (var s = a.length; s--; )
                        if ((o = a[s]) === t || o.fn === t) {
                            a.splice(s, 1);
                            break;
                        }
                    return n;
                }),
                (e.prototype.$emit = function (e) {
                    var t = this._events[e];
                    if (t) {
                        t = t.length > 1 ? k(t) : t;
                        for (var n = k(arguments, 1), r = 'event handler for "' + e + '"', i = 0, o = t.length; i < o; i++)
                            He(t[i], this, n, this, r);
                    }
                    return this;
                });
        })(wn),
        (function (e) {
            (e.prototype._update = function (e, t) {
                var n = this,
                    r = n.$el,
                    i = n._vnode,
                    o = Zt(n);
                (n._vnode = e),
                    (n.$el = i ? n.__patch__(i, e) : n.__patch__(n.$el, e, t, !1)),
                    o(),
                    r && (r.__vue__ = null),
                    n.$el && (n.$el.__vue__ = n),
                    n.$vnode && n.$parent && n.$vnode === n.$parent._vnode && (n.$parent.$el = n.$el);
            }),
                (e.prototype.$forceUpdate = function () {
                    this._watcher && this._watcher.update();
                }),
                (e.prototype.$destroy = function () {
                    var e = this;
                    if (!e._isBeingDestroyed) {
                        Yt(e, 'beforeDestroy'), (e._isBeingDestroyed = !0);
                        var t = e.$parent;
                        !t || t._isBeingDestroyed || e.$options.abstract || h(t.$children, e), e._watcher && e._watcher.teardown();
                        for (var n = e._watchers.length; n--; ) e._watchers[n].teardown();
                        e._data.__ob__ && e._data.__ob__.vmCount--,
                            (e._isDestroyed = !0),
                            e.__patch__(e._vnode, null),
                            Yt(e, 'destroyed'),
                            e.$off(),
                            e.$el && (e.$el.__vue__ = null),
                            e.$vnode && (e.$vnode.parent = null);
                    }
                });
        })(wn),
        (function (e) {
            St(e.prototype),
                (e.prototype.$nextTick = function (e) {
                    return Ye(e, this);
                }),
                (e.prototype._render = function () {
                    var e,
                        t = this,
                        n = t.$options,
                        r = n.render,
                        i = n._parentVnode;
                    i && (t.$scopedSlots = ft(i.data.scopedSlots, t.$slots, t.$scopedSlots)), (t.$vnode = i);
                    try {
                        (Ht = t), (e = r.call(t._renderProxy, t.$createElement));
                    } catch (n) {
                        Re(n, t, 'render'), (e = t._vnode);
                    } finally {
                        Ht = null;
                    }
                    return Array.isArray(e) && 1 === e.length && (e = e[0]), e instanceof pe || (e = ve()), (e.parent = i), e;
                });
        })(wn);
    var Sn = [String, RegExp, Array],
        Tn = {
            KeepAlive: {
                name: 'keep-alive',
                abstract: !0,
                props: { include: Sn, exclude: Sn, max: [String, Number] },
                created: function () {
                    (this.cache = Object.create(null)), (this.keys = []);
                },
                destroyed: function () {
                    for (var e in this.cache) On(this.cache, e, this.keys);
                },
                mounted: function () {
                    var e = this;
                    this.$watch('include', function (t) {
                        An(e, function (e) {
                            return kn(t, e);
                        });
                    }),
                        this.$watch('exclude', function (t) {
                            An(e, function (e) {
                                return !kn(t, e);
                            });
                        });
                },
                render: function () {
                    var e = this.$slots.default,
                        t = zt(e),
                        n = t && t.componentOptions;
                    if (n) {
                        var r = xn(n),
                            i = this.include,
                            o = this.exclude;
                        if ((i && (!r || !kn(i, r))) || (o && r && kn(o, r))) return t;
                        var a = this.cache,
                            s = this.keys,
                            c = null == t.key ? n.Ctor.cid + (n.tag ? '::' + n.tag : '') : t.key;
                        a[c]
                            ? ((t.componentInstance = a[c].componentInstance), h(s, c), s.push(c))
                            : ((a[c] = t), s.push(c), this.max && s.length > parseInt(this.max) && On(a, s[0], s, this._vnode)),
                            (t.data.keepAlive = !0);
                    }
                    return t || (e && e[0]);
                },
            },
        };
    !(function (e) {
        var t = {
            get: function () {
                return F;
            },
        };
        Object.defineProperty(e, 'config', t),
            (e.util = { warn: ae, extend: A, mergeOptions: De, defineReactive: xe }),
            (e.set = ke),
            (e.delete = Ae),
            (e.nextTick = Ye),
            (e.observable = function (e) {
                return Ce(e), e;
            }),
            (e.options = Object.create(null)),
            M.forEach(function (t) {
                e.options[t + 's'] = Object.create(null);
            }),
            (e.options._base = e),
            A(e.options.components, Tn),
            (function (e) {
                e.use = function (e) {
                    var t = this._installedPlugins || (this._installedPlugins = []);
                    if (t.indexOf(e) > -1) return this;
                    var n = k(arguments, 1);
                    return (
                        n.unshift(this),
                        'function' == typeof e.install ? e.install.apply(e, n) : 'function' == typeof e && e.apply(null, n),
                        t.push(e),
                        this
                    );
                };
            })(e),
            (function (e) {
                e.mixin = function (e) {
                    return (this.options = De(this.options, e)), this;
                };
            })(e),
            Cn(e),
            (function (e) {
                M.forEach(function (t) {
                    e[t] = function (e, n) {
                        return n
                            ? ('component' === t && s(n) && ((n.name = n.name || e), (n = this.options._base.extend(n))),
                              'directive' === t && 'function' == typeof n && (n = { bind: n, update: n }),
                              (this.options[t + 's'][e] = n),
                              n)
                            : this.options[t + 's'][e];
                    };
                });
            })(e);
    })(wn),
        Object.defineProperty(wn.prototype, '$isServer', { get: te }),
        Object.defineProperty(wn.prototype, '$ssrContext', {
            get: function () {
                return this.$vnode && this.$vnode.ssrContext;
            },
        }),
        Object.defineProperty(wn, 'FunctionalRenderContext', { value: Tt }),
        (wn.version = '2.6.12');
    var En = p('style,class'),
        Nn = p('input,textarea,option,select,progress'),
        jn = function (e, t, n) {
            return (
                ('value' === n && Nn(e) && 'button' !== t) ||
                ('selected' === n && 'option' === e) ||
                ('checked' === n && 'input' === e) ||
                ('muted' === n && 'video' === e)
            );
        },
        Dn = p('contenteditable,draggable,spellcheck'),
        Ln = p('events,caret,typing,plaintext-only'),
        Mn = function (e, t) {
            return Hn(t) || 'false' === t ? 'false' : 'contenteditable' === e && Ln(t) ? t : 'true';
        },
        In = p(
            'allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible'
        ),
        Fn = 'http://www.w3.org/1999/xlink',
        Pn = function (e) {
            return ':' === e.charAt(5) && 'xlink' === e.slice(0, 5);
        },
        Rn = function (e) {
            return Pn(e) ? e.slice(6, e.length) : '';
        },
        Hn = function (e) {
            return null == e || !1 === e;
        };
    function Bn(e) {
        for (var t = e.data, r = e, i = e; n(i.componentInstance); ) (i = i.componentInstance._vnode) && i.data && (t = Un(i.data, t));
        for (; n((r = r.parent)); ) r && r.data && (t = Un(t, r.data));
        return (function (e, t) {
            if (n(e) || n(t)) return zn(e, Vn(t));
            return '';
        })(t.staticClass, t.class);
    }
    function Un(e, t) {
        return { staticClass: zn(e.staticClass, t.staticClass), class: n(e.class) ? [e.class, t.class] : t.class };
    }
    function zn(e, t) {
        return e ? (t ? e + ' ' + t : e) : t || '';
    }
    function Vn(e) {
        return Array.isArray(e)
            ? (function (e) {
                  for (var t, r = '', i = 0, o = e.length; i < o; i++) n((t = Vn(e[i]))) && '' !== t && (r && (r += ' '), (r += t));
                  return r;
              })(e)
            : o(e)
            ? (function (e) {
                  var t = '';
                  for (var n in e) e[n] && (t && (t += ' '), (t += n));
                  return t;
              })(e)
            : 'string' == typeof e
            ? e
            : '';
    }
    var Kn = { svg: 'http://www.w3.org/2000/svg', math: 'http://www.w3.org/1998/Math/MathML' },
        Jn = p(
            'html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot'
        ),
        qn = p(
            'svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view',
            !0
        ),
        Wn = function (e) {
            return Jn(e) || qn(e);
        };
    function Zn(e) {
        return qn(e) ? 'svg' : 'math' === e ? 'math' : void 0;
    }
    var Gn = Object.create(null);
    var Xn = p('text,number,password,search,email,tel,url');
    function Yn(e) {
        if ('string' == typeof e) {
            var t = document.querySelector(e);
            return t || document.createElement('div');
        }
        return e;
    }
    var Qn = Object.freeze({
            createElement: function (e, t) {
                var n = document.createElement(e);
                return 'select' !== e ? n : (t.data && t.data.attrs && void 0 !== t.data.attrs.multiple && n.setAttribute('multiple', 'multiple'), n);
            },
            createElementNS: function (e, t) {
                return document.createElementNS(Kn[e], t);
            },
            createTextNode: function (e) {
                return document.createTextNode(e);
            },
            createComment: function (e) {
                return document.createComment(e);
            },
            insertBefore: function (e, t, n) {
                e.insertBefore(t, n);
            },
            removeChild: function (e, t) {
                e.removeChild(t);
            },
            appendChild: function (e, t) {
                e.appendChild(t);
            },
            parentNode: function (e) {
                return e.parentNode;
            },
            nextSibling: function (e) {
                return e.nextSibling;
            },
            tagName: function (e) {
                return e.tagName;
            },
            setTextContent: function (e, t) {
                e.textContent = t;
            },
            setStyleScope: function (e, t) {
                e.setAttribute(t, '');
            },
        }),
        er = {
            create: function (e, t) {
                tr(t);
            },
            update: function (e, t) {
                e.data.ref !== t.data.ref && (tr(e, !0), tr(t));
            },
            destroy: function (e) {
                tr(e, !0);
            },
        };
    function tr(e, t) {
        var r = e.data.ref;
        if (n(r)) {
            var i = e.context,
                o = e.componentInstance || e.elm,
                a = i.$refs;
            t
                ? Array.isArray(a[r])
                    ? h(a[r], o)
                    : a[r] === o && (a[r] = void 0)
                : e.data.refInFor
                ? Array.isArray(a[r])
                    ? a[r].indexOf(o) < 0 && a[r].push(o)
                    : (a[r] = [o])
                : (a[r] = o);
        }
    }
    var nr = new pe('', {}, []),
        rr = ['create', 'activate', 'update', 'remove', 'destroy'];
    function ir(e, i) {
        return (
            e.key === i.key &&
            ((e.tag === i.tag &&
                e.isComment === i.isComment &&
                n(e.data) === n(i.data) &&
                (function (e, t) {
                    if ('input' !== e.tag) return !0;
                    var r,
                        i = n((r = e.data)) && n((r = r.attrs)) && r.type,
                        o = n((r = t.data)) && n((r = r.attrs)) && r.type;
                    return i === o || (Xn(i) && Xn(o));
                })(e, i)) ||
                (r(e.isAsyncPlaceholder) && e.asyncFactory === i.asyncFactory && t(i.asyncFactory.error)))
        );
    }
    function or(e, t, r) {
        var i,
            o,
            a = {};
        for (i = t; i <= r; ++i) n((o = e[i].key)) && (a[o] = i);
        return a;
    }
    var ar = {
        create: sr,
        update: sr,
        destroy: function (e) {
            sr(e, nr);
        },
    };
    function sr(e, t) {
        (e.data.directives || t.data.directives) &&
            (function (e, t) {
                var n,
                    r,
                    i,
                    o = e === nr,
                    a = t === nr,
                    s = ur(e.data.directives, e.context),
                    c = ur(t.data.directives, t.context),
                    u = [],
                    l = [];
                for (n in c)
                    (r = s[n]),
                        (i = c[n]),
                        r
                            ? ((i.oldValue = r.value), (i.oldArg = r.arg), fr(i, 'update', t, e), i.def && i.def.componentUpdated && l.push(i))
                            : (fr(i, 'bind', t, e), i.def && i.def.inserted && u.push(i));
                if (u.length) {
                    var f = function () {
                        for (var n = 0; n < u.length; n++) fr(u[n], 'inserted', t, e);
                    };
                    o ? it(t, 'insert', f) : f();
                }
                l.length &&
                    it(t, 'postpatch', function () {
                        for (var n = 0; n < l.length; n++) fr(l[n], 'componentUpdated', t, e);
                    });
                if (!o) for (n in s) c[n] || fr(s[n], 'unbind', e, e, a);
            })(e, t);
    }
    var cr = Object.create(null);
    function ur(e, t) {
        var n,
            r,
            i = Object.create(null);
        if (!e) return i;
        for (n = 0; n < e.length; n++) (r = e[n]).modifiers || (r.modifiers = cr), (i[lr(r)] = r), (r.def = Le(t.$options, 'directives', r.name));
        return i;
    }
    function lr(e) {
        return e.rawName || e.name + '.' + Object.keys(e.modifiers || {}).join('.');
    }
    function fr(e, t, n, r, i) {
        var o = e.def && e.def[t];
        if (o)
            try {
                o(n.elm, e, n, r, i);
            } catch (r) {
                Re(r, n.context, 'directive ' + e.name + ' ' + t + ' hook');
            }
    }
    var pr = [er, ar];
    function dr(e, r) {
        var i = r.componentOptions;
        if (!((n(i) && !1 === i.Ctor.options.inheritAttrs) || (t(e.data.attrs) && t(r.data.attrs)))) {
            var o,
                a,
                s = r.elm,
                c = e.data.attrs || {},
                u = r.data.attrs || {};
            for (o in (n(u.__ob__) && (u = r.data.attrs = A({}, u)), u)) (a = u[o]), c[o] !== a && vr(s, o, a);
            for (o in ((q || Z) && u.value !== c.value && vr(s, 'value', u.value), c))
                t(u[o]) && (Pn(o) ? s.removeAttributeNS(Fn, Rn(o)) : Dn(o) || s.removeAttribute(o));
        }
    }
    function vr(e, t, n) {
        e.tagName.indexOf('-') > -1
            ? hr(e, t, n)
            : In(t)
            ? Hn(n)
                ? e.removeAttribute(t)
                : ((n = 'allowfullscreen' === t && 'EMBED' === e.tagName ? 'true' : t), e.setAttribute(t, n))
            : Dn(t)
            ? e.setAttribute(t, Mn(t, n))
            : Pn(t)
            ? Hn(n)
                ? e.removeAttributeNS(Fn, Rn(t))
                : e.setAttributeNS(Fn, t, n)
            : hr(e, t, n);
    }
    function hr(e, t, n) {
        if (Hn(n)) e.removeAttribute(t);
        else {
            if (q && !W && 'TEXTAREA' === e.tagName && 'placeholder' === t && '' !== n && !e.__ieph) {
                var r = function (t) {
                    t.stopImmediatePropagation(), e.removeEventListener('input', r);
                };
                e.addEventListener('input', r), (e.__ieph = !0);
            }
            e.setAttribute(t, n);
        }
    }
    var mr = { create: dr, update: dr };
    function yr(e, r) {
        var i = r.elm,
            o = r.data,
            a = e.data;
        if (!(t(o.staticClass) && t(o.class) && (t(a) || (t(a.staticClass) && t(a.class))))) {
            var s = Bn(r),
                c = i._transitionClasses;
            n(c) && (s = zn(s, Vn(c))), s !== i._prevClass && (i.setAttribute('class', s), (i._prevClass = s));
        }
    }
    var gr,
        _r,
        br,
        $r,
        wr,
        Cr,
        xr = { create: yr, update: yr },
        kr = /[\w).+\-_$\]]/;
    function Ar(e) {
        var t,
            n,
            r,
            i,
            o,
            a = !1,
            s = !1,
            c = !1,
            u = !1,
            l = 0,
            f = 0,
            p = 0,
            d = 0;
        for (r = 0; r < e.length; r++)
            if (((n = t), (t = e.charCodeAt(r)), a)) 39 === t && 92 !== n && (a = !1);
            else if (s) 34 === t && 92 !== n && (s = !1);
            else if (c) 96 === t && 92 !== n && (c = !1);
            else if (u) 47 === t && 92 !== n && (u = !1);
            else if (124 !== t || 124 === e.charCodeAt(r + 1) || 124 === e.charCodeAt(r - 1) || l || f || p) {
                switch (t) {
                    case 34:
                        s = !0;
                        break;
                    case 39:
                        a = !0;
                        break;
                    case 96:
                        c = !0;
                        break;
                    case 40:
                        p++;
                        break;
                    case 41:
                        p--;
                        break;
                    case 91:
                        f++;
                        break;
                    case 93:
                        f--;
                        break;
                    case 123:
                        l++;
                        break;
                    case 125:
                        l--;
                }
                if (47 === t) {
                    for (var v = r - 1, h = void 0; v >= 0 && ' ' === (h = e.charAt(v)); v--);
                    (h && kr.test(h)) || (u = !0);
                }
            } else void 0 === i ? ((d = r + 1), (i = e.slice(0, r).trim())) : m();
        function m() {
            (o || (o = [])).push(e.slice(d, r).trim()), (d = r + 1);
        }
        if ((void 0 === i ? (i = e.slice(0, r).trim()) : 0 !== d && m(), o)) for (r = 0; r < o.length; r++) i = Or(i, o[r]);
        return i;
    }
    function Or(e, t) {
        var n = t.indexOf('(');
        if (n < 0) return '_f("' + t + '")(' + e + ')';
        var r = t.slice(0, n),
            i = t.slice(n + 1);
        return '_f("' + r + '")(' + e + (')' !== i ? ',' + i : i);
    }
    function Sr(e, t) {
        console.error('[Vue compiler]: ' + e);
    }
    function Tr(e, t) {
        return e
            ? e
                  .map(function (e) {
                      return e[t];
                  })
                  .filter(function (e) {
                      return e;
                  })
            : [];
    }
    function Er(e, t, n, r, i) {
        (e.props || (e.props = [])).push(Rr({ name: t, value: n, dynamic: i }, r)), (e.plain = !1);
    }
    function Nr(e, t, n, r, i) {
        (i ? e.dynamicAttrs || (e.dynamicAttrs = []) : e.attrs || (e.attrs = [])).push(Rr({ name: t, value: n, dynamic: i }, r)), (e.plain = !1);
    }
    function jr(e, t, n, r) {
        (e.attrsMap[t] = n), e.attrsList.push(Rr({ name: t, value: n }, r));
    }
    function Dr(e, t, n, r, i, o, a, s) {
        (e.directives || (e.directives = [])).push(Rr({ name: t, rawName: n, value: r, arg: i, isDynamicArg: o, modifiers: a }, s)), (e.plain = !1);
    }
    function Lr(e, t, n) {
        return n ? '_p(' + t + ',"' + e + '")' : e + t;
    }
    function Mr(t, n, r, i, o, a, s, c) {
        var u;
        (i = i || e).right
            ? c
                ? (n = '(' + n + ")==='click'?'contextmenu':(" + n + ')')
                : 'click' === n && ((n = 'contextmenu'), delete i.right)
            : i.middle && (c ? (n = '(' + n + ")==='click'?'mouseup':(" + n + ')') : 'click' === n && (n = 'mouseup')),
            i.capture && (delete i.capture, (n = Lr('!', n, c))),
            i.once && (delete i.once, (n = Lr('~', n, c))),
            i.passive && (delete i.passive, (n = Lr('&', n, c))),
            i.native ? (delete i.native, (u = t.nativeEvents || (t.nativeEvents = {}))) : (u = t.events || (t.events = {}));
        var l = Rr({ value: r.trim(), dynamic: c }, s);
        i !== e && (l.modifiers = i);
        var f = u[n];
        Array.isArray(f) ? (o ? f.unshift(l) : f.push(l)) : (u[n] = f ? (o ? [l, f] : [f, l]) : l), (t.plain = !1);
    }
    function Ir(e, t, n) {
        var r = Fr(e, ':' + t) || Fr(e, 'v-bind:' + t);
        if (null != r) return Ar(r);
        if (!1 !== n) {
            var i = Fr(e, t);
            if (null != i) return JSON.stringify(i);
        }
    }
    function Fr(e, t, n) {
        var r;
        if (null != (r = e.attrsMap[t]))
            for (var i = e.attrsList, o = 0, a = i.length; o < a; o++)
                if (i[o].name === t) {
                    i.splice(o, 1);
                    break;
                }
        return n && delete e.attrsMap[t], r;
    }
    function Pr(e, t) {
        for (var n = e.attrsList, r = 0, i = n.length; r < i; r++) {
            var o = n[r];
            if (t.test(o.name)) return n.splice(r, 1), o;
        }
    }
    function Rr(e, t) {
        return t && (null != t.start && (e.start = t.start), null != t.end && (e.end = t.end)), e;
    }
    function Hr(e, t, n) {
        var r = n || {},
            i = r.number,
            o = '$$v';
        r.trim && (o = "(typeof $$v === 'string'? $$v.trim(): $$v)"), i && (o = '_n(' + o + ')');
        var a = Br(t, o);
        e.model = { value: '(' + t + ')', expression: JSON.stringify(t), callback: 'function ($$v) {' + a + '}' };
    }
    function Br(e, t) {
        var n = (function (e) {
            if (((e = e.trim()), (gr = e.length), e.indexOf('[') < 0 || e.lastIndexOf(']') < gr - 1))
                return ($r = e.lastIndexOf('.')) > -1 ? { exp: e.slice(0, $r), key: '"' + e.slice($r + 1) + '"' } : { exp: e, key: null };
            (_r = e), ($r = wr = Cr = 0);
            for (; !zr(); ) Vr((br = Ur())) ? Jr(br) : 91 === br && Kr(br);
            return { exp: e.slice(0, wr), key: e.slice(wr + 1, Cr) };
        })(e);
        return null === n.key ? e + '=' + t : '$set(' + n.exp + ', ' + n.key + ', ' + t + ')';
    }
    function Ur() {
        return _r.charCodeAt(++$r);
    }
    function zr() {
        return $r >= gr;
    }
    function Vr(e) {
        return 34 === e || 39 === e;
    }
    function Kr(e) {
        var t = 1;
        for (wr = $r; !zr(); )
            if (Vr((e = Ur()))) Jr(e);
            else if ((91 === e && t++, 93 === e && t--, 0 === t)) {
                Cr = $r;
                break;
            }
    }
    function Jr(e) {
        for (var t = e; !zr() && (e = Ur()) !== t; );
    }
    var qr,
        Wr = '__r',
        Zr = '__c';
    function Gr(e, t, n) {
        var r = qr;
        return function i() {
            null !== t.apply(null, arguments) && Qr(e, i, n, r);
        };
    }
    var Xr = Ve && !(X && Number(X[1]) <= 53);
    function Yr(e, t, n, r) {
        if (Xr) {
            var i = an,
                o = t;
            t = o._wrapper = function (e) {
                if (e.target === e.currentTarget || e.timeStamp >= i || e.timeStamp <= 0 || e.target.ownerDocument !== document)
                    return o.apply(this, arguments);
            };
        }
        qr.addEventListener(e, t, Q ? { capture: n, passive: r } : n);
    }
    function Qr(e, t, n, r) {
        (r || qr).removeEventListener(e, t._wrapper || t, n);
    }
    function ei(e, r) {
        if (!t(e.data.on) || !t(r.data.on)) {
            var i = r.data.on || {},
                o = e.data.on || {};
            (qr = r.elm),
                (function (e) {
                    if (n(e[Wr])) {
                        var t = q ? 'change' : 'input';
                        (e[t] = [].concat(e[Wr], e[t] || [])), delete e[Wr];
                    }
                    n(e[Zr]) && ((e.change = [].concat(e[Zr], e.change || [])), delete e[Zr]);
                })(i),
                rt(i, o, Yr, Qr, Gr, r.context),
                (qr = void 0);
        }
    }
    var ti,
        ni = { create: ei, update: ei };
    function ri(e, r) {
        if (!t(e.data.domProps) || !t(r.data.domProps)) {
            var i,
                o,
                a = r.elm,
                s = e.data.domProps || {},
                c = r.data.domProps || {};
            for (i in (n(c.__ob__) && (c = r.data.domProps = A({}, c)), s)) i in c || (a[i] = '');
            for (i in c) {
                if (((o = c[i]), 'textContent' === i || 'innerHTML' === i)) {
                    if ((r.children && (r.children.length = 0), o === s[i])) continue;
                    1 === a.childNodes.length && a.removeChild(a.childNodes[0]);
                }
                if ('value' === i && 'PROGRESS' !== a.tagName) {
                    a._value = o;
                    var u = t(o) ? '' : String(o);
                    ii(a, u) && (a.value = u);
                } else if ('innerHTML' === i && qn(a.tagName) && t(a.innerHTML)) {
                    (ti = ti || document.createElement('div')).innerHTML = '<svg>' + o + '</svg>';
                    for (var l = ti.firstChild; a.firstChild; ) a.removeChild(a.firstChild);
                    for (; l.firstChild; ) a.appendChild(l.firstChild);
                } else if (o !== s[i])
                    try {
                        a[i] = o;
                    } catch (e) {}
            }
        }
    }
    function ii(e, t) {
        return (
            !e.composing &&
            ('OPTION' === e.tagName ||
                (function (e, t) {
                    var n = !0;
                    try {
                        n = document.activeElement !== e;
                    } catch (e) {}
                    return n && e.value !== t;
                })(e, t) ||
                (function (e, t) {
                    var r = e.value,
                        i = e._vModifiers;
                    if (n(i)) {
                        if (i.number) return f(r) !== f(t);
                        if (i.trim) return r.trim() !== t.trim();
                    }
                    return r !== t;
                })(e, t))
        );
    }
    var oi = { create: ri, update: ri },
        ai = g(function (e) {
            var t = {},
                n = /:(.+)/;
            return (
                e.split(/;(?![^(]*\))/g).forEach(function (e) {
                    if (e) {
                        var r = e.split(n);
                        r.length > 1 && (t[r[0].trim()] = r[1].trim());
                    }
                }),
                t
            );
        });
    function si(e) {
        var t = ci(e.style);
        return e.staticStyle ? A(e.staticStyle, t) : t;
    }
    function ci(e) {
        return Array.isArray(e) ? O(e) : 'string' == typeof e ? ai(e) : e;
    }
    var ui,
        li = /^--/,
        fi = /\s*!important$/,
        pi = function (e, t, n) {
            if (li.test(t)) e.style.setProperty(t, n);
            else if (fi.test(n)) e.style.setProperty(C(t), n.replace(fi, ''), 'important');
            else {
                var r = vi(t);
                if (Array.isArray(n)) for (var i = 0, o = n.length; i < o; i++) e.style[r] = n[i];
                else e.style[r] = n;
            }
        },
        di = ['Webkit', 'Moz', 'ms'],
        vi = g(function (e) {
            if (((ui = ui || document.createElement('div').style), 'filter' !== (e = b(e)) && e in ui)) return e;
            for (var t = e.charAt(0).toUpperCase() + e.slice(1), n = 0; n < di.length; n++) {
                var r = di[n] + t;
                if (r in ui) return r;
            }
        });
    function hi(e, r) {
        var i = r.data,
            o = e.data;
        if (!(t(i.staticStyle) && t(i.style) && t(o.staticStyle) && t(o.style))) {
            var a,
                s,
                c = r.elm,
                u = o.staticStyle,
                l = o.normalizedStyle || o.style || {},
                f = u || l,
                p = ci(r.data.style) || {};
            r.data.normalizedStyle = n(p.__ob__) ? A({}, p) : p;
            var d = (function (e, t) {
                var n,
                    r = {};
                if (t) for (var i = e; i.componentInstance; ) (i = i.componentInstance._vnode) && i.data && (n = si(i.data)) && A(r, n);
                (n = si(e.data)) && A(r, n);
                for (var o = e; (o = o.parent); ) o.data && (n = si(o.data)) && A(r, n);
                return r;
            })(r, !0);
            for (s in f) t(d[s]) && pi(c, s, '');
            for (s in d) (a = d[s]) !== f[s] && pi(c, s, null == a ? '' : a);
        }
    }
    var mi = { create: hi, update: hi },
        yi = /\s+/;
    function gi(e, t) {
        if (t && (t = t.trim()))
            if (e.classList)
                t.indexOf(' ') > -1
                    ? t.split(yi).forEach(function (t) {
                          return e.classList.add(t);
                      })
                    : e.classList.add(t);
            else {
                var n = ' ' + (e.getAttribute('class') || '') + ' ';
                n.indexOf(' ' + t + ' ') < 0 && e.setAttribute('class', (n + t).trim());
            }
    }
    function _i(e, t) {
        if (t && (t = t.trim()))
            if (e.classList)
                t.indexOf(' ') > -1
                    ? t.split(yi).forEach(function (t) {
                          return e.classList.remove(t);
                      })
                    : e.classList.remove(t),
                    e.classList.length || e.removeAttribute('class');
            else {
                for (var n = ' ' + (e.getAttribute('class') || '') + ' ', r = ' ' + t + ' '; n.indexOf(r) >= 0; ) n = n.replace(r, ' ');
                (n = n.trim()) ? e.setAttribute('class', n) : e.removeAttribute('class');
            }
    }
    function bi(e) {
        if (e) {
            if ('object' == typeof e) {
                var t = {};
                return !1 !== e.css && A(t, $i(e.name || 'v')), A(t, e), t;
            }
            return 'string' == typeof e ? $i(e) : void 0;
        }
    }
    var $i = g(function (e) {
            return {
                enterClass: e + '-enter',
                enterToClass: e + '-enter-to',
                enterActiveClass: e + '-enter-active',
                leaveClass: e + '-leave',
                leaveToClass: e + '-leave-to',
                leaveActiveClass: e + '-leave-active',
            };
        }),
        wi = z && !W,
        Ci = 'transition',
        xi = 'animation',
        ki = 'transition',
        Ai = 'transitionend',
        Oi = 'animation',
        Si = 'animationend';
    wi &&
        (void 0 === window.ontransitionend && void 0 !== window.onwebkittransitionend && ((ki = 'WebkitTransition'), (Ai = 'webkitTransitionEnd')),
        void 0 === window.onanimationend && void 0 !== window.onwebkitanimationend && ((Oi = 'WebkitAnimation'), (Si = 'webkitAnimationEnd')));
    var Ti = z
        ? window.requestAnimationFrame
            ? window.requestAnimationFrame.bind(window)
            : setTimeout
        : function (e) {
              return e();
          };
    function Ei(e) {
        Ti(function () {
            Ti(e);
        });
    }
    function Ni(e, t) {
        var n = e._transitionClasses || (e._transitionClasses = []);
        n.indexOf(t) < 0 && (n.push(t), gi(e, t));
    }
    function ji(e, t) {
        e._transitionClasses && h(e._transitionClasses, t), _i(e, t);
    }
    function Di(e, t, n) {
        var r = Mi(e, t),
            i = r.type,
            o = r.timeout,
            a = r.propCount;
        if (!i) return n();
        var s = i === Ci ? Ai : Si,
            c = 0,
            u = function () {
                e.removeEventListener(s, l), n();
            },
            l = function (t) {
                t.target === e && ++c >= a && u();
            };
        setTimeout(function () {
            c < a && u();
        }, o + 1),
            e.addEventListener(s, l);
    }
    var Li = /\b(transform|all)(,|$)/;
    function Mi(e, t) {
        var n,
            r = window.getComputedStyle(e),
            i = (r[ki + 'Delay'] || '').split(', '),
            o = (r[ki + 'Duration'] || '').split(', '),
            a = Ii(i, o),
            s = (r[Oi + 'Delay'] || '').split(', '),
            c = (r[Oi + 'Duration'] || '').split(', '),
            u = Ii(s, c),
            l = 0,
            f = 0;
        return (
            t === Ci
                ? a > 0 && ((n = Ci), (l = a), (f = o.length))
                : t === xi
                ? u > 0 && ((n = xi), (l = u), (f = c.length))
                : (f = (n = (l = Math.max(a, u)) > 0 ? (a > u ? Ci : xi) : null) ? (n === Ci ? o.length : c.length) : 0),
            { type: n, timeout: l, propCount: f, hasTransform: n === Ci && Li.test(r[ki + 'Property']) }
        );
    }
    function Ii(e, t) {
        for (; e.length < t.length; ) e = e.concat(e);
        return Math.max.apply(
            null,
            t.map(function (t, n) {
                return Fi(t) + Fi(e[n]);
            })
        );
    }
    function Fi(e) {
        return 1e3 * Number(e.slice(0, -1).replace(',', '.'));
    }
    function Pi(e, r) {
        var i = e.elm;
        n(i._leaveCb) && ((i._leaveCb.cancelled = !0), i._leaveCb());
        var a = bi(e.data.transition);
        if (!t(a) && !n(i._enterCb) && 1 === i.nodeType) {
            for (
                var s = a.css,
                    c = a.type,
                    u = a.enterClass,
                    l = a.enterToClass,
                    p = a.enterActiveClass,
                    d = a.appearClass,
                    v = a.appearToClass,
                    h = a.appearActiveClass,
                    m = a.beforeEnter,
                    y = a.enter,
                    g = a.afterEnter,
                    _ = a.enterCancelled,
                    b = a.beforeAppear,
                    $ = a.appear,
                    w = a.afterAppear,
                    C = a.appearCancelled,
                    x = a.duration,
                    k = Wt,
                    A = Wt.$vnode;
                A && A.parent;

            )
                (k = A.context), (A = A.parent);
            var O = !k._isMounted || !e.isRootInsert;
            if (!O || $ || '' === $) {
                var S = O && d ? d : u,
                    T = O && h ? h : p,
                    E = O && v ? v : l,
                    N = (O && b) || m,
                    j = O && 'function' == typeof $ ? $ : y,
                    L = (O && w) || g,
                    M = (O && C) || _,
                    I = f(o(x) ? x.enter : x),
                    F = !1 !== s && !W,
                    P = Bi(j),
                    R = (i._enterCb = D(function () {
                        F && (ji(i, E), ji(i, T)), R.cancelled ? (F && ji(i, S), M && M(i)) : L && L(i), (i._enterCb = null);
                    }));
                e.data.show ||
                    it(e, 'insert', function () {
                        var t = i.parentNode,
                            n = t && t._pending && t._pending[e.key];
                        n && n.tag === e.tag && n.elm._leaveCb && n.elm._leaveCb(), j && j(i, R);
                    }),
                    N && N(i),
                    F &&
                        (Ni(i, S),
                        Ni(i, T),
                        Ei(function () {
                            ji(i, S), R.cancelled || (Ni(i, E), P || (Hi(I) ? setTimeout(R, I) : Di(i, c, R)));
                        })),
                    e.data.show && (r && r(), j && j(i, R)),
                    F || P || R();
            }
        }
    }
    function Ri(e, r) {
        var i = e.elm;
        n(i._enterCb) && ((i._enterCb.cancelled = !0), i._enterCb());
        var a = bi(e.data.transition);
        if (t(a) || 1 !== i.nodeType) return r();
        if (!n(i._leaveCb)) {
            var s = a.css,
                c = a.type,
                u = a.leaveClass,
                l = a.leaveToClass,
                p = a.leaveActiveClass,
                d = a.beforeLeave,
                v = a.leave,
                h = a.afterLeave,
                m = a.leaveCancelled,
                y = a.delayLeave,
                g = a.duration,
                _ = !1 !== s && !W,
                b = Bi(v),
                $ = f(o(g) ? g.leave : g),
                w = (i._leaveCb = D(function () {
                    i.parentNode && i.parentNode._pending && (i.parentNode._pending[e.key] = null),
                        _ && (ji(i, l), ji(i, p)),
                        w.cancelled ? (_ && ji(i, u), m && m(i)) : (r(), h && h(i)),
                        (i._leaveCb = null);
                }));
            y ? y(C) : C();
        }
        function C() {
            w.cancelled ||
                (!e.data.show && i.parentNode && ((i.parentNode._pending || (i.parentNode._pending = {}))[e.key] = e),
                d && d(i),
                _ &&
                    (Ni(i, u),
                    Ni(i, p),
                    Ei(function () {
                        ji(i, u), w.cancelled || (Ni(i, l), b || (Hi($) ? setTimeout(w, $) : Di(i, c, w)));
                    })),
                v && v(i, w),
                _ || b || w());
        }
    }
    function Hi(e) {
        return 'number' == typeof e && !isNaN(e);
    }
    function Bi(e) {
        if (t(e)) return !1;
        var r = e.fns;
        return n(r) ? Bi(Array.isArray(r) ? r[0] : r) : (e._length || e.length) > 1;
    }
    function Ui(e, t) {
        !0 !== t.data.show && Pi(t);
    }
    var zi = (function (e) {
        var o,
            a,
            s = {},
            c = e.modules,
            u = e.nodeOps;
        for (o = 0; o < rr.length; ++o) for (s[rr[o]] = [], a = 0; a < c.length; ++a) n(c[a][rr[o]]) && s[rr[o]].push(c[a][rr[o]]);
        function l(e) {
            var t = u.parentNode(e);
            n(t) && u.removeChild(t, e);
        }
        function f(e, t, i, o, a, c, l) {
            if (
                (n(e.elm) && n(c) && (e = c[l] = me(e)),
                (e.isRootInsert = !a),
                !(function (e, t, i, o) {
                    var a = e.data;
                    if (n(a)) {
                        var c = n(e.componentInstance) && a.keepAlive;
                        if ((n((a = a.hook)) && n((a = a.init)) && a(e, !1), n(e.componentInstance)))
                            return (
                                d(e, t),
                                v(i, e.elm, o),
                                r(c) &&
                                    (function (e, t, r, i) {
                                        for (var o, a = e; a.componentInstance; )
                                            if (((a = a.componentInstance._vnode), n((o = a.data)) && n((o = o.transition)))) {
                                                for (o = 0; o < s.activate.length; ++o) s.activate[o](nr, a);
                                                t.push(a);
                                                break;
                                            }
                                        v(r, e.elm, i);
                                    })(e, t, i, o),
                                !0
                            );
                    }
                })(e, t, i, o))
            ) {
                var f = e.data,
                    p = e.children,
                    m = e.tag;
                n(m)
                    ? ((e.elm = e.ns ? u.createElementNS(e.ns, m) : u.createElement(m, e)), g(e), h(e, p, t), n(f) && y(e, t), v(i, e.elm, o))
                    : r(e.isComment)
                    ? ((e.elm = u.createComment(e.text)), v(i, e.elm, o))
                    : ((e.elm = u.createTextNode(e.text)), v(i, e.elm, o));
            }
        }
        function d(e, t) {
            n(e.data.pendingInsert) && (t.push.apply(t, e.data.pendingInsert), (e.data.pendingInsert = null)),
                (e.elm = e.componentInstance.$el),
                m(e) ? (y(e, t), g(e)) : (tr(e), t.push(e));
        }
        function v(e, t, r) {
            n(e) && (n(r) ? u.parentNode(r) === e && u.insertBefore(e, t, r) : u.appendChild(e, t));
        }
        function h(e, t, n) {
            if (Array.isArray(t)) for (var r = 0; r < t.length; ++r) f(t[r], n, e.elm, null, !0, t, r);
            else i(e.text) && u.appendChild(e.elm, u.createTextNode(String(e.text)));
        }
        function m(e) {
            for (; e.componentInstance; ) e = e.componentInstance._vnode;
            return n(e.tag);
        }
        function y(e, t) {
            for (var r = 0; r < s.create.length; ++r) s.create[r](nr, e);
            n((o = e.data.hook)) && (n(o.create) && o.create(nr, e), n(o.insert) && t.push(e));
        }
        function g(e) {
            var t;
            if (n((t = e.fnScopeId))) u.setStyleScope(e.elm, t);
            else for (var r = e; r; ) n((t = r.context)) && n((t = t.$options._scopeId)) && u.setStyleScope(e.elm, t), (r = r.parent);
            n((t = Wt)) && t !== e.context && t !== e.fnContext && n((t = t.$options._scopeId)) && u.setStyleScope(e.elm, t);
        }
        function _(e, t, n, r, i, o) {
            for (; r <= i; ++r) f(n[r], o, e, t, !1, n, r);
        }
        function b(e) {
            var t,
                r,
                i = e.data;
            if (n(i)) for (n((t = i.hook)) && n((t = t.destroy)) && t(e), t = 0; t < s.destroy.length; ++t) s.destroy[t](e);
            if (n((t = e.children))) for (r = 0; r < e.children.length; ++r) b(e.children[r]);
        }
        function $(e, t, r) {
            for (; t <= r; ++t) {
                var i = e[t];
                n(i) && (n(i.tag) ? (w(i), b(i)) : l(i.elm));
            }
        }
        function w(e, t) {
            if (n(t) || n(e.data)) {
                var r,
                    i = s.remove.length + 1;
                for (
                    n(t)
                        ? (t.listeners += i)
                        : (t = (function (e, t) {
                              function n() {
                                  0 == --n.listeners && l(e);
                              }
                              return (n.listeners = t), n;
                          })(e.elm, i)),
                        n((r = e.componentInstance)) && n((r = r._vnode)) && n(r.data) && w(r, t),
                        r = 0;
                    r < s.remove.length;
                    ++r
                )
                    s.remove[r](e, t);
                n((r = e.data.hook)) && n((r = r.remove)) ? r(e, t) : t();
            } else l(e.elm);
        }
        function C(e, t, r, i) {
            for (var o = r; o < i; o++) {
                var a = t[o];
                if (n(a) && ir(e, a)) return o;
            }
        }
        function x(e, i, o, a, c, l) {
            if (e !== i) {
                n(i.elm) && n(a) && (i = a[c] = me(i));
                var p = (i.elm = e.elm);
                if (r(e.isAsyncPlaceholder)) n(i.asyncFactory.resolved) ? O(e.elm, i, o) : (i.isAsyncPlaceholder = !0);
                else if (r(i.isStatic) && r(e.isStatic) && i.key === e.key && (r(i.isCloned) || r(i.isOnce)))
                    i.componentInstance = e.componentInstance;
                else {
                    var d,
                        v = i.data;
                    n(v) && n((d = v.hook)) && n((d = d.prepatch)) && d(e, i);
                    var h = e.children,
                        y = i.children;
                    if (n(v) && m(i)) {
                        for (d = 0; d < s.update.length; ++d) s.update[d](e, i);
                        n((d = v.hook)) && n((d = d.update)) && d(e, i);
                    }
                    t(i.text)
                        ? n(h) && n(y)
                            ? h !== y &&
                              (function (e, r, i, o, a) {
                                  for (
                                      var s, c, l, p = 0, d = 0, v = r.length - 1, h = r[0], m = r[v], y = i.length - 1, g = i[0], b = i[y], w = !a;
                                      p <= v && d <= y;

                                  )
                                      t(h)
                                          ? (h = r[++p])
                                          : t(m)
                                          ? (m = r[--v])
                                          : ir(h, g)
                                          ? (x(h, g, o, i, d), (h = r[++p]), (g = i[++d]))
                                          : ir(m, b)
                                          ? (x(m, b, o, i, y), (m = r[--v]), (b = i[--y]))
                                          : ir(h, b)
                                          ? (x(h, b, o, i, y), w && u.insertBefore(e, h.elm, u.nextSibling(m.elm)), (h = r[++p]), (b = i[--y]))
                                          : ir(m, g)
                                          ? (x(m, g, o, i, d), w && u.insertBefore(e, m.elm, h.elm), (m = r[--v]), (g = i[++d]))
                                          : (t(s) && (s = or(r, p, v)),
                                            t((c = n(g.key) ? s[g.key] : C(g, r, p, v)))
                                                ? f(g, o, e, h.elm, !1, i, d)
                                                : ir((l = r[c]), g)
                                                ? (x(l, g, o, i, d), (r[c] = void 0), w && u.insertBefore(e, l.elm, h.elm))
                                                : f(g, o, e, h.elm, !1, i, d),
                                            (g = i[++d]));
                                  p > v ? _(e, t(i[y + 1]) ? null : i[y + 1].elm, i, d, y, o) : d > y && $(r, p, v);
                              })(p, h, y, o, l)
                            : n(y)
                            ? (n(e.text) && u.setTextContent(p, ''), _(p, null, y, 0, y.length - 1, o))
                            : n(h)
                            ? $(h, 0, h.length - 1)
                            : n(e.text) && u.setTextContent(p, '')
                        : e.text !== i.text && u.setTextContent(p, i.text),
                        n(v) && n((d = v.hook)) && n((d = d.postpatch)) && d(e, i);
                }
            }
        }
        function k(e, t, i) {
            if (r(i) && n(e.parent)) e.parent.data.pendingInsert = t;
            else for (var o = 0; o < t.length; ++o) t[o].data.hook.insert(t[o]);
        }
        var A = p('attrs,class,staticClass,staticStyle,key');
        function O(e, t, i, o) {
            var a,
                s = t.tag,
                c = t.data,
                u = t.children;
            if (((o = o || (c && c.pre)), (t.elm = e), r(t.isComment) && n(t.asyncFactory))) return (t.isAsyncPlaceholder = !0), !0;
            if (n(c) && (n((a = c.hook)) && n((a = a.init)) && a(t, !0), n((a = t.componentInstance)))) return d(t, i), !0;
            if (n(s)) {
                if (n(u))
                    if (e.hasChildNodes())
                        if (n((a = c)) && n((a = a.domProps)) && n((a = a.innerHTML))) {
                            if (a !== e.innerHTML) return !1;
                        } else {
                            for (var l = !0, f = e.firstChild, p = 0; p < u.length; p++) {
                                if (!f || !O(f, u[p], i, o)) {
                                    l = !1;
                                    break;
                                }
                                f = f.nextSibling;
                            }
                            if (!l || f) return !1;
                        }
                    else h(t, u, i);
                if (n(c)) {
                    var v = !1;
                    for (var m in c)
                        if (!A(m)) {
                            (v = !0), y(t, i);
                            break;
                        }
                    !v && c.class && et(c.class);
                }
            } else e.data !== t.text && (e.data = t.text);
            return !0;
        }
        return function (e, i, o, a) {
            if (!t(i)) {
                var c,
                    l = !1,
                    p = [];
                if (t(e)) (l = !0), f(i, p);
                else {
                    var d = n(e.nodeType);
                    if (!d && ir(e, i)) x(e, i, p, null, null, a);
                    else {
                        if (d) {
                            if ((1 === e.nodeType && e.hasAttribute(L) && (e.removeAttribute(L), (o = !0)), r(o) && O(e, i, p)))
                                return k(i, p, !0), e;
                            (c = e), (e = new pe(u.tagName(c).toLowerCase(), {}, [], void 0, c));
                        }
                        var v = e.elm,
                            h = u.parentNode(v);
                        if ((f(i, p, v._leaveCb ? null : h, u.nextSibling(v)), n(i.parent)))
                            for (var y = i.parent, g = m(i); y; ) {
                                for (var _ = 0; _ < s.destroy.length; ++_) s.destroy[_](y);
                                if (((y.elm = i.elm), g)) {
                                    for (var w = 0; w < s.create.length; ++w) s.create[w](nr, y);
                                    var C = y.data.hook.insert;
                                    if (C.merged) for (var A = 1; A < C.fns.length; A++) C.fns[A]();
                                } else tr(y);
                                y = y.parent;
                            }
                        n(h) ? $([e], 0, 0) : n(e.tag) && b(e);
                    }
                }
                return k(i, p, l), i.elm;
            }
            n(e) && b(e);
        };
    })({
        nodeOps: Qn,
        modules: [
            mr,
            xr,
            ni,
            oi,
            mi,
            z
                ? {
                      create: Ui,
                      activate: Ui,
                      remove: function (e, t) {
                          !0 !== e.data.show ? Ri(e, t) : t();
                      },
                  }
                : {},
        ].concat(pr),
    });
    W &&
        document.addEventListener('selectionchange', function () {
            var e = document.activeElement;
            e && e.vmodel && Xi(e, 'input');
        });
    var Vi = {
        inserted: function (e, t, n, r) {
            'select' === n.tag
                ? (r.elm && !r.elm._vOptions
                      ? it(n, 'postpatch', function () {
                            Vi.componentUpdated(e, t, n);
                        })
                      : Ki(e, t, n.context),
                  (e._vOptions = [].map.call(e.options, Wi)))
                : ('textarea' === n.tag || Xn(e.type)) &&
                  ((e._vModifiers = t.modifiers),
                  t.modifiers.lazy ||
                      (e.addEventListener('compositionstart', Zi),
                      e.addEventListener('compositionend', Gi),
                      e.addEventListener('change', Gi),
                      W && (e.vmodel = !0)));
        },
        componentUpdated: function (e, t, n) {
            if ('select' === n.tag) {
                Ki(e, t, n.context);
                var r = e._vOptions,
                    i = (e._vOptions = [].map.call(e.options, Wi));
                if (
                    i.some(function (e, t) {
                        return !N(e, r[t]);
                    })
                )
                    (e.multiple
                        ? t.value.some(function (e) {
                              return qi(e, i);
                          })
                        : t.value !== t.oldValue && qi(t.value, i)) && Xi(e, 'change');
            }
        },
    };
    function Ki(e, t, n) {
        Ji(e, t, n),
            (q || Z) &&
                setTimeout(function () {
                    Ji(e, t, n);
                }, 0);
    }
    function Ji(e, t, n) {
        var r = t.value,
            i = e.multiple;
        if (!i || Array.isArray(r)) {
            for (var o, a, s = 0, c = e.options.length; s < c; s++)
                if (((a = e.options[s]), i)) (o = j(r, Wi(a)) > -1), a.selected !== o && (a.selected = o);
                else if (N(Wi(a), r)) return void (e.selectedIndex !== s && (e.selectedIndex = s));
            i || (e.selectedIndex = -1);
        }
    }
    function qi(e, t) {
        return t.every(function (t) {
            return !N(t, e);
        });
    }
    function Wi(e) {
        return '_value' in e ? e._value : e.value;
    }
    function Zi(e) {
        e.target.composing = !0;
    }
    function Gi(e) {
        e.target.composing && ((e.target.composing = !1), Xi(e.target, 'input'));
    }
    function Xi(e, t) {
        var n = document.createEvent('HTMLEvents');
        n.initEvent(t, !0, !0), e.dispatchEvent(n);
    }
    function Yi(e) {
        return !e.componentInstance || (e.data && e.data.transition) ? e : Yi(e.componentInstance._vnode);
    }
    var Qi = {
            model: Vi,
            show: {
                bind: function (e, t, n) {
                    var r = t.value,
                        i = (n = Yi(n)).data && n.data.transition,
                        o = (e.__vOriginalDisplay = 'none' === e.style.display ? '' : e.style.display);
                    r && i
                        ? ((n.data.show = !0),
                          Pi(n, function () {
                              e.style.display = o;
                          }))
                        : (e.style.display = r ? o : 'none');
                },
                update: function (e, t, n) {
                    var r = t.value;
                    !r != !t.oldValue &&
                        ((n = Yi(n)).data && n.data.transition
                            ? ((n.data.show = !0),
                              r
                                  ? Pi(n, function () {
                                        e.style.display = e.__vOriginalDisplay;
                                    })
                                  : Ri(n, function () {
                                        e.style.display = 'none';
                                    }))
                            : (e.style.display = r ? e.__vOriginalDisplay : 'none'));
                },
                unbind: function (e, t, n, r, i) {
                    i || (e.style.display = e.__vOriginalDisplay);
                },
            },
        },
        eo = {
            name: String,
            appear: Boolean,
            css: Boolean,
            mode: String,
            type: String,
            enterClass: String,
            leaveClass: String,
            enterToClass: String,
            leaveToClass: String,
            enterActiveClass: String,
            leaveActiveClass: String,
            appearClass: String,
            appearActiveClass: String,
            appearToClass: String,
            duration: [Number, String, Object],
        };
    function to(e) {
        var t = e && e.componentOptions;
        return t && t.Ctor.options.abstract ? to(zt(t.children)) : e;
    }
    function no(e) {
        var t = {},
            n = e.$options;
        for (var r in n.propsData) t[r] = e[r];
        var i = n._parentListeners;
        for (var o in i) t[b(o)] = i[o];
        return t;
    }
    function ro(e, t) {
        if (/\d-keep-alive$/.test(t.tag)) return e('keep-alive', { props: t.componentOptions.propsData });
    }
    var io = function (e) {
            return e.tag || Ut(e);
        },
        oo = function (e) {
            return 'show' === e.name;
        },
        ao = {
            name: 'transition',
            props: eo,
            abstract: !0,
            render: function (e) {
                var t = this,
                    n = this.$slots.default;
                if (n && (n = n.filter(io)).length) {
                    var r = this.mode,
                        o = n[0];
                    if (
                        (function (e) {
                            for (; (e = e.parent); ) if (e.data.transition) return !0;
                        })(this.$vnode)
                    )
                        return o;
                    var a = to(o);
                    if (!a) return o;
                    if (this._leaving) return ro(e, o);
                    var s = '__transition-' + this._uid + '-';
                    a.key =
                        null == a.key
                            ? a.isComment
                                ? s + 'comment'
                                : s + a.tag
                            : i(a.key)
                            ? 0 === String(a.key).indexOf(s)
                                ? a.key
                                : s + a.key
                            : a.key;
                    var c = ((a.data || (a.data = {})).transition = no(this)),
                        u = this._vnode,
                        l = to(u);
                    if (
                        (a.data.directives && a.data.directives.some(oo) && (a.data.show = !0),
                        l &&
                            l.data &&
                            !(function (e, t) {
                                return t.key === e.key && t.tag === e.tag;
                            })(a, l) &&
                            !Ut(l) &&
                            (!l.componentInstance || !l.componentInstance._vnode.isComment))
                    ) {
                        var f = (l.data.transition = A({}, c));
                        if ('out-in' === r)
                            return (
                                (this._leaving = !0),
                                it(f, 'afterLeave', function () {
                                    (t._leaving = !1), t.$forceUpdate();
                                }),
                                ro(e, o)
                            );
                        if ('in-out' === r) {
                            if (Ut(a)) return u;
                            var p,
                                d = function () {
                                    p();
                                };
                            it(c, 'afterEnter', d),
                                it(c, 'enterCancelled', d),
                                it(f, 'delayLeave', function (e) {
                                    p = e;
                                });
                        }
                    }
                    return o;
                }
            },
        },
        so = A({ tag: String, moveClass: String }, eo);
    function co(e) {
        e.elm._moveCb && e.elm._moveCb(), e.elm._enterCb && e.elm._enterCb();
    }
    function uo(e) {
        e.data.newPos = e.elm.getBoundingClientRect();
    }
    function lo(e) {
        var t = e.data.pos,
            n = e.data.newPos,
            r = t.left - n.left,
            i = t.top - n.top;
        if (r || i) {
            e.data.moved = !0;
            var o = e.elm.style;
            (o.transform = o.WebkitTransform = 'translate(' + r + 'px,' + i + 'px)'), (o.transitionDuration = '0s');
        }
    }
    delete so.mode;
    var fo = {
        Transition: ao,
        TransitionGroup: {
            props: so,
            beforeMount: function () {
                var e = this,
                    t = this._update;
                this._update = function (n, r) {
                    var i = Zt(e);
                    e.__patch__(e._vnode, e.kept, !1, !0), (e._vnode = e.kept), i(), t.call(e, n, r);
                };
            },
            render: function (e) {
                for (
                    var t = this.tag || this.$vnode.data.tag || 'span',
                        n = Object.create(null),
                        r = (this.prevChildren = this.children),
                        i = this.$slots.default || [],
                        o = (this.children = []),
                        a = no(this),
                        s = 0;
                    s < i.length;
                    s++
                ) {
                    var c = i[s];
                    c.tag &&
                        null != c.key &&
                        0 !== String(c.key).indexOf('__vlist') &&
                        (o.push(c), (n[c.key] = c), ((c.data || (c.data = {})).transition = a));
                }
                if (r) {
                    for (var u = [], l = [], f = 0; f < r.length; f++) {
                        var p = r[f];
                        (p.data.transition = a), (p.data.pos = p.elm.getBoundingClientRect()), n[p.key] ? u.push(p) : l.push(p);
                    }
                    (this.kept = e(t, null, u)), (this.removed = l);
                }
                return e(t, null, o);
            },
            updated: function () {
                var e = this.prevChildren,
                    t = this.moveClass || (this.name || 'v') + '-move';
                e.length &&
                    this.hasMove(e[0].elm, t) &&
                    (e.forEach(co),
                    e.forEach(uo),
                    e.forEach(lo),
                    (this._reflow = document.body.offsetHeight),
                    e.forEach(function (e) {
                        if (e.data.moved) {
                            var n = e.elm,
                                r = n.style;
                            Ni(n, t),
                                (r.transform = r.WebkitTransform = r.transitionDuration = ''),
                                n.addEventListener(
                                    Ai,
                                    (n._moveCb = function e(r) {
                                        (r && r.target !== n) ||
                                            (r && !/transform$/.test(r.propertyName)) ||
                                            (n.removeEventListener(Ai, e), (n._moveCb = null), ji(n, t));
                                    })
                                );
                        }
                    }));
            },
            methods: {
                hasMove: function (e, t) {
                    if (!wi) return !1;
                    if (this._hasMove) return this._hasMove;
                    var n = e.cloneNode();
                    e._transitionClasses &&
                        e._transitionClasses.forEach(function (e) {
                            _i(n, e);
                        }),
                        gi(n, t),
                        (n.style.display = 'none'),
                        this.$el.appendChild(n);
                    var r = Mi(n);
                    return this.$el.removeChild(n), (this._hasMove = r.hasTransform);
                },
            },
        },
    };
    (wn.config.mustUseProp = jn),
        (wn.config.isReservedTag = Wn),
        (wn.config.isReservedAttr = En),
        (wn.config.getTagNamespace = Zn),
        (wn.config.isUnknownElement = function (e) {
            if (!z) return !0;
            if (Wn(e)) return !1;
            if (((e = e.toLowerCase()), null != Gn[e])) return Gn[e];
            var t = document.createElement(e);
            return e.indexOf('-') > -1
                ? (Gn[e] = t.constructor === window.HTMLUnknownElement || t.constructor === window.HTMLElement)
                : (Gn[e] = /HTMLUnknownElement/.test(t.toString()));
        }),
        A(wn.options.directives, Qi),
        A(wn.options.components, fo),
        (wn.prototype.__patch__ = z ? zi : S),
        (wn.prototype.$mount = function (e, t) {
            return (function (e, t, n) {
                var r;
                return (
                    (e.$el = t),
                    e.$options.render || (e.$options.render = ve),
                    Yt(e, 'beforeMount'),
                    (r = function () {
                        e._update(e._render(), n);
                    }),
                    new fn(
                        e,
                        r,
                        S,
                        {
                            before: function () {
                                e._isMounted && !e._isDestroyed && Yt(e, 'beforeUpdate');
                            },
                        },
                        !0
                    ),
                    (n = !1),
                    null == e.$vnode && ((e._isMounted = !0), Yt(e, 'mounted')),
                    e
                );
            })(this, (e = e && z ? Yn(e) : void 0), t);
        }),
        z &&
            setTimeout(function () {
                F.devtools && ne && ne.emit('init', wn);
            }, 0);
    var po = /\{\{((?:.|\r?\n)+?)\}\}/g,
        vo = /[-.*+?^${}()|[\]\/\\]/g,
        ho = g(function (e) {
            var t = e[0].replace(vo, '\\$&'),
                n = e[1].replace(vo, '\\$&');
            return new RegExp(t + '((?:.|\\n)+?)' + n, 'g');
        });
    var mo = {
        staticKeys: ['staticClass'],
        transformNode: function (e, t) {
            t.warn;
            var n = Fr(e, 'class');
            n && (e.staticClass = JSON.stringify(n));
            var r = Ir(e, 'class', !1);
            r && (e.classBinding = r);
        },
        genData: function (e) {
            var t = '';
            return e.staticClass && (t += 'staticClass:' + e.staticClass + ','), e.classBinding && (t += 'class:' + e.classBinding + ','), t;
        },
    };
    var yo,
        go = {
            staticKeys: ['staticStyle'],
            transformNode: function (e, t) {
                t.warn;
                var n = Fr(e, 'style');
                n && (e.staticStyle = JSON.stringify(ai(n)));
                var r = Ir(e, 'style', !1);
                r && (e.styleBinding = r);
            },
            genData: function (e) {
                var t = '';
                return e.staticStyle && (t += 'staticStyle:' + e.staticStyle + ','), e.styleBinding && (t += 'style:(' + e.styleBinding + '),'), t;
            },
        },
        _o = function (e) {
            return ((yo = yo || document.createElement('div')).innerHTML = e), yo.textContent;
        },
        bo = p('area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr'),
        $o = p('colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source'),
        wo = p(
            'address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track'
        ),
        Co = /^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,
        xo = /^\s*((?:v-[\w-]+:|@|:|#)\[[^=]+\][^\s"'<>\/=]*)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,
        ko = '[a-zA-Z_][\\-\\.0-9_a-zA-Z' + P.source + ']*',
        Ao = '((?:' + ko + '\\:)?' + ko + ')',
        Oo = new RegExp('^<' + Ao),
        So = /^\s*(\/?)>/,
        To = new RegExp('^<\\/' + Ao + '[^>]*>'),
        Eo = /^<!DOCTYPE [^>]+>/i,
        No = /^<!\--/,
        jo = /^<!\[/,
        Do = p('script,style,textarea', !0),
        Lo = {},
        Mo = { '&lt;': '<', '&gt;': '>', '&quot;': '"', '&amp;': '&', '&#10;': '\n', '&#9;': '\t', '&#39;': "'" },
        Io = /&(?:lt|gt|quot|amp|#39);/g,
        Fo = /&(?:lt|gt|quot|amp|#39|#10|#9);/g,
        Po = p('pre,textarea', !0),
        Ro = function (e, t) {
            return e && Po(e) && '\n' === t[0];
        };
    function Ho(e, t) {
        var n = t ? Fo : Io;
        return e.replace(n, function (e) {
            return Mo[e];
        });
    }
    var Bo,
        Uo,
        zo,
        Vo,
        Ko,
        Jo,
        qo,
        Wo,
        Zo = /^@|^v-on:/,
        Go = /^v-|^@|^:|^#/,
        Xo = /([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,
        Yo = /,([^,\}\]]*)(?:,([^,\}\]]*))?$/,
        Qo = /^\(|\)$/g,
        ea = /^\[.*\]$/,
        ta = /:(.*)$/,
        na = /^:|^\.|^v-bind:/,
        ra = /\.[^.\]]+(?=[^\]]*$)/g,
        ia = /^v-slot(:|$)|^#/,
        oa = /[\r\n]/,
        aa = /\s+/g,
        sa = g(_o),
        ca = '_empty_';
    function ua(e, t, n) {
        return { type: 1, tag: e, attrsList: t, attrsMap: ma(t), rawAttrsMap: {}, parent: n, children: [] };
    }
    function la(e, t) {
        (Bo = t.warn || Sr), (Jo = t.isPreTag || T), (qo = t.mustUseProp || T), (Wo = t.getTagNamespace || T);
        t.isReservedTag;
        (zo = Tr(t.modules, 'transformNode')),
            (Vo = Tr(t.modules, 'preTransformNode')),
            (Ko = Tr(t.modules, 'postTransformNode')),
            (Uo = t.delimiters);
        var n,
            r,
            i = [],
            o = !1 !== t.preserveWhitespace,
            a = t.whitespace,
            s = !1,
            c = !1;
        function u(e) {
            if (
                (l(e),
                s || e.processed || (e = fa(e, t)),
                i.length || e === n || (n.if && (e.elseif || e.else) && da(n, { exp: e.elseif, block: e })),
                r && !e.forbidden)
            )
                if (e.elseif || e.else)
                    (a = e),
                        (u = (function (e) {
                            var t = e.length;
                            for (; t--; ) {
                                if (1 === e[t].type) return e[t];
                                e.pop();
                            }
                        })(r.children)) &&
                            u.if &&
                            da(u, { exp: a.elseif, block: a });
                else {
                    if (e.slotScope) {
                        var o = e.slotTarget || '"default"';
                        (r.scopedSlots || (r.scopedSlots = {}))[o] = e;
                    }
                    r.children.push(e), (e.parent = r);
                }
            var a, u;
            (e.children = e.children.filter(function (e) {
                return !e.slotScope;
            })),
                l(e),
                e.pre && (s = !1),
                Jo(e.tag) && (c = !1);
            for (var f = 0; f < Ko.length; f++) Ko[f](e, t);
        }
        function l(e) {
            if (!c) for (var t; (t = e.children[e.children.length - 1]) && 3 === t.type && ' ' === t.text; ) e.children.pop();
        }
        return (
            (function (e, t) {
                for (var n, r, i = [], o = t.expectHTML, a = t.isUnaryTag || T, s = t.canBeLeftOpenTag || T, c = 0; e; ) {
                    if (((n = e), r && Do(r))) {
                        var u = 0,
                            l = r.toLowerCase(),
                            f = Lo[l] || (Lo[l] = new RegExp('([\\s\\S]*?)(</' + l + '[^>]*>)', 'i')),
                            p = e.replace(f, function (e, n, r) {
                                return (
                                    (u = r.length),
                                    Do(l) ||
                                        'noscript' === l ||
                                        (n = n.replace(/<!\--([\s\S]*?)-->/g, '$1').replace(/<!\[CDATA\[([\s\S]*?)]]>/g, '$1')),
                                    Ro(l, n) && (n = n.slice(1)),
                                    t.chars && t.chars(n),
                                    ''
                                );
                            });
                        (c += e.length - p.length), (e = p), A(l, c - u, c);
                    } else {
                        var d = e.indexOf('<');
                        if (0 === d) {
                            if (No.test(e)) {
                                var v = e.indexOf('--\x3e');
                                if (v >= 0) {
                                    t.shouldKeepComment && t.comment(e.substring(4, v), c, c + v + 3), C(v + 3);
                                    continue;
                                }
                            }
                            if (jo.test(e)) {
                                var h = e.indexOf(']>');
                                if (h >= 0) {
                                    C(h + 2);
                                    continue;
                                }
                            }
                            var m = e.match(Eo);
                            if (m) {
                                C(m[0].length);
                                continue;
                            }
                            var y = e.match(To);
                            if (y) {
                                var g = c;
                                C(y[0].length), A(y[1], g, c);
                                continue;
                            }
                            var _ = x();
                            if (_) {
                                k(_), Ro(_.tagName, e) && C(1);
                                continue;
                            }
                        }
                        var b = void 0,
                            $ = void 0,
                            w = void 0;
                        if (d >= 0) {
                            for ($ = e.slice(d); !(To.test($) || Oo.test($) || No.test($) || jo.test($) || (w = $.indexOf('<', 1)) < 0); )
                                (d += w), ($ = e.slice(d));
                            b = e.substring(0, d);
                        }
                        d < 0 && (b = e), b && C(b.length), t.chars && b && t.chars(b, c - b.length, c);
                    }
                    if (e === n) {
                        t.chars && t.chars(e);
                        break;
                    }
                }
                function C(t) {
                    (c += t), (e = e.substring(t));
                }
                function x() {
                    var t = e.match(Oo);
                    if (t) {
                        var n,
                            r,
                            i = { tagName: t[1], attrs: [], start: c };
                        for (C(t[0].length); !(n = e.match(So)) && (r = e.match(xo) || e.match(Co)); )
                            (r.start = c), C(r[0].length), (r.end = c), i.attrs.push(r);
                        if (n) return (i.unarySlash = n[1]), C(n[0].length), (i.end = c), i;
                    }
                }
                function k(e) {
                    var n = e.tagName,
                        c = e.unarySlash;
                    o && ('p' === r && wo(n) && A(r), s(n) && r === n && A(n));
                    for (var u = a(n) || !!c, l = e.attrs.length, f = new Array(l), p = 0; p < l; p++) {
                        var d = e.attrs[p],
                            v = d[3] || d[4] || d[5] || '',
                            h = 'a' === n && 'href' === d[1] ? t.shouldDecodeNewlinesForHref : t.shouldDecodeNewlines;
                        f[p] = { name: d[1], value: Ho(v, h) };
                    }
                    u || (i.push({ tag: n, lowerCasedTag: n.toLowerCase(), attrs: f, start: e.start, end: e.end }), (r = n)),
                        t.start && t.start(n, f, u, e.start, e.end);
                }
                function A(e, n, o) {
                    var a, s;
                    if ((null == n && (n = c), null == o && (o = c), e))
                        for (s = e.toLowerCase(), a = i.length - 1; a >= 0 && i[a].lowerCasedTag !== s; a--);
                    else a = 0;
                    if (a >= 0) {
                        for (var u = i.length - 1; u >= a; u--) t.end && t.end(i[u].tag, n, o);
                        (i.length = a), (r = a && i[a - 1].tag);
                    } else
                        'br' === s
                            ? t.start && t.start(e, [], !0, n, o)
                            : 'p' === s && (t.start && t.start(e, [], !1, n, o), t.end && t.end(e, n, o));
                }
                A();
            })(e, {
                warn: Bo,
                expectHTML: t.expectHTML,
                isUnaryTag: t.isUnaryTag,
                canBeLeftOpenTag: t.canBeLeftOpenTag,
                shouldDecodeNewlines: t.shouldDecodeNewlines,
                shouldDecodeNewlinesForHref: t.shouldDecodeNewlinesForHref,
                shouldKeepComment: t.comments,
                outputSourceRange: t.outputSourceRange,
                start: function (e, o, a, l, f) {
                    var p = (r && r.ns) || Wo(e);
                    q &&
                        'svg' === p &&
                        (o = (function (e) {
                            for (var t = [], n = 0; n < e.length; n++) {
                                var r = e[n];
                                ya.test(r.name) || ((r.name = r.name.replace(ga, '')), t.push(r));
                            }
                            return t;
                        })(o));
                    var d,
                        v = ua(e, o, r);
                    p && (v.ns = p),
                        ('style' !== (d = v).tag && ('script' !== d.tag || (d.attrsMap.type && 'text/javascript' !== d.attrsMap.type))) ||
                            te() ||
                            (v.forbidden = !0);
                    for (var h = 0; h < Vo.length; h++) v = Vo[h](v, t) || v;
                    s ||
                        (!(function (e) {
                            null != Fr(e, 'v-pre') && (e.pre = !0);
                        })(v),
                        v.pre && (s = !0)),
                        Jo(v.tag) && (c = !0),
                        s
                            ? (function (e) {
                                  var t = e.attrsList,
                                      n = t.length;
                                  if (n)
                                      for (var r = (e.attrs = new Array(n)), i = 0; i < n; i++)
                                          (r[i] = { name: t[i].name, value: JSON.stringify(t[i].value) }),
                                              null != t[i].start && ((r[i].start = t[i].start), (r[i].end = t[i].end));
                                  else e.pre || (e.plain = !0);
                              })(v)
                            : v.processed ||
                              (pa(v),
                              (function (e) {
                                  var t = Fr(e, 'v-if');
                                  if (t) (e.if = t), da(e, { exp: t, block: e });
                                  else {
                                      null != Fr(e, 'v-else') && (e.else = !0);
                                      var n = Fr(e, 'v-else-if');
                                      n && (e.elseif = n);
                                  }
                              })(v),
                              (function (e) {
                                  null != Fr(e, 'v-once') && (e.once = !0);
                              })(v)),
                        n || (n = v),
                        a ? u(v) : ((r = v), i.push(v));
                },
                end: function (e, t, n) {
                    var o = i[i.length - 1];
                    (i.length -= 1), (r = i[i.length - 1]), u(o);
                },
                chars: function (e, t, n) {
                    if (r && (!q || 'textarea' !== r.tag || r.attrsMap.placeholder !== e)) {
                        var i,
                            u,
                            l,
                            f = r.children;
                        if (
                            (e =
                                c || e.trim()
                                    ? 'script' === (i = r).tag || 'style' === i.tag
                                        ? e
                                        : sa(e)
                                    : f.length
                                    ? a
                                        ? 'condense' === a && oa.test(e)
                                            ? ''
                                            : ' '
                                        : o
                                        ? ' '
                                        : ''
                                    : '')
                        )
                            c || 'condense' !== a || (e = e.replace(aa, ' ')),
                                !s &&
                                ' ' !== e &&
                                (u = (function (e, t) {
                                    var n = t ? ho(t) : po;
                                    if (n.test(e)) {
                                        for (var r, i, o, a = [], s = [], c = (n.lastIndex = 0); (r = n.exec(e)); ) {
                                            (i = r.index) > c && (s.push((o = e.slice(c, i))), a.push(JSON.stringify(o)));
                                            var u = Ar(r[1].trim());
                                            a.push('_s(' + u + ')'), s.push({ '@binding': u }), (c = i + r[0].length);
                                        }
                                        return (
                                            c < e.length && (s.push((o = e.slice(c))), a.push(JSON.stringify(o))),
                                            { expression: a.join('+'), tokens: s }
                                        );
                                    }
                                })(e, Uo))
                                    ? (l = { type: 2, expression: u.expression, tokens: u.tokens, text: e })
                                    : (' ' === e && f.length && ' ' === f[f.length - 1].text) || (l = { type: 3, text: e }),
                                l && f.push(l);
                    }
                },
                comment: function (e, t, n) {
                    if (r) {
                        var i = { type: 3, text: e, isComment: !0 };
                        r.children.push(i);
                    }
                },
            }),
            n
        );
    }
    function fa(e, t) {
        var n, r;
        (r = Ir((n = e), 'key')) && (n.key = r),
            (e.plain = !e.key && !e.scopedSlots && !e.attrsList.length),
            (function (e) {
                var t = Ir(e, 'ref');
                t &&
                    ((e.ref = t),
                    (e.refInFor = (function (e) {
                        var t = e;
                        for (; t; ) {
                            if (void 0 !== t.for) return !0;
                            t = t.parent;
                        }
                        return !1;
                    })(e)));
            })(e),
            (function (e) {
                var t;
                'template' === e.tag
                    ? ((t = Fr(e, 'scope')), (e.slotScope = t || Fr(e, 'slot-scope')))
                    : (t = Fr(e, 'slot-scope')) && (e.slotScope = t);
                var n = Ir(e, 'slot');
                n &&
                    ((e.slotTarget = '""' === n ? '"default"' : n),
                    (e.slotTargetDynamic = !(!e.attrsMap[':slot'] && !e.attrsMap['v-bind:slot'])),
                    'template' === e.tag ||
                        e.slotScope ||
                        Nr(
                            e,
                            'slot',
                            n,
                            (function (e, t) {
                                return e.rawAttrsMap[':' + t] || e.rawAttrsMap['v-bind:' + t] || e.rawAttrsMap[t];
                            })(e, 'slot')
                        ));
                if ('template' === e.tag) {
                    var r = Pr(e, ia);
                    if (r) {
                        var i = va(r),
                            o = i.name,
                            a = i.dynamic;
                        (e.slotTarget = o), (e.slotTargetDynamic = a), (e.slotScope = r.value || ca);
                    }
                } else {
                    var s = Pr(e, ia);
                    if (s) {
                        var c = e.scopedSlots || (e.scopedSlots = {}),
                            u = va(s),
                            l = u.name,
                            f = u.dynamic,
                            p = (c[l] = ua('template', [], e));
                        (p.slotTarget = l),
                            (p.slotTargetDynamic = f),
                            (p.children = e.children.filter(function (e) {
                                if (!e.slotScope) return (e.parent = p), !0;
                            })),
                            (p.slotScope = s.value || ca),
                            (e.children = []),
                            (e.plain = !1);
                    }
                }
            })(e),
            (function (e) {
                'slot' === e.tag && (e.slotName = Ir(e, 'name'));
            })(e),
            (function (e) {
                var t;
                (t = Ir(e, 'is')) && (e.component = t);
                null != Fr(e, 'inline-template') && (e.inlineTemplate = !0);
            })(e);
        for (var i = 0; i < zo.length; i++) e = zo[i](e, t) || e;
        return (
            (function (e) {
                var t,
                    n,
                    r,
                    i,
                    o,
                    a,
                    s,
                    c,
                    u = e.attrsList;
                for (t = 0, n = u.length; t < n; t++)
                    if (((r = i = u[t].name), (o = u[t].value), Go.test(r)))
                        if (((e.hasBindings = !0), (a = ha(r.replace(Go, ''))) && (r = r.replace(ra, '')), na.test(r)))
                            (r = r.replace(na, '')),
                                (o = Ar(o)),
                                (c = ea.test(r)) && (r = r.slice(1, -1)),
                                a &&
                                    (a.prop && !c && 'innerHtml' === (r = b(r)) && (r = 'innerHTML'),
                                    a.camel && !c && (r = b(r)),
                                    a.sync &&
                                        ((s = Br(o, '$event')),
                                        c
                                            ? Mr(e, '"update:"+(' + r + ')', s, null, !1, 0, u[t], !0)
                                            : (Mr(e, 'update:' + b(r), s, null, !1, 0, u[t]),
                                              C(r) !== b(r) && Mr(e, 'update:' + C(r), s, null, !1, 0, u[t])))),
                                (a && a.prop) || (!e.component && qo(e.tag, e.attrsMap.type, r)) ? Er(e, r, o, u[t], c) : Nr(e, r, o, u[t], c);
                        else if (Zo.test(r)) (r = r.replace(Zo, '')), (c = ea.test(r)) && (r = r.slice(1, -1)), Mr(e, r, o, a, !1, 0, u[t], c);
                        else {
                            var l = (r = r.replace(Go, '')).match(ta),
                                f = l && l[1];
                            (c = !1),
                                f && ((r = r.slice(0, -(f.length + 1))), ea.test(f) && ((f = f.slice(1, -1)), (c = !0))),
                                Dr(e, r, i, o, f, c, a, u[t]);
                        }
                    else Nr(e, r, JSON.stringify(o), u[t]), !e.component && 'muted' === r && qo(e.tag, e.attrsMap.type, r) && Er(e, r, 'true', u[t]);
            })(e),
            e
        );
    }
    function pa(e) {
        var t;
        if ((t = Fr(e, 'v-for'))) {
            var n = (function (e) {
                var t = e.match(Xo);
                if (!t) return;
                var n = {};
                n.for = t[2].trim();
                var r = t[1].trim().replace(Qo, ''),
                    i = r.match(Yo);
                i ? ((n.alias = r.replace(Yo, '').trim()), (n.iterator1 = i[1].trim()), i[2] && (n.iterator2 = i[2].trim())) : (n.alias = r);
                return n;
            })(t);
            n && A(e, n);
        }
    }
    function da(e, t) {
        e.ifConditions || (e.ifConditions = []), e.ifConditions.push(t);
    }
    function va(e) {
        var t = e.name.replace(ia, '');
        return t || ('#' !== e.name[0] && (t = 'default')), ea.test(t) ? { name: t.slice(1, -1), dynamic: !0 } : { name: '"' + t + '"', dynamic: !1 };
    }
    function ha(e) {
        var t = e.match(ra);
        if (t) {
            var n = {};
            return (
                t.forEach(function (e) {
                    n[e.slice(1)] = !0;
                }),
                n
            );
        }
    }
    function ma(e) {
        for (var t = {}, n = 0, r = e.length; n < r; n++) t[e[n].name] = e[n].value;
        return t;
    }
    var ya = /^xmlns:NS\d+/,
        ga = /^NS\d+:/;
    function _a(e) {
        return ua(e.tag, e.attrsList.slice(), e.parent);
    }
    var ba = [
        mo,
        go,
        {
            preTransformNode: function (e, t) {
                if ('input' === e.tag) {
                    var n,
                        r = e.attrsMap;
                    if (!r['v-model']) return;
                    if (
                        ((r[':type'] || r['v-bind:type']) && (n = Ir(e, 'type')),
                        r.type || n || !r['v-bind'] || (n = '(' + r['v-bind'] + ').type'),
                        n)
                    ) {
                        var i = Fr(e, 'v-if', !0),
                            o = i ? '&&(' + i + ')' : '',
                            a = null != Fr(e, 'v-else', !0),
                            s = Fr(e, 'v-else-if', !0),
                            c = _a(e);
                        pa(c),
                            jr(c, 'type', 'checkbox'),
                            fa(c, t),
                            (c.processed = !0),
                            (c.if = '(' + n + ")==='checkbox'" + o),
                            da(c, { exp: c.if, block: c });
                        var u = _a(e);
                        Fr(u, 'v-for', !0), jr(u, 'type', 'radio'), fa(u, t), da(c, { exp: '(' + n + ")==='radio'" + o, block: u });
                        var l = _a(e);
                        return (
                            Fr(l, 'v-for', !0), jr(l, ':type', n), fa(l, t), da(c, { exp: i, block: l }), a ? (c.else = !0) : s && (c.elseif = s), c
                        );
                    }
                }
            },
        },
    ];
    var $a,
        wa,
        Ca = {
            expectHTML: !0,
            modules: ba,
            directives: {
                model: function (e, t, n) {
                    var r = t.value,
                        i = t.modifiers,
                        o = e.tag,
                        a = e.attrsMap.type;
                    if (e.component) return Hr(e, r, i), !1;
                    if ('select' === o)
                        !(function (e, t, n) {
                            var r =
                                'var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = "_value" in o ? o._value : o.value;return ' +
                                (n && n.number ? '_n(val)' : 'val') +
                                '});';
                            (r = r + ' ' + Br(t, '$event.target.multiple ? $$selectedVal : $$selectedVal[0]')), Mr(e, 'change', r, null, !0);
                        })(e, r, i);
                    else if ('input' === o && 'checkbox' === a)
                        !(function (e, t, n) {
                            var r = n && n.number,
                                i = Ir(e, 'value') || 'null',
                                o = Ir(e, 'true-value') || 'true',
                                a = Ir(e, 'false-value') || 'false';
                            Er(
                                e,
                                'checked',
                                'Array.isArray(' + t + ')?_i(' + t + ',' + i + ')>-1' + ('true' === o ? ':(' + t + ')' : ':_q(' + t + ',' + o + ')')
                            ),
                                Mr(
                                    e,
                                    'change',
                                    'var $$a=' +
                                        t +
                                        ',$$el=$event.target,$$c=$$el.checked?(' +
                                        o +
                                        '):(' +
                                        a +
                                        ');if(Array.isArray($$a)){var $$v=' +
                                        (r ? '_n(' + i + ')' : i) +
                                        ',$$i=_i($$a,$$v);if($$el.checked){$$i<0&&(' +
                                        Br(t, '$$a.concat([$$v])') +
                                        ')}else{$$i>-1&&(' +
                                        Br(t, '$$a.slice(0,$$i).concat($$a.slice($$i+1))') +
                                        ')}}else{' +
                                        Br(t, '$$c') +
                                        '}',
                                    null,
                                    !0
                                );
                        })(e, r, i);
                    else if ('input' === o && 'radio' === a)
                        !(function (e, t, n) {
                            var r = n && n.number,
                                i = Ir(e, 'value') || 'null';
                            Er(e, 'checked', '_q(' + t + ',' + (i = r ? '_n(' + i + ')' : i) + ')'), Mr(e, 'change', Br(t, i), null, !0);
                        })(e, r, i);
                    else if ('input' === o || 'textarea' === o)
                        !(function (e, t, n) {
                            var r = e.attrsMap.type,
                                i = n || {},
                                o = i.lazy,
                                a = i.number,
                                s = i.trim,
                                c = !o && 'range' !== r,
                                u = o ? 'change' : 'range' === r ? Wr : 'input',
                                l = '$event.target.value';
                            s && (l = '$event.target.value.trim()'), a && (l = '_n(' + l + ')');
                            var f = Br(t, l);
                            c && (f = 'if($event.target.composing)return;' + f),
                                Er(e, 'value', '(' + t + ')'),
                                Mr(e, u, f, null, !0),
                                (s || a) && Mr(e, 'blur', '$forceUpdate()');
                        })(e, r, i);
                    else if (!F.isReservedTag(o)) return Hr(e, r, i), !1;
                    return !0;
                },
                text: function (e, t) {
                    t.value && Er(e, 'textContent', '_s(' + t.value + ')', t);
                },
                html: function (e, t) {
                    t.value && Er(e, 'innerHTML', '_s(' + t.value + ')', t);
                },
            },
            isPreTag: function (e) {
                return 'pre' === e;
            },
            isUnaryTag: bo,
            mustUseProp: jn,
            canBeLeftOpenTag: $o,
            isReservedTag: Wn,
            getTagNamespace: Zn,
            staticKeys: (function (e) {
                return e
                    .reduce(function (e, t) {
                        return e.concat(t.staticKeys || []);
                    }, [])
                    .join(',');
            })(ba),
        },
        xa = g(function (e) {
            return p('type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap' + (e ? ',' + e : ''));
        });
    function ka(e, t) {
        e &&
            (($a = xa(t.staticKeys || '')),
            (wa = t.isReservedTag || T),
            (function e(t) {
                t.static = (function (e) {
                    if (2 === e.type) return !1;
                    if (3 === e.type) return !0;
                    return !(
                        !e.pre &&
                        (e.hasBindings ||
                            e.if ||
                            e.for ||
                            d(e.tag) ||
                            !wa(e.tag) ||
                            (function (e) {
                                for (; e.parent; ) {
                                    if ('template' !== (e = e.parent).tag) return !1;
                                    if (e.for) return !0;
                                }
                                return !1;
                            })(e) ||
                            !Object.keys(e).every($a))
                    );
                })(t);
                if (1 === t.type) {
                    if (!wa(t.tag) && 'slot' !== t.tag && null == t.attrsMap['inline-template']) return;
                    for (var n = 0, r = t.children.length; n < r; n++) {
                        var i = t.children[n];
                        e(i), i.static || (t.static = !1);
                    }
                    if (t.ifConditions)
                        for (var o = 1, a = t.ifConditions.length; o < a; o++) {
                            var s = t.ifConditions[o].block;
                            e(s), s.static || (t.static = !1);
                        }
                }
            })(e),
            (function e(t, n) {
                if (1 === t.type) {
                    if (
                        ((t.static || t.once) && (t.staticInFor = n),
                        t.static && t.children.length && (1 !== t.children.length || 3 !== t.children[0].type))
                    )
                        return void (t.staticRoot = !0);
                    if (((t.staticRoot = !1), t.children)) for (var r = 0, i = t.children.length; r < i; r++) e(t.children[r], n || !!t.for);
                    if (t.ifConditions) for (var o = 1, a = t.ifConditions.length; o < a; o++) e(t.ifConditions[o].block, n);
                }
            })(e, !1));
    }
    var Aa = /^([\w$_]+|\([^)]*?\))\s*=>|^function(?:\s+[\w$]+)?\s*\(/,
        Oa = /\([^)]*?\);*$/,
        Sa = /^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,
        Ta = { esc: 27, tab: 9, enter: 13, space: 32, up: 38, left: 37, right: 39, down: 40, delete: [8, 46] },
        Ea = {
            esc: ['Esc', 'Escape'],
            tab: 'Tab',
            enter: 'Enter',
            space: [' ', 'Spacebar'],
            up: ['Up', 'ArrowUp'],
            left: ['Left', 'ArrowLeft'],
            right: ['Right', 'ArrowRight'],
            down: ['Down', 'ArrowDown'],
            delete: ['Backspace', 'Delete', 'Del'],
        },
        Na = function (e) {
            return 'if(' + e + ')return null;';
        },
        ja = {
            stop: '$event.stopPropagation();',
            prevent: '$event.preventDefault();',
            self: Na('$event.target !== $event.currentTarget'),
            ctrl: Na('!$event.ctrlKey'),
            shift: Na('!$event.shiftKey'),
            alt: Na('!$event.altKey'),
            meta: Na('!$event.metaKey'),
            left: Na("'button' in $event && $event.button !== 0"),
            middle: Na("'button' in $event && $event.button !== 1"),
            right: Na("'button' in $event && $event.button !== 2"),
        };
    function Da(e, t) {
        var n = t ? 'nativeOn:' : 'on:',
            r = '',
            i = '';
        for (var o in e) {
            var a = La(e[o]);
            e[o] && e[o].dynamic ? (i += o + ',' + a + ',') : (r += '"' + o + '":' + a + ',');
        }
        return (r = '{' + r.slice(0, -1) + '}'), i ? n + '_d(' + r + ',[' + i.slice(0, -1) + '])' : n + r;
    }
    function La(e) {
        if (!e) return 'function(){}';
        if (Array.isArray(e))
            return (
                '[' +
                e
                    .map(function (e) {
                        return La(e);
                    })
                    .join(',') +
                ']'
            );
        var t = Sa.test(e.value),
            n = Aa.test(e.value),
            r = Sa.test(e.value.replace(Oa, ''));
        if (e.modifiers) {
            var i = '',
                o = '',
                a = [];
            for (var s in e.modifiers)
                if (ja[s]) (o += ja[s]), Ta[s] && a.push(s);
                else if ('exact' === s) {
                    var c = e.modifiers;
                    o += Na(
                        ['ctrl', 'shift', 'alt', 'meta']
                            .filter(function (e) {
                                return !c[e];
                            })
                            .map(function (e) {
                                return '$event.' + e + 'Key';
                            })
                            .join('||')
                    );
                } else a.push(s);
            return (
                a.length &&
                    (i += (function (e) {
                        return "if(!$event.type.indexOf('key')&&" + e.map(Ma).join('&&') + ')return null;';
                    })(a)),
                o && (i += o),
                'function($event){' +
                    i +
                    (t ? 'return ' + e.value + '($event)' : n ? 'return (' + e.value + ')($event)' : r ? 'return ' + e.value : e.value) +
                    '}'
            );
        }
        return t || n ? e.value : 'function($event){' + (r ? 'return ' + e.value : e.value) + '}';
    }
    function Ma(e) {
        var t = parseInt(e, 10);
        if (t) return '$event.keyCode!==' + t;
        var n = Ta[e],
            r = Ea[e];
        return '_k($event.keyCode,' + JSON.stringify(e) + ',' + JSON.stringify(n) + ',$event.key,' + JSON.stringify(r) + ')';
    }
    var Ia = {
            on: function (e, t) {
                e.wrapListeners = function (e) {
                    return '_g(' + e + ',' + t.value + ')';
                };
            },
            bind: function (e, t) {
                e.wrapData = function (n) {
                    return (
                        '_b(' +
                        n +
                        ",'" +
                        e.tag +
                        "'," +
                        t.value +
                        ',' +
                        (t.modifiers && t.modifiers.prop ? 'true' : 'false') +
                        (t.modifiers && t.modifiers.sync ? ',true' : '') +
                        ')'
                    );
                };
            },
            cloak: S,
        },
        Fa = function (e) {
            (this.options = e),
                (this.warn = e.warn || Sr),
                (this.transforms = Tr(e.modules, 'transformCode')),
                (this.dataGenFns = Tr(e.modules, 'genData')),
                (this.directives = A(A({}, Ia), e.directives));
            var t = e.isReservedTag || T;
            (this.maybeComponent = function (e) {
                return !!e.component || !t(e.tag);
            }),
                (this.onceId = 0),
                (this.staticRenderFns = []),
                (this.pre = !1);
        };
    function Pa(e, t) {
        var n = new Fa(t);
        return { render: 'with(this){return ' + (e ? Ra(e, n) : '_c("div")') + '}', staticRenderFns: n.staticRenderFns };
    }
    function Ra(e, t) {
        if ((e.parent && (e.pre = e.pre || e.parent.pre), e.staticRoot && !e.staticProcessed)) return Ha(e, t);
        if (e.once && !e.onceProcessed) return Ba(e, t);
        if (e.for && !e.forProcessed) return za(e, t);
        if (e.if && !e.ifProcessed) return Ua(e, t);
        if ('template' !== e.tag || e.slotTarget || t.pre) {
            if ('slot' === e.tag)
                return (function (e, t) {
                    var n = e.slotName || '"default"',
                        r = qa(e, t),
                        i = '_t(' + n + (r ? ',' + r : ''),
                        o =
                            e.attrs || e.dynamicAttrs
                                ? Ga(
                                      (e.attrs || []).concat(e.dynamicAttrs || []).map(function (e) {
                                          return { name: b(e.name), value: e.value, dynamic: e.dynamic };
                                      })
                                  )
                                : null,
                        a = e.attrsMap['v-bind'];
                    (!o && !a) || r || (i += ',null');
                    o && (i += ',' + o);
                    a && (i += (o ? '' : ',null') + ',' + a);
                    return i + ')';
                })(e, t);
            var n;
            if (e.component)
                n = (function (e, t, n) {
                    var r = t.inlineTemplate ? null : qa(t, n, !0);
                    return '_c(' + e + ',' + Va(t, n) + (r ? ',' + r : '') + ')';
                })(e.component, e, t);
            else {
                var r;
                (!e.plain || (e.pre && t.maybeComponent(e))) && (r = Va(e, t));
                var i = e.inlineTemplate ? null : qa(e, t, !0);
                n = "_c('" + e.tag + "'" + (r ? ',' + r : '') + (i ? ',' + i : '') + ')';
            }
            for (var o = 0; o < t.transforms.length; o++) n = t.transforms[o](e, n);
            return n;
        }
        return qa(e, t) || 'void 0';
    }
    function Ha(e, t) {
        e.staticProcessed = !0;
        var n = t.pre;
        return (
            e.pre && (t.pre = e.pre),
            t.staticRenderFns.push('with(this){return ' + Ra(e, t) + '}'),
            (t.pre = n),
            '_m(' + (t.staticRenderFns.length - 1) + (e.staticInFor ? ',true' : '') + ')'
        );
    }
    function Ba(e, t) {
        if (((e.onceProcessed = !0), e.if && !e.ifProcessed)) return Ua(e, t);
        if (e.staticInFor) {
            for (var n = '', r = e.parent; r; ) {
                if (r.for) {
                    n = r.key;
                    break;
                }
                r = r.parent;
            }
            return n ? '_o(' + Ra(e, t) + ',' + t.onceId++ + ',' + n + ')' : Ra(e, t);
        }
        return Ha(e, t);
    }
    function Ua(e, t, n, r) {
        return (
            (e.ifProcessed = !0),
            (function e(t, n, r, i) {
                if (!t.length) return i || '_e()';
                var o = t.shift();
                return o.exp ? '(' + o.exp + ')?' + a(o.block) + ':' + e(t, n, r, i) : '' + a(o.block);
                function a(e) {
                    return r ? r(e, n) : e.once ? Ba(e, n) : Ra(e, n);
                }
            })(e.ifConditions.slice(), t, n, r)
        );
    }
    function za(e, t, n, r) {
        var i = e.for,
            o = e.alias,
            a = e.iterator1 ? ',' + e.iterator1 : '',
            s = e.iterator2 ? ',' + e.iterator2 : '';
        return (e.forProcessed = !0), (r || '_l') + '((' + i + '),function(' + o + a + s + '){return ' + (n || Ra)(e, t) + '})';
    }
    function Va(e, t) {
        var n = '{',
            r = (function (e, t) {
                var n = e.directives;
                if (!n) return;
                var r,
                    i,
                    o,
                    a,
                    s = 'directives:[',
                    c = !1;
                for (r = 0, i = n.length; r < i; r++) {
                    (o = n[r]), (a = !0);
                    var u = t.directives[o.name];
                    u && (a = !!u(e, o, t.warn)),
                        a &&
                            ((c = !0),
                            (s +=
                                '{name:"' +
                                o.name +
                                '",rawName:"' +
                                o.rawName +
                                '"' +
                                (o.value ? ',value:(' + o.value + '),expression:' + JSON.stringify(o.value) : '') +
                                (o.arg ? ',arg:' + (o.isDynamicArg ? o.arg : '"' + o.arg + '"') : '') +
                                (o.modifiers ? ',modifiers:' + JSON.stringify(o.modifiers) : '') +
                                '},'));
                }
                if (c) return s.slice(0, -1) + ']';
            })(e, t);
        r && (n += r + ','),
            e.key && (n += 'key:' + e.key + ','),
            e.ref && (n += 'ref:' + e.ref + ','),
            e.refInFor && (n += 'refInFor:true,'),
            e.pre && (n += 'pre:true,'),
            e.component && (n += 'tag:"' + e.tag + '",');
        for (var i = 0; i < t.dataGenFns.length; i++) n += t.dataGenFns[i](e);
        if (
            (e.attrs && (n += 'attrs:' + Ga(e.attrs) + ','),
            e.props && (n += 'domProps:' + Ga(e.props) + ','),
            e.events && (n += Da(e.events, !1) + ','),
            e.nativeEvents && (n += Da(e.nativeEvents, !0) + ','),
            e.slotTarget && !e.slotScope && (n += 'slot:' + e.slotTarget + ','),
            e.scopedSlots &&
                (n +=
                    (function (e, t, n) {
                        var r =
                                e.for ||
                                Object.keys(t).some(function (e) {
                                    var n = t[e];
                                    return n.slotTargetDynamic || n.if || n.for || Ka(n);
                                }),
                            i = !!e.if;
                        if (!r)
                            for (var o = e.parent; o; ) {
                                if ((o.slotScope && o.slotScope !== ca) || o.for) {
                                    r = !0;
                                    break;
                                }
                                o.if && (i = !0), (o = o.parent);
                            }
                        var a = Object.keys(t)
                            .map(function (e) {
                                return Ja(t[e], n);
                            })
                            .join(',');
                        return (
                            'scopedSlots:_u([' +
                            a +
                            ']' +
                            (r ? ',null,true' : '') +
                            (!r && i
                                ? ',null,false,' +
                                  (function (e) {
                                      var t = 5381,
                                          n = e.length;
                                      for (; n; ) t = (33 * t) ^ e.charCodeAt(--n);
                                      return t >>> 0;
                                  })(a)
                                : '') +
                            ')'
                        );
                    })(e, e.scopedSlots, t) + ','),
            e.model && (n += 'model:{value:' + e.model.value + ',callback:' + e.model.callback + ',expression:' + e.model.expression + '},'),
            e.inlineTemplate)
        ) {
            var o = (function (e, t) {
                var n = e.children[0];
                if (n && 1 === n.type) {
                    var r = Pa(n, t.options);
                    return (
                        'inlineTemplate:{render:function(){' +
                        r.render +
                        '},staticRenderFns:[' +
                        r.staticRenderFns
                            .map(function (e) {
                                return 'function(){' + e + '}';
                            })
                            .join(',') +
                        ']}'
                    );
                }
            })(e, t);
            o && (n += o + ',');
        }
        return (
            (n = n.replace(/,$/, '') + '}'),
            e.dynamicAttrs && (n = '_b(' + n + ',"' + e.tag + '",' + Ga(e.dynamicAttrs) + ')'),
            e.wrapData && (n = e.wrapData(n)),
            e.wrapListeners && (n = e.wrapListeners(n)),
            n
        );
    }
    function Ka(e) {
        return 1 === e.type && ('slot' === e.tag || e.children.some(Ka));
    }
    function Ja(e, t) {
        var n = e.attrsMap['slot-scope'];
        if (e.if && !e.ifProcessed && !n) return Ua(e, t, Ja, 'null');
        if (e.for && !e.forProcessed) return za(e, t, Ja);
        var r = e.slotScope === ca ? '' : String(e.slotScope),
            i =
                'function(' +
                r +
                '){return ' +
                ('template' === e.tag
                    ? e.if && n
                        ? '(' + e.if + ')?' + (qa(e, t) || 'undefined') + ':undefined'
                        : qa(e, t) || 'undefined'
                    : Ra(e, t)) +
                '}',
            o = r ? '' : ',proxy:true';
        return '{key:' + (e.slotTarget || '"default"') + ',fn:' + i + o + '}';
    }
    function qa(e, t, n, r, i) {
        var o = e.children;
        if (o.length) {
            var a = o[0];
            if (1 === o.length && a.for && 'template' !== a.tag && 'slot' !== a.tag) {
                var s = n ? (t.maybeComponent(a) ? ',1' : ',0') : '';
                return '' + (r || Ra)(a, t) + s;
            }
            var c = n
                    ? (function (e, t) {
                          for (var n = 0, r = 0; r < e.length; r++) {
                              var i = e[r];
                              if (1 === i.type) {
                                  if (
                                      Wa(i) ||
                                      (i.ifConditions &&
                                          i.ifConditions.some(function (e) {
                                              return Wa(e.block);
                                          }))
                                  ) {
                                      n = 2;
                                      break;
                                  }
                                  (t(i) ||
                                      (i.ifConditions &&
                                          i.ifConditions.some(function (e) {
                                              return t(e.block);
                                          }))) &&
                                      (n = 1);
                              }
                          }
                          return n;
                      })(o, t.maybeComponent)
                    : 0,
                u = i || Za;
            return (
                '[' +
                o
                    .map(function (e) {
                        return u(e, t);
                    })
                    .join(',') +
                ']' +
                (c ? ',' + c : '')
            );
        }
    }
    function Wa(e) {
        return void 0 !== e.for || 'template' === e.tag || 'slot' === e.tag;
    }
    function Za(e, t) {
        return 1 === e.type
            ? Ra(e, t)
            : 3 === e.type && e.isComment
            ? ((r = e), '_e(' + JSON.stringify(r.text) + ')')
            : '_v(' + (2 === (n = e).type ? n.expression : Xa(JSON.stringify(n.text))) + ')';
        var n, r;
    }
    function Ga(e) {
        for (var t = '', n = '', r = 0; r < e.length; r++) {
            var i = e[r],
                o = Xa(i.value);
            i.dynamic ? (n += i.name + ',' + o + ',') : (t += '"' + i.name + '":' + o + ',');
        }
        return (t = '{' + t.slice(0, -1) + '}'), n ? '_d(' + t + ',[' + n.slice(0, -1) + '])' : t;
    }
    function Xa(e) {
        return e.replace(/\u2028/g, '\\u2028').replace(/\u2029/g, '\\u2029');
    }
    new RegExp(
        '\\b' +
            'do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments'
                .split(',')
                .join('\\b|\\b') +
            '\\b'
    );
    function Ya(e, t) {
        try {
            return new Function(e);
        } catch (n) {
            return t.push({ err: n, code: e }), S;
        }
    }
    function Qa(e) {
        var t = Object.create(null);
        return function (n, r, i) {
            (r = A({}, r)).warn;
            delete r.warn;
            var o = r.delimiters ? String(r.delimiters) + n : n;
            if (t[o]) return t[o];
            var a = e(n, r),
                s = {},
                c = [];
            return (
                (s.render = Ya(a.render, c)),
                (s.staticRenderFns = a.staticRenderFns.map(function (e) {
                    return Ya(e, c);
                })),
                (t[o] = s)
            );
        };
    }
    var es,
        ts,
        ns = ((es = function (e, t) {
            var n = la(e.trim(), t);
            !1 !== t.optimize && ka(n, t);
            var r = Pa(n, t);
            return { ast: n, render: r.render, staticRenderFns: r.staticRenderFns };
        }),
        function (e) {
            function t(t, n) {
                var r = Object.create(e),
                    i = [],
                    o = [];
                if (n)
                    for (var a in (n.modules && (r.modules = (e.modules || []).concat(n.modules)),
                    n.directives && (r.directives = A(Object.create(e.directives || null), n.directives)),
                    n))
                        'modules' !== a && 'directives' !== a && (r[a] = n[a]);
                r.warn = function (e, t, n) {
                    (n ? o : i).push(e);
                };
                var s = es(t.trim(), r);
                return (s.errors = i), (s.tips = o), s;
            }
            return { compile: t, compileToFunctions: Qa(t) };
        })(Ca),
        rs = (ns.compile, ns.compileToFunctions);
    function is(e) {
        return ((ts = ts || document.createElement('div')).innerHTML = e ? '<a href="\n"/>' : '<div a="\n"/>'), ts.innerHTML.indexOf('&#10;') > 0;
    }
    var os = !!z && is(!1),
        as = !!z && is(!0),
        ss = g(function (e) {
            var t = Yn(e);
            return t && t.innerHTML;
        }),
        cs = wn.prototype.$mount;
    return (
        (wn.prototype.$mount = function (e, t) {
            if ((e = e && Yn(e)) === document.body || e === document.documentElement) return this;
            var n = this.$options;
            if (!n.render) {
                var r = n.template;
                if (r)
                    if ('string' == typeof r) '#' === r.charAt(0) && (r = ss(r));
                    else {
                        if (!r.nodeType) return this;
                        r = r.innerHTML;
                    }
                else
                    e &&
                        (r = (function (e) {
                            if (e.outerHTML) return e.outerHTML;
                            var t = document.createElement('div');
                            return t.appendChild(e.cloneNode(!0)), t.innerHTML;
                        })(e));
                if (r) {
                    var i = rs(
                            r,
                            {
                                outputSourceRange: !1,
                                shouldDecodeNewlines: os,
                                shouldDecodeNewlinesForHref: as,
                                delimiters: n.delimiters,
                                comments: n.comments,
                            },
                            this
                        ),
                        o = i.render,
                        a = i.staticRenderFns;
                    (n.render = o), (n.staticRenderFns = a);
                }
            }
            return cs.call(this, e, t);
        }),
        (wn.compile = rs),
        wn
    );
});
Vue.config.devtools = window.location.hostname != 'www.dunkindonuts.com';

/* @license 
 * jQuery.print, version 1.5.1
 *  (c) Sathvik Ponangi, Doers' Guild
 * Licence: CC-By (http://creativecommons.org/licenses/by/3.0/)
 *--------------------------------------------------------------------------*/
(function ($) {
    "use strict";
    // A nice closure for our definitions
    function getjQueryObject(string) {
        // Make string a vaild jQuery thing
        var jqObj = $("");
        try {
            jqObj = $(string)
                .clone();
        } catch (e) {
            jqObj = $("<span />")
                .html(string);
        }
        return jqObj;
    }

    function printFrame(frameWindow, content, options) {
        // Print the selected window/iframe
        var def = $.Deferred();
        try {
            frameWindow = frameWindow.contentWindow || frameWindow.contentDocument || frameWindow;
            var wdoc = frameWindow.document || frameWindow.contentDocument || frameWindow;
            if(options.doctype) {
                wdoc.write(options.doctype);
            }
            wdoc.write(content);
            wdoc.close();
            var printed = false;
            var callPrint = function () {
                if(printed) {
                    return;
                }
                // Fix for IE : Allow it to render the iframe
                frameWindow.focus();
                try {
                    // Fix for IE11 - printng the whole page instead of the iframe content
                    if (!frameWindow.document.execCommand('print', false, null)) {
                        // document.execCommand returns false if it failed -http://stackoverflow.com/a/21336448/937891
                        frameWindow.print();
                    }
                    // focus body as it is losing focus in iPad and content not getting printed
                    $('body').focus();
                } catch (e) {
                    frameWindow.print();
                }
                frameWindow.close();
                printed = true;
                def.resolve();
            }
            // Print once the frame window loads - seems to work for the new-window option but unreliable for the iframe
            $(frameWindow).on("load", callPrint);
            // Fallback to printing directly if the frame doesn't fire the load event for whatever reason
            setTimeout(callPrint, options.timeout);
        } catch (err) {
            def.reject(err);
        }
        return def;
    }

    function printContentInIFrame(content, options) {
        var $iframe = $(options.iframe + "");
        var iframeCount = $iframe.length;
        if (iframeCount === 0) {
            // Create a new iFrame if none is given
            $iframe = $('<iframe height="0" width="0" border="0" wmode="Opaque"/>')
                .prependTo('body')
                .css({
                    "position": "absolute",
                    "top": -999,
                    "left": -999
                });
        }
        var frameWindow = $iframe.get(0);
        return printFrame(frameWindow, content, options)
            .done(function () {
                // Success
                setTimeout(function () {
                    // Wait for IE
                    if (iframeCount === 0) {
                        // Destroy the iframe if created here
                        $iframe.remove();
                    }
                }, 1000);
            })
            .fail(function (err) {
                // Use the pop-up method if iframe fails for some reason
                console.error("Failed to print from iframe", err);
                printContentInNewWindow(content, options);
            })
            .always(function () {
                try {
                    options.deferred.resolve();
                } catch (err) {
                    console.warn('Error notifying deferred', err);
                }
            });
    }

    function printContentInNewWindow(content, options) {
        // Open a new window and print selected content
        var frameWindow = window.open();
        return printFrame(frameWindow, content, options)
            .always(function () {
                try {
                    options.deferred.resolve();
                } catch (err) {
                    console.warn('Error notifying deferred', err);
                }
            });
    }

    function isNode(o) {
        /* http://stackoverflow.com/a/384380/937891 */
        return !!(typeof Node === "object" ? o instanceof Node : o && typeof o === "object" && typeof o.nodeType === "number" && typeof o.nodeName === "string");
    }
    $.print = $.fn.print = function () {
        // Print a given set of elements
        var options, $this, self = this;
        // console.log("Printing", this, arguments);
        if (self instanceof $) {
            // Get the node if it is a jQuery object
            self = self.get(0);
        }
        if (isNode(self)) {
            // If `this` is a HTML element, i.e. for
            // $(selector).print()
            $this = $(self);
            if (arguments.length > 0) {
                options = arguments[0];
            }
        } else {
            if (arguments.length > 0) {
                // $.print(selector,options)
                $this = $(arguments[0]);
                if (isNode($this[0])) {
                    if (arguments.length > 1) {
                        options = arguments[1];
                    }
                } else {
                    // $.print(options)
                    options = arguments[0];
                    $this = $("html");
                }
            } else {
                // $.print()
                $this = $("html");
            }
        }
        // Default options
        var defaults = {
            globalStyles: true,
            mediaPrint: false,
            stylesheet: null,
            noPrintSelector: ".no-print",
            iframe: true,
            append: null,
            prepend: null,
            manuallyCopyFormValues: true,
            deferred: $.Deferred(),
            timeout: 750,
            title: null,
            doctype: '<!doctype html>'
        };
        // Merge with user-options
        options = $.extend({}, defaults, (options || {}));
        var $styles = $("");
        if (options.globalStyles) {
            // Apply the stlyes from the current sheet to the printed page
            $styles = $("style, link, meta, base, title");
        } else if (options.mediaPrint) {
            // Apply the media-print stylesheet
            $styles = $("link[media=print]");
        }
        if (options.stylesheet) {
            // Add a custom stylesheet if given
            $styles = $.merge($styles, $('<link rel="stylesheet" href="' + options.stylesheet + '">'));
        }
        // Create a copy of the element to print
        var copy = $this.clone();
        // Wrap it in a span to get the HTML markup string
        copy = $("<span/>")
            .append(copy);
        // Remove unwanted elements
        copy.find(options.noPrintSelector)
            .remove();
        // Add in the styles
        copy.append($styles.clone());
        // Update title
        if (options.title) {
            var title = $("title", copy);
            if (title.length === 0) {
                title = $("<title />");
                copy.append(title);                
            }
            title.text(options.title);            
        }
        // Appedned content
        copy.append(getjQueryObject(options.append));
        // Prepended content
        copy.prepend(getjQueryObject(options.prepend));
        if (options.manuallyCopyFormValues) {
            // Manually copy form values into the HTML for printing user-modified input fields
            // http://stackoverflow.com/a/26707753
            copy.find("input")
                .each(function () {
                    var $field = $(this);
                    if ($field.is("[type='radio']") || $field.is("[type='checkbox']")) {
                        if ($field.prop("checked")) {
                            $field.attr("checked", "checked");
                        }
                    } else {
                        $field.attr("value", $field.val());
                    }
                });
            copy.find("select").each(function () {
                var $field = $(this);
                $field.find(":selected").attr("selected", "selected");
            });
            copy.find("textarea").each(function () {
                // Fix for https://github.com/DoersGuild/jQuery.print/issues/18#issuecomment-96451589
                var $field = $(this);
                $field.text($field.val());
            });
        }
        // Get the HTML markup string
        var content = copy.html();
        // Notify with generated markup & cloned elements - useful for logging, etc
        try {
            options.deferred.notify('generated_markup', content, copy);
        } catch (err) {
            console.warn('Error notifying deferred', err);
        }
        // Destroy the copy
        copy.remove();
        if (options.iframe) {
            // Use an iframe for printing
            try {
                printContentInIFrame(content, options);
            } catch (e) {
                // Use the pop-up method if iframe fails for some reason
                console.error("Failed to print from iframe", e.stack, e.message);
                printContentInNewWindow(content, options);
            }
        } else {
            // Use a new window for printing
            printContentInNewWindow(content, options);
        }
        return this;
    };
})(jQuery);

'use strict';

var APP = (window.APP = window.APP || {});

APP.storeSearchResults = (function () {
    var selectors = {
        wrapper: '.store-search-results',
        locationForm: '.location-search__form',
        locationFormContainer: '.location-search',
        storeItems: '.store-item__wrapper',
        cta: '.cta-group',
        loadMore: '.js-store-item__cta .u-cta',
        noResultsClass: 'store-search-results--no-results',
        noResultsWithFiltersClass: 'store-search-results--no-results with-filter-applied',
        locationInput: '.location-search__form input#location',
        nextPagination: '.slick-next',
        prevPagination: '.slick-prev',
        paginationDots: '.js-career-dots',
        dot: '.js-dot',
        deliveryPartners: '.delivery-partner-teaser',
        deliveryPartnersNotFoundBanner: '.delivery-partner-teaser__not-found',
        deliveryPartnersInactiveBanner: '.delivery-partner-teaser__partner-inactive',
    };

    var distanceCutoff = [10, 25]; //technically how many stores show up
    var storesPerPage = 10;
    var originZip = '';
    var storeRadius;
    var filteredStores;
    var filteredStoresInitialCopy;
    var positionStartPagination = 0;

    var showNoStore = function (err) {
        if (APP.locationSearch.isDeliveryPage()) {
            $(selectors.deliveryPartners).addClass('u-hide');
            // $(selectors.deliveryPartnersInactiveBanner).addClass('u-hide');
            // $(selectors.deliveryPartnersNotFoundBanner).removeClass('u-hide');
            $("#location").parsley().removeError("deliveryPartnersNotFound", {updateClass: true});
            $("#location").parsley().addError("deliveryPartnersNotFound", {
                message: "Sorry, we're not able to find a Dunkin' Delivery partner within your radius. Please try another location.",
                updateClass: true
            });
        } else {
            if (err) {
                filteredStores = [];
                filteredStoresInitialCopy = [];
            }
            var classToAdd = APP.locationSearchFilter.isFilterApplied() ? selectors.noResultsWithFiltersClass : selectors.noResultsClass;
            $(selectors.wrapper).addClass('show');
            $(selectors.wrapper).addClass(classToAdd);
            $(selectors.storeItems).remove();
            $(selectors.wrapper).find(selectors.cta).eq(0).removeClass('js-show');
        }
    };

    var filterLogic = function (store, index) {
        return store.distance <= storeRadius && filterClosedStoresLogic(store);
    };

    var filterStores = function (stores) {
        var distanceCutoffLength = distanceCutoff.length;
        var filtered;
        for (var i = 0; i < distanceCutoffLength; i++) {
            storeRadius = distanceCutoff[i];
            filtered = $.grep(stores, filterLogic);
            if (filtered.length > 0) {
                if (APP.storeItem.isStoreSearchResult()) {
                    filtered = filtered.slice(0, 10);
                }
                return filtered;
            }
        }
        return false;
    };

    var filterClosedStoresLogic = function (store) {
        if (['3', '6', '7'].indexOf(store.operation_status_cd) != -1) {
            return APP.storeItem.isCareerSearchResult() ? isUnderConstructionStore(store) || isReadyToOpenStore(store) : false;
        } else {
            return true;
        }
    };

    var isUnderConstructionStore = function (store) {
        return store.dev_status == 'Under Construction';
    };

    var isReadyToOpenStore = function (store) {
        return store.dev_status == 'Ready to Open';
    };

    var filterStoresByAmenities = function (store) {
        if (APP.locationSearchFilter.isFilterApplied()) {
            var filters = APP.locationSearchFilter.getAppliedFilters();
            var hasMatchingFilters = true;
            $.each(filters, function (index, amenityKey) {
                var allAmenities = APP.store.getAllAmenitiesForFiltering();
                var amenityExistsInStore = store[amenityKey];

                if (!(!!amenityExistsInStore && allAmenities[amenityKey + '_' + amenityExistsInStore.toLowerCase()] == amenityKey)) {
                    hasMatchingFilters = false;
                    return false;
                }
            });
            return hasMatchingFilters;
        } else {
            return true;
        }
    };

    var initializeMap = function () {
        var totalStores = filteredStores.length;
        if (totalStores > storesPerPage) {
            totalStores = storesPerPage;
        }
        APP.googleMap.geocodeStoreMapMarkers(0, totalStores, filteredStores);
    };

    var hideExtraResults = function () {
        if (filteredStores.length > storesPerPage) {
            $(selectors.wrapper).find(selectors.storeItems).slice(storesPerPage).addClass('js-hide');
            //$(selectors.wrapper).find(selectors.cta).eq(0).addClass('js-show');
        } else {
            //$(selectors.wrapper).find(selectors.cta).eq(0).removeClass('js-show');
        }
    };

    var scrollToSticky = function () {
        var $locationSearchContainer = $(selectors.locationFormContainer);
        var $storeSearchResultsList = $('.store-search-results__list');
        var searchContainerOffset = $locationSearchContainer.offset().top;
        var globalNavHeight = $('.global-nav').height();
        $(window).on('scroll', function () {
            var windowPosition = $(window).scrollTop() + globalNavHeight;
            var mainContainerHeight = $('.store-search-results').height();
            var mainContainerOffset = $('.store-search-results').offset().top;
            var offset = $('.js-sticky').offset();
            var adjustmentBottom = windowPosition + mainContainerOffset - mainContainerHeight;
            var searchContainerHeight = $locationSearchContainer.height() + globalNavHeight;

            if ($(window).width() > 1024 && !$('.store-search-results').hasClass('store-search-results--no-results')) {
                if (searchContainerOffset < windowPosition) {
                    $locationSearchContainer.addClass('location-search--sticky');
                    $storeSearchResultsList.addClass('store-search-results__list--sticky');
                } else {
                    $locationSearchContainer.removeClass('location-search--sticky');
                    $storeSearchResultsList.removeClass('store-search-results__list--sticky');
                }
                if (offset.top < windowPosition || searchContainerOffset < windowPosition) {
                    $('.js-sticky').addClass('store-search-results__map--sticky');
                    $('.js-sticky > div').css({
                        top: searchContainerHeight + 'px',
                    });

                    if (mainContainerHeight < windowPosition + mainContainerOffset) {
                        $('.js-sticky > div').css({
                            top: '-' + adjustmentBottom + 'px',
                        });
                    }
                } else {
                    $('.js-sticky').removeClass('store-search-results__map--sticky');
                    $('.js-sticky > div').css('top', '0');
                }
            } else {
                $locationSearchContainer.removeClass('location-search--sticky');
                $('.js-sticky').removeClass('store-search-results__map--sticky');
                $('.js-sticky > div').css('top', '0');
            }
        });
    };

    var processData = function (response) {
        if ($(window).width() > 1024) {
            $(window).scrollTop(0);
        }
        var totalResults = response.storeAttributes ? response.storeAttributes.length : '';
        if (totalResults > 0) {
            originZip = response.storeAttributes[0].postal ? response.storeAttributes[0].postal : '';
            var stores = response.storeAttributes;
            //First level filter -- distance & closed stores
            filteredStores = filterStores(stores);
            filteredStoresInitialCopy = filteredStores.slice();
            if (APP.locationSearch.isDeliveryPage()) {
                processDeliveryPartnerData(response);
            } else if (APP.storeItem.isStoreSearchResult()) {
                APP.locationSearchFilter.isInitialized().done(function () {
                    applyAmenitiesFilterAndShowStores(response.searchOptions);
                });
            } else {
                applyAmenitiesFilterAndShowStores(response.searchOptions);
            }
        } else {
            showNoStore();
        }
    };

    var processDeliveryPartnerData = function (response) {
        if ($(selectors.locationInput).val() === '') {
            $(selectors.locationInput).val(originZip);
        }

        // $(selectors.deliveryPartnersNotFoundBanner).addClass('u-hide');
        if(response.deliveryPartners.length == 0){
            // $(selectors.deliveryPartnersInactiveBanner).removeClass('u-hide');
            $("#location").parsley().removeError("deliveryPartnersInactive", {updateClass: true});
            $("#location").parsley().addError("deliveryPartnersInactive", {
                message: "Dunkin' Delivery is not available in this area. Check back soon as we continue to expand.",
                updateClass: true
            });
        }
        else{
            // $(selectors.deliveryPartnersInactiveBanner).addClass('u-hide');
        }

        var $partners = $(selectors.deliveryPartners).removeClass('u-hide').find('.teaser-new__wrapper');
        $partners.each(function () {
            if (response.deliveryPartners.indexOf($(this).data('track')) > -1) {
                $(this).removeClass('notAvailable').find('a').html('<u>ORDER NOW</u>');
            } else {
                $(this).addClass('notAvailable').find('a').html('NOT AVAILABLE');
            }
        });
    };

    var applyAmenitiesFilterAndShowStores = function (searchOptions) {
        if (filteredStoresInitialCopy) {
            //Second level filter -- store amenities
            filteredStores = $.grep(filteredStoresInitialCopy, filterStoresByAmenities);
            bindStoresInMapAndPage(searchOptions);
        }
    };

    var bindStoresInMapAndPage = function (searchOptions) {
        loadPagination(filteredStores.length);

        if (filteredStores && filteredStores.length > 0) {
            $(selectors.wrapper).removeClass(selectors.noResultsWithFiltersClass);
            APP.storeItem.showStores(filteredStores);
            hideExtraResults();
            $(selectors.wrapper).addClass('show');
            initializeMap();
            if ($(selectors.locationInput).val() === '') {
                $(selectors.locationInput).val(originZip);
            }
        } else {
            showNoStore();
        }
    };

    var searchStore = function (e) {
        if ($(selectors.locationForm).parsley().isValid()) {
            e.preventDefault();
            APP.global.showLoader();
            positionStartPagination = 0;
            var searchTerm = $(this).find('#location').val();
            window.history.pushState(null, null, '?location=' + searchTerm);
            intializeSearch(searchTerm);
        }
    };

    // var loadResultsOnMap = function (noOfStores) {
    //     var bounds = L.latLngBounds();

    //     for (var i = 0; i < noOfStores; i++) {
    //         var latlng = {
    //             lat: filteredStores[nextStoreOnMap + i].fields.lat,
    //             lng: filteredStores[nextStoreOnMap + i].fields.lng,
    //         };

    //         var marker = L.marker([latlng.lat, latlng.lng], {
    //             icon: L.divIcon({
    //                 className: 'text-labels',
    //                 html: nextStoreOnMap + i + 1,
    //             }),
    //             zIndexOffset: 1000,
    //         });

    //         marker.addTo(window.map);
    //         bounds.extend([latlng.lat, latlng.lng]);
    //     }

    //     window.map.fitBounds(bounds);
    //     nextStoreOnMap = nextStoreOnMap + noOfStores;
    // };

    // var loadMoreResults = function (e) {
    //     e.preventDefault();
    //     var hiddenStores = $(selectors.wrapper).find(selectors.storeItems + '.js-hide');
    //     if (hiddenStores.length > storesPerPage) {
    //         loadResultsOnMap(storesPerPage);
    //         hiddenStores.slice(0, storesPerPage).removeClass('js-hide');
    //     } else {
    //         loadResultsOnMap(hiddenStores.length);
    //         hiddenStores.removeClass('js-hide');
    //         $(selectors.wrapper).find(selectors.cta).removeClass('js-show');
    //     }
    // };

    var intializeSearch = function (searchTerm) {
        APP.global.showLoader();
        APP.store
            .getStores(searchTerm)
            .done(processData)
            .fail(showNoStore)
            .always(function (response) {
                APP.global.hideLoader();
                $(selectors.wrapper).addClass('show');
            });
    };

    var nextPage = function () {
        var totalCareers = $('.store-item__wrapper').length;

        if (totalCareers > positionStartPagination) {
            var futureNextPage = positionStartPagination + 10;
            if (totalCareers > futureNextPage) {
                $(selectors.paginationDots).find('.slick-active').removeClass('slick-active').next().addClass('slick-active');
                positionStartPagination += 10;
            }
        }

        if (totalCareers > positionStartPagination) {
            var positionEndPagination = positionStartPagination + 10;

            $(selectors.wrapper).find(selectors.storeItems).addClass('js-hide');

            for (var x = positionStartPagination; x < positionEndPagination; x++) {
                $(selectors.wrapper).find(selectors.storeItems).eq(x).removeClass('js-hide');
            }

            APP.googleMap.geocodeStoreMapMarkers(positionStartPagination, positionEndPagination, filteredStores);

            var top = $(selectors.wrapper).offset().top;
            var nav = $('.js-global-nav').height();
            if (positionStartPagination !== 0) {
                if ($(window).width() > 1024) {
                    $(window).scrollTop(0);
                } else {
                    $(window).scrollTop(top - nav);
                }
            }
        }
    };

    var prevPage = function () {
        var positionEndPagination = positionStartPagination;

        if (positionStartPagination > 0) {
            positionStartPagination -= 10;
            $(selectors.wrapper).find(selectors.storeItems).addClass('js-hide');

            $(selectors.paginationDots).find('.slick-active').removeClass('slick-active').prev().addClass('slick-active');

            for (var x = positionStartPagination; x < positionEndPagination; x++) {
                $(selectors.wrapper).find(selectors.storeItems).eq(x).removeClass('js-hide');
            }

            APP.googleMap.geocodeStoreMapMarkers(positionStartPagination, positionEndPagination, filteredStores);

            var top = $(selectors.wrapper).offset().top;
            var nav = $('.js-global-nav').height();
            if ($(window).width() > 1024) {
                $(window).scrollTop(0);
            } else {
                $(window).scrollTop(top - nav);
            }
        }
    };

    var loadPagination = function (pages) {
        var dots = pages / 10;
        var li = '';

        if (dots > 0) {
            for (var x = 1; x < dots + 1; x++) {
                if (x === 1) {
                    li += '<li class="career-item__pagination-page js-dot slick-active" data-position="' + x + '"></li>';
                } else {
                    li += '<li class="career-item__pagination-page js-dot" data-position="' + x + '"></li>';
                }
            }

            $(selectors.paginationDots).html(li);
        }
    };

    var pageChange = function () {
        var position = $(this).attr('data-position');
        var startPag = 0;
        var endPag = position * 10;

        $(selectors.dot).removeClass('slick-active');
        $(this).addClass('slick-active');

        $(selectors.wrapper).find(selectors.storeItems).addClass('js-hide');

        if (position === 1) {
            positionStartPagination = 0;
        } else {
            startPag = position * 10 - 10;
            positionStartPagination = startPag;
        }

        for (var x = startPag; x < endPag; x++) {
            $(selectors.wrapper).find(selectors.storeItems).eq(x).removeClass('js-hide');
        }

        updatedStoresMap(startPag, endPag);

        var top = $(selectors.wrapper).offset().top;
        var nav = $('.js-global-nav').height();
        if ($(window).width() > 1024) {
            $(window).scrollTop(0);
        } else {
            $(window).scrollTop(top - nav);
        }
    };

    var bindEventsToUI = function () {
        $(selectors.locationForm).on('submit', searchStore);
        // $(selectors.wrapper).on('click tap', selectors.loadMore, loadMoreResults);
        $(selectors.wrapper).on('click tap', selectors.nextPagination, nextPage);
        $(selectors.wrapper).on('click tap', selectors.prevPagination, prevPage);
        $(selectors.wrapper).on('click tap', selectors.dot, pageChange);
        if (APP.locationSearch.isDeliveryPage()) {
            $(selectors.deliveryPartners).on('click', 'a', function (event) {
                if ($(this).closest('.teaser-new__wrapper').hasClass('notAvailable')) {
                    event.stopImmediatePropagation();
                    event.preventDefault();
                }
            });
        }
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('storeSearchResults'); */
    };

    var init = function (element) {
        //console.log('APP.storeSearchResults');
        bindEventsToUI();

        if (window.Cookies.get('wcmmode') !== 'edit') {
            var searchParam = APP.global.getURLParameter('location');

            if (searchParam !== null && searchParam !== '') {
                $(selectors.locationInput).val(decodeURIComponent(searchParam));
                $(selectors.locationForm).trigger('submit');
            } else {
                APP.global.showLoader();
                if (window.Cookies.get('DMA') !== undefined) {
                    intializeSearch(null);
                } else {
                    $(window).on('dma-created', function () {
                        intializeSearch(null);
                    });
                }
            }
            !APP.locationSearch.isDeliveryPage() ? scrollToSticky() : null;

            if(APP.locationSearch.isDeliveryPage()){
                $("#location").on('input', function(){
                    $(this).parsley().removeError("deliveryPartnersNotFound", {updateClass: true});
                    $(this).parsley().removeError("deliveryPartnersInactive", {updateClass: true});
                });
            }
        }
        //APP.global.resizeRouteList.push('storeSearchResults');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        filterClosedStoresLogic: filterClosedStoresLogic,
        isUnderConstructionStore: isUnderConstructionStore,
        isReadyToOpenStore: isReadyToOpenStore,
        filterStores: filterStores,
        bindOnResize: bindOnResize,
        applyAmenitiesFilterAndShowStores: applyAmenitiesFilterAndShowStores,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.storeItem = (function () {
    var selectors = {
        wrapper: '.store-item',
        address: '.js-store-address',
        addressLine1: '.js-address-line1',
        distance: '.js-store-distance',
        timings: '.js-store-timings',
        contacts: '.js-store-contacts',
        viewDetailsBtn: '.js-view-details-btn',
        phoneLabel: '.js-store-phone-label',
        phone: '.js-store-phone',
        faxLabel: '.js-store-fax-label',
        fax: '.js-store-fax',
        amenitiesTitle: '.js-store-amenities-title',
        amenities: '.js-store-amenities',
        showDetails: '.js-show-details',
        showAmenities: '.js-show-all-amenities',
        storeList: '.js-store-list',
        hidden: '.js-hidden',
        ctaApply: '.js-career-item__cta',
        careerNumber: '.js-store-number',
    };

    var storeDetailTemplate = {
        address:
            '' +
            "<div class='store-item__address--line1'>{address}</div>" +
            "<div class='store-item__address--line2'>{address2}</div>" +
            "<div class='store-item__address--line3'>{city}, {state} {postal}</div>",
        timings: '{time}',
        phone: '{phonenumber}',
        amenities:
            '' +
            "<li class='store-item__amenity'>" +
            "<span class='store-item__amenities__icon store-item__amenities__icon--{key}'></span>" +
            "<span class='store-item__amenities__caption'>{amenity}</span>" +
            '</li>',
    };

    var storeResultsTemplate = {
        address:
            '' +
            "<div class='store-item__address--line1'><a class='js-address-line1'>{address}</a></div>" +
            "<div class='store-item__address--line2'>{address2}</div>" +
            "<div class='store-item__address--line3'>{city}, {state} {postal}</div>",
        distance: '{distance} miles',
        timings: '{time}',
        timeFormat: '{hours}:{minutes}{dn}',
        phone: '{phonenumber}',
        fax: '{faxnumber}',
        amenities:
            '' +
            '<li>' +
            "<span class='store-item__amenities__icon store-item__amenities__icon--{key}'></span>" +
            "<span class='store-item__amenities__caption'>{amenity}</span>" +
            '</li>',
    };

    var careersResultsTemplate = {
        address:
            '' +
            "<span class='store-item__address--line1'>{address}</span><span class='store-item__address--coming-soon'>&nbsp;(Coming soon!)</span>" +
            "<div class='store-item__address--line2'>{address2}</div>" +
            "<div class='store-item__address--line3'>{city}, {state} {postal}</div>",
        distance: '{distance} miles',
        timings: '{time}',
        timeFormat: '{hours}:{minutes}{dn}',
        phone: '{phonenumber}',
        fax: '{faxnumber}',
        recordId: '{recordid}',
        btnApply: '{dbi_fee_hr_link}',
    };

    var template = $('#storeDetailTemplate');

    var desktopBreakpoint = 1200;

    // This is a sample Map Quest JSON Response to display the static UI in this component.
    var staticJSON = [
        {
            distance: 2,
            address: '51 East 34th St',
            address2: 'Hoboken University',
            city: 'New York',
            state: 'NY',
            postal: '10016',
            phonenumber: '212-481-2355',
            faxnumber: '212-481-2345',
            adv_ord: 'Y',
            curbside: 'Y',
            dunkincardenabled: 'Y',
            turbooven: 'Y',
            k_cup: 'Y',
            kosher: 'Y',
            wireless: 'Y',
            sun_hours: '07:00-00:00',
            mon_hours: '06:00-00:00',
            tue_hours: '06:00-00:00',
            wed_hours: '06:00-00:00',
            thu_hours: '06:00-00:00',
            fri_hours: '06:00-00:00',
            sat_hours: '07:00-00:00',
        },
    ];

    var staticJSONCareers = [
        {
            distance: 2,
            address: '51 East 34th St',
            address2: 'Hoboken University',
            city: 'New York',
            state: 'NY',
            postal: '10016',
            phonenumber: '212-481-2355',
            faxnumber: '212-481-2345',
            adv_ord: 'Y',
            curbside: 'Y',
            dunkincardenabled: 'Y',
            turbooven: 'Y',
            k_cup: 'Y',
            kosher: 'Y',
            wireless: 'Y',
            sun_hours: '07:00-00:00',
            mon_hours: '06:00-00:00',
            tue_hours: '06:00-00:00',
            wed_hours: '06:00-00:00',
            thu_hours: '06:00-00:00',
            fri_hours: '06:00-00:00',
            sat_hours: '07:00-00:00',
            applyUrl: '#',
        },
    ];

    var hideFields = function () {
        if ($(window).width() < desktopBreakpoint) {
            $(selectors.wrapper).find(selectors.hidden).hide();
        }
    };

    var bindClosestStoreData = function (response) {
        var searchMarkup = APP.store.getStoreDetailMarkup(response, storeDetailTemplate);
        var temp = template.clone();
        temp.find(selectors.address).html(searchMarkup.address);
        temp.find(selectors.timings).html(searchMarkup.storeTimings);
        temp.find(selectors.amenities).html(searchMarkup.amenities);
        temp.find(selectors.phone).html(searchMarkup.phone);
        temp.find(selectors.phone)
            .filter('a')
            .attr('href', 'tel:' + searchMarkup.phone.replace(/-/g, ''));
        temp.find(selectors.viewDetailsBtn).attr('href', APP.store.getStoreLocalPageURL(response[0]));
        var $li = $("<li class='store-item__wrapper'>");
        $li.attr('recordid', searchMarkup.recordId);
        $li.append(temp.html());
        $(selectors.storeList).html($li);
    };

    var bindStoreSearchData = function (response) {
        var searchMarkup = APP.store.getStoreResultsMarkup(response, storeResultsTemplate);
        var totalResults = searchMarkup.length;
        var finalMarkup = [];
        var $li;
        var temp;
        for (var i = 0; i < totalResults; i++) {
            temp = template.clone();
            temp.find(selectors.address)
                .html(searchMarkup[i].address)
                .find(selectors.addressLine1)
                .attr('href', APP.store.getStoreLocalPageURL(response[i]));
            temp.find(selectors.distance).html(searchMarkup[i].distance);
            temp.find(selectors.timings).html(searchMarkup[i].storeTimings);
            if (searchMarkup[i].phone !== '' && searchMarkup[i].phone !== '--') {
                temp.find(selectors.phone).html(searchMarkup[i].phone);
                temp.find(selectors.phone)
                    .filter('a')
                    .attr('href', 'tel:' + searchMarkup[i].phone.replace(/-/g, ''));
            } else {
                temp.find(selectors.phoneLabel).remove();
                temp.find(selectors.phone).remove();
            }
            if (searchMarkup[i].fax !== '' && searchMarkup[i].fax !== '--') {
                temp.find(selectors.fax).html(searchMarkup[i].fax);
            } else {
                temp.find(selectors.faxLabel).remove();
                temp.find(selectors.fax).remove();
            }
            temp.find(selectors.viewDetailsBtn).attr('href', APP.store.getStoreLocalPageURL(response[i]));
            temp.find(selectors.amenities).html(searchMarkup[i].amenities);
            var amenitiesCount = temp.find(selectors.amenities + ' li').length;
            if (amenitiesCount <= 3) {
                temp.find(selectors.showAmenities).remove();
            } else {
                temp.find(selectors.amenities + ' li')
                    .slice(3)
                    .addClass('js-hidden');
            }

            $li = $("<li class='store-item__wrapper'>").attr('id', response[i].recordId);
            $li.append(temp.html());
            finalMarkup.push($li);
        }
        $(selectors.storeList).html(finalMarkup);
        hideFields();

        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.LOCATION, APP.analytics.Events.CLICK, APP.analytics.EventLabels.ZIPCODE_SEARCH);
    };

    var bindCareerSearchData = function (response) {
        var searchMarkup = APP.store.getCarrerResultsMarkup(response, careersResultsTemplate);
        var totalResults = searchMarkup.length;
        var finalMarkup = [];
        var $li;
        var temp;
        for (var i = 0; i < totalResults; i++) {
            temp = template.clone();
            temp.find(selectors.careerNumber).html(i + 1);
            temp.find(selectors.address).html(searchMarkup[i].address);
            temp.find(selectors.distance).html(searchMarkup[i].distance);
            temp.find(selectors.timings).html(searchMarkup[i].storeTimings);
            if (searchMarkup[i].phone !== '' && searchMarkup[i].phone !== '--') {
                temp.find(selectors.phone).html(searchMarkup[i].phone);
                temp.find(selectors.phone)
                    .filter('a')
                    .attr('href', 'tel:' + searchMarkup[i].phone.replace(/-/g, ''));
            } else {
                temp.find(selectors.phoneLabel).remove();
                temp.find(selectors.phone).remove();
            }
            if (searchMarkup[i].fax !== '' && searchMarkup[i].fax !== '--') {
                temp.find(selectors.fax).html(searchMarkup[i].fax);
            } else {
                temp.find(selectors.faxLabel).remove();
                temp.find(selectors.fax).remove();
            }
            temp.find(selectors.viewDetailsBtn).hide();
            if (APP.storeSearchResults.isUnderConstructionStore(response[i]) || APP.storeSearchResults.isReadyToOpenStore(response[i])) {
                temp.find('.store-item__address--coming-soon').css('display', 'inline-block');
            }

            if (isValidURL(searchMarkup[i].dbi_fee_hr_link)) {
                temp.find(selectors.ctaApply).html(
                    '<a data-toggle="modal-external-links" class=\'u-cta  u-cta--primary\' href="' +
                        searchMarkup[i].dbi_fee_hr_link +
                        '">Apply Now</a>'
                );
            } else {
                if (APP.storeSearchResults.isUnderConstructionStore(response[i]) || APP.storeSearchResults.isReadyToOpenStore(response[i])) {
                    temp.find(selectors.ctaApply).html('<span class="career-item__note">This location will be opening soon</span>');
                } else {
                    temp.find(selectors.ctaApply).html('<span class="career-item__note">Inquire in the restaurant for opportunities</span>');
                }
                //temp.find(selectors.ctaApply).remove();
            }

            $li = $("<li class='store-item__wrapper'>").attr('id', response[i].recordId);

            $li.append(temp.html());
            finalMarkup.push($li);
        }
        $(selectors.storeList).html(finalMarkup);
        hideFields();

        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.LOCATION, APP.analytics.Events.CLICK, APP.analytics.EventLabels.ZIPCODE_SEARCH);
    };

    var isValidURL = function (str) {
        var pattern = new RegExp(
            '^(https?:\\/\\/)?' + // protocol
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + // domain name
                '((\\d{1,3}\\.){3}\\d{1,3}))' + // OR ip (v4) address
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + // port and path
                '(\\?[;&a-z\\d%_.~+=-]*)?' + // query string
                '(\\#[-a-z\\d_]*)?$',
            'i'
        ); // fragment locator
        return !!pattern.test(str);
    };

    var bindEventsToUI = function () {
        $(selectors.wrapper).on('click tap', selectors.showDetails, function (e) {
            e.preventDefault();
            var $wrapper = $(this)
                .toggleClass('js-active')
                .parents(selectors.wrapper + ' li');
            $wrapper.find(selectors.timings).slideToggle();
            $wrapper.find(selectors.contacts).slideToggle();
            $wrapper.find(selectors.amenitiesTitle).slideToggle();
            $wrapper.find(selectors.amenities).slideToggle();

            // GTM tag
            if ($(this).hasClass('js-active')) {
                APP.analytics.fireCategoryEvent(
                    APP.analytics.EventCategories.LOCATION,
                    APP.analytics.Events.CLICK,
                    APP.analytics.EventLabels.SHOW_DETAILS
                );
            }
        });
        $(selectors.wrapper).on('click tap', selectors.showAmenities, function (e) {
            e.preventDefault();
            var $wrapper = $(this)
                .toggleClass('js-active')
                .parents(selectors.wrapper + ' li');
            $wrapper
                .find(selectors.amenities)
                .find('li' + selectors.hidden)
                .toggle();
            var label = $(this).text();
            $(this).text($(this).data('alt-label'));
            $(this).data('alt-label', label);

            // GTM tag
            if ($(this).hasClass('js-active')) {
                APP.analytics.fireCategoryEvent(
                    APP.analytics.EventCategories.LOCATION,
                    APP.analytics.Events.CLICK,
                    APP.analytics.EventLabels.SHOW_DETAILS
                );
            }
        });
    };

    var bindOnResize = function () {
        var storeItem = $(selectors.wrapper + '.store-item--results');
        if ($(window).width() < desktopBreakpoint) {
            $(selectors.wrapper).find(selectors.hidden).hide(0);
            if (storeItem.find(selectors.showDetails).hasClass('js-active')) {
                storeItem.find(selectors.showDetails).removeClass('js-active');
                storeItem.find(selectors.timings).removeAttr('style');
                storeItem.find(selectors.contacts).removeAttr('style');
                storeItem.find(selectors.amenitiesTitle).removeAttr('style');
                storeItem.find(selectors.amenities).removeAttr('style');
            }
        } else {
            if (storeItem.find(selectors.showAmenities).hasClass('js-active')) {
                storeItem.find(selectors.showAmenities).removeClass('js-active');
            }
            $(selectors.wrapper).find(selectors.hidden).show(0);
        }
    };

    var init = function (element) {
        // console.log('APP.storeItem');
        var isCareersResult = $(selectors.wrapper).hasClass('career-item--results');
        var isStoreResult = $(selectors.wrapper).hasClass('store-item--results');

        if (isStoreResult) {
            bindStoreSearchData(staticJSON);
        } else if (isCareersResult) {
            bindCareerSearchData(staticJSONCareers);
        } else {
            bindClosestStoreData(staticJSON);
        }
        bindEventsToUI();
        APP.global.resizeRouteList.push('storeItem');
    };

    var showStores = function (response) {
        var isCareersResult = $(selectors.wrapper).hasClass('career-item--results');
        var isStoreResult = $(selectors.wrapper).hasClass('store-item--results');
        if (isStoreResult) {
            bindStoreSearchData(response);
        } else if (isCareersResult) {
            bindCareerSearchData(response);
        } else {
            bindClosestStoreData(response);
        }
    };

    var isStoreSearchResult = function () {
        return $(selectors.wrapper).hasClass('store-item--results');
    };

    var isCareerSearchResult = function () {
        return $(selectors.wrapper).hasClass('career-item--results');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        showStores: showStores,
        bindOnResize: bindOnResize,
        isStoreSearchResult: isStoreSearchResult,
        isCareerSearchResult: isCareerSearchResult,
        storeResultsTemplate: storeResultsTemplate,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.storeFindClosest = (function () {
    var $closestStore;

    var storeFound = function (response) {
        if (response.storeAttributes && response.storeAttributes.length > 0) {
            var filteredStores = $.grep(response.storeAttributes, APP.storeSearchResults.filterClosedStoresLogic).slice(0, 1);
            APP.storeItem.showStores(filteredStores);
            $closestStore.trigger('store-found');
        } else {
            storeNotFound();
        }
    };

    var storeNotFound = function () {
        $closestStore.trigger('store-not-found');
    };

    var bindEventsToUI = function () {};

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('storeFindClosest'); */
    };

    var getClosestStore = function () {
        $closestStore = $('.js-store-find-closest');
        var radius = $closestStore.data('radius');
        APP.store
            .getClosestStore(radius)
            .done(storeFound)
            .fail(storeNotFound)
            .always(function () {
                $closestStore.addClass('store-find-closest--show');
            });
    };

    var init = function (element) {
        // console.log('APP.storeFindClosest');
        if (window.Cookies.get('wcmmode') === 'edit') {
            return;
        }

        if (APP.googleMap.dmaCookieExists()) {
            getClosestStore();
        } else {
            $(window).on('dma-created', function () {
                getClosestStore();
            });
        }
        bindEventsToUI();
        //APP.global.resizeRouteList.push('storeFindClosest');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.storeCard = (function () {
    
    var $storeCard;
    
    var noStoreHandler = function () {
        $storeCard.find('.teaser__ctas').fadeIn();
    };
    
    var storeFoundHandler = function () {
        $storeCard.find('.store-card__details').fadeIn();
    };

    var bindEventsToUI = function () {
        $(window).on('store-not-found', $storeCard.find('.js-store-find-closest'), noStoreHandler);
        $(window).on('store-found', $storeCard.find('.js-store-find-closest'), storeFoundHandler);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('storeCard'); */
    };

    var init = function (element) {
        // console.log('APP.storeCard');
        $storeCard = $('.js-store-card');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('storeCard');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';
var APP = (window.APP = window.APP || {});
APP.productMenu = (function () {
    var defaults = {
        servletURL: '/bin/servlet/getMenuItems',
        storageKey: 'menu-items',
    };
    var variantClass = {
        asSubmenu: 'product-menu--as-submenu',
        asPageContent: 'product-menu--as-pagecontent',
    };
    var elemsRefs = {
        aemComponentRoot: {
            selector: '.product-menu',
            $elems: null,
        },
        vueInstanceRoot: {
            selector: '.product-menu__container-products',
            $elems: null,
        },
        productPagesRootPath: {
            selector: '.productPagesRootPath',
            $elems: null,
        },
    };
    var vueInstances = {
        submenuInstance: null,
        pagecontentInstance: null,
    };

    var getElemsReferrences = function () {
        elemsRefs.aemComponentRoot.$elems = $(elemsRefs.aemComponentRoot.selector);
        elemsRefs.productPagesRootPath.$elems = elemsRefs.aemComponentRoot.$elems.find(elemsRefs.productPagesRootPath.selector);
    };

    var createVueApp = function (menuItems) {
        Vue.directive('init-slick', {
            componentUpdated: function (el, binding, vnode) {
                if (vnode.context.isSubMenuVariant && !vnode.context.isProductsReady && binding.value != binding.oldValue) {
                    vnode.context.destroySlider(el);
                    vnode.context.initSlider(el);
                }
            },
        });

        Vue.component('product-menu', {
            props: ['menuItems', 'variant', 'viewAllProductsImage'],
            data: function () {
                var isSubMenuVariant = this.variant == variantClass.asSubmenu;
                return {
                    menuItems: this.menuItems,
                    selectedCategoryProducts: this.menuItems[0].sublist,
                    activeCategoryIndex: 0,
                    isProductsReady: true,
                    productsHideTimeout: 150,
                    isSubMenuVariant: isSubMenuVariant,
                };
            },
            methods: {
                showProducts: function (index, isMenuClick) {
                    if (isMenuClick) {
                        this.destroySlider(this.$refs.productsList);
                        this.initSlider(this.$refs.productsList);
                    } else if (this.activeCategoryIndex != index) {
                        this.isProductsReady = false;
                        setTimeout(
                            function () {
                                this.destroySlider(this.$refs.productsList);
                                this.setActiveCategoryProducts(index);
                                if (!this.isSubMenuVariant) {
                                    setTimeout(
                                        function () {
                                            this.isProductsReady = true;
                                        }.bind(this),
                                        this.productsHideTimeout
                                    );
                                }
                            }.bind(this),
                            this.productsHideTimeout
                        );
                    }
                },
                setActiveCategoryProducts: function (index) {
                    this.activeCategoryIndex = index;
                    this.selectedCategoryProducts = this.menuItems[this.activeCategoryIndex].sublist;
                },
                hideProducts: function () {
                    this.isProductsReady = false;
                },
                destroySlider: function (el) {
                    if ($(el).hasClass('slick-initialized')) {
                        $(el).slick('unslick');
                    }
                },
                initSlider: function (el) {
                    $(el)
                        .slick({
                            infinite: false,
                            slidesToShow: 5,
                            slidesToScroll: 3,
                            dots: false,
                            focusOnSelect: true,
                            lazyLoad: 'ondemand',
                        })
                        .find('.slick-slide')
                        .each(function () {
                            var $slide = $(this);
                            if ($slide.attr('aria-describedby') != undefined) {
                                $slide.removeAttr('aria-describedby');
                            }
                        });
                    setTimeout(
                        function () {
                            this.isProductsReady = true;
                        }.bind(this),
                        this.productsHideTimeout
                    );
                },
                getRelativePath: (function () {
                    var a;

                    return function (pagepath) {
                        if (!a) {
                            a = document.createElement('a');
                        }
                        a.href = pagepath;

                        if (window.MSInputMethodContext && document.documentMode) {
                            return '/' + a.pathname;
                        } else {
                            return a.pathname;
                        }
                    };
                })(),
            },
        });

        elemsRefs.aemComponentRoot.$elems.each(function () {
            var rootElem = $(this).find(elemsRefs.vueInstanceRoot.selector).get(0);
            var vueApp = new Vue({
                el: rootElem,
                data: {
                    menuItems: menuItems,
                    selectedCategoryProducts: menuItems[0].sublist,
                    activeCategoryIndex: 0,
                    isProductsReady: false,
                },
                methods: {
                    hideProducts: function () {
                        this.$refs.productMenuComp.isProductsReady = false;
                    },
                    showProductsOnMenuClick: function () {
                        this.$refs.productMenuComp.showProducts(null, true);
                    },
                },
            });

            if ($(this).hasClass(variantClass.asSubmenu)) {
                vueInstances.submenuInstance = vueApp;
            } else if ($(this).hasClass(variantClass.asPageContent)) {
                vueInstances.pagecontentInstance = vueApp;
            }
        });
    };

    var getMenuItems = function () {
        APP.global.showLoader();
        var deferred = new $.Deferred();
        var isMenuItemsDataAvailable = defaults.storageKey in sessionStorage;
        if (isMenuItemsDataAvailable) {
            deferred.resolve(JSON.parse(sessionStorage.getItem(defaults.storageKey)));
            APP.global.hideLoader();
        } else {
            $.ajax({
                url: defaults.servletURL,
                method: 'GET',
                data: {
                    rp: elemsRefs.productPagesRootPath.$elems.val(),
                },
            })
                .done(function (response) {
                    if (response.list) {
                        deferred.resolve(response.list);
                        sessionStorage.setItem(defaults.storageKey, JSON.stringify(response.list));
                    } else {
                        deferred.reject(response);
                        console.error('GetMenuItems Error ::', response);
                    }
                })
                .fail(function (error) {
                    deferred.reject(error);
                    console.error('GetMenuItems Error ::', error);
                })
                .always(function () {
                    APP.global.hideLoader();
                });
        }

        return deferred;
    };

    var getMenuItemsAndCreateApp = function () {
        getMenuItems().done(function (menuItems) {
            createVueApp(menuItems);
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            getElemsReferrences();
            getMenuItemsAndCreateApp();
        }
    };

    return {
        init: init,
        getMenuItems: getMenuItems,
        vueInstances: vueInstances,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.pdpContainer = (function () {
    var selector = {
        pdpContainer: '.pdp-container',
        pdpBanner: '.pdp-container__product-banner-wrapper',
        productBanner: '.product-banner',
    };

    var bindEventsToUI = function () {
        var $banner = $(selector.pdpBanner);
        var bannerHeight = $banner.outerHeight();

        $(window).on('scroll', function (e) {
            if (isDifferingNeeded()) {
            } else {
                applyParallaxScrolling($banner, bannerHeight);
            }
        });
        bindOnResize();
    };

    var bindOnResize = function () {
        $(window).resize(function () {
            adjustHeight();
        });
    };

    var isDifferingNeeded = function (threshold) {
        var $productBanner = $(selector.productBanner);
        var threshold = $productBanner.outerHeight() * 0.3;
        var enableOpacity = threshold > window.scrollY;

        if (threshold < window.scrollY) {
            $productBanner.addClass('product-banner__fixed');
        } else {
            $productBanner.removeClass('product-banner__fixed');
            $(selector.pdpBanner).css('opacity', '1');
        }

        return enableOpacity;
    };

    var applyParallaxScrolling = function ($banner, bannerHeight) {
        var scrollPercent = (bannerHeight - window.scrollY) / bannerHeight;
        if (scrollPercent >= 0) {
            if (!window.matchMedia('(min-width:767px) and (max-width: 1023px)').matches) {
                $banner.css('opacity', scrollPercent);
            }
        }
    };

    var adjustHeight = function () {
        var $productBannerWrapper = $(selector.pdpBanner);
        var productBannerHeight = $(selector.productBanner).outerHeight();
        $productBannerWrapper.css('height', productBannerHeight + 'px');
    };

    var addClassInBody = function () {
        $('body').addClass('pdp-page');
    };

    var init = function (element) {
        // console.log("APP.pdpContainer");
        addClassInBody();
        bindEventsToUI();
        adjustHeight();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.nutritionToggle = (function () {

    var bindEventsToUI = function () {
        $('.js-nutrition-toggle-link').click(function (e) {
            //$(this).toggleClass('is-active');
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('nutritionToggle'); */
    };

    var init = function (element) {
        // console.log('APP.nutritionToggle');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('nutritionToggle');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
"use strict";

var APP = (window.APP = window.APP || {});

APP.nutritionFilter = (function () {
  var dataUrl = "/bin/servlet/nutrition",
    pageLoad = true,
    nutritionAltText,
    mayContainFlag = false,
    sizeExist = false,
    allergens = ["eggs", "fish", "milk", "peanuts", "wheat", "soy", "treenuts", "sesame"],
    filters = ["DRP_EGG", "DRP_MEAT", "DRP_BLEND", "DRP_DAIRY", "DRP_FLAVOR", "DRP_CARRIER", "DRP_SWEET"];

  var bindEventsToUI = function (elem) {
    var $this = elem;
    $this.find("select").on("change", function () {
      var elem = $(this).closest(".nutrition");
      if ($(this).attr('id') === "variety") {
        pageLoad = true;
      } else {
        pageLoad = false;
      }
      loadData(elem);
    });

    $this.find("input:radio[name=size]").on("click", function () {
      var elem = $(this).closest(".nutrition");
      pageLoad = false;
      loadData(elem);
    });
  };

  var bindOnResize = function () {
    /* Don't forget to uncomment APP.global.resizeRouteList.push('nutritionFilter'); */
  };

  var init = function (element) {
    // console.log('APP.nutritionFilter');
    //bindEventsToUI();

    var nutrition = $(".nutrition");
    // if (window.Cookies.get('wcmmode') !== 'edit') {
    $.each(nutrition, function (index, item) {
      loadData($(item));
      bindEventsToUI($(item));
    });

    changeSizeLabelForADA();
    // }
    //APP.global.resizeRouteList.push('nutritionFilter');
  };

  var changeSizeLabelForADA = function(){
    $("#Small").attr("aria-label", "Small");
    $("#Medium").attr("aria-label", "Medium");
    $("#Large").attr("aria-label", "Large");
    $("#ExtraLarge").attr("aria-label", "Extra Large");
  };

  var loadData = function (elem) {
    var $this = elem,
      prodId = $this.find("#variety").val() || null,
      flavor = $this.find("#DRP_FLAVOR").val() || null,
      eggs = $this.find("#DRP_EGG").val() || null,
      carrier = $this.find("#DRP_CARRIER").val() || null,
      meat = $this.find("#DRP_MEAT").val() || null,
      blend = $this.find("#DRP_BLEND").val() || null,
      dairy = $this.find("#DRP_DAIRY").val() || null,
      sweet = $this.find("#DRP_SWEET").val() || null,
      size = null,
      isDDSmartEnabled = $this.data("isddsmart") || false;
    if (sizeExist) {
      size = $this.find("input:radio[name=size]:checked").length ? $this.find("input:radio[name=size]:checked").val() : null;
    }
    $.ajax({
      url: dataUrl,
      method: "GET",
      contentType: "application/x-www-form-urlencoded; charset=UTF-8",
      data: {
        service: pageLoad,
        productId: prodId,
        isDDSmartEnabled: isDDSmartEnabled,
        DRP_EGG: pageLoad ? null : eggs,
        DRP_CARRIER: pageLoad ? null : carrier,
        DRP_MEAT: pageLoad ? null : meat,
        DRP_SIZE: pageLoad ? null : size,
        DRP_BLEND: pageLoad ? null : blend,
        DRP_DAIRY: pageLoad ? null : dairy,
        DRP_SWEET: pageLoad ? null : sweet,
        DRP_FLAVOR: pageLoad ? null : flavor,
        _charset_: "UTF-8"
      },
      success: function (response) {
        if (!$.isEmptyObject(response.data)) {
          if (pageLoad) {
            checkSizeVisibility(response.data.metaInfo, $this);
            createFilters(response.data.metaInfo, $this);
          }
          checkDDsmartVisibility(response.data, $this);
          checkTableVisibility(response.data, $this);
          createTable(response.data, $this);
          setAllergens(response.data, $this);
        } else {
          noRecipeFound($this);
        }
      },
      error: function () {
        noRecipeFound($this);
      }
    });
  };

  var noRecipeFound = function ($this) {
    var nodatafound = {};
    if (pageLoad) {
      checkSizeVisibility(nodatafound, $this);
      createFilters(nodatafound, $this);
    }
    checkDDsmartVisibility(nodatafound, $this);
    createTable(nodatafound, $this);
    checkTableVisibility(nodatafound, $this);
    setAllergens(nodatafound, $this);
  };

  var checkSizeVisibility = function (data, elem) {
    var sizeValues = data.DRP_SIZE || [],
      $this = elem,
      radioBtns = ["Small", "Medium", "Large", "ExtraLarge"];

    if (sizeValues.length > 1) {
      $this.find(".nutrition-filter__size").show();
    } else {
      $this.find(".nutrition-filter__size").hide();
    }

    if (sizeValues.length) {
      sizeExist = true;
      for (var i = 0; i < sizeValues.length; i++) {
        sizeValues[i] = sizeValues[i].trim();
      }
      $.each(radioBtns, function (index, item) {
        if ($.inArray(item, sizeValues) === -1) {
          $this
            .find("#" + item.replace(/\s+/g, ""))
            .closest(".form-checkradio__item")
            .hide();
        } else {
          $this
            .find("#" + item.replace(/\s+/g, ""))
            .closest(".form-checkradio__item")
            .show();
          if (sizeValues[0] === item) {
            $this.find("#" + item.replace(/\s+/g, "")).attr("checked", "checked");
          }
        }
      });
    }
    //Check variety dropdwon visibility
    // if ($this.find("#variety").find("option").length > 1) {
    //   $this
    //     .find("#variety")
    //     .closest(".nutrition-filter__dropdown")
    //     .show();
    // } else {
    //   $this
    //     .find("#variety")
    //     .closest(".nutrition-filter__dropdown")
    //     .hide();
    // }
  };

  var checkDDsmartVisibility = function (data, elem) {
    var isSmart = data.isDDSmart,
      // Commented below code as requested in DDCOM-2140
      //calroies = data.calories,
      ddsClaim = data.ddsClaim,
      $this = elem;
    $this.find(".nutrition-table__nutrient-disclaimer").hide();
    $this.find(".nutrition-table__ddsmart-text,.nutrition-table__ddsmart-modal").hide();
    //$this.find('.nutrition-table__less-than').hide();
    if (isSmart === true) {
      $this.find(".nutrition-table__ddsmart-text,.nutrition-table__ddsmart-modal").show();
      $this
        .find(".nutrition-table__nutrient-disclaimer")
        .html(ddsClaim)
        .show();
    } else if (isSmart === false) {
      $this.find(".nutrition-table__ddsmart-text,.nutrition-table__ddsmart-modal").hide();
      $this.find(".nutrition-table__nutrient-disclaimer").hide();
    }
    // Commented below code as requested in DDCOM-2140
    /*if (calroies < 400) {
            $this.find('.nutrition-table__less-than').show();
        } else {
            $this.find('.nutrition-table__less-than').hide();
        }*/
  };

  var checkTableVisibility = function (data, elem) {
    var $this = elem;
    nutritionAltText = data.nutritionAltText;
    if (nutritionAltText === "" || nutritionAltText === null) {
      $this.find(".nutrition-facts__table tbody").show();
      $this.find(".nutrition-facts__table").show();
      $this.find(".nutrition-facts__recipe").hide();
      $this.find(".nutrition-facts__nutrition-alttext").hide();
    } else if (nutritionAltText === undefined) {
      $this.find(".nutrition-facts__table").hide();
      $this.find(".nutrition-facts__recipe").show();
      $this.find(".nutrition-facts__nutrition-alttext").hide();
    } else if (nutritionAltText !== null) {
      $this
        .find(".nutrition-facts__nutrition-alttext")
        .html(nutritionAltText)
        .show();
      $this.find(".nutrition-facts__table").show();
      $this.find(".nutrition-facts__table tbody").hide();
      $this.find(".nutrition-facts__recipe").hide();
    }
  };

  var createTable = function (data, elem) {
    var value,
      $this = elem,
      xmlVersionToRemove;
    if (pageLoad) {
      xmlVersionToRemove = "2019";//data.xmlFileVersion == "2019" ? "2020" : "2019";
      $this.find("[data-xmlversion='" + xmlVersionToRemove + "']").remove();
    }
    var tableRowValue = $this.find(".nutrition-facts__value, .ingredients__value, .ingredients__maycontain");
    //loop through all the values and get the key and get the corresponding value form the json
    $.each(tableRowValue, function (index, item) {
      value = $(item)
        .data("key")
        .replace(/{[^{}]+}/g, function (key) {
          var emptyVal;
          if (['{mayContain}', '{ingredientstmt}'].indexOf(key) != -1) {
            emptyVal = '';
          }
          else {
            emptyVal = '-';
          }
          return data[key.replace(/[{}]+/g, "")] || emptyVal;
        });
      //Check if caffeine row will be visible or not
      if ($(item).hasClass("caffeine") && value === "") {
        $(item)
          .closest("tr")
          .hide();
        $this.find(".nutrition-table__caffeine").hide();
      } else if ($(item).hasClass("caffeine") && value !== "") {
        $(item)
          .closest("tr")
          .show();
        $this.find(".nutrition-table__caffeine").show();
      } else if ($(item).hasClass("ingredients__maycontain") && (value === "" || value === undefined)) {
        mayContainFlag = false;
        $(item)
          .parent()
          .hide();
      } else if ($(item).hasClass("ingredients__maycontain") && value !== "") {
        mayContainFlag = true;
        $(item)
          .parent()
          .show();
      }
      //bind the value in html
      $(item).html(value);
    });
    // show all the values once they are populated
    hideEmptyBlocks();
    $this.find(".nutrition-facts__value").show();
  };

  var createFilters = function (data, elem) {
    var $this = elem,
      value,
      options,
      filterSelectBox;

    //Get the values for the filter and create dropdowns respectivily
    $.each(filters, function (index, item) {
      value = data[item];
      options = "";

      if (value instanceof Array) {
        options = createFilterOptions(value);
      }
      $this.find("#" + item).html(options);
      var isRoundedDropdown = $this.find("#" + item).hasClass('form-select--rounded-dropdown');
      filterSelectBox = isRoundedDropdown ? $this.find("#" + item).select2({
        dropdownCssClass: 'form-select--rounded-dropdown__options'
      }) : $this.find("#" + item).select2(); 

      if (filterSelectBox.selectElement) {
        filterSelectBox.refresh();
      }
      if (value && value.length > 1) {
        $this
          .find("#" + item)
          .closest(".nutrition-filter__dropdown")
          .show();
      } else {
        $this
          .find("#" + item)
          .closest(".nutrition-filter__dropdown")
          .hide();
      }
    });

    $('.nutrition-filter').css('display','flex');
  };

  var createFilterOptions = function (value) {
    var template = "";
    if (value.length) {
      $.each(value, function (index, item) {
        template += '<option value="' + item + '">' + item + "</option>";
      });
    }
    return template;
  };

  var setAllergens = function (data, elem) {
    var $this = elem,
      value,
      showNone = true,
      showDefault = true;

    // leave this in for now to assist in debugging nutrition.xml updates
    console.log("nutrition data: " + JSON.stringify(data, null, 4));

    // loop through all allergens and show/hide as appropriate
    $.each(allergens, function (index, item) {
      value = data[item];
      // console.log('allergen ' + item + ': ' + value);

      // if allergen is present
      if (value === "1") {
        $this
          .find(".icon-allergen-" + item)
          .parent()
          .addClass("show");
        showNone = false;
        showDefault = false;

        // if allergen is not present
      } else if (value === "0") {
        $this
          .find(".icon-allergen-" + item)
          .parent()
          .removeClass("show");
        showDefault = false;

        // we have insufficient data
      } else {
        $this.find(".ingredients__allergen").removeClass("show");
        showDefault = true;
      }
    });

    // no known allergens
    if (showNone && !showDefault) {
      $this
        .find(".icon-allergen-none")
        .parent()
        .addClass("show");
    } else {
      $this
        .find(".icon-allergen-none")
        .parent()
        .removeClass("show");
    }

    // uncertainty about allergens
    if (showDefault) {
      $this.find(".ingredients__allergen.default-text").show();
      $this
        .find(".icon-allergen-none")
        .parent()
        .removeClass("show");
    } else {
      $this.find(".ingredients__allergen.default-text").hide();
    }

    // if may contain is present dont show none icon
    if (mayContainFlag) {
      $this.find(".ingredients__allergen.default-text").hide();
      $this
        .find(".icon-allergen-none")
        .parent()
        .removeClass("show");
    }
  };

    var hideEmptyBlocks = function () {
        $(".nutrition-facts__table > .nutrition-fact__tableHeader  > tr").each(function (index, tr) {
            applyHiddenBlock(tr);
        });
        $(".nutrition-facts__table > .nutrition-facts__tableBody  > tr").each(function (index, tr) {
            applyHiddenBlock(tr);
        });
    };

    var applyHiddenBlock = function (tr) {
      var elmNutritionText = $(tr).find(".nutrition-facts__text");
      var elmNutritionAmount = $(tr).find(".nutrition-facts__amount");
    
      //remove hidden classes if any
      $(tr).removeClass("nutrition-facts__hide");
      $(elmNutritionAmount)
        .find(".nutrition-facts__value")
        .removeClass("nutrition-facts__hide");
    
      $(elmNutritionAmount)
        .find(".nutrition-facts__suffix")
        .removeClass("nutrition-facts__hide");
    
      var factText = $(elmNutritionText).find(".nutrition-facts__value").text();
      var factAmount = $(elmNutritionAmount).find(".nutrition-facts__value").text();
    
      if (factAmount == "-") {
        $(elmNutritionAmount)
          .find(".nutrition-facts__value")
          .addClass("nutrition-facts__hide");
        $(elmNutritionAmount)
          .find(".nutrition-facts__suffix")
          .addClass("nutrition-facts__hide");
      }
    
      if (factText == "-") {
        if (factAmount == "-" || factAmount == "") {
          $(tr).addClass("nutrition-facts__hide");
        }
      }
    };

  /**
   * interfaces to public functions
   */
  return {
    init: init,
    bindOnResize: bindOnResize
  };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.section = (function () {

    var bindEventsToUI = function () {

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('section'); */
    };

    var checkDMA = function() {

        // determine user's DMA
        var dmaCookie;
        dmaCookie = window.Cookies.get('DMA');

        // if not in edit mode, and the user's DMA is known
        if ( (dmaCookie !== undefined) && !APP.global.isEditMode() ) {
            var dmaSplit = dmaCookie.split(':');
            var userDMA = dmaSplit[3];
            var sectionsToCheck = $('.js-check-dma');

            console.log('user DMA is ' + userDMA);
            
            // run through each section with DMA settings
            $.each(sectionsToCheck, function() {
                var validList = $(this).data('validdmas') + '';
                var invalidList = $(this).data('invaliddmas') + '';

                // console.log('validList is ' + validList);
                // console.log('invalidList is ' + invalidList);

                // if valid DMAs have been specified, show for those and remove for others
                if ( validList !== undefined ) {
                    if( validList.indexOf(userDMA) >= 0 ) {
                        $(this).show();
                    } else {
                        $(this).parent('.aem-wrap--section').remove();
                    }
                }

                // if invalid DMAs have been specified, remove those
                // invalid always overrides valid if both are specified
                if ( invalidList !== undefined ) {
                    if( invalidList.indexOf(userDMA) >= 0 ) {
                        $(this).parent('.aem-wrap--section').remove();
                    }
                }
            });
        }
    };

    var init = function (element) {
        console.log('APP.section');

        checkDMA();
        bindEventsToUI();

        //APP.global.resizeRouteList.push('section');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.container = (function () {
    
	var init = function (element) {
		var $element = $(element);
		
		// Check if the given element is part of the personalization result to bind again the tagging
		if ($element.closest('.campaign').length > 0 && $element.closest('.target').length > 0) {
			var taggingCategory = $('.js-generalTagging').data('eventcategory');
		 	
		 	if (taggingCategory && taggingCategory !== '') {
		 		APP.analytics.bindGeneralCTATagging(taggingCategory, $element);
		 	}
		}
    };
    
    /**
     * interfaces to public functions
     */
    return {
        init: init
    };
    
}());
'use strict';

var APP = window.APP = window.APP || {};

APP.smallNav = (function () {
    
    var $body;
    var $smallNav;
    var $backBtn;
    var $languageDropDown;
    var $languagesList;
    var $lowContrastToggle;
    var $highContrastToggle;
    
    var toggleLanguage = function (e) {
        e.preventDefault();
        e.stopPropagation();
        $(this).toggleClass('is-active');
        $languagesList.slideToggle();

        $body.one('click touchend', function(){
            $languageDropDown.removeClass('is-active');
            $languagesList.slideUp();
        });
    };
    
    /*var signUpBack = function (e) {
        e.preventDefault();
        window.history.back();
    };*/

    var bindEventsToUI = function () {
        $languageDropDown.on('click', toggleLanguage);
        //$backBtn.on('click touch', signUpBack);

        $('.js-small-nav__dd-logo a').on('click', function() {
            $('img', $(this)).each(function() {
                var $this = $(this);
                if ($this.is(':visible')) {
                    APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, ($this.attr('alt') || 'Dunkin Donuts Logo'));
                    return false;
                }
            });
        });

        $('.small-nav__ribbon').on('click', function() {
            $('img', $(this)).each(function() {
                var $this = $(this);
                if ($this.is(':visible')) {
                    APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, ($this.attr('alt') || 'Perks Logo'));
                    return false;
                }
            });
        });
        
        $('.small-nav__xfinity').on('click', function() {
            $('img', $(this)).each(function() {
                var $this = $(this);
                if ($this.is(':visible')) {
                    APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, ($this.attr('alt') || 'Xfinity Logo'));
                    return false;
                }
            });
        });

        $('.small-nav__toggle a').on('click', function() {
            var $this = $(this);
            if ($this.is(':visible')) {
                APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, $this.text().trim());
                return false;
            }
        }); 

        

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('smallNav'); */
    };

    var init = function (element) {
        // console.log('APP.smallNav');
        $body = $('html, body');
        $smallNav = $('.small-nav');
        $backBtn = $smallNav.find('.js-signup-back');
        $languageDropDown = $smallNav.find('.js-language-dropdown');
        $languagesList = $smallNav.find('.js-languages');
        $lowContrastToggle = $smallNav.find('.js-low-contrast-toggle');
        $highContrastToggle = $smallNav.find('.js-high-contrast-toggle');
        
        if(APP.ada.getHighContrastMode()){
            $lowContrastToggle.addClass('is-active');
        } else {
            $highContrastToggle.addClass('is-active');
        }
        
        bindEventsToUI();
        //APP.global.resizeRouteList.push('smallNav');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());

'use strict';

var APP = window.APP = window.APP || {};

APP.smallNav = (function () {
    
    var $body;
    var $smallNav;
    var $backBtn;
    var $languageDropDown;
    var $languagesList;
    var $lowContrastToggle;
    var $highContrastToggle;
    
    var toggleLanguage = function (e) {
        e.preventDefault();
        e.stopPropagation();
        $(this).toggleClass('is-active');
        $languagesList.slideToggle();

        $body.one('click touchend', function(){
            $languageDropDown.removeClass('is-active');
            $languagesList.slideUp();
        });
    };
    
    /*var signUpBack = function (e) {
        e.preventDefault();
        window.history.back();
    };*/

    var bindEventsToUI = function () {
        $languageDropDown.on('click', toggleLanguage);
        //$backBtn.on('click touch', signUpBack);

        $('.js-small-nav__dd-logo a').on('click', function() {
            $('img', $(this)).each(function() {
                var $this = $(this);
                if ($this.is(':visible')) {
                    APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, ($this.attr('alt') || 'Dunkin Donuts Logo'));
                    return false;
                }
            });
        });

        $('.small-nav__ribbon').on('click', function() {
            $('img', $(this)).each(function() {
                var $this = $(this);
                if ($this.is(':visible')) {
                    APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, ($this.attr('alt') || 'Perks Logo'));
                    return false;
                }
            });
        });
        
        $('.small-nav__xfinity').on('click', function() {
            $('img', $(this)).each(function() {
                var $this = $(this);
                if ($this.is(':visible')) {
                    APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, ($this.attr('alt') || 'Xfinity Logo'));
                    return false;
                }
            });
        });

        $('.small-nav__toggle a').on('click', function() {
            var $this = $(this);
            if ($this.is(':visible')) {
                APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, $this.text().trim());
                return false;
            }
        }); 

        

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('smallNav'); */
    };

    var init = function (element) {
        // console.log('APP.smallNav');
        $body = $('html, body');
        $smallNav = $('.small-nav');
        $backBtn = $smallNav.find('.js-signup-back');
        $languageDropDown = $smallNav.find('.js-language-dropdown');
        $languagesList = $smallNav.find('.js-languages');
        $lowContrastToggle = $smallNav.find('.js-low-contrast-toggle');
        $highContrastToggle = $smallNav.find('.js-high-contrast-toggle');
        
        if(APP.ada.getHighContrastMode()){
            $lowContrastToggle.addClass('is-active');
        } else {
            $highContrastToggle.addClass('is-active');
        }
        
        bindEventsToUI();
        //APP.global.resizeRouteList.push('smallNav');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());

'use strict';

var APP = (window.APP = window.APP || {});

APP.interstitial = (function (Cookies) {
    var $doc;
    var $body;
    var $jsModalClose;
    var domainList = [];

    var setDomainList = function () {
        var elm = document.querySelectorAll('.interstitial');
        var len = elm.length;
        for (var i = 0; i < len; i++) {
            domainList.push(elm[i].getAttribute('data-domain'));
        }
    };

    var getWhiteLisDomains = function (element) {
        var $interstitial = $(element);

        if ($interstitial && $interstitial.length > 0) {
            setExternalLinks($interstitial.filter('#interstitial-whitelist').data('whitelist'));
        }
    };

    var setExternalLinks = function (data) {
        var allLinks = $('a[href *= "www."], a[href *= "http"]');
        var list = [];

        //for (var i = 0, len=data.length; i < len; i++) {
        //list.push('a[href*="' + data[i].value + '"]');
        //}

        //var whiteListedDomains = list.toString();
        //allLinks = allLinks.not(whiteListedDomains);
        //allLinks.attr('data-toggle', '#modal-external-links');

        //console.log('whiteListedDomains:- ' + whiteListedDomains);
        //console.log(allLinks);
        var isInWhiteList,
            linksLength = allLinks.length,
            whiteListLength = 0;
        if (data != undefined) {
            whiteListLength = data.length;
        }

        for (var j = 0; j < linksLength; j++) {
            isInWhiteList = false;

            for (var i = 0; i < whiteListLength; i++) {
                if (allLinks[j].host === data[i].value) {
                    isInWhiteList = true;
                }
            }

            if (!isInWhiteList) {
                var interstitialModal = $("[id='" + allLinks[j].host + "']");
                $(allLinks[j])
                    .attr('data-toggle', 'modal-external-links')
                    .attr('role', 'button')
                    .attr('aria-haspopup', 'dialog');
            }
        }
    };

    var bindEventsToUI = function () {
        $doc.on('click', '[data-toggle="modal-external-links"]', function (e) {
            e.preventDefault();
            //console.log(e);
            handleExternalLinks($(this).attr('data-toggle'), e.currentTarget.href, e.currentTarget.host);
        });
        //Open Register DD Card Redirection Modal
        $doc.on('click', '[data-track="Register a DD Card"]', function (e) {
            APP.modal.showModal(e, $('#register-dd-card-modal'));
        });
        $doc.on('click', '.interstitial .js-modal-close', closeModal);
        $doc.on('click', '.interstitial .modal__overlay', closeModal);
        $doc.on('keydown', handleEscapeKey);
        $('.js-modal-cancle').on('click', closeModal);
    };

    var handleEscapeKey = function (e) {
        if (e.keyCode === 27) {
            closeModal();
        }
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('interstitial'); */
    };

    var getModalByDomain = function (url, domainName) {
        var finaldomain = null;
        var isFullUrl = null;
        var isDomainSpecific = null;
        var genericDomain = null;

        isFullUrl = document.getElementById(url);
        isDomainSpecific = document.getElementById(domainName);

        if (isFullUrl) {
            finaldomain = isFullUrl;
        } else {
            if (isDomainSpecific) {
                finaldomain = isDomainSpecific;
            } else {
                if (domainName.indexOf('www') !== -1) {
                    genericDomain = domainName.replace('www', '*');

                    //console.log(domainName.indexOf('www') + 'genericDomain : ' + genericDomain);

                    finaldomain = document.getElementById(genericDomain);

                    //console.log(finaldomain);
                }
            }
        }

        /*for (var i = 0; i < domainList.length; i++) {
            if (url.indexOf(domainList[i]) !== -1) {
                counter = counter + 1;
                finaldomain = domainList[i];
            }
        }*/
        //console.log('finaldomain---' + finaldomain);
        return finaldomain;
    };

    var handleExternalLinks = function (dataToggle, url, domainName) {
        var modalId = getModalByDomain(url, domainName);
        var id = null;

        if (modalId) {
            id = $(modalId);
        } else {
            id = $(document.getElementById('*'));
        }

        //console.log($(id) + ' -----id----- ' + id.length);

        var externalDomain = domainName !== 'www.dunkindonuts.com' ? domainName : null;
        if (externalDomain !== null && Cookies.get(externalDomain) === undefined) {
            var checkBox = $(id).find('input[type="checkbox"]');

            checkBox.prop('checked', false);
            openModal(id);

            $(id)
                .find('.js-modal-accept')
                .off('click')
                .on('click', function (e) {
                    e.preventDefault();
                    if (checkBox.is(':checked')) {
                        Cookies.set(externalDomain, true, false);
                    }
                    closeModal();
                    window.open(url);
                });
        } else {
            closeModal();
            window.open(url);
            return true;
        }
    };

    var openModal = function (id) {
        $(id).removeClass('modal--hide').addClass('modal--show');
        //set focus to modal
        $('.js-modal-close').focus();
        $body.addClass('interstitial--on');
        $('.site-wrapper').attr('aria-hidden', 'true');
        trapFocus();
    };

    var closeModal = function (e) {
        if (e) {
            e.preventDefault();
        }
        $body.removeClass('interstitial--on');
        $('.modal.interstitial:visible').removeClass('modal--show').addClass('modal--hide');

        APP.analytics.fireCategoryEvent(
            APP.analytics.EventCategories.MANAGE_ACCOUNT,
            APP.analytics.Events.CLICK,
            'CANCEL'
        );
        $('.site-wrapper').attr('aria-hidden', 'false');
    };

    var trapFocus = function () {
        var focusableElements = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
        var modal = document.querySelector('.interstitial.modal');
        var firstFocusableElement = modal.querySelectorAll(focusableElements)[0];
        var focusableContent = modal.querySelectorAll(focusableElements);
        var lastFocusableElement = focusableContent[focusableContent.length - 1];

        document.addEventListener('keydown', function (e) {
            var isTabPressed = e.key === 'Tab' || e.keyCode === 9;
            if (!isTabPressed) {
                return;
            }
            if (e.shiftKey) {
                if (document.activeElement === firstFocusableElement) {
                    lastFocusableElement.focus();
                    e.preventDefault();
                }
            } else {
                if (document.activeElement === lastFocusableElement) {
                    firstFocusableElement.focus();
                    e.preventDefault();
                }
            }
        });

        firstFocusableElement.focus();
    };

    var init = function (element) {
        $doc = $(document);
        $body = $('body');
        $jsModalClose = $('.js-modal-close');
        setDomainList();
        getWhiteLisDomains(element);
        bindEventsToUI();
        // APP.global.resizeRouteList.push('interstitial');
        // console.log('APP.interstitial');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        handleExternalLinks: handleExternalLinks,
    };
})(window.Cookies);

$(function () {
    var $body = $('body');

    if (!$body.data('avoid-interstitial')) {
        $body.append('<div id="js-intersitial-main-wrapper"><div/>');

        $('#js-intersitial-main-wrapper').load(
            '/content/dd/en/system/interstitial/_jcr_content/content/interstitial.html',
            function (response, status, xhr) {
                if (status === 'success') {
                    APP.interstitial.init(response);
                }
            }
        );
    }
});

'use strict';
(function ($, $document) {
    var dialogSelector = '.cq-dialog';
    var titleName = '[name="./primaryCtaText"]'; // dialog field for file name autofill
	var titleNameSec = '[name="./secondaryCtaText"]'; // dialog field for file name autofill
   // var $multifield = $('.coral-Multifield');

   $document.on('dialog-ready', function () {
         $('.coral-Multifield').on('click', '.js-coral-Multifield-add', function (e) {
            var $dialog = $document.find(dialogSelector);
             if($dialog.find('.cq-dialog-header h2') && $dialog.find('.cq-dialog-header h2').text() === 'Interstitial Component Dialog'){
				$dialog.find(titleName).last().val('Continue');
             	$dialog.find(titleNameSec).last().val('Cancel');
             }
        });
    });

})(jQuery, jQuery(document));
'use strict';

var APP = (window.APP = window.APP || {});

APP.globalNav = (function () {
    var $parent = $('.js-global-nav-dropdown');
    var $parentTrigger = $('.global-nav__item a');
    var $linkToFocus = $('.js-global-nav-link');
    var $lastLink = $(
        '.js-global-nav-dropdown nav > div:last-of-type > div:last-of-type a:last-of-type,' +
            ".js-global-nav-dropdown nav > div:last-of-type > div:last-of-type input[type='submit']"
    );
    var $navDropdownOverlay = $('.dropdown-menu__container--overlay');
    var $highContrastCheckbox = $('.utility-bar__toggles input');

    var focusOffMenu = function (e) {
        if (!$(e.target).hasClass('js-global-nav-dropdown') && !$(e.target).parents().hasClass('js-global-nav-dropdown')) {
            $parentTrigger.removeClass('is-active');
            $parent.slideUp(function () {
                $(this).removeClass('is-visible').attr('aria-expanded', false);
            });
        }
    };

    var closeDropDownMenu = function (e) {
        //console.log(e);
        $('.js-global-nav-link').removeClass('is-active');
        $('.js-global-nav-dropdown').slideUp(function () {
            $(this).removeClass('is-visible').attr('aria-expanded', false);
        });
    };

    var showMenuOnClick = function (e) {
        var $this = $(this);
        var windowSizeLg = 1200;

        if ($(window).width() >= windowSizeLg) {
            e.preventDefault();
            e.stopPropagation();
            if (!$this.hasClass('is-active')) {
                $parent.each(function () {
                    $(this).removeClass('is-visible').hide();
                });

                $parentTrigger.removeClass('is-active');
                $this.addClass('is-active');

                switch (true) {
                    case $(this).hasClass('global-nav__perks'): {
                        if (APP.login.isDDPerksUser()) {
                            $this
                                .parent()
                                .find('.js-global-nav-dropdown.dropdown-menu--option5')
                                .slideDown()
                                .addClass('is-visible')
                                .attr('aria-expanded', true);
                        } else {
                            $this
                                .parent()
                                .find('.js-global-nav-dropdown.dropdown-menu--option4')
                                .slideDown()
                                .addClass('is-visible')
                                .attr('aria-expanded', true);
                        }
                        break;
                    }
                    case $(this).hasClass('product-menu__link'): {
                        APP.productMenu.vueInstances.submenuInstance.hideProducts();
                        $this
                            .parent()
                            .find('.js-global-nav-dropdown')
                            .slideDown({
                                duration: 400,
                                complete: function () {
                                    APP.productMenu.vueInstances.submenuInstance.showProductsOnMenuClick();
                                },
                            })
                            .addClass('is-visible')
                            .attr('aria-expanded', true);

                        break;
                    }
                    default: {
                        $this
                            .parent()
                            .find('.js-global-nav-dropdown')
                            .slideDown()
                            .addClass('is-visible')
                            .attr('aria-expanded', true);
                    }
                }
            } else {
                $this
                    .parent()
                    .find('.js-global-nav-dropdown')
                    .slideUp(function () {
                        $(this).removeClass('is-visible').attr('aria-expanded', false);
                    });

                $this.removeClass('is-active');
            }

            $('html, body').on('click touchend', focusOffMenu);

            //escape key
            $('html, body').keyup(function (e) {
                if (e.which === 27) {
                    closeDropDownMenu(e);
                }
            });
        }
    };

    var checkLoggedIn = function () {
        // dropdown DDPerks and username
        if (APP.login.isLoggedIn()) {
            var userJSON = APP.login.getUserInfo();
            $('.js-username').text(userJSON.firstName);
            $('.js-utility-bar-loggedOut').css('display', 'none');
            $('.js-utility-bar-loggedIn').css('display', 'flex');

            if (APP.login.isDDPerksUser()) {
                $('.js-global-nav-dropdown.dropdown-menu--option4 .dropdown-menu__container').hide();
                $('.js-global-nav-dropdown.dropdown-menu--option5 .dropdown-menu__container').show();

                $('.js-mobile-global-nav-ddperks').attr('href', $('.js-mobile-global-nav-ddperks').attr('data-perks-logged-in'));
            }
        } else {
            $('.js-global-nav-dropdown.dropdown-menu--option5 .dropdown-menu__container, .js-utility-bar-loggedIn').css(
                'display',
                'none'
            );
            $('.js-global-nav-dropdown.dropdown-menu--option4 .dropdown-menu__container, .js-utility-bar-loggedOut').css(
                'display',
                'block'
            );
        }
    };

    var highlightActiveMenu = function () {
        var linkToHighlight;
        var $links = $('.js-global-nav-link');
        var location = window.location.href;

        $links.each(function (e) {
            if ($(this).attr('data-group')) {
                var group = $(this).attr('data-group').split('|');

                for (var i = 0; i < group.length; i++) {
                    if (location.indexOf(group[i]) > -1) {
                        $(this).addClass('is-shown');
                    }
                }
            }
        });
    };

    var bindOnResize = function () {
        if ($('.js-alert-banner').length > 0) {
            $(window).resize(function () {
                var globalNavHeight = $('.global-nav').height();

                $('.js-main-content').css('padding-top', globalNavHeight);
            });
        }
        /* Don't forget to uncomment APP.global.resizeRouteList.push('globalNav'); */
    };

    var bindEventsToUI = function () {
        $('.js-mobile-menu-link').on('click touch', function (e) {
            e.preventDefault();
            $(this).toggleClass('is-active');
            $('.js-global-utility-bar').slideToggle();
            $('.js-global-menu').toggleClass('is-mobile-active').slideToggle();
            $('.js-global-nav').toggleClass('is-mobile-active');
            $('body').toggleClass('body--no-scroll');
        });

        // $('.js-global-nav')
        //     .not('.global-nav--edit')
        //     .headroom({
        //         // css classes to apply
        //         offset: $('.js-global-nav').outerHeight(),
        //         classes: {
        //             // when element is initialised
        //             initial: 'global-nav',
        //             // when scrolling up
        //             pinned: 'global-nav--pinned',
        //             // when scrolling down
        //             unpinned: 'global-nav--unpinned',
        //             // when above offset
        //             top: 'global-nav--top',
        //             // when below offset
        //             notTop: 'global-nav--not-top',
        //             // when at bottom of scoll area
        //             bottom: 'global-nav--bottom',
        //             // when not at bottom of scroll area
        //             notBottom: 'global-nav--not-bottom',
        //         },
        //     });

        //ADA on focus
        /* 
            escape should close all open menus
        */
        $('.js-signin-btn').on('click', function (e) {
            //Stop navigation to sign-in page from shell login page
            if (location.href.indexOf('shell-offer') > -1) {
                e.preventDefault();
                if ($(window).width() < 1200) {
                    $('.js-mobile-menu-link').trigger('click');
                }
                $('#email').focus();
            }
        });

        $linkToFocus.on('click touchend', showMenuOnClick);
        $lastLink.on('blur', focusOffMenu);

        if (APP.ada.getHighContrastMode()) {
            $highContrastCheckbox.prop('checked', true);
        } else {
            $highContrastCheckbox.prop('checked', false);
        }

        $('.js-language-dropdown').on('click touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();

            if ($(this).hasClass('is-active')) {
                $(this).removeClass('is-active');
                $('.js-languages').slideUp();
            } else {
                $(this).addClass('is-active');
                $('.js-languages').slideDown();
            }

            $('html, body').one('click touchend', function () {
                $('.js-language-dropdown').removeClass('is-active');
                $('.js-languages').slideUp();
            });
        });

        /* Fix Padding for Add Alert Banner*/
        var alertCookie = window.Cookies.get('alert-banner') ? true : false;
        if (!alertCookie) {
            if ($('.js-alert-banner').length > 0) {
                var alertBannerHeight = $('.js-alert-banner').height();
                var globalNav = $('.js-global-nav').height();
                var windowsWidth = $(window).width();

                var padding = 193.66;

                if (windowsWidth < 1200) {
                    padding = alertBannerHeight + globalNav;
                }

                $('.js-main-content').css('padding-top', padding);
            }

            $('.js-global-nav .js-alert-banner .js-accept-checkbox, .js-global-nav .js-alert-banner-close').on(
                'click',
                function () {
                    $('.js-main-content').removeAttr('style');
                }
            );
        }
        //Close sub-menu on overlay click
        $navDropdownOverlay.on('click touchend', function () {
            closeDropDownMenu();
        });
        //Close sub-menu if scrolling down
        var position = $(window).scrollTop();
        $(window).scroll(function () {
            var scroll = $(window).scrollTop();
            if (scroll > position && $(window).width() > 1200) {
                closeDropDownMenu();
            }
            position = scroll;
        });
    };

    var bindAnalyticsEvents = function () {
        // Logo analytics
        $('.global-nav__logo').on('click', function () {
            $('img', $(this)).each(function () {
                var $this = $(this);
                if ($this.is(':visible')) {
                    APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, $this.attr('alt'));
                    return false;
                }
            });
        });

        // main menu
        $('.global-nav__link').on('click', function () {
            var menuItemText = $('p.global-nav__header', $(this));
            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, menuItemText.html());
        });

        // submenu global nav analytics
        $('.global-nav-link a').on('click', function () {
            var $this = $(this);
            var submenuLabel = $this.data('track') || $this.attr('title');

            var menuParentContainer = $this.closest('li.global-nav__item');
            var parentMenuItemText = $('a.global-nav__link p.global-nav__header', menuParentContainer);

            var eventLabel = parentMenuItemText.html() + ':' + submenuLabel;
            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, eventLabel);
            return true;
        });

        // location search under location menu
        $('.js-global-nav-dropdown .location-search__submit input').on('click', function () {
            var $this = $(this);
            var eventLabel = $this.data('track') || $this.attr('value');

            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, eventLabel);
        });

        // perk analytics
        $('.global-nav__perks, .mobile-menu__perks').on('click', function () {
            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, APP.analytics.EventLabels.PERKS_TAB);
            return true;
        });

        // Promo tiles
        $('a.global-nav-promo-tile__link').on('click', function () {
            var $this = $(this);
            var clickedAnchorTitle = $this.attr('title');
            var tileText = $('.global-nav-promo-tile__header', $this).html();
            var tileSubHeaderText = $('.global-nav-promo-tile__subheader', $this).html();

            if (tileText) {
                tileText += ' ';
            }

            var eventLabel = tileText + tileSubHeaderText || clickedAnchorTitle;
            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV_PROMO, eventLabel);
        });

        // navigation toggle, mobile
        $('a.mobile-menu__menu').on('click', function () {
            var $this = $(this);
            var spanElement = $('span', $this);
            var eventLabel = spanElement.html(); // toggle menu

            if (!$this.hasClass('is-active')) {
                eventLabel = 'Toggle Cancel';
            }

            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.GLOBAL_NAV, eventLabel);
        });

        //----------- footer section -----------
        $('.footer__quick-links a').on('click', function (e) {
            var eventLabel = $(this).html();

            if (eventLabel && eventLabel !== '') {
                eventLabel = eventLabel.trim();
            }

            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.FOOTER, eventLabel);
        });

        $('.footer__social-link').on('click', function (e) {
            var imgEl = $('img', $(this));

            if (imgEl) {
                var eventLabel = imgEl.attr('alt') || $(this).attr('href') || 'social link missing alt text';
                APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.FOOTER, eventLabel);
            }
        });

        $('.footer__legal-link').on('click', function (e) {
            var eventLabel = $(this).html();

            if (eventLabel && eventLabel !== '') {
                eventLabel = eventLabel.trim();
            }

            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.FOOTER, eventLabel);
        });

        // back to top analytics
        $('.js-back-to-top a').on('click', function () {
            var eventLabel = $(this).html();
            if (eventLabel && eventLabel !== '') {
                eventLabel = eventLabel.trim();
            }

            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.BACK_TO_TOP, eventLabel);
        });

        // top nav links, high/low contrast toggles and sign in/out
        $('.utility-bar__toggle a, .utility-bar__welcome a').on('click', function () {
            var eventLabel = $(this).text();
            if (eventLabel && eventLabel !== '') {
                eventLabel = eventLabel.trim();
            }

            APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.TOP_NAV, eventLabel);
        });
    };

    var bindFooterLogosAnalyticsEvents = function () {
        // attaching analytics for footer partner teaser logos
        // unbind first as it could be  binded multiple times
        $('.footer__partners .teaser__link').unbind('click');
        $('.footer__partners .teaser__link').on('click', function (e) {
            var imgEl = $('img', $(this));

            if (imgEl) {
                var eventLabel = imgEl.attr('alt');
                APP.analytics.fireNavigationEvent(APP.analytics.NavigationActions.FOOTER, eventLabel);
            }
        });
    };

    var init = function (element) {
        // console.log('APP.globalNav');
        if (!APP.global.isEditMode()) {
            bindEventsToUI();
            bindAnalyticsEvents();
            highlightActiveMenu();
            checkLoggedIn();
            bindOnResize();
        }
        //APP.global.resizeRouteList.push('globalNav');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        bindFooterLogosAnalyticsEvents: bindFooterLogosAnalyticsEvents,
        checkLoggedIn: checkLoggedIn,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.cookiesPopup = (function (Cookies) {
    
	var init = function (element) {
		var COOKIES_CONSENT_NAME = 'cookieconsent';
		
		var cookieConsentValue = Cookies.get(COOKIES_CONSENT_NAME);
		var $element = $(element);
		var cookiesToDelete = $element.data('cookies-to-delete');
		
		// Check if the cookie consent message should be displayed
		if (cookieConsentValue === undefined || cookieConsentValue === '') {			
			window.cookieconsent.initialise({
				'type': 'opt-in',
				'layout': 'basic-header',
				'theme': 'dd',
				'window': '<div id="cookies-popup" role="dialog" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="interstitial modal modal--hide">' + 
						'<div class="interstitial__main {{classes}}">{{children}}</div>' + 
						'<div class="modal__overlay"></div>' + 
					'</div>',
				'position': 'bottom-right',
				'showLink': false,
				'elements': {
					'header': '<p class="interstitial__title">{{header}}</p>',
					'message': '<span id="cookieconsent:desc" class="interstitial__text" style="font-size: 14px;">{{message}}</span>',
					'dismiss': '<a aria-label="dismiss cookie message" tabindex="0" class="cc-btn cc-dismiss u-cta u-cta--secondary">{{dismiss}}</a>',
					'allow': '<a aria-label="allow cookies" tabindex="0" class="cc-btn cc-allow u-cta">{{allow}}</a>'
				},
				'compliance': {
					'opt-in': '<div class="cc-highlight interstitial__cta">{{allow}}{{dismiss}}</div>'
				},
				'content': {
					'header': $element.data('title'),
					'message': $element.data('text'),
					'allow': $element.data('accept-button-label'),
					'dismiss': $element.data('decline-button-label')
				},
				'revokeBtn': '<div class=cc-revoke></div>',
				'cookie': {
					'name': COOKIES_CONSENT_NAME,
					'domain': window.location.hostname,
					'expiryDays': 7300
				},
				'onPopupOpen': function() {
					$('#cookies-popup').removeClass('modal--hide').addClass('modal--show').show();
					$('body').addClass('interstitial--on');
				},
				'onStatusChange': function(status) {
					if (status === 'dismiss') {
						removeSiteCookies(cookiesToDelete);
					}
					
					$('body').removeClass('interstitial--on');
				}					
			});
		}
		
		// Check the cookie consent value to see if cookies should be cleared
		if (cookieConsentValue !== 'allow') {
			removeSiteCookies(cookiesToDelete);
		}
    };
    
    /**
     * Remove the site cookies when the user has decline the cookie management
     */
    var removeSiteCookies = function(cookiesToDelete) {
    	var cookiesRegexArray = [];
    	var existingCookiesJson = Cookies.getJSON();
    	var currentRegexExec;
    	
    	// Build the array of regex for the cookies to remove
    	for (var indexCookieName = 0; indexCookieName < cookiesToDelete.length; indexCookieName++) {
    		cookiesRegexArray.push(new RegExp(cookiesToDelete[indexCookieName].cookieName, 'ig'));
    	}
    	
    	// Check for the cookies that should be removed based on the configured regex
    	for (var cookieName in existingCookiesJson) {
    		if (cookieName && existingCookiesJson[cookieName]) {
    			for (var indexCookieRegex = 0; indexCookieRegex < cookiesRegexArray.length; indexCookieRegex++) {
    				currentRegexExec = cookiesRegexArray[indexCookieRegex].exec(cookieName);
    				
    				if (currentRegexExec && currentRegexExec.length > 0) {
    					// Remove the cookie
    					Cookies.remove(cookieName);
    					
    					// Reset the regex last index to avoid issues with the matching
    					cookiesRegexArray[indexCookieRegex].lastIndex = 0;
    					
    					break;
    				}
    			}
    		}
    	}
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init
    };
    
}(window.Cookies));
'use strict';

var APP = window.APP = window.APP || {};

APP.backToTop = (function () {
    var $backToTopTrigger;
    var $backToTopWrapper;
    var threshold = 2000; //height in pixels after which 'back to top' will appear on screen
    var lastScrollPosition = 0; //last pixel position for scroll
    var viewportWidth = $(window).width(); //current device's viewportWidth  
    var pinClass = 'back-to-top__pinned';

    var bindOnResize = function () {
        viewportWidth = $(window).width();
    };

    var bindEventsToUI = function () {
        $backToTopTrigger.on('click', function (event) {
            event.preventDefault();
            backToTop.apply(this, arguments);
        });

        $(window).on('scroll', function () {
            $backToTopWrapper.removeClass(pinClass);
            toggleBackToTopButton();
        });
    };

    var toggleBackToTopButton = APP.global.debounce(function() {
        var currentScrollPosition = $(window).scrollTop();
        if (viewportWidth > 768) {
            if (currentScrollPosition > threshold) {
                $backToTopWrapper.addClass(pinClass);
            } else {
                $backToTopWrapper.removeClass(pinClass);
            }
        } else {
            if (lastScrollPosition > currentScrollPosition && currentScrollPosition > threshold) {
                $backToTopWrapper.addClass(pinClass);
            } else {
                $backToTopWrapper.removeClass(pinClass);
            }
            lastScrollPosition = currentScrollPosition;
        }
    }, 100);

    var backToTop = function () {
        $('html, body').animate({
            scrollTop: 0
        }, 800);
    };

    var init = function (element) {
        // console.log('APP.backToTop');
        $backToTopTrigger = $('[data-action=\'backToTop\']');
        $backToTopWrapper = $backToTopTrigger.parent('.js-back-to-top');
        bindEventsToUI();
        APP.global.resizeRouteList.push('backToTop');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());

'use strict';

var APP = window.APP = window.APP || {};
var YT = {};
APP.youtube = (function () {

    var bindEventsToUI = function () {
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('youtube'); */
    };

    // to handle events when player is ready
    	var onPlayerReady = function (event) {
  	  //console.log('en player ready');
      //event.target.playVideo();  // autoplay
    };

    // listen for player events to track,  for now only when video "start" and "end" should be tracked
    	var onPlayerStateChange = function (event) {
    		var videoObj = event.target;
    		var videoData = videoObj.getVideoData();
    		var videoTitle = videoData.title;
    	
	    	switch (event.data) {
	        case YT.PlayerState.PLAYING:
	        		// only when playing starting the video
	            if (roundTime(videoObj) === 0) {
	            		//console.log('-- started '  + roundTime(videoObj));
	                APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.YOUTUBE, APP.analytics.Events.VIDEO_START, videoTitle);
	            }
	            break;
	        case YT.PlayerState.ENDED:
	        		//console.log('-- ended');
	        		APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.YOUTUBE, APP.analytics.Events.VIDEO_END, videoTitle);
	            break;
	    }
    };
    
    var roundTime = function (playerObj) {
        return Math.round(playerObj.getCurrentTime());
    };

    var init = function (element) {
        //console.log('APP.youtube');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('youtube');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        onPlayerReady: onPlayerReady,
        onPlayerStateChange: onPlayerStateChange
    };

}());


// creates the YT videos object and set the event handlers
function onYouTubeIframeAPIReady() {
  	//console.log(' ----- creating YT videos object);
  	$('.videoYoutube').each(function (index, value) { 
  		  var player = new YT.Player(this.id, {
  		  events: {
  		    'onReady': APP.youtube.onPlayerReady,
  		    'onStateChange': APP.youtube.onPlayerStateChange
  		  }
  		}); 
  	});
}

'use strict';

var APP = (window.APP = window.APP || {});

APP.vueInstanceWrapper = (function () {
    var init = function (el) {
        if (!APP.global.isEditMode()) {
            new Vue({
                el: el,
            });
        }
    };

    return {
        init: init,
    };
})();


'use strict';

var APP = window.APP = window.APP || {};

APP.textWithBackground = (function () {

    var checkSizing = function(e) {
        var containerHeight = $(this).outerHeight();
        var contentHeight = $(this).find('.text-with-background__content').outerHeight();
        var containerName = $(this).find('.teaser__title').text().trim();

        // TODO: Remove log pre-production; keep for testing for now
        // console.log( containerName + ': containerHeight ' + containerHeight + ', contentHeight ' + contentHeight);

        if (contentHeight > containerHeight) {
            $(this).css('min-height', contentHeight);

            // TODO: Remove log pre-production; keep for testing for now
            // console.log('>>> new height for ' + containerName + ' is ' + $(this).outerHeight() );
        }
    };

    var bindEventsToUI = function () {
        $.each( $('[data-action="textWithBackground"]') , checkSizing);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('textWithBackground'); */
        $.each( $('[data-action="textWithBackground"]') , checkSizing);
    };

    var init = function (element) {
        // console.log('APP.textWithBackground');
        bindEventsToUI();
        APP.global.resizeRouteList.push('textWithBackground');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';
var APP = (window.APP = window.APP || {});
APP.teaserNew = (function () {
    var elemsRefs = {
        wrapper: {
            selector: '.teaser-new__wrapper',
            $elems: null,
        },
        image: {
            selector: '.teaser-new__image',
            $elems: null,
        },
        content: {
            selector: '.teaser-new__content',
            $elems: null,
        },
        wrapper_parsys: {
            selector: '.teaser-new__wrapper-parsys',
            $elems: null,
        },
        wrapper_parsys_1: {
            selector: '.teaser-new__wrapper-parsys-1',
            $elems: null,
        },
    };

    var getImageHeight = function ($image) {
        return $image.outerHeight(true);
    };

    var getContentHeight = function ($content) {
        var height = 0,
            paddT = 0,
            paddB = 0,
            marT = 0,
            marB = 0;
        if ($content.length) {
            paddT = parseFloat($content.css('paddingTop').replace('px', ''));
            paddB = parseFloat($content.css('paddingBottom').replace('px', ''));
            marT = parseFloat($content.css('marginTop').replace('px', ''));
            marB = parseFloat($content.css('marginBottom').replace('px', ''));
            $content.children().each(function () {
                height += $(this).outerHeight(true);
            });
        }
        return height + paddT + paddB + marT + marB;
    };

    var getWrapperParsysHeight = function ($wrapperParsys) {
        var height = 0,
            paddT = 0,
            paddB = 0,
            marT = 0,
            marB = 0;
        if ($wrapperParsys.length) {
            paddT = parseFloat($wrapperParsys.css('paddingTop').replace('px', ''));
            paddB = parseFloat($wrapperParsys.css('paddingBottom').replace('px', ''));
            marT = parseFloat($wrapperParsys.css('marginTop').replace('px', ''));
            marB = parseFloat($wrapperParsys.css('marginBottom').replace('px', ''));
            $wrapperParsys.children().each(function () {
                height += $(this).outerHeight(true);
            });
        }
        return height + paddT + paddB + marT + marB;
    };

    var onTextResize = function () {
        elemsRefs.wrapper.$elems.each(function () {
            calculateAndSetWrapperHeight($(this));
            if ($(this).data('observe')) {
                observeDomMutation(this);
            }
        });
    };

    var calculateAndSetWrapperHeight = function ($wrapper) {
        var $image = $wrapper.find('> ' + elemsRefs.image.selector);
        var $content = $wrapper.find('> ' + elemsRefs.content.selector);
        var $wrapperParsys = $wrapper.find('> ' + elemsRefs.wrapper_parsys.selector);
        var $wrapperParsys_1 = $wrapper.find('> ' + elemsRefs.wrapper_parsys_1.selector);
        if ($image.find('img').length) {
            if ($image.find('img').get(0).complete) {
                //calculateIfPositionAbsolute($wrapper, $image, $content, $wrapperParsys, $wrapperParsys_1);
            } else {
                $image.find('img').on('load', function (e) {
                    calculateAndSetWrapperHeight($wrapper);
                    var $parentWrapper = $wrapper.parents(elemsRefs.wrapper.selector);
                    if ($parentWrapper.length) {
                        //calculateAndSetWrapperHeight($parentWrapper);
                    }
                });
            }
        }
    };

    var calculateIfPositionAbsolute = function ($wrapper, $image, $content, $wrapperParsys, $wrapperParsys_1) {
        if (
            $content.css('position') == 'absolute' ||
            $wrapperParsys.css('position') == 'absolute' ||
            $wrapperParsys_1.css('position') == 'absolute'
        ) {
            var imageHeight = getImageHeight($image);
            var contentHeight = getContentHeight($content);
            var wrapperParsysHeight = getWrapperParsysHeight($wrapperParsys);
            var wrapperParsys_1_Height = getWrapperParsysHeight($wrapperParsys_1);
            logHeightsInConsole($content, imageHeight, contentHeight, wrapperParsysHeight, wrapperParsys_1_Height);
            if (contentHeight + wrapperParsysHeight + wrapperParsys_1_Height > imageHeight) {
                $wrapper.css('height', contentHeight + wrapperParsysHeight + 'px');
                $content.css('height', 'auto');
                $wrapperParsys.css('height', 'auto');
                $wrapperParsys_1.css('height', 'auto');
            } else if (contentHeight + wrapperParsysHeight + wrapperParsys_1_Height <= imageHeight) {
                $wrapper.css('height', '');
                $content.css('height', '');
                $wrapperParsys.css('height', '');
                $wrapperParsys_1.css('height', '');
            }
        }
    };

    var addTextResizeEventHandler = function () {
        TextResizeDetector.addEventListener(onTextResize, null);
    };

    var initTextResizeDetector = function () {
        TextResizeDetector.TARGET_ELEMENT_ID = 'main-content';
        TextResizeDetector.USER_INIT_FUNC = addTextResizeEventHandler;
    };

    var getElemsRefs = function () {
        elemsRefs.wrapper.$elems = $(elemsRefs.wrapper.selector);
    };

    var adjustHeightOnComponentLoad = function (el, isTargetedComponent) {
        if (isTargetedComponent) {
            var $wrapper = $(el).find(elemsRefs.wrapper.selector);
            elemsRefs.wrapper.$elems.push($wrapper.get(0));
            setTimeout(function () {
                calculateAndSetWrapperHeight($wrapper);
                if ($wrapper.data('observe')) {
                    observeDomMutation($wrapper.get(0));
                }
            }, 100);
        } else {
            onTextResize();
        }
    };

    var logHeightsInConsole = function ($content, imageHeight, contentHeight, wrapperParsysHeight, wrapperParsys_1_Height) {
        if (APP.global.isDebugMode()) {
            var title = $content.find('.teaser-new__title').text().trim();
            var subTitle = $content.find('.teaser-new__subtitle').text().trim();
            var text = $content.find('.teaser-new__text').text().trim();
            console.group(title || subTitle || text || 'Empty Content');
            console.log('Image Height:', imageHeight);
            console.log('Content Height:', contentHeight);
            console.log('Wrapper Parsys Height:', wrapperParsysHeight);
            console.log('Wrapper Parsys-1 Height:', wrapperParsys_1_Height);
            console.groupEnd();
        }
    };

    var moveStyleElement = function (el, isTargetedComponent) {
        var $body = $('body');
        var $style;
        if (isTargetedComponent) {
            var $el = $(el);
            $style = $el.find('#' + $el.data('resid'));
            $body.append($style.remove());
        } else {
            elemsRefs.wrapper.$elems.each(function () {
                $style = $(this).next();
                $body.append($style.remove());
            });
        }
    };

    var observeDomMutation = function (targetNode) {
        var observer = new MutationObserver(function (mutationList, observer) {
            setTimeout(function () {
                calculateAndSetWrapperHeight($(mutationList[0].target).closest(elemsRefs.wrapper.selector));
            }, 100);
        });
        var config = {
            attributes: true,
            childList: true,
            subtree: true,
            attributeFilter: ['class', 'style'],
            characterData: false,
        };
        observer.observe(targetNode, config);
    };

    var init = function (el, isTargetedComponent) {
        if (!APP.global.isEditMode()) {
            getElemsRefs();
            moveStyleElement(el, isTargetedComponent);
            // adjustHeightOnComponentLoad(el, isTargetedComponent);
            // initTextResizeDetector();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.tabs = (function () {
    var $tabComponent;
    var $tabNavigation;
    var $tabContent;
    var $tabHeaderLink;

    var changeTab = function (e) {
        var isLinkOnlyVariant = $(this).closest('.js-tabs').hasClass('tabs--link-only');
        if (!isLinkOnlyVariant) {
            var $this = $(this);
            var currentItem = $this.parent('li');
            var isNotActive = currentItem.hasClass('js-active') ? false : true;
            if (isNotActive) {
                var $parentComponent = $this.parents('.js-tabs');
                var tabIndex = currentItem.index();
                $parentComponent.find('.js-navigation li').removeClass('js-active');
                $parentComponent.find('.js-tab-content').removeClass('js-active').eq(tabIndex).addClass('js-active');
                $parentComponent.find('.js-tab-header').removeClass('js-active').eq(tabIndex).addClass('js-active');
                currentItem.addClass('js-active');
            }
            // e.preventDefault();
        }
    };

    var bindEventsToUI = function () {
        $tabNavigation.on('click tap', 'a', changeTab);
        $tabContent.on('click tap', 'a', function (e) {
            var hash = this.hash;
            if (hash) {
                // e.preventDefault();
                $tabNavigation
                    .find('[href="' + hash + '"]')
                    .trigger('click')
                    .focus();
            }
        });
        $tabHeaderLink.on('click tap', function (e) {
            e.preventDefault();
            var $this = $(this);
            $this.toggleClass('js-active');
            $('[data-tabcontent=' + $this.attr('href') + ']').toggleClass('js-active');
        });
        $(window).on('hashchange', scrollToHashSection);
    };

    var scrollToHashSection = function () {
        if (location.hash) {
            var $tabLink = $tabComponent.find('.tabs__link').filter('[href="' + location.hash + '"]');

            if ($tabLink.length) {
                $tabLink.trigger('click');
            }
        }
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('tabs'); */
    };

    var addInitialActiveClass = function () {
        var url = location.href;
        $tabComponent.each(function () {
            var isLinkOnlyVariant = $(this).hasClass('tabs--link-only');
            if (isLinkOnlyVariant) {
                $(this)
                    .find('.tabs__tab')
                    .each(function () {
                        var $anchor = $(this).find('a');
                        var groups = $anchor.attr('data-group');
                        if (groups) {
                            var matchArr = APP.global.matchWords(location.href, groups.split('|'));
                            if (matchArr.length > 0) {
                                $(this).addClass('js-active');
                            }
                        } else {
                            var isMatchingURL = url.indexOf($anchor.attr('href')) != -1;
                            if (isMatchingURL) {
                                $(this).addClass('js-active');
                            }
                        }
                    });
            } else {
                if (location.hash && location.hash != '#') {
                    $(this)
                        .find('.tabs__tab')
                        .find('[href="' + location.hash + '"]')
                        .trigger('click');
                } else {
                    $(this).find('.tabs__tab').eq(0).find('.tabs__link').trigger('click');
                }
            }
        });
    };

    var openParentTabOfHashElement = function () {
        var $hashElem = $(location.hash);
        var tabLinkHash = $hashElem.closest('[data-tabcontent]').attr('data-tabcontent');
        $hashElem
            .closest('.js-tabs')
            .find('.js-navigation')
            .find('[href="' + tabLinkHash + '"]')
            .trigger('click');
    };

    var init = function (element) {
        // console.log('APP.tabs');
        $tabComponent = $('.js-tabs');
        $tabNavigation = $tabComponent.find('.js-navigation');
        $tabContent = $tabComponent.find('.js-tab-content');
        $tabHeaderLink = $tabComponent.find('.js-tab-header');

        bindEventsToUI();
        addInitialActiveClass();
        //APP.global.resizeRouteList.push('tabs');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        openParentTabOfHashElement: openParentTabOfHashElement,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.rewardItem = (function () {

    var bindEventsToUI = function () {
        $('.js-reward-print').on('click touch', function(e){
            e.preventDefault();
            window.print();
            return false;
        });

        $('.js-main-content').on('click', '.js-modal-close, .js-modal:not(.modal--processing) .js-modal-close, .js-modal:not(.modal--processing) .modal__overlay',function(e){
        		var $modalParent = $(this).parent();
        		var eventLabel = $modalParent.find('.js-modal-title').text();
            APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel + ':Cancel');
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('rewardItem'); */
    };

    var init = function (element) {
        // console.log('APP.rewardItem');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('rewardItem');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());

'use strict';

var APP = window.APP = window.APP || {};

APP.revtraxIframe = (function () {

    var bindEventsToUI = function () {
        var $this = $('.js-revtrax');
        var height = $this.data('desktop-height');

        if($(window).width() < 1080) {
            height = $this.data('mobile-height');
        } 
        $this.css('height', height);
    };

    var init = function () {
        bindEventsToUI();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.relatedLinks = (function () {

    var bindEventsToUI = function () {

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('relatedLinks'); */
    };

    var init = function (element) {
        // console.log('APP.relatedLinks');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('relatedLinks');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';
(function ($, $document) {
    var dialogSelector = '.cq-dialog';
    var titleName = '[name="./headline"]'; // dialog field for file name autofill
 
    $document.on('dialog-ready', function () {
        var $dialog = $document.find(dialogSelector);
        if( $dialog.find(titleName).length !== 0 && $dialog.find(titleName).val().trim() === '' ){
            $dialog.find(titleName).val('Related Links');
        }
    });
 
})(jQuery, jQuery(document));
'use strict';
var APP = (window.APP = window.APP || {});

APP.promoCode = (function () {
    var vueApp;

    var servletUrl = '/bin/servlet/processactivity';

    var payloadObj = {
        promo: null,
    };

    var createVueApp = function () {
        vueApp = new Vue({
            el: $('.promo-code__form').get(0),
            data: {
                currentView: null,
                views: {
                    promoCodeEnter: {
                        name: 'promoCodeEnter',
                    },
                    promoCodeSuccess: {
                        name: 'promoCodeSuccess',
                    },
                },
                formAlertMsg: '',
            },
            created: function () {
                this.currentView = this.views.promoCodeEnter;
            },
            methods: {
                promoCodeFormSubmit: function (event) {
                    APP.global.removeError();
                    this.formAlertMsg = '';
                    if ($(this.$refs.promoCodeForm).parsley().isValid()) {
                        event.preventDefault();
                        payloadObj.promo = this.$refs.promoCodeForm.elements.promoCodeInput.value;
                        APP.global.postFormData(
                            servletUrl,
                            payloadObj,
                            function (response) {
                                vueApp.formAlertMsg = 'Promo Code Accepted!';
                                vueApp.currentView = vueApp.views.promoCodeSuccess;
                                if (APP.carouselPromo.isInitialized()) {
                                    APP.carouselPromo.getOfferts();
                                }
                            },
                            function (jqXHR) {
                                var errorCode = jqXHR.responseJSON.error.code;
                                var errorMessage = jqXHR.responseJSON.error.message;
                                vueApp.formAlertMsg = errorMessage;
                                if (['APP5045', 'APP5046', 'APP5047', 'APP5048'].indexOf(errorCode) != -1) {
                                    $(vueApp.$refs.promoCodeForm.elements.promoCodeInput).parsley().addError('promoCodeError', {
                                        message: errorMessage,
                                    });
                                    setTimeout(function () {
                                        $(vueApp.$refs.promoCodeForm.elements.promoCodeInput)
                                            .parsley()
                                            .removeError('promoCodeError');
                                    }, 5000);
                                } else {
                                    APP.global.getErrorMsg(jqXHR, $(vueApp.$refs.promoCodeForm));
                                }
                            }
                        );
                    }
                },
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            createVueApp();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.perksDashboard = (function () {
    var $slider = '',
        sliderAmountTablet = '',
        sliderAmountDesktop = '';

    var reviewItemTemplate = '';

    var noneRewardsTemplate =
        '<div class="reward-item reward-item--none js-reward-none" data-action="rewardItem"><div class="reward-item__point-container reward-item--coffee"><p class="reward-item__points js-reward-item-points"></p></div><h4 class="reward-item__title js-reward-item-title">Youre only <strong></strong> away from your next Free Beverage.</h4></div>';

    var modalTemplate = '';

    var bindEventsToUI = function () {
        $('body').on('click touch', '.js-reward-print', function (e) {
            e.preventDefault();
            $('.js-dashboard-section-modals .modal__content').print({ globalStyles: true });
            // https://github.com/DoersGuild/jQuery.print
            // window.print();
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('dashboardSection'); */
    };

    var init = function (element) {
        // console.log('APP.dashboardSection');
        $slider = $('.js-dashboard-slider');
        sliderAmountTablet = $slider.attr('data-tablet-slides');
        sliderAmountDesktop = $slider.attr('data-desktop-slides');
        bindEventsToUI();
        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;
        if (!isEditMode) {
            getAllCertificates();
        }
        //APP.global.resizeRouteList.push('dashboardSection');
    };

    var getAllCertificates = function () {
        var data = {
            service: 'getAllCertificates',
        };
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/loyalty',
            data: JSON.stringify(data),
            success: function (response) {
                console.log('getAllCertificates : ' + response);
                createReviewItemTemplate(response.data);
                APP.global.hideLoader();
            },
            error: function (jqXHR) {
                //APP.global.getErrorMsg(jqXHR, $addressForm);
                APP.global.hideLoader();
            },
            dataType: 'json',
            contentType: 'application/json',
        });
    };

    var createReviewItemTemplate = function (data) {
        console.log('createReviewItemTemplate');

        var count = 0;

        if (data.certificateList) {
            $.each(data.certificateList, function (index, item) {
                reviewItemTemplate = $('.reward-item__template .reward-item')[0].outerHTML;
                $slider.append(reviewItemTemplate);
                var $curReviewItem = $($slider.find('.reward-item')[count]);
                var path = $slider.attr('data-dampath');
                $curReviewItem.find('.js-review-item-img').attr('src', path + item.strCertificateImage + '.svg');
                $curReviewItem.find('.js-review-item-title').html(item.strCertificateName);
                $curReviewItem.find('.js-review-item-date').html('Expires: ' + item.strExpiryDate);
                $curReviewItem
                    .find('.js-review-item-link')
                    .attr('data-modal', item.strCertificateImage + '-' + count)
                    .attr('title', item.strCertificateName);
                createModalTemplate($curReviewItem, item, count);
                count++;
            });
        }

        console.log('count');

        if (count === 0) {
            var userInfoCookie = APP.cookie.getUserInfo();
            $slider.append(noneRewardsTemplate);
            $slider.find('.js-reward-none .js-reward-item-points').html(200 - userInfoCookie.loyaltyPoints);
            $slider.find('.js-reward-none .js-reward-item-title strong').html(200 - userInfoCookie.loyaltyPoints + ' points');
        } else {
            createSlider($slider);
        }
    };

    var createModalTemplate = function ($curReviewItem, item, i) {
        var $modalLists = $('.js-dashboard-section-modals');
        modalTemplate = $('.reward-item__template .js-modal')[0].outerHTML;
        $modalLists.append(modalTemplate);
        var $modal = $($modalLists.find('.js-modal')[i]);
        $modal.attr('id', $curReviewItem.find('.js-review-item-link').attr('data-modal'));
        $modal.find('.js-modal-title').html(item.strCertificateName);
        $modal.find('.js-modal-subtitle').html(item.strCertificateDesc);
        $modal.find('.js-modal-exp').html('Expires: ' + item.strExpiryDate);
        $modal.find('.js-modal-disclaimer').html(item.strCertificateFinePrint);

        // set certificate number to QR code url, if not certificate number, then qr code is not shown
        var googleQRURL = $modal.find('.js-modal-qrcode').html();
        if (item.strCertificateNumber && item.strCertificateNumber !== '') {
            $modal.find('.js-modal-qrcode').html(googleQRURL.replace('dataCode', item.strCertificateNumber));
            $modal.find('.js-modal-qr-text').html(item.strCertificateNumber);
        } else {
            $modal.find('.js-modal-qrcode').html('');
        }
    };

    var createSlider = function () {
        $slider.slick({
            dots: true,
            infinite: false,
            slidesToShow: parseInt(sliderAmountDesktop),
            slidesToScroll: parseInt(sliderAmountDesktop),
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: parseInt(sliderAmountTablet),
                        slidesToScroll: parseInt(sliderAmountTablet),
                    },
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1,
                    },
                },
            ],
        });
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.modal = (function () {
    var isAnimationRunning = false;
    var $document;

    var handleEscapeKey = function (e) {
        var isProcessingModal = $('.js-modal.modal--show').hasClass('modal--processing');
        if (e.keyCode === 27 && !isProcessingModal) {
            closeModal();
        }
    };

    var closeModal = function (e, $modal) {
        if (!isAnimationRunning) {
            if (e) {
                e.preventDefault();
            }
            isAnimationRunning = true;
            var $this = $(this) ? $(this) : $modal;
            var parentModal = $this.parents('.js-modal');
            if (parentModal.length > 0) {
                if (isPreventModalClose(parentModal)) {
                    return false;
                }
                parentModal.removeClass('modal--show');
                setTimeout(function () {
                    parentModal.hide(0);
                    isAnimationRunning = false;
                    $modal.trigger('modal-close');
                }, 1000); // Hide modal after completion of animation

                $modal = parentModal;
            } else {
                var openModal = $document.find('.js-modal.modal--show');
                if (isPreventModalClose(openModal)) {
                    return false;
                }
                openModal.removeClass('modal--show');
                setTimeout(function () {
                    openModal.hide(0);
                    isAnimationRunning = false;
                    $modal.trigger('modal-close');
                }, 1000); // Hide modal after completion of animation

                $modal = openModal;
            }
            $('body').removeClass('modal--show body--no-scroll');
        }
    };

    var isPreventModalClose = function (modalElem) {
        return modalElem.hasClass('modal--prevent-closing');
    };

    var showModal = function (e, $modal, disaleAnimation) {
        if (e) {
            e.preventDefault();
        }
        if (isUserAllowed($modal)) {
            if (disaleAnimation) {
                isAnimationRunning = false;
            }

            if (!isAnimationRunning) {
                isAnimationRunning = true;
                var $targetModal = $(this).data('modal') ? $('#' + $(this).data('modal')) : $modal;
                $targetModal.show(0).addClass('modal--show');
                setTimeout(function () {
                    isAnimationRunning = false;
                }, 1000); // Animation stops after 1second
                $('body').addClass('modal--show');
                if ($targetModal.find('.modal__container--fullScreenOnMobile').length) {
                    $('body').addClass('body--no-scroll');
                }
            }
        }
    };

    var checkModal = function (e) {
        e.preventDefault();
        var $targetModal = $('#' + $(this).attr('data-modal'));
        if ($targetModal.hasClass('modal--show')) {
            closeModal(e, $targetModal);
        } else {
            showModal(e, $targetModal);
        }
    };

    var bindEventsToUI = function () {
        $document.on('click', '.js-modal:not(.modal--processing) .js-modal-close, .js-modal:not(.modal--processing) .modal__overlay', closeModal);
        $document.on('keydown', handleEscapeKey);
        $document.on('click tap', 'a[data-modal]', checkModal);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('modal'); */
    };

    var isUserAllowed = function ($modal) {
        switch ($modal.data('user_state')) {
            case 'logged-in': {
                return APP.login.isLoggedIn();
            }
            case 'not-logged-in': {
                return !APP.login.isLoggedIn();
            }
            case 'club-dunkin': {
                return window.Cookies.get('dlt_st') ? true : false;
            }
            case 'dd-perks': {
                return window.Cookies.get('dlt_st') ? false : true;
            }
            default: {
                return true;
            }
        }
    };

    var handleAutomaticModalOpening = function () {
        var $modals = $('.js-modal').filter('[data-auto_open]');
        $modals.each(function () {
            var $modal = $(this);
            var pageNames = $modal.data('auto_open_pages') ? $modal.data('auto_open_pages') : '';
            if (pageNames && APP.global.matchPagePathNames(location.pathname, pageNames.split('|')).length > 0) {
                var timeout = $modal.data('auto_open_timeout') ? $modal.data('auto_open_timeout') : 0;
                var isOncePerSession = $modal.data('auto_open_once');
                if (isOncePerSession) {
                    var cookieName = $modal.data('auto_open_cookie');
                    if (!window.Cookies.get(cookieName)) {
                        setTimeout(function () {
                            showModal(null, $modal);
                            if (isUserAllowed($modal)) {
                                if (cookieName == 'enrollment_popup') {
                                    window.dataLayer = window.dataLayer || [];
                                    window.dataLayer.push({
                                        event: 'view_modal',
                                        modal_type : 'promotion',
                                        modal_name: 'Amazing Rewards',
                                    });
                                    $modal.on('click', '.u-cta.u-cta--primary', function(){
                                        window.dataLayer = window.dataLayer || [];
                                        window.dataLayer.push({
                                            'event' : 'modal_promotions_click',
                                            'link_name' : 'Sign Up'
                                        });
                                    });
                                    $modal.on('click', '.u-cta.u-cta--secondary', function(){
                                        window.dataLayer = window.dataLayer || [];
                                        window.dataLayer.push({
                                            'event' : 'modal_promotions_click',
                                            'link_name' : 'Learn More'
                                        });
                                    });
                                }
                                window.Cookies.set(cookieName, true);
                            }
                        }, timeout);
                    }
                } else {
                    setTimeout(function () {
                        showModal(null, $modal);
                    }, timeout);
                }
            }
        });
    };

    var init = function (element) {
        // console.log('APP.modal');
        $document = $(document);
        bindEventsToUI();
        if (APP.global.isEditMode()) {
            $('.js-modal').addClass('modal--edit');
        }
        if (!APP.global.isEditMode()) {
            handleAutomaticModalOpening();
        }
        //APP.global.resizeRouteList.push('modal');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        showModal: showModal,
        closeModal: closeModal,
    };
})();

'use strict';
(function ($, $document) {
    var dialogSelector = '.cq-dialog';
    var titleName = '[name="./closeButtonText"]'; // dialog field for file name autofill
 
    $document.on('dialog-ready', function () {
        var $dialog = $document.find(dialogSelector);
        if( $dialog.find(titleName).length !== 0 && $dialog.find(titleName).val().trim() === '' ){
            $dialog.find(titleName).val('Close Modal');
        }
    });
 
})(jQuery, jQuery(document));
'use strict';

var APP = window.APP = window.APP || {};

APP.imageFallingEffect = (function () {

    var effect = function() {
        var $elementEffect = $('.js-settings');
        var $imageFallingElement = $('.js-image-falling-effect');
        var effectCount = $elementEffect.length;

        var active = $imageFallingElement.attr('data-active');
        var timer = $imageFallingElement.attr('data-timer') ? $imageFallingElement.attr('data-timer') : 'unlimited';
        var round = ($imageFallingElement.attr('data-round') === 'true');
        var shadow = ($imageFallingElement.attr('data-shadow') === 'true');

        if( active === 'true' ){
            for(var x = 0; x < effectCount; x++){
                var flakeCount = $elementEffect.eq(x).attr('data-count') ? $elementEffect.eq(x).attr('data-count') : '1';
                var flakeColor = $elementEffect.eq(x).attr('data-color') ? $elementEffect.eq(x).attr('data-color') : '#ffffff';
                var flakeIndex = $elementEffect.eq(x).attr('data-index') ? $elementEffect.eq(x).attr('data-index') : '999999';
                var minSize = $elementEffect.eq(x).attr('data-minSize') ? $elementEffect.eq(x).attr('data-minSize') : '1';
                var maxSize = $elementEffect.eq(x).attr('data-maxSize') ? $elementEffect.eq(x).attr('data-maxSize') : '25';
                var minSpeed = $elementEffect.eq(x).attr('data-minSpeed') ? $elementEffect.eq(x).attr('data-minSpeed') : '1';
                var maxSpeed = $elementEffect.eq(x).attr('data-maxSpeed') ? $elementEffect.eq(x).attr('data-maxSpeed') : '5';
                var image = $elementEffect.eq(x).attr('data-image') ? $elementEffect.eq(x).attr('data-image') : '';

                var options = {
                    flakeCount : parseInt(flakeCount),
                    flakeColor : flakeColor,
                    flakeIndex: parseInt(flakeIndex),
                    minSize : parseInt(minSize),
                    maxSize : parseInt(maxSize),
                    minSpeed : parseInt(minSpeed),
                    maxSpeed : parseInt(maxSpeed),
                    round : round, // makes the snowflakes rounded if the browser supports it.
                    shadow : shadow, // gives the snowflakes a shadow if the browser supports it.
                    image : image
                };

                $(document).snowfall(options);
            }

            if(timer !== 'unlimited'){
                var setTimer = timer * 1000;
                
                setTimeout(
                    function(){
                        $('.snowfall-flakes').fadeOut(function(){
                            $(document).snowfall('clear');
                        });        
                }, setTimer);
            }

        }
        
    };

    var bindEventsToUI = function () {

    };

    var bindOnResize = function () {

    };

    var init = function (element) {
        //console.log('APP.imageFallingEffect');
        bindEventsToUI();
        effect();
    };
    
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.hiddenMessageJS = (function () {
    var $msg_container = '';
    var $section = '';
    var $class = '';
    var $newDiv = '';
    var $cookie_name = '';
    var $registeredCookie = '';
    var $flag = false;
    var $msg_wrp = '';

    var bindEventsToUI = function () {
        showHiddenMessage($cookie_name);
    };

    var setCookie = function (name, value, expired) {
        if (!expired) {
            expired = 31;
        }

        var expireDate = new Date();
        expireDate.setDate(expireDate.getDate() + expired);

        document.cookie = name + '=' + escape(value) + '; expires=' + expireDate.toGMTString() + '; path=/';
    };

    var deleteCookie = function (name) {
        setCookie(name, null);
        document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/';
    };

    var showHiddenMessage = function ($cookie_name) {
        $registeredCookie = window.Cookies.get($cookie_name);

        if ($registeredCookie && $registeredCookie == 'true') {
            $newDiv = $newDiv.html($content);
            setTimeout(function () {
                $section = $($section);
                if ($section.length) {
                    if ($section.hasClass('teaser-new__wrapper')) {
                        $section = $section.parent();
                    }
                    $newDiv.prependTo($section);
                }
            }, 2500);

            // Apply only for new users registered
            setTimeout(function () {
                if ($('.dashboard-new-user').length > 0) {
                    $msg_wrp = $('.dashboard-new-user').parent().siblings();
                    $msg_wrp = $msg_wrp.find('.responsive-image__img').css({ height: 330 + 'px' });
                }
            }, 2500);

            setTimeout(function () {
                $newDiv.slideToggle();
            }, 2500);

            deleteCookie($cookie_name);
            //setCookie($cookie_name,false);
        }
    };

    var init = function (element) {
        $msg_container = $('.hidden__msg__container');
        $section = '.' + $msg_container.attr('data-section');
        $class = $msg_container.attr('data-class');
        $cookie_name = $msg_container.attr('data-cookie');
        $content = $msg_container.html();
        $newDiv = $('<div>').attr({ class: $class + ' hidden-message-js' });
        bindEventsToUI();
    };
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        setCookie: setCookie,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.hero = (function () {
    var $defaultDropDownState;
    var $body;
    var dropDownList = '.js-dropdown-list';
    var selectedOption = 'selected-option';
    var menuShowing = 'menu-showing';
    var heroDropDown = '.js-dropdown';
    var $dropDownArrow;
    var $window;
    
    var bindEventsToUI = function () {
        $.each( $('.hero') , checkSizing);

        $defaultDropDownState.unbind().on('click', function (e) {
            e.preventDefault(); 
            $(dropDownList).slideToggle();
            $dropDownArrow.toggleClass(menuShowing);
        });
        
        $body.on('click', function(e) {
            var $curElem = ''; 
            if (!$(e.target).is('li.is-heading')) {
                $curElem = $(e.target);
                if($curElem.parents(heroDropDown).length === 0) {
                    $(dropDownList).hide();
                    $dropDownArrow.removeClass(menuShowing);
                }
                if($curElem.parents(dropDownList).length > 0) {
                    $('.js-dropdown-list li').removeClass(selectedOption);
                    $curElem.parent('li').addClass(selectedOption);
                    $('.js-selected-dropdown-option').html($curElem.html());
                    $dropDownArrow.removeClass(menuShowing);
                    $(dropDownList).hide();
                }
            } 
        });
    };

    var checkSizing = function(e) {
        var containerHeight = $(this).outerHeight();
        var contentHeight = $(this).find('.teaser').outerHeight();
        var heroImage = $(this).find('.hero__image .responsive-image__img');
        var containerName = $(this).find('.teaser__title').text().trim();

        // TODO: Remove log pre-production; keep for testing for now
        // console.log( containerName + ': containerHeight ' + containerHeight + ', contentHeight ' + contentHeight);

        //heroImage.css('min-height', '0');

        if (contentHeight > containerHeight) {
            $(this).addClass('hero--long-text');
            contentHeight += 70;
            heroImage.css('min-height', contentHeight);

            // TODO: Remove log pre-production; keep for testing for now
            // console.log('>>> new height for ' + containerName + ' hero is ' + $(this).outerHeight() );
        }
    };

    var setDefaultbyUrl = function(){
        var currentPagePath = location.pathname;
        var shortUrl = currentPagePath.replace('/content/dd', '');
        var options = $('.js-dropdown-list').find('[href="'+shortUrl+'"]');
        if(options.length  < 1){
			options = $('.js-dropdown-list').find('[href="'+currentPagePath+'"]');
        }
        if(options.length){
            $('.js-dropdown-list li').removeClass('is-selected selected-option');
            options.closest('li').addClass('is-selected selected-option');
            $('.js-selected-dropdown-option').html($('.is-selected.selected-option a').html());
        }
    };

    var bindOnResize = function () {
        $.each( $('.hero') , checkSizing);
    };

    var init = function (element) {
        // console.log('APP.hero');
        $defaultDropDownState = $('.js-default-dropdown-state');
        $body = $('body');
        $dropDownArrow = $('.js-dropdown-arrow');
        $window = $(window);
        bindEventsToUI();
        var defaultSelectedOption = $('.js-dropdown-list li.is-selected');
        if( defaultSelectedOption.length >0 ) {
            defaultSelectedOption.addClass(selectedOption);
            $('.js-selected-dropdown-option').html(defaultSelectedOption.find('a').html()); 
        }
        setDefaultbyUrl();        
        APP.global.resizeRouteList.push('hero');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());

'use strict';

var APP = window.APP = window.APP || {};

APP.giftcardCarousel = (function () {

    var bindEventsToUI = function () {
        $('.js-card-carousel').slick({
            centerMode: true,
            slidesToShow: 5,
            slidesToScroll: 1,
            centerPadding: '0px',
            arrows: true,
            responsive: [{
                breakpoint: 1023,
                settings: {
                    slidesToShow: 1,
                    centerMode: false
                }
            }]
        }); 

        // Had to create my own dots because slidesToShow
        $('.js-card-carousel-dot').on('click touch', function(e){
            e.preventDefault();
            var slide = $(this).parent().index();
            $('.js-card-carousel').slick('slickGoTo', slide);        
        });

        $('.js-card-carousel').on('afterChange', function(event, slick, currentSlide) {
            $('.js-card-carousel-dot.slick-active').removeClass('slick-active');
            $('.js-card-carousel-dot').parent()
                .eq(currentSlide)
                .find('.js-card-carousel-dot')
                .addClass('slick-active'); 
        });

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('cardCarousel'); */
    };

    var init = function (element) {
        // console.log('APP.giftcardCarousel');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('cardCarousel');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.flavorKey = (function () {
    var config;
    var cache;
    var defaults = {
        flavorKey: '.js-flavor-key',
        flavorKeyButton: '.js-flavor-key-button',        
        flavorKeyData: '.js-panel'
    };
    var bindEventsToUI = function () {       
        cache.$flavorKeyButton.on('click', function () {
            var $this = $(this);
            $this.toggleClass('active');
            $this.next().toggleClass('flavor-key__open-state').slideToggle();
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('flavorKey'); */
    };

    var init = function (element, params) {
        console.log('APP.flavorKey');
        // bindEventsToUI();
        //APP.global.resizeRouteList.push('flavorKey');
        //Set repetitive DOM lookups in cache
        config = $.extend(true, {}, defaults, params || {});
        cache = {
            $flavorKey: $(config.flavorKey),
            $flavorKeyButton: $(config.flavorKeyButton),            
            $flavorKeyData: $(config.flavorKeyData)
        };
        bindEventsToUI.apply(this, arguments);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.dropdownlinks = (function () {
    var $defaultDropDownState;
    var $body;
    var dropDownList = '.js-dropdownComponent-list';
    var selectedOption = 'selected-option';
    var menuShowing = 'menu-showing';
    var dropDownComponent = '.js-dropdownComponent';
    var $dropDownArrow;
    var $window;

    var bindEventsToUI = function () {
        $defaultDropDownState.off('click').on('click', function (e) {
            e.preventDefault();
            var $ddnList = $(this).parent().find(dropDownList);
            if (!$ddnList.hasClass('inProgress')) {
                $ddnList.addClass('inProgress').slideToggle({
                    complete: function () {
                        $(this).removeClass('inProgress');
                    },
                });
                $(this).find('.js-dropdownComponent-arrow').toggleClass(menuShowing);
            }
        });

        $body.on('click', function (e) {
            var $curElem = '';
            if (!$(e.target).is('li.is-heading')) {
                $curElem = $(e.target);
                if ($curElem.parents(dropDownComponent).length === 0) {
                    $(dropDownList).hide();
                    $dropDownArrow.removeClass(menuShowing);
                }
                if ($curElem.parents(dropDownList).length > 0) {
                    $curElem.parents(dropDownList).find('li').removeClass(selectedOption);
                    $curElem.parent('li').addClass(selectedOption);
                    $curElem
                        .closest(dropDownComponent)
                        .find('.js-selected-dropdownComponent-option')
                        .html($curElem.html());
                    $dropDownArrow.removeClass(menuShowing);
                    $(dropDownList).hide();
                }
            }
        });
    };

    var setDefaultbyUrl = function () {
        var currentPagePath = location.pathname;
        var shortUrl = currentPagePath.replace('/content/dd', '');

        $.each($(dropDownList), function (e) {
            var defaultSelectedOption = $(this).find('li.is-selected');

            var options = $(this).find('[href="' + shortUrl + '"]');
            if (options.length < 1) {
                options = $(this).find('[href="' + currentPagePath + '"]');
            }
            if (options.length) {
                $(this).find('li').removeClass('is-selected selected-option');
                options.closest('li').addClass('is-selected selected-option');
                $(this)
                    .parent()
                    .find('.js-selected-dropdownComponent-option')
                    .html($('.is-selected.selected-option a').html());
            }
        });
    };

    var setSelected = function () {
        $.each($(dropDownList), function (e) {
            var defaultSelectedOption = $(this).find('li.is-selected');

            if (defaultSelectedOption.length > 0) {
                defaultSelectedOption.addClass(selectedOption);
                $(this)
                    .parent()
                    .find('.js-selected-dropdownComponent-option')
                    .html(defaultSelectedOption.find('a').html());
            }
        });
    };

    var init = function (element) {
        $defaultDropDownState = $('.js-default-dropdownComponent-state');
        $body = $('body');
        $dropDownArrow = $('.js-dropdownComponent-arrow');
        $window = $(window);
        bindEventsToUI();

        setSelected();

        setDefaultbyUrl();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.deleteAccount = (function () {
    var cancelLoyaltyEnrollment;
    
    var bindEventsToUI = function () {
        $('.delete-account .u-cta').on('click', function() {
            APP.global.showLoader();
            $.ajax({
                type: 'POST', 
                url: '/bin/servlet/profile',
                data: cancelLoyaltyEnrollment,
                success: function (response) {
                    console.log('Account Deleted');  
                    APP.global.hideLoader();
                },
                error: function(jqXHR) {
                    console.log('Error in deleting account'); 
                    APP.global.hideLoader();
                },
                dataType: 'html'
            });
        });
        
        $('.js-modal .u-cta.u-cta--primary').on('click',  function(e) {
            APP.modal.closeModal(e);
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('deleteAccount'); */
    };

    var init = function (element) {
        // console.log('APP.deleteAccount');
        cancelLoyaltyEnrollment = $('input[type="hidden"]');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('deleteAccount');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.dashboardSection = (function () {
    var $slider = '',
        sliderAmountTablet = '',
        sliderAmountDesktop = '';

    var reviewItemTemplate = '';

    var noneRewardsTemplate =
        '<div class="reward-item reward-item--none js-reward-none" data-action="rewardItem"><div class="reward-item__point-container reward-item--coffee"><p class="reward-item__points js-reward-item-points"></p></div><h4 class="reward-item__title js-reward-item-title">Youre only <strong></strong> away from your next Free Beverage.</h4></div>';

    var modalTemplate = '';

    var loyaltyCalled = false;

    var bindEventsToUI = function () {
        $('body').on('click touch', '.js-reward-print', function (e) {
            e.preventDefault();

            var current_reward = $(this).closest('div[class^="modal__content"]');
            // prints current reward
            current_reward.print({ globalStyles: true });
            // https://github.com/DoersGuild/jQuery.print
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('dashboardSection'); */
    };

    var init = function (element) {
        // console.log('APP.dashboardSection');
        $slider = $('.js-dashboard-slider');
        sliderAmountTablet = $slider.attr('data-tablet-slides');
        sliderAmountDesktop = $slider.attr('data-desktop-slides');
        bindEventsToUI();
        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;
        if (!isEditMode) {
            getAllCertificates();
        }
        //APP.global.resizeRouteList.push('dashboardSection');
    };

    var getAllCertificates = function () {
        var data = {
            service: 'getAllCertificates',
        };
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/loyalty',
            data: JSON.stringify(data),
            success: function (response) {
                console.log('getAllCertificates : ' + response);
                // if (!loyaltyCalled) {
                //     createReviewItemTemplate(response.data);
                //     loyaltyCalled = true;
                // }
                createReviewItemTemplate(response.data);
                loyaltyCalled = true;

                APP.global.hideLoader();
            },
            error: function (jqXHR) {
                //APP.global.getErrorMsg(jqXHR, $addressForm);
                APP.global.hideLoader();
            },
            dataType: 'json',
            contentType: 'application/json',
        });
    };

    var createReviewItemTemplate = function (data) {
        console.log('createReviewItemTemplate');

        var count = 0;
        if (data.certificateList) {
            $slider.empty();
            reviewItemTemplate = $('.reward-item__template .reward-item')[0].outerHTML;
            $.each(data.certificateList, function (index, item) {
                $slider.append(reviewItemTemplate);
                var $curReviewItem = $($slider.find('.reward-item')[count]);
                var path = $slider.attr('data-dampath');
                $curReviewItem.find('.js-review-item-img').attr('src', path + 'DD_Perks_Free_Beverage_Reward.svg');
                $curReviewItem.find('.js-review-item-title').html(item.strCertificateName);
                $curReviewItem.find('.js-review-item-date').html('Expires: ' + item.strExpiryDate);
                $curReviewItem
                    .find('.js-review-item-link')
                    .attr('data-modal', item.strCertificateImage + '-' + count)
                    .attr('title', item.strCertificateName);
                createModalTemplate($curReviewItem, item, count);
                count++;
            });
        }

        console.log('count');

        if (count === 0) {
            var userInfoCookie = APP.cookie.getUserInfo();
            $slider.append(noneRewardsTemplate);
            $slider.find('.js-reward-none .js-reward-item-points').html(200 - userInfoCookie.loyaltyPoints);
            $slider.find('.js-reward-none .js-reward-item-title strong').html(200 - userInfoCookie.loyaltyPoints + ' points');
        } else {
            createSlider($slider);
        }
    };

    var createModalTemplate = function ($curReviewItem, item, i) {
        var $modalLists = $('.js-dashboard-section-modals');
        modalTemplate = $('.reward-item__template .js-modal')[0].outerHTML;
        $modalLists.append(modalTemplate);
        var $modal = $($modalLists.find('.js-modal')[i]);
        $modal.attr('id', $curReviewItem.find('.js-review-item-link').attr('data-modal'));
        $modal.find('.js-modal-title').html(item.strCertificateName);
        $modal.find('.js-modal-subtitle').html(item.strCertificateDesc);
        $modal.find('.js-modal-exp').html('Expires: ' + item.strExpiryDate);
        $modal.find('.js-modal-disclaimer').html(item.strCertificateFinePrint);

        // set certificate number to QR code url, if not certificate number, then qr code is not shown
        var googleQRURL = $modal.find('.js-modal-qrcode').html();
        if (item.strCertificateNumber && item.strCertificateNumber !== '') {
            $modal.find('.js-modal-qrcode').html(googleQRURL.replace('dataCode', item.strCertificateNumber));
            $modal.find('.js-modal-qr-text').html(item.strCertificateNumber);
        } else {
            $modal.find('.js-modal-qrcode').html('');
        }
    };

    var createSlider = function () {
        if ($slider.hasClass('slick-initialized')) {
            $slider.slick('destroy');
        }

        $slider.slick({
            dots: false,
            infinite: false,
            centerMode: true,
            centerPadding: '20px',
            slidesToShow: parseInt(sliderAmountDesktop),
            slidesToScroll: parseInt(sliderAmountDesktop),
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: parseInt(sliderAmountTablet),
                        slidesToScroll: parseInt(sliderAmountTablet),
                    },
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1,
                    },
                },
            ],
        });
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';
(function ($, $document) {
	// when dialog gets injected
	$document.on('foundation-contentloaded', function (e) {   
        // if there is already an inital value make sure the according target element becomes visible        
        setTimeout(function(){
            showHide($('.cq-dialog-multifield-dropdown-showhide', e.target));
        }, 500);
    });

    $document.on('selected', '.cq-dialog-multifield-dropdown-showhide', function(e) {
        showHide($(this));
    });
	
	function showHide(el){
        el.each(function(i, element) {
			var widget = $(element).data('select');
			var parent = $(element).closest('li');
			if (widget) {
               // get the selector to find the target elements. its stored as data-.. attribute
               var target = $(element).data('cqDialogDropdownShowhideTarget');

               // get the selected value
               var value = widget.getValue(); 
               // make sure all unselected target elements are hidden.

               parent.find(target).not('.hide').parent().addClass('hide'); 

               // unhide the target element that contains the selected value as data-showhidetargetvalue attribute
                parent.find(target).filter('[data-showhidetargetvalue*="' + value + '"]').parent().removeClass('hide'); 
			}
		});
	}
 
})(jQuery, jQuery(document));



'use strict';

var APP = window.APP = window.APP || {};

APP.ctaGroup = (function () {
    
    var $ctaGroup;
    var $notLoggedIn;
    var $loggedIn;
    var $loggedInPerks;
    var $loggedInEmailonly;
    
    
    var bindEventsToUI = function () {
        
        //$ctaGroup.find('a').addClass('u-hide');

        $('.js-main-content').on('click','.js-try-again', function(e){
            e.preventDefault();
            location.reload();
        });
        
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('ctaGroup'); */
    };
    
    var displayCta = function () {
        
        if( APP.login.isLoggedIn() ){
            $notLoggedIn.addClass('u-hide');
            $loggedIn.removeClass('u-hide');
        }else {
             $notLoggedIn.removeClass('u-hide');
        }
        
        if( APP.login.isEmailOnly() ){
            $loggedInEmailonly.removeClass('u-hide');
        }
        
        if( APP.login.isDDPerksUser() ){
            $loggedInPerks.removeClass('u-hide');
        }

    };
    

    var init = function (element) {
        // console.log('APP.ctaGroup');
        $ctaGroup = $('.cta-group');
        $notLoggedIn =  $ctaGroup.find('a[data-userstate="not-logged-in"]');
        $loggedIn =  $ctaGroup.find('a[data-userstate="logged-in"]');
        $loggedInPerks =  $ctaGroup.find('a[data-userstate="logged-in-perks"]');
        $loggedInEmailonly =  $ctaGroup.find('a[data-userstate="logged-in-emailonly"]');
        bindEventsToUI();
        displayCta();
        //APP.global.resizeRouteList.push('ctaGroup');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
/*
 * @name	collapse-panel.js
 * @desc	Handles collapse-pannel functionality
 *
 */
/*globals Vue:false */
'use strict';

var APP = (window.APP = window.APP || {});

APP.carouselPromo = (function () {
    var initState = false;
    var availableOffersJson = {
        maxRecordsReturned: '',
        service: 'getAvailableOffers',
    };
    var elementID, maxRecordsReturned, component, autoplay, dots, slideShow, slideScroll, loop;

    var bindEventsToUI = function () {
        createVueView();
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('carouselPromo'); */
    };

    var init = function (element) {
        elementID = $(element).attr('data-identifier');
        maxRecordsReturned = $('#maxrecords-' + elementID).val();
        availableOffersJson.maxRecordsReturned = maxRecordsReturned;

        autoplay = $(element).data('cautoplay');
        dots = $(element).data('cdots');
        slideShow = $(element).data('cslideshow');
        slideScroll = $(element).data('cslidescroll');
        loop = $(element).data('cloop');

        getOfferts();

        bindEventsToUI();

        initState = true;

        //APP.global.resizeRouteList.push('carouselPromo');
    };

    var isInitialized = function () {
        return initState;
    };

    var getOfferts = function () {
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/getAvailableOffers',
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify(availableOffersJson),
            success: function (response) {
                if (response && response.data.offerList) {
                    setTimeout(function () {
                        component.offerts = response.data.offerList;
                        component.zipCode = response.data.zipCode;
                        $.each(component.offerts, function (index, obj) {
                            if (obj.imageURL2.match(/(plus\d+|add\d+|\d+x)/g)) {
                                obj.bonusPointVal = obj.imageURL2.match(/(\d+x|\d+)/g);
                            }
                        });
                    }, 100);
                }
                APP.global.hideLoader();
            },
            error: function (jqXHR) {
                APP.global.hideLoader();
                APP.global.getErrorMsg(jqXHR, $('#carousel-promo-' + elementID));
            },
        });
    };

    var createVueView = function () {
        component = new Vue({
            el: '#carousel-promo-' + elementID,

            data: {
                offerts: [],
                currentOffert: [],
                zipCode: '',
                hideItems: true,
            },
            watch: {
                offerts: function () {
                    if (this.offerts.length > 0) {
                        setTimeout(function () {
                            createCarousel();
                        }, 200);
                    }
                },
            },
            methods: {
                selectOffer: function (elem) {
                    this.currentOffert = $(elem).data('value');
                },
            },
        });
    };

    var selectOffer = function (elem) {
        component.selectOffer(elem);
    };

    var createCarousel = function () {
        var $elem = $('.js-' + elementID);
        if ($elem.hasClass('slick-initialized')) {
            $elem.slick('destroy');
        }

        $elem.slick({
            dots: dots ? true : false,
            infinite: loop ? true : false,
            autoplay: autoplay ? true : false,
            slidesToShow: slideShow ? slideShow : 3,
            slidesToScroll: slideScroll ? slideScroll : 1,
            arrows: dots ? true : false,
            responsive: [
                {
                    breakpoint: 767,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1,
                    },
                },
            ],
        });

        $elem.removeClass('hide-items');

        //Show Content
        component.hideItems = false;

        // Trigger resize to reset slick width
        $(window).trigger('resize');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        getOfferts: getOfferts,
        selectOffer: selectOffer,
        isInitialized: isInitialized,
    };
})();

/*globals Vue:false */
'use strict';

var APP = (window.APP = window.APP || {});

APP.carouselBoxes = (function () {
    var elementID, component, autoplay, dots, slideShow, slideScroll, loop, $element;

    var bindEventsToUI = function () {};

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('carouselboxes'); */
    };

    var init = function (element) {
        $element = $(element);

        elementID = $element.attr('data-identifier');
        autoplay = $element.data('cautoplay') !== undefined;
        dots = $element.data('cdots') !== undefined;
        slideShow = $element.data('cslideshow');
        slideScroll = $element.data('cslidescroll');
        loop = $element.data('cloop') !== undefined;
        centerMode = $element.data('ccentermode') !== undefined;
        variableWidth = $element.data('cvariablewidth') !== undefined;

        bindEventsToUI();

        createCarousel();

        //APP.global.resizeRouteList.push('carouselboxes');
    };

    var createCarousel = function () {
        console.log('dots', dots);
        $('.js-' + elementID)
            .slick({
                dots: dots,
                infinite: loop,
                autoplay: autoplay,
                slidesToShow: slideShow ? slideShow : 3,
                slidesToScroll: slideScroll ? slideScroll : 1,
                arrows: dots,
                centerMode: centerMode,
                variableWidth: variableWidth,
                responsive: [
                    {
                        breakpoint: 767,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                        },
                    },
                ],
            })
            .find('.slick-slide')
            .each(function () {
                var $slide = $(this);
                if ($slide.attr('aria-describedby') != undefined) {
                    $slide.removeAttr('aria-describedby');
                }
            });

        $('.slick-dots')
            .find('li')
            .each(function () {
                var $dots = $(this);
                if ($dots.attr('id') !== undefined) {
                    $dots.removeAttr('id');
                }
                if ($dots.attr('aria-controls') !== undefined) {
                    $dots.removeAttr('aria-controls');
                }
            });

        //Show Content
        //component.hideItems = false;

        // Trigger resize to reset slick width
        $(window).trigger('resize');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.anchorNavigation = (function () {
    var $anchorNav;
    var $anchorNavLinks;
    var $anchorNavAccordion;
    var $globalNav;
    var $body;
    var anchorNavTopPosition;
    var articlePositions = [];
    var globalNavInitialHeight = 0;
    var isComponentVisible = false;
    var lastActiveArticle = 0;
    var documentHeight = 0;

    var addSticky = function () {
        $anchorNavLinks.addClass('js-sticky');
        $anchorNavLinks.headroom({
            classes: {
                initial: 'js-sticky',
                pinned: 'pinned',
                unpinned: 'unpinned',
            },
        });
    };

    var removeSticky = function () {
        $anchorNavLinks.removeClass('js-sticky pinned');
    };

    var setCorrectArticlePositions = function () {
        var dummyDoesntExists = $anchorNav.find('.anchor-nav-dummy').length === 0 ? true : false;
        if (dummyDoesntExists) {
            var anchorNavHeight = $anchorNavLinks.height();
            $anchorNavLinks.after('<div class="anchor-nav-dummy"></div>');
            $anchorNav.find('.anchor-nav-dummy').height(anchorNavHeight);
        }
    };

    var activateLinks = function (topPosition) {
        var currentArticle;
        if ($globalNav.hasClass('global-nav--unpinned')) {
            topPosition = topPosition + $anchorNavLinks.height();
        } else {
            topPosition = topPosition + $globalNav.height() + $anchorNavLinks.height();
        }
        for (var i = 0; i < articlePositions.length; i++) {
            if (topPosition < articlePositions[i]) {
                currentArticle = i - 1;
                break;
            }
        }
        if (currentArticle === undefined) {
            currentArticle = articlePositions.length - 1;
        }
        if (currentArticle >= 0 && currentArticle !== lastActiveArticle) {
            changeAnchorNav(currentArticle);
            changeAccordion(currentArticle);
            lastActiveArticle = currentArticle;
        }
    };

    var checkVisible = function (e) {
        var buffer = 250;
        var windowTop = $(this).scrollTop();
        var diff1 = windowTop - $anchorNav.offset().top + buffer;
        var diff2 = diff1 - $anchorNav.outerHeight(true) - buffer;
        isComponentVisible = diff1 > 0 && diff2 < 0 ? true : false;
    };

    var checkVisibleDebounced;

    var changeAnchorNav = function (index) {
        var $anchorNavGlobal = $('.js-anchor-links');
        var anchorNavGlobalLength = $anchorNavGlobal.length;
        for (var i = 0; i < anchorNavGlobalLength; i++) {
            $($anchorNavGlobal[i]).find('.js-anchor-link').removeClass('active').eq(index).addClass('active');
        }
    };

    var changeAccordion = function (index) {
        //$anchorNavAccordion
        //.find('.js-accordion-panel')
        //.toggleClass('active');

        //if(index !== undefined) {
        $anchorNavAccordion.find('.js-accordion-panel').eq(index).toggleClass('active');

        //}
    };

    var accordionClickHandler = function (e) {
        var $this = $(this);
        var parentPanel = $this.parent('.js-accordion-panel');
        var isActive = parentPanel.hasClass('active');
        var itemIndex = parentPanel.index() - 1;

        //if(isActive){
        //changeAccordion();
        //}
        //else{
        changeAccordion(itemIndex);
        //}
        changeAnchorNav(itemIndex);

        //Adding timeout to wait for CSS animation to finish.
        setTimeout(function () {
            var target = $this.attr('href');
            var offset = $anchorNav.find(target).offset().top;
            //$body.scrollTop(offset-100);
        }, 500);
        e.preventDefault();
    };

    var scrollToAnchor = function (e) {
        var target = $(this).attr('href');
        var offset = $anchorNav.find(target).offset().top;
        var globalNavHeight = $globalNav.height();
        var windowPosition = $(window).scrollTop();
        var anchorNavHeight = $anchorNavLinks.height();
        var adjustedOffset = 0;

        adjustedOffset = offset - globalNavHeight - anchorNavHeight;

        if (e) {
            e.preventDefault();
            animateToSection(adjustedOffset, $(target));
        } else {
            $body.scrollTop(adjustedOffset);
        }
    };

    var animateToSection = function (offset, $targetElement) {
        $body.animate(
            {
                scrollTop: offset,
            },
            800,
            function () {
                $targetElement.attr('tabindex', '-1').focus({ preventScroll: true });
            }
        );
    };

    var anchorNavScrollHandler = function (e) {
        anchorNavTopPosition = $anchorNav.offset().top;
        var globalNavHeight = $('.global-nav').height();
        var topPosition = $(this).scrollTop() + globalNavHeight;
        var positionToHide = anchorNavTopPosition - globalNavInitialHeight;
        var showSticky = topPosition > anchorNavTopPosition ? true : false;
        var hideSticky = topPosition <= positionToHide ? true : false;
        positionToHide = positionToHide < 0 ? 0 : positionToHide;

        // Code to handle sticky controls
        if (showSticky && !$anchorNavLinks.hasClass('js-sticky')) {
            addSticky();
        }
        if (hideSticky && $anchorNavLinks.hasClass('js-sticky')) {
            removeSticky();
        }

        // Code to select anchor tags based on scroll position
        var changedHeight = documentHeight - $(document).height();
        if (changedHeight > 100 || changedHeight < -100) {
            calculateArticlesTopPosition();
            documentHeight = $(document).height();
        }
        activateLinks(topPosition);
    };

    var calculateArticlesTopPosition = function () {
        var globalNavHeight = $globalNav.height();
        var isGlobalNavRelativePositioned = $globalNav.hasClass('global-nav--top');
        articlePositions = [];
        var $anchorNavAccordionPanels = $anchorNav.find('.js-accordion-panel');
        var accordionPanelsLength = $anchorNavAccordionPanels.length;
        for (var i = 0; i < accordionPanelsLength; i++) {
            var $this = $($anchorNavAccordionPanels[i]);
            var topPosition = Math.floor($this.offset().top);
            if (isGlobalNavRelativePositioned) {
                topPosition = topPosition - globalNavHeight;
            }
            articlePositions.push(topPosition);
        }
    };

    var unbindScrollEvent = function () {
        $(window).off('scroll', checkVisibleDebounced);
        if (window.innerWidth < 1024) {
            $(window).off('scroll', anchorNavScrollHandler);
        }
    };

    var bindEventsToUI = function () {
        $anchorNavAccordion.on('click touch', '.js-accordion-header', accordionClickHandler);
        $anchorNavLinks.on('click touch', '.js-anchor-link', scrollToAnchor);
        $(window).on('scroll', checkVisibleDebounced);
        $(window).on('resize', unbindScrollEvent);

        if (window.innerWidth >= 1024) {
            setCorrectArticlePositions();
            calculateArticlesTopPosition();
            //$(window).on('load', setCorrectArticlePositions);
            //$(window).on('load', calculateArticlesTopPosition);
            $(window).on('scroll', anchorNavScrollHandler);
        }
    };

    var bindOnResize = function () {
        var windowWidth = window.innerWidth;
        var activeTab = $anchorNavLinks.find('.active');
        var activeAccordion = $anchorNavAccordion.find('.js-accordion-panel.active .js-accordion-header');

        $(window).on('scroll', checkVisibleDebounced);
        if (windowWidth < 1024) {
            $anchorNav.find('.anchor-nav-dummy').remove();
            $(window).off('scroll', anchorNavScrollHandler);
            if (isComponentVisible) {
                var target = activeAccordion.attr('href');
                var offset = $anchorNav.find(target).offset().top;
                $body.scrollTop(offset - 100);
            }
        } else {
            setCorrectArticlePositions();
            if (articlePositions.length === 0) {
                calculateArticlesTopPosition();
            }
            $(window).on('scroll', anchorNavScrollHandler);
            if (isComponentVisible) {
                scrollToAnchor.apply(activeTab);
            }
        }
    };

    var checkUrlHashAndSetInitialState = function () {
        var $hashElem = $(location.hash);
        var $closestAccordianPanel = $hashElem.closest('.js-accordion-panel');
        if ($closestAccordianPanel.length) {
            if ($(window).width() < 1024) {
                $closestAccordianPanel.toggleClass('active');
                var offset = $hashElem.offset();
                var adjustedOffset = offset.top - $globalNav.height();
                if (window.loaded) {
                    animateToSection(adjustedOffset, $hashElem.get(0));
                } else {
                    $(window).on('load', function () {
                        animateToSection(adjustedOffset, $hashElem.get(0));
                    });
                }
            } else {
                if (window.loaded) {
                    console.log('inside timeout');
                    setTimeout(function () {
                        var offset = $hashElem.offset();
                        var adjustedOffset = offset.top - $globalNav.height() - $anchorNavLinks.height();
                        animateToSection(adjustedOffset, $hashElem);
                    }, 500);
                } else {
                    $(window).on('load', function () {
                        console.log('inside load');
                        setTimeout(function () {
                            var offset = $hashElem.offset();
                            var adjustedOffset = offset.top - $globalNav.height() - $anchorNavLinks.height();
                            animateToSection(adjustedOffset, $hashElem);
                        }, 500);
                    });
                }

                // $(window).on('load', function () {
                //     var offset = $hashElem.offset();
                //     setTimeout(function () {
                //         $('html, body').animate(
                //             {
                //                 scrollTop: offset.top - (globalNavInitialHeight + $anchorNavLinks.height()),
                //             },
                //             800,
                //             function () {
                //                 $hashElem.attr('tabindex', '-1').focus({ preventScroll: true });
                //             }
                //         );
                //     }, 500);
                // });
            }
        } else {
            changeAccordion(0);
            changeAnchorNav(0);
        }
    };

    var init = function (element) {
        // console.log('APP.anchorNavigation');

        $anchorNav = $('.anchor-navigation');
        $anchorNavLinks = $anchorNav.find('.js-anchor-links');
        $anchorNavAccordion = $('.anchor-navigation.js-accordion-anchor-navigation');
        $globalNav = $('.js-global-nav');
        $body = $('html, body');
        documentHeight = $(document).height();

        checkVisibleDebounced = APP.global.debounce(checkVisible, 100);

        //Initialize initial state
        checkUrlHashAndSetInitialState();

        globalNavInitialHeight = $globalNav.height();

        bindEventsToUI();
        APP.global.resizeRouteList.push('anchorNavigation');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

/*(function (document, $, ns) {
'use strict';

    $(document).on("click", ".cq-dialog-submit", function (e) {
        var dialogSelector = '.cq-dialog',
   			anchorId = '[name="./anchorId"]',// dialog field for file name autofill
            $dialog = $document.find(dialogSelector),
        	$form = $(this).closest("form.foundation-form"),
            endSpace = /\s$/,
       		message, clazz = "coral-Button ";
        if(endSpace.test($dialog.find(anchorId).val())){
			message = "Extra Spaces are not Permitted";
            clazz = clazz + "coral-Button--warning";
        }
        ns.ui.helpers.prompt({
            title: Granite.I18n.get("Confirm"),
            message: message,
            actions: [{
                    id: "CANCEL",
                    text: "CANCEL",
                    className: "coral-Button"
                },{
                    id: "SUBMIT",
                    text: "SUBMIT",
                    className: clazz
                }
            ],
            callback: function (actionId) {
                if (actionId === "SUBMIT") {
                    $form.submit();
                }
            }
        });
    });

})(document, Granite.$, Granite.author);*/
'use strict';

if($.validator !== undefined) {

    $.validator.register({
      selector: '[data-validation="my.custom.anchor.validator"]',
      validate: function(el) {
        var field,
            value;
    
        field = el.closest('.coral-Form-field');
        value = el.val();
    
        if (value.trim()==='' || /\s/.test(value)) {
            $('.cq-dialog-submit').attr('disabled','disabled');
          return Granite.I18n.get('Blank Field and Extra spaces not allowed');
    
        }
          else{
                $('.cq-dialog-submit').removeAttr('disabled');
          }
      }
    });

}
'use strict';

var APP = window.APP = window.APP || {};

APP.alertBanner = (function () {
    var $alertBanner;

    var closeBanner = function() {
        var in30Minutes = new Date(new Date().getTime() + 30 * 60 * 1000);
        window.Cookies.set('alert-banner', true, { expires: in30Minutes }); 
        $('.js-alert-banner').slideUp();
    };

    var acceptCheckbox = function() {
        window.Cookies.set('alert-banner', true, { expires: 100 }); 
        $('.js-alert-banner').slideUp();
    };

    var bindOnResize = function () {

    };

    var bindEventsToUI = function () {
        var alertCookie = window.Cookies.get('alert-banner')  ? true : false;
        
        if(alertCookie){
            $alertBanner.hide();
        }else{
            setTimeout(function() {
                $alertBanner.slideDown({
                     duration: 1000,
                     start: function () {
                         $(this).css({
                           display: "flex"
                         });
                      }
                });
            }, 1000);
        }

        $alertBanner.find('.js-alert-banner-close').on('click', closeBanner);

        $alertBanner.find('.js-accept-checkbox').on('change', acceptCheckbox);
    };
    
  
    var init = function (element) {
        // console.log('APP.alertBanner');
        $alertBanner = $(element);

        bindEventsToUI();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init
    };

}());

'use strict';

var APP = (window.APP = window.APP || {});

APP.addressList = (function () {
    // MUST LOOK AT WHAT SELECT BOX RENDER IS DOING HERE.

    var $body = $('body');
    var $addressForm = '';
    var $editAddressForm = '';
    var $addAddressForm = '';
    var $updateAddress = '';
    var $cancelUpdateAddress = '';
    var $addAdress = '';
    var $cancelAddAddress = '';
    var $addressList = '';
    var addressId = '';
    var $firstName = '';
    var $lastName = '';
    var $street1Add = '';
    var $street2Add = '';
    var $city = '';
    var $zip = '';
    var $state = '';
    var $addAddressStreet1 = '';
    var $addAddressStreet2 = '';
    var $addAddressCity = '';
    var $addAddressZip = '';
    var $addMoreAnchor = '';
    var $addMoreContent = '';
    var address =
        '<li class="address-list__item js-address-list-item">' +
        '<p>' +
        '<span class="address-list__firstName js-firstName"></span>' +
        ' ' +
        '<span class="address-list__lastName js-lastName"></span>' +
        '</p>' +
        '<span class="address-list__address-1 js-address-1"></span>' +
        '<span class="address-list__address-2 js-address-2" data-sly-unwrap> </span>' +
        '<p class="address-list__regional">' +
        '<span class="address-list__city js-city"></span>' +
        ', ' +
        '<span class="address-list__state js-state"></span>' +
        ' ' +
        '<span class="address-list__zip js-zip"></span>' +
        '</p>' +
        '<a class="address-list__edit js-edit" href="#">Edit</a>' +
        '<a class="address-list__delete js-delete" href="#">Delete</a>' +
        '</li>';

    var addressData = {
        address: {
            encryptedAddressId: '',
            firstName: '',
            lastName: '',
            firstStreet: '',
            secondStreet: '',
            city: '',
            state: '',
            zipCode5: '',
        },
        service: '',
    };

    var init = function (element) {
        if (!APP.global.isEditMode()) {
            // console.log('APP.addressList');
            $addressForm = $('.js-address-list');
            $editAddressForm = $('.js-address-list .js-edit-address');
            $addAddressForm = $('.js-add-address');
            $updateAddress = $('.js-edit-address .u-cta--primary');
            $cancelUpdateAddress = $('.js-edit-address .u-cta--link');
            $addAdress = $('.js-add-address .u-cta--primary');
            $cancelAddAddress = $('.js-add-address .u-cta--link');
            $addressList = $('.js-address-list-container');
            $firstName = $('.js-edit-address input#firstName');
            $lastName = $('.js-edit-address input#lastName');
            $street1Add = $('.js-edit-address input#streetAddressOne');
            $street2Add = $('.js-edit-address input#streetAddressTwo');
            $city = $('.js-edit-address input#city');
            $zip = $('.js-edit-address input#zipCode');
            $state = $('.js-edit-address #state');
            $addAddressStreet1 = $('.js-add-address input#streetAddressOne');
            $addAddressStreet2 = $('.js-add-address input#streetAddressTwo');
            $addAddressCity = $('.js-add-address input#city');
            $addAddressZip = $('.js-add-address input#zipCode');
            $addMoreAnchor = $('.js-add-address .js-add-more-button-link');
            $addMoreContent = $('.js-add-address .add-more-button__content');

            bindEventsToUI();
            getAllAddresses();
            //APP.global.resizeRouteList.push('addressList');
        }
    };

    var bindEventsToUI = function () {
        $body.on('click', '.js-address-list .js-edit:not(".disabled")', function (e) {
            e.preventDefault();
            addressId = $(e.target).parent().attr('data-id');
            $('.js-edit').addClass('disabled');
            editAddress(e);
            $('body').off('click', '.js-edit.disabled');
            $('body, html').animate(
                {
                    scrollTop: $editAddressForm.offset().top - $('.js-global-nav').height(),
                },
                600
            );
        });

        $body.on('click', '.js-delete', deleteAddress);

        $updateAddress.on('click', updateAddress);

        $addAdress.on('click', addAddress);

        $cancelUpdateAddress.on('click', function (e) {
            e.preventDefault();
            APP.global.removeError();
            $editAddressForm.hide();
            $('.js-edit').removeClass('disabled');
        });

        $cancelAddAddress.on('click', function (e) {
            e.preventDefault();
            APP.global.removeError();
            //$addMoreAnchor.trigger('click');
            $cancelAddAddressToogle();
        });

        $addMoreAnchor.on('click', function (e) {
            e.preventDefault();
            APP.global.removeError();
            $addAddressForm.parsley().reset();
            APP.formSelect.changeSelection($('.js-add-address #add_state'), null);
        });

        $body.on('click', '.js-add-more-button-link.is-active', function (e) {
            e.preventDefault();
            APP.global.removeError();
            $('.js-add-address input').val('');
            $('.js-add-address .select2-selection .select2-selection__rendered').html($('.js-add-address .form-select__default-option').html());
        });
    };

    var $cancelAddAddressToogle = function () {
        APP.global.removeError();

        if ($addAddressForm) {
            $addAddressForm.parsley().reset();
            APP.formSelect.changeSelection($('.js-add-address #add_state'), null);
            $addMoreAnchor.toggleClass('is-active');
            $addMoreContent.slideUp();
            $('body, html').animate(
                {
                    scrollTop: $addMoreAnchor.offset().top,
                },
                600
            );

            $('.js-add-address input').val('');
            $('.js-add-address .select2-selection .select2-selection__rendered').html($('.js-add-address .form-select__default-option').html());
        }
    };

    var addAddress = function (e) {
        e.preventDefault();
        APP.global.removeError();
        addressData.address.firstName = $addAddressForm.find('input#add_firstName').val();
        addressData.address.lastName = $addAddressForm.find('input#add_lastName').val();
        addressData.address.firstStreet = $addAddressForm.find('input#add_streetAddressOne').val();
        addressData.address.secondStreet = $addAddressForm.find('input#add_streetAddressTwo').val();
        addressData.address.city = $addAddressForm.find('input#add_city').val();
        addressData.address.state = $addAddressForm.find('select#add_state').val();
        addressData.address.zipCode5 = $addAddressForm.find('input#add_zipCode').val();
        addressData.service = 'addNewAddress';
        $addAddressForm
            .parsley()
            .whenValidate()
            .done(function () {
                APP.global.showLoader();

                var eventLabel = $addAddressForm.find('.u-cta--primary').text().trim();
                APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                addAddressAJAX(addressData, $addressForm, null, $addressList, address);
                $cancelAddAddressToogle();
            });
    };

    var updateAddress = function (e) {
        e.preventDefault();
        APP.global.removeError();
        var currentAddress = $(e.target)
            .parents('.address-list')
            .find('li[data-id="' + addressId + '"]');
        addressData.address.firstName = $firstName.val();
        addressData.address.lastName = $lastName.val();
        addressData.address.firstStreet = $street1Add.val();
        addressData.address.secondStreet = $street2Add.val();
        addressData.address.city = $city.val();
        addressData.address.state = $('.js-edit-address #state').val();
        addressData.address.zipCode5 = $zip.val();
        addressData.address.encryptedAddressId = addressId.replace('address-', '');
        addressData.service = 'modifyAddress';
        $editAddressForm
            .parsley()
            .whenValidate()
            .done(function () {
                APP.global.showLoader();
                $.ajax({
                    type: 'POST',
                    url: '/bin/servlet/address',
                    data: JSON.stringify(addressData),
                    success: function (response) {
                        var selectedOption = $('.js-edit-address .select2-selection .select2-selection__rendered').html();
                        currentAddress.find('.js-firstName').html($firstName.val());
                        currentAddress.find('.js-lastName').html($lastName.val());
                        currentAddress.find('.js-address-1').html($street1Add.val());
                        currentAddress.find('.js-address-2').html($street2Add.val());
                        currentAddress.find('.js-city').html($city.val());
                        currentAddress.find('.js-state').html(selectedOption);
                        currentAddress.find('.js-zip').html($zip.val());

                        $editAddressForm.hide();
                        $('.js-edit').removeClass('disabled');

                        var eventLabel = $updateAddress.find('.u-cta--primary').text().trim();

                        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                        APP.formChooseCreditCard.editAddress(
                            addressId,
                            $firstName.val(),
                            $lastName.val(),
                            $street1Add.val(),
                            $street2Add.val(),
                            $city.val(),
                            selectedOption,
                            $zip.val()
                        );
                        APP.global.hideLoader();
                    },
                    error: function (jqXHR) {
                        APP.global.getErrorMsg(jqXHR, $addressForm);
                        APP.global.hideLoader();
                    },
                    dataType: 'json',
                    contentType: 'application/json',
                });
            });
    };

    var deleteAddress = function (e) {
        e.preventDefault();
        APP.global.removeError();
        var currentAddress = $(e.target).parent();
        addressData.address.firstName = currentAddress.find('.js-firstName').html();
        addressData.address.lastName = currentAddress.find('.js-lastName').html();
        addressData.address.firstStreet = currentAddress.find('.js-address-1').html();
        addressData.address.secondStreet = currentAddress.find('.js-address-2').html();
        addressData.address.city = currentAddress.find('.js-city').html();
        addressData.address.state = currentAddress.find('.js-state').html();
        addressData.address.zipCode5 = currentAddress.find('.js-zip').html();
        addressData.address.encryptedAddressId = currentAddress.attr('data-id').replace('address-', '');
        addressData.service = 'deleteAddress';
        addressId = addressData.address.encryptedAddressId;
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/address',
            data: JSON.stringify(addressData),
            success: function (response) {
                currentAddress.remove();

                $editAddressForm.hide();
                $('.js-edit').removeClass('disabled');

                APP.formChooseCreditCard.deleteAddress(currentAddress.attr('data-id'));
                APP.global.hideLoader();
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $addressForm);
                APP.global.hideLoader();
            },
            dataType: 'json',
            contentType: 'application/json',
        });
    };

    var addAddressAJAX = function (addressData, $addressForm, $cancelAddAddress, $addressList, address) {
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/address',
            data: JSON.stringify(addressData),
            success: function (response) {
                appendNewAddedAddress(response.data, addressData, $addressList, address);

                if ($cancelAddAddress) {
                    $cancelAddAddress.trigger('click');
                }

                APP.formChooseCreditCard.appendAddress(response.data.encryptedAddressId, addressData);
                APP.global.hideLoader();
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $addressForm);
                APP.global.hideLoader();
            },
            dataType: 'json',
            contentType: 'application/json',
        });
    };

    var getAllAddresses = function () {
        addressData.service = 'getAllAddresses';
        APP.global.showLoader();
        APP.global.removeError();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/address',
            data: JSON.stringify(addressData),
            success: function (response) {
                response = JSON.parse(response);
                var data = response.data;
                if ($addressList) {
                    $addressList.empty();
                    $.each(data, function (i, item) {
                        $(address).appendTo($addressList);
                        var curAddress = $addressList.find('li')[i];
                        $(curAddress).attr('data-id', 'address-' + item.encryptedAddressId);
                        $(curAddress).find('.js-firstName').html(item.firstName);
                        $(curAddress).find('.js-lastName').html(item.lastName);
                        $(curAddress).find('.js-address-1').html(item.firstStreet);
                        $(curAddress).find('.js-address-2').html(item.secondStreet);
                        $(curAddress).find('.js-city').html(item.city);
                        $(curAddress).find('.js-state').html(item.state);
                        $(curAddress).find('.js-zip').html(item.zipCode5);
                        if (item.billingEnabled || item.ddCardAddress) {
                            $(curAddress).find('.js-delete').hide();
                        }
                    });
                }
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $addressForm);
                APP.global.hideLoader();
            },
            dataType: 'html',
            contentType: 'application/json',
        });
    };

    var editAddress = function (e) {
        $editAddressForm.show();
        var currentAddress = $(e.target).parent();
        var selectedOption = currentAddress.find('.js-state').html();
        $firstName.val(currentAddress.find('.js-firstName').html());
        $lastName.val(currentAddress.find('.js-lastName').html());
        $street1Add.val(currentAddress.find('.js-address-1').html());
        $street2Add.val(currentAddress.find('.js-address-2').html().trim());
        $city.val(currentAddress.find('.js-city').html());
        APP.formSelect.changeSelection($state, selectedOption.trim());
        $zip.val(currentAddress.find('.js-zip').html());
    };

    var appendNewAddedAddress = function (data, addressData, $addressListparam, addressparam) {
        var $this = '';
        if (addressparam !== undefined && $addressListparam !== undefined) {
            $this = $(addressparam);
            $this.appendTo($addressListparam);
            $this.attr('data-id', 'address-' + data.encryptedAddressId);
        } else {
            $this = $(address);
            $this.appendTo($addressList);
            $this.attr('data-id', 'address-' + data.encryptedAddressId);
        }
        $this.find('.js-firstName').html(addressData.address.firstName);
        $this.find('.js-lastName').html(addressData.address.lastName);
        $this.find('.js-address-1').html(addressData.address.firstStreet);
        $this.find('.js-address-2').html(addressData.address.secondStreet);
        $this.find('.js-city').html(addressData.address.city);
        $this.find('.js-zip').html(addressData.address.zipCode5);
        $this.find('.js-state').html(addressData.address.state);
        $this.parent().find('input[type="radio"]').removeProp('checked');
        $this.find('input[type="radio"]').attr('data-id', 'address-' + data.encryptedAddressId);
        $this.find('input[type="radio"]').prop('checked', true);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('addressList'); */
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        appendNewAddedAddress: appendNewAddedAddress,
        getAllAddresses: getAllAddresses,
        addAddressAJAX: addAddressAJAX,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.addMoreButton = (function () {
    var toggleState = function (e) {
        $(this).toggleClass('is-active');

        if ($(this).hasClass('is-active')) {
            $(this).attr('aria-expanded', 'true');
            $(this).closest('.add-more-button').trigger('addMoreButton:expanded');
        } else {
            $(this).attr('aria-expanded', 'false');
            $(this).closest('.add-more-button').trigger('addMoreButton:collapsed');
        }
    };

    var toggleEvent = function (e) {
        e.preventDefault();

        $(this).next('.js-has-toggle-event .js-add-more-button__content').slideToggle();
    };

    var bindEventsToUI = function () {
        $('body').on('click', '.js-add-more-button-link', toggleState);

        $('body').on('click', '.js-has-toggle-event > .js-add-more-button-link', toggleEvent);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('addMoreButton'); */
    };

    var collapsePanel = function ($addMoreBtn) {
        var $link = $addMoreBtn.closest('.add-more-button').find('.js-add-more-button-link');
        if ($link.hasClass('is-active')) {
            $link.click();
        }
    };

    var init = function (element) {
        // console.log('APP.addMoreButton');
        var isEditMode = window.Cookies.get('wcmmode') === 'edit';
        if (!isEditMode) {
            $('.add-more-button__content').slideUp();
        }
        bindEventsToUI();
        //APP.global.resizeRouteList.push('addMoreButton');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        collapsePanel: collapsePanel,
    };
})();

/*
 * @name	accordion.js
 * @desc	Handles accordion functionality
 *
 * @author	Divya (Sapient)
 */

'use strict';

var APP = (window.APP = window.APP || {});

APP.accordion = (function () {
    var config;
    var cache;
    var $globalNav;
    var defaults = {
        accordion: '.js-accordion',
        accordionButton: '.js-accordion-button',
        arrowImage: '.js-arrow img',
        expandIcon: '.js-expand',
        collapseIcon: '.js-collapse',
        accordionData: '.js-panel',
    };

    var init = function (element, params) {
        //console.log('APP.accordion');

        $globalNav = $('.js-global-nav');

        config = $.extend(true, {}, defaults, params || {});

        //Set repetitive DOM lookups in cache
        cache = {
            $accordion: $(config.accordion),
            $accordionButton: $(config.accordionButton),
            $arrowImage: $(config.arrowImage),
            $expandIcon: $(config.expandIcon),
            $collapseIcon: $(config.collapseIcon),
            $accordionData: $(config.accordionData),
        };

        //APP.global.resizeRouteList.push('accordion');
        hidePasswordSecuritySectionForAppleIdUser();
        bindEventsToUI.apply(this, arguments);
        calculateTotalItems.apply(this, arguments);

        if (window.loaded) {
            setTimeout(function () {
                console.log('inside timeout');
                scrollToHashSection();
                removeAriaControls();
            }, 1000);
        } else {
            $(window).on('load', function () {
                setTimeout(function(){
                    console.log('inside load');
                    scrollToHashSection();
                    removeAriaControls();
                }, 1000);
            });
        }
    };

    var hidePasswordSecuritySectionForAppleIdUser = function () {
        if (APP.cookie.getUserInfo() && APP.cookie.getUserInfo().signinProvider === 'Apple') {
            cache.$accordionButton.filter('#password_security').parent().hide();
        }
    };

    var scrollToHashSection = function () {
        if (window.location.hash) {
            var $hash = $(window.location.hash);

            if ($hash.closest('.js-tabs').length) {
                APP.tabs.openParentTabOfHashElement();
            }

            if ($hash.length) {
                if ($hash.is(defaults.accordionButton) && !$hash.is('.active')) {
                    $hash.trigger('click');
                } else if ($hash.closest(defaults.accordionData).length && !$hash.closest(defaults.accordionData).prev().is('.active')) {
                    $hash.closest(defaults.accordionData).prev().trigger('click');
                }
                setTimeout(function () {
                    $('body, html').animate({ scrollTop: $hash.offset().top - $globalNav.height() });
                }, 1000);
            }
        }
    };

    var bindEventsToUI = function () {
        var openStateAccordionButton = cache.$accordion.find('.accordion__open-state');
        if (openStateAccordionButton.length > 0) {
            openStateAccordionButton.siblings(cache.$accordionButton).addClass('active').attr('aria-expanded', 'true');
        }

        cache.$accordionButton.on('click', function () {
            var self = $(this);
            if (self.hasClass('active')) {
                self.removeClass('active').attr('aria-expanded', 'false');
                self.next().removeClass('accordion__open-state').slideUp();
            } else {
                cache.$accordion.find('.active').removeClass('active').attr('aria-expanded', 'false');
                var openStateAccordionButton = cache.$accordion.find('.accordion__open-state');
                openStateAccordionButton.removeClass('accordion__open-state').addClass('accordion__close-state').slideUp();
                self.addClass('active').attr('aria-expanded', 'true');
                self.next().toggleClass('accordion__open-state').slideDown();
            }
        });

        // Expand All
        cache.$expandIcon.on('click', function (e) {
            e.preventDefault();
            var self = $(this);
            self.closest(defaults.accordion).find(cache.$accordionButton).addClass('active').attr('aria-expanded', 'true');
            self.closest(defaults.accordion).find(cache.$accordionData).addClass('accordion__open-state').slideDown();
        });

        // Collapse All
        cache.$collapseIcon.on('click', function (e) {
            e.preventDefault();
            var self = $(this);
            self.closest(defaults.accordion).find(cache.$accordionButton).removeClass('active').attr('aria-expanded', 'false');
            self.closest(defaults.accordion).find(cache.$accordionData).removeClass('accordion__open-state').slideUp();
        });

        $(window).on('hashchange', scrollToHashSection);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('accordion'); */
    };

    var calculateTotalItems = function () {
        // collect all accordion instances
        var totalAccordions = $('.js-accordion').not('.anchor-navigation');

        // haven't yet counted items within each accordion
        var totalItemsInAccordion = '';

        // loop through each accordion instance to count items
        $(totalAccordions).each(function () {
            totalItemsInAccordion = $(this).find('> .accordion__list > .js-accordion-button').length;
            // look for existing 'items' text
            var totalItemText = $(this).find('.js-totalItems') || '';
            // concatenate # of items found and 'items' text
            totalItemText.prepend(totalItemsInAccordion + ' ');
        });
    };

    var removeAriaControls = function () {
        if ($('.js-accordion-button').attr('id') == undefined) {
            $('.js-accordion-button').removeAttr('aria-controls');
        }
        if ($('.accordion__panel').attr('id') == 'section-') {
            $('.js-accordion-button').removeAttr('id');
        }
    };
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

(function ($, $document) {
    'use strict';
    $document.on('dialog-ready', function () {
                 $('.coral-FixedColumn-column').css('height', '50rem');

                 $('.coral-FixedColumn-column').css('width', '50rem');

        $('.richtext-container').css('width', '50rem');

    });


})(jQuery, jQuery(document));
'use strict';
(function ($, $document) {
    var dialogSelector = '.cq-dialog';
    var titleName = '[name="./itemCountText"]'; // dialog field for file name autofill
 
    $document.on('dialog-ready', function () {
        var $dialog = $document.find(dialogSelector);
        if( $dialog.find(titleName).length !== 0 && $dialog.find(titleName).val().trim() === '' ){
            $dialog.find(titleName).val('Items');
        }
    });
 
})(jQuery, jQuery(document));
'use strict';

var APP = window.APP = window.APP || {};

APP.visaCheckout = (function () {
   
    var $window;
    var $visaCheckout;
    var $visaCheckoutButtonImg;
    
    var buttonUrl = '';
    var merchantApiKey = '';
    var amountVal = 0; //to be changed later on
    var paymentRequest = '';
    
    var checkoutSuccess;
    var checkoutFailure;
    var checkoutCancel;
    
     var visaServiceData = {
        'service': 'generateTokenRequest'
    };
    var visaCheckoutJson = {
        'encKey' : '',
		'encPaymentData' : '',
    'service' : ''
    };
    var generateTokenJson = {
        qs1 : {
            apikey : merchantApiKey,
            callId :'',
            currencyCode : 'USD',
            discount : '',
            eventType : '',
            orderId : '',
            promoCode : '',
            reason : '',
            subtotal : amountVal,
            total : amountVal
        },
        service : ''
    };
    
    var bindEventsToUI = function () {
        //$window.on('load', function(e) {
            visaServiceData.service = 'getVisaConfiguration';
            $.ajax({
                type: 'POST', 
                url: '/bin/servlet/visacheckout',
                data: JSON.stringify(visaServiceData),
                dataType: 'json',
                contentType: 'application/json',
                success: function (response) {
                    buttonUrl = response.data.buttonUrl;
                    merchantApiKey = response.data.merchantApiKey;
                    $visaCheckoutButtonImg.attr('src', buttonUrl);
                    paymentRequest = { currencyCode : 'USD', total : amountVal };
                    onVisaCheckoutReady();
                },
                error: function(jqXHR) {
                    var response = JSON.parse(jqXHR.responseText);
                    var $msg = APP.formRegistration.getHTMLMsg('Error: ' + response.error.code + ' | ' + response.error.message);
                    $('.js-status-notes').remove();
                    $visaCheckout.parent().after($msg);
                }                
            });
       // });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('visaCheckout'); */
    };

    var init = function (amount, visaCheckoutSuccess, visaCheckoutFailure, visaCheckoutCancel) {
        //console.log('APP.visaCheckout');
        $window = $(window);
        $visaCheckout = $('.js-visa-checkout');
        $visaCheckoutButtonImg = $visaCheckout.find('img.v-button');
        checkoutSuccess = visaCheckoutSuccess;
        checkoutFailure = visaCheckoutFailure;
        checkoutCancel = visaCheckoutCancel;
        amountVal = amount;
        bindEventsToUI();
        //APP.global.resizeRouteList.push('visaCheckout');
    };
    
    var onVisaCheckoutReady = function() {
        window.V.init({
            apikey : merchantApiKey,
            settings: {
                locale: 'en_US',
                countryCode: 'US',
                displayName: 'DunkinDonuts',
                websiteUrl: 'www.DunkinDonuts.com',
                shipping: {
                    acceptedRegions: ['US', 'CA'],
                    collectShipping: 'false'
                },
                dataLevel: 'FULL',
                paymentRequest : paymentRequest
            }
        });
        window.V.on('payment.success', function(payment) {
            generateTokenJson.qs1.callId = payment.callid;
            handlePaymentSuccess(payment);
        });
        window.V.on('payment.cancel', function(payment) {
            checkoutCancel();
        });
        window.V.on('payment.error', function(payment, error) {
        	checkoutFailure(error);
        });
    };
    
    var handlePaymentSuccess = function(payment) {
        visaCheckoutJson.encKey = payment.encKey;
        visaCheckoutJson.encPaymentData = payment.encPaymentData;
        visaCheckoutJson.service = 'getDecryptedVisaData';
        $.ajax({
            type: 'POST', 
            url: '/bin/servlet/visacheckout',
            data: JSON.stringify(visaCheckoutJson),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                checkoutSuccess(response.data, payment);
            },
            error: function(jqXHR) {
                var response = JSON.parse(jqXHR.responseText);
                checkoutFailure(response);
            }
        });
    };
    
    var generateToken = function(requestObj, generateTokenSuccess, generateTokenFailure) {
        generateTokenJson.service = 'generateTokenRequest';
        generateTokenJson.qs1.orderId = requestObj.orderId;
        generateTokenJson.qs1.eventType = requestObj.eventType;
        generateTokenJson.qs1.reason = requestObj.reason;
        generateTokenJson.qs1.subtotal = requestObj.total;
        generateTokenJson.qs1.total = requestObj.total;
        APP.registration.postData(
            '/bin/servlet/visacheckout',
            undefined,
            'application/json',
            JSON.stringify(generateTokenJson),
            function (response) {
                generateTokenSuccess(response);
            },
            function (jqXHR, textStatus) {
                generateTokenFailure(jqXHR, textStatus);
            },
            true
        );
    };
    
    /**
     * interfaces to public functions
     */
    return {
        initialize: init,
        bindOnResize: bindOnResize,
        generateToken : generateToken
    };
}());
'use strict';

var APP = window.APP = window.APP || {};


APP.userVehicleInfo = (function () {

  var vueApp;
  var servletUrl = '/bin/servlet/orderpickupinfo';
  var templates = {
    error: '' + "<div class='vehicle-info-error'>{msg}</div>",
  };


  var createVueApp = function () {
    vueApp = new Vue({
      el: $('.vehicle-info__container').get(0),
      data: {
        orderPickUpDetails: null
      },
      created: function () {
        APP.global.postFormData(
          servletUrl,
          null,
          function (response) {
            if (response.data && response.data.orderPickupCarDetails && response.data.orderPickupCarDetails.length > 0) {
              vueApp.orderPickUpDetails = response.data.orderPickupCarDetails;
            }
            else {
              $(vueApp.$refs.vehicleInfoRef).prepend(
                APP.registration.generateMarkup(templates.error, {
                  msg: 'Sorry, we could not find any order pickup information for this customer',
                })
              );
            }
          },
          function (jqXHR) {
            var response = JSON.parse(jqXHR.responseText);
            $(vueApp.$refs.vehicleInfoRef).prepend(
              APP.registration.generateMarkup(templates.error, {
                msg: response.error.message,
              })
            );
          }
        );
      }
    });
  };


  var init = function (el) {
    if (!APP.global.isEditMode()) {
      createVueApp();
    }
  };

  return {
    init: init
  };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.userTermsConditionsUpdate = (function () {
    var $compRoot;

    var bindEventsToUI = function (element) {
        $compRoot.find('.u-cta.u-cta--primary').on('click', function (e) {
            e.preventDefault();
            updateTermsAndConditions();
        });
    };

    var updateTermsAndConditions = function () {
        APP.global
            .postFormData('/bin/servlet/profile', {
                service: 'updateTermsAndConditions',
            })
            .done(function () {
                window.location.href = $('#perksDashboardPage').val();
            })
            .fail(function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $compRoot);
            });
    };

    var init = function (element) {
        if (!APP.global.isEditMode()) {
            $compRoot = $(element);
            bindEventsToUI();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};


APP.userAppPurchaseHistory = (function () {

  var vueApp,
    $monthDropDown,
    selectedDate,
    servletUrl = '/bin/servlet/orderpickupinfo';

  var $appPurchaseInfoList = '';
  var $appPurchaseInfoContainer = '';
  var templates = {
    error: '' + "<div class='additional-info-error'>{msg}</div>",
  };



  var loadMonthDropdown = function () {
    var option,
      actualMonth,
      now = new Date(),
      curMonth = now.getMonth(),
      curYear = now.getFullYear(),
      month,
      monthsAgo = 16;

    for (var i = 0; i < monthsAgo; i++) {
      actualMonth = curMonth + 1;
      curMonth--;
      if (actualMonth > 0 && actualMonth < 10) {
        actualMonth = '0' + actualMonth;
      }
      month = parseInt(actualMonth, 10);
      option = '<option value="' + month + '-' + curYear + '">' + window.CQ.I18n.getMessage('common.date.month.' + actualMonth + '.text') + ' ' + curYear + '</option>';

      $(option).appendTo($monthDropDown);

      if (curMonth < 0) {
        curMonth = 11;
        curYear--;
      }
    }

    $monthDropDown.prop('selectedIndex', '0').trigger('change');

  };



  var getMonthPurchaseHistory = function () {
    if (vueApp.orderPickupLoginAudit) {
      $('.noDataErrorMsg').remove();
      selectedDate = $(this).val().split('-');
      vueApp.filteredData = vueApp.orderPickupLoginAudit.filter(function (item) {
        var month = new Date(item.created_date).getMonth() + 1;
        var year = new Date(item.created_date).getFullYear();
        return month == selectedDate[0] && year == selectedDate[1];
      });
      if (vueApp.filteredData.length > 1) {
        vueApp.filteredData = vueApp.filteredData.sort(function (a, b) {
          return new Date(b.created_date) - new Date(a.created_date);
        });
      }
      if (vueApp.filteredData.length == 0) {
        $('.paginationjs').remove();
        $('.app-purchase-info__container').append("<div class='noDataErrorMsg'>No data is available for the selected month</div>");
      }
      if (vueApp.filteredData.length > 0 && vueApp.filteredData.length <= 10) {
        $('.paginationjs').remove();
        $('.app-purchase-info__list').append(vueApp.$refs.additionalInfoListItemRef);
      }
    }
  };


  var paginate = function (listItem, $appPurchaseInfoContainer) {
    var data = listItem;
    $appPurchaseInfoContainer.pagination({
      dataSource: function (done) {
        var result = [];
        for (var i = 0; i < data.length; i++) {
          result.push(data[i]);
        }
        done(result);
      },
      pageSize: 10,
      prevText: '<span class="icon-circle-arrow-pink--left"></span>',
      nextText: '<span class="icon-circle-arrow-pink--right"></span>',
      callback: function (data, pagination) {
        $appPurchaseInfoList.empty();
        for (var i = 0; i < data.length; i++) {
          $appPurchaseInfoList.append(data[i]);
        }
      }
    });
  };


  var createVueApp = function () {
    vueApp = new Vue({
      el: $('.app-purchase-info__container').get(0),
      data: {
        orderPickupLoginAudit: null,
        filteredData: null
      },
      created: function () {
        $monthDropDown = $('.app-purchase-info #additional_info_date');
        APP.global.postFormData(
          servletUrl,
          null,
          function (response) {
            if (response.data && response.data.orderPickupLoginAudit && response.data.orderPickupLoginAudit.length > 0) {
              vueApp.orderPickupLoginAudit = response.data.orderPickupLoginAudit;
              vueApp.orderPickupLoginAudit.forEach(function (item) {
                item.created_date = new Date(item.created_date).toLocaleDateString("en-US");
              });
            } else {
              $(vueApp.$refs.additionalInfoRef).prepend(
                APP.registration.generateMarkup(templates.error, {
                  msg: 'Sorry, we could not find any order pickup information for this customer',
                })
              );
            }
            loadMonthDropdown();
          },
          function (jqXHR) {
            var response = JSON.parse(jqXHR.responseText);
            $(vueApp.$refs.additionalInfoRef).prepend(
              APP.registration.generateMarkup(templates.error, {
                msg: response.error.message,
              })
            );
            loadMonthDropdown();
          }
        );
        $monthDropDown.on('change', getMonthPurchaseHistory);
      },
      updated: function () {
        $appPurchaseInfoList = $('.app-purchase-info__list');
        $appPurchaseInfoContainer = $('.app-purchase-info__container');
        if ($(vueApp.$refs.additionalInfoListItemRef).length > 10) {
          paginate(vueApp.$refs.additionalInfoListItemRef, $appPurchaseInfoContainer);
        }
      }
    });
  };


  var init = function (el) {
    if (!APP.global.isEditMode()) {
      createVueApp();
    }
  };


  return {
    init: init
  };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.signinSignupWrapper = (function () {
    var selectors = {
        appleSSO: "[data-action='appleSSO']",
        formLogin: "[data-action='formLogin']",
        formSimplifiedRegistration: "[data-action='formSimplifiedRegistration']",
        formContactUsGuestInfo: "[data-action='formContactUsGuestInfo']",
        formDoNotSellGuestForm: "[data-action='formDoNotSellGuestForm']",
    };
    var $rootElem;

    var showComponentOnPageLoad = function () {
        switch (window.location.pathname) {
            case '/en/dunkinrewards/registration': {
                if (APP.cookie.getAppleUserInfo()) {
                    $rootElem.find(selectors.appleSSO).fadeIn(300);
                } else {
                    $rootElem.find(selectors.appleSSO).fadeIn(300);
                    $rootElem.find(selectors.formSimplifiedRegistration).fadeIn(300);
                }
                break;
            }
            default: {
                if (APP.cookie.getAppleUserInfo()) {
                    $rootElem.find(selectors.appleSSO).fadeIn(300);
                } else {
                    $rootElem.find(selectors.appleSSO).fadeIn(300);
                    $rootElem.find(selectors.formLogin).fadeIn(300);
                }
            }
        }
    };

    var toggleContactUsGuestForm = function (action) {
        if (action == 'show') {
            $.when($rootElem.find(selectors.appleSSO).fadeOut(300).promise(), $rootElem.find(selectors.formLogin).fadeOut(300).promise()).done(
                function () {
                    $rootElem.find(selectors.formContactUsGuestInfo).fadeIn(300);
                    APP.global.removeError();
                }
            );
        } else if (action == 'hide') {
            $.when($rootElem.find(selectors.formContactUsGuestInfo).fadeOut(300).promise()).done(function () {
                $rootElem.find(selectors.appleSSO).fadeIn(300);
                $rootElem.find(selectors.formLogin).fadeIn(300);
                APP.global.removeError();
            });
        }
    };

    var toggleDoNotSellGuestForm = function (action) {
        if (action == 'show') {
            $.when($rootElem.find(selectors.appleSSO).fadeOut(300).promise(), $rootElem.find(selectors.formLogin).fadeOut(300).promise()).done(
                function () {
                    $rootElem.find(selectors.formDoNotSellGuestForm).fadeIn(300);
                    APP.global.removeError();
                }
            );
        } else if (action == 'hide') {
            $.when($rootElem.find(selectors.formDoNotSellGuestForm).fadeOut(300).promise()).done(function () {
                $rootElem.find(selectors.appleSSO).fadeIn(300);
                $rootElem.find(selectors.formLogin).fadeIn(300);
                APP.global.removeError();
            });
        }
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            $rootElem = $(el);
            showComponentOnPageLoad();
        }
    };

    return {
        init: init,
        toggleContactUsGuestForm: toggleContactUsGuestForm,
        toggleDoNotSellGuestForm: toggleDoNotSellGuestForm,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.rewardMilestone = (function () {
    var vueApp;

    var createVueApp = function (el) {
        vueApp = new Vue({
            el: el,
            data: {
                milestones: [],
                cardbalance: 0,
                tier: {},
            },
            computed: {
                isBoostedUser: function () {
                    return this.tier.name == 'DLTBOOSTED';
                },
                headingLabel: function () {
                    switch (true) {
                        case this.isBoostedUser: {
                            return 'Earning big with Boosted Status!';
                        }
                        case this.tier.name == 'DLTBASE' && this.cardbalance == 0: {
                            return 'Its a great day to start earning points!';
                        }
                        case this.tier.name == 'DLTBASE' && this.cardbalance > 0: {
                            return 'Keep earning points toward FREE faves!';
                        }
                        default: {
                            return '';
                        }
                    }
                },
            },
            directives: {
                'progress-width': {
                    componentUpdated: function (el, binding, vnode) {
                        var progressWidth = 0;
                        var singleMilestoneWidth = 100 / vnode.context.milestones.length;
                        var nextMilestoneIndex = vnode.context.milestones.findIndex(function (value, index) {
                            progressWidth += index == 0 ? singleMilestoneWidth / 2 : singleMilestoneWidth;
                            return vnode.context.cardbalance <= value;
                        });
                        var milestoneReachedIndex = nextMilestoneIndex - 1;

                        switch (true) {
                            //Earned point <= Last milestone point
                            case nextMilestoneIndex >= 0: {
                                var pointsDifferenceToNext =
                                    milestoneReachedIndex >= 0
                                        ? vnode.context.milestones[nextMilestoneIndex] - vnode.context.milestones[milestoneReachedIndex]
                                        : vnode.context.milestones[nextMilestoneIndex];
                                var pointsNeededToNext = vnode.context.milestones[nextMilestoneIndex] - vnode.context.cardbalance;

                                if (nextMilestoneIndex == 0) {
                                    progressWidth -= (singleMilestoneWidth / 2 / 100) * (pointsNeededToNext / pointsDifferenceToNext) * 100;
                                } else {
                                    progressWidth -= (singleMilestoneWidth / 100) * (pointsNeededToNext / pointsDifferenceToNext) * 100;
                                }
                                break;
                            }
                            //Earned point > Last milestone point
                            case nextMilestoneIndex == -1: {
                                var pointsDifferenceToNext = vnode.context.milestones[0];
                                var pointsNeededToNext =
                                    vnode.context.milestones[vnode.context.milestones.length - 1] +
                                    pointsDifferenceToNext -
                                    vnode.context.cardbalance;

                                if (pointsNeededToNext < 0) {
                                    progressWidth = 100;
                                } else {
                                    progressWidth += singleMilestoneWidth / 2;
                                    progressWidth -= (singleMilestoneWidth / 2 / 100) * (pointsNeededToNext / pointsDifferenceToNext) * 100;
                                }
                                break;
                            }
                        }
                        setTimeout(function () {
                            $(el)
                                .find('.reward-milestone__progress-bar')
                                .attr('aria-valuenow', progressWidth)
                                .width(progressWidth + '%');
                        }, 1500);
                    },
                },
                'cardbalance-counter': {
                    componentUpdated: function (el, binding, vnode) {
                        setTimeout(function () {
                            $({ countNum: $(el).text() }).animate(
                                {
                                    countNum: binding.value,
                                },

                                {
                                    duration: 1500,
                                    easing: 'swing',
                                    step: function () {
                                        $(el).text(Math.floor(this.countNum));
                                    },
                                    complete: function () {
                                        $(el).text(this.countNum);
                                    },
                                }
                            );
                        }, 1500);
                    },
                },
            },
            created: function () {
                var self = this;
                $.when(APP.loyaltyService.getRewardsCatalog(), APP.loyaltyService.getLoyaltyProfile(), APP.loyaltyService.getProgramDetails()).done(
                    function (rewardsCatalog, loyaltyProfile, programDetails) {
                        self.milestones = rewardsCatalog.data.rewardCategories
                            .map(function (obj) {
                                return obj.categoryPoints;
                            })
                            .filter(function (value, index, arr) {
                                return value ? index == arr.indexOf(value) : false;
                            });
                        self.cardbalance = loyaltyProfile[0].data.cardbalance ? loyaltyProfile[0].data.cardbalance : 0;
                        self.tier = programDetails[0].data.responseData.data.tiers.filter(function (obj) {
                            return obj.name == loyaltyProfile[0].data.tier;
                        })[0];
                    }
                );
            },
        });
    };

    var arrayFindIndexPollyfill = function () {
        if (!Array.prototype.findIndex) {
            Object.defineProperty(Array.prototype, 'findIndex', {
                value: function (predicate) {
                    // 1. Let O be ? ToObject(this value).
                    if (this == null) {
                        throw new TypeError('"this" is null or not defined');
                    }

                    var o = Object(this);

                    // 2. Let len be ? ToLength(? Get(O, "length")).
                    var len = o.length >>> 0;

                    // 3. If IsCallable(predicate) is false, throw a TypeError exception.
                    if (typeof predicate !== 'function') {
                        throw new TypeError('predicate must be a function');
                    }

                    // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
                    var thisArg = arguments[1];

                    // 5. Let k be 0.
                    var k = 0;

                    // 6. Repeat, while k < len
                    while (k < len) {
                        // a. Let Pk be ! ToString(k).
                        // b. Let kValue be ? Get(O, Pk).
                        // c. Let testResult be ToBoolean(? Call(predicate, T,  kValue, k, O )).
                        // d. If testResult is true, return k.
                        var kValue = o[k];
                        if (predicate.call(thisArg, kValue, k, o)) {
                            return k;
                        }
                        // e. Increase k by 1.
                        k++;
                    }

                    // 7. Return -1.
                    return -1;
                },
                configurable: true,
                writable: true,
            });
        }
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            arrayFindIndexPollyfill();
            createVueApp(el);
        }
    };

    var getVueApp = function () {
        return vueApp;
    };

    return {
        init: init,
        getVueApp: getVueApp,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.rewardCatalog = (function () {

  var vueApp;
  var templates = {
    error: '' + "<div class='u-page-error'>{msg}</div>",
  };

  var createVueApp = function () {
    vueApp = new Vue({
      el: $('.reward-catalog__container').get(0),
      data: {
        rewardCatalogProducts: []
      },
      methods: {
        bindEventandData: function () {
          $(this.$options.el).find('.product-catalog-image .responsive-image__img').attr("v-bind:src", "item.images.length > 0 ? item.images[0].url : ''");
        }
      },
      created: function () {
        var self = this;

        $.when(APP.loyaltyService.getRewardsCatalog()).then(
          function (response) {
            if (response.data && response.data.rewardCategories && response.data.rewardCategories.length > 0) {
              self.rewardCatalogProducts = response.data.rewardCategories.filter(function (item) {
                return item.categoryPoints > 0;
              });
            }
            else {
              $(vueApp.$refs.rewardCatalogRef).prepend(
                APP.registration.generateMarkup(templates.error, {
                  msg: 'Error',
                })
              );
            }
          },

          function (error) {
            $(vueApp.$refs.rewardCatalogRef).prepend(
              APP.registration.generateMarkup(templates.error, {
                msg: error.message,
              })
            );
          }
        );

        this.bindEventandData();

      }
    });
  };

  var init = function (el) {
    if (!APP.global.isEditMode()) {
      createVueApp();
    }
  };

  return {
    init: init
  };


})();
'use strict';

var APP = (window.APP = window.APP || {});

APP.redirectionComponent = (function () {
    var $redirectionComponent;

    var bindEventsToUI = function () {};

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('redirectionComponent'); */
    };

    var addQueryParamInMfaUrl = function (mfaUrl) {
        var referrer = APP.global.getPageReferrer();
        if (!APP.global.isLocalHost()) {
            mfaUrl = mfaUrl.substring(11);
        }
        switch (true) {
            case referrer.indexOf('consumer-rights') > -1: {
                return mfaUrl + '?from=consumer-rights';
            }
            case referrer.indexOf('do-not-sell') > -1: {
                return mfaUrl + '?from=do-not-sell';
            }
            case referrer.indexOf('shell-offer') > -1 || window.location.href.indexOf('shell-offer') > -1: {
                return mfaUrl + '?from=shell-offer';
            }
            case window.location.href.indexOf('military-coffee-request') > -1: {
                return mfaUrl + '?from=military-coffee-request';
            }
            case window.location.href.indexOf('contact-us') > -1: {
                return mfaUrl + '?from=contact-us';
            }
            case APP.global.getURLParameter('action') == 'deleteAccount': {
                return mfaUrl + '?from=deleteAccount';
            }
            case window.location.href.indexOf('sign-in') > -1: {
                return mfaUrl;
            }
            default: {
                return mfaUrl;
            }
        }
    };

    var init = function (element) {
        // console.log('APP.redirectionComponent');
        $redirectionComponent = $('.js-redirection-component');
        var targetUserType = $redirectionComponent.data('user');
        var userType;
        var redirectionURL = $redirectionComponent.data('redirection');
        var mfaPageUrl = $('#mfaPage').val();
        var user_info_mfa = window.Cookies.get('user_info_mfa') ? true : false;
        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;
        if (!isEditMode && APP.login.isLoggedIn()) {
            if (targetUserType === 'unauthenticated') {
                window.location.href = redirectionURL;
                return;
            }
            if (APP.login.isDDPerksUser()) {
                userType = 'perks';
            } else {
                userType = 'non-perks';
            }
            if (userType !== targetUserType) {
                window.location.href = redirectionURL;
            }
        } else if (!isEditMode && user_info_mfa) {
            window.location.href = mfaPageUrl;
        } else if (!isEditMode) {
            window.location.href = redirectionURL;
        }
        bindEventsToUI();
        //APP.global.resizeRouteList.push('redirectionComponent');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        addQueryParamInMfaUrl: addQueryParamInMfaUrl,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.pointsStatus = (function () {
    var bindEventsToUI = function () {
        $.when(APP.loyaltyService.getLoyaltyProfile(), APP.loyaltyService.getAllCertificates()).done(function (loyaltyProfile, allCertificates) {
            var totalPoints = 200;
            var accuiredPoints = loyaltyProfile[0].data.cardbalance ? loyaltyProfile[0].data.cardbalance : 0;
            var freeBeverageCount = allCertificates[0].data.certificateList ? Object.keys(allCertificates[0].data.certificateList).length : 0;

            setTimeout(function () {
                var $pointProgressBar = $('.point__progressbar');
                var $circleProgress = $('.point__progressbar-circle-progress');
                var $lineProgress = $('.point__progressbar-line-progress');
                var $lineTrack = $('.point__progressbar-line-track');
                var $pointsNeeded = $('.js-points-needed');
                var $freebeverageLabel = $('.js-freebeverage-label');

                var transitionDuration = parseInt($pointProgressBar.css('--transitionDuration'));
                var lineWidthPercentage = $pointProgressBar.css('--progressLinePercentage') * 100;
                var progressPercentage = (accuiredPoints / totalPoints) * 100;

                $pointsNeeded.text(totalPoints - accuiredPoints);
                freeBeverageCount ? $freebeverageLabel.text(freeBeverageCount).css('display', 'flex') : undefined;

                $lineProgress.animate(
                    {
                        width: progressPercentage + '%',
                    },
                    {
                        duration: transitionDuration,
                        easing: 'linear',
                        step: function (x) {
                            if (x > lineWidthPercentage && $circleProgress.width() == 0) {
                                $pointProgressBar.css('--progressMadePercentage', progressPercentage / 100);
                            }
                        },
                    }
                );

                $({ countNum: 0 }).animate(
                    {
                        countNum: accuiredPoints,
                    },
                    {
                        duration: 1500,
                        easing: 'linear',
                        step: function () {
                            $lineTrack.attr('data-pointcounter', Math.floor(this.countNum));
                            $lineProgress.attr('data-pointcounter', Math.floor(this.countNum));
                        },
                        complete: function () {
                            $lineTrack.attr('data-pointcounter', Math.floor(this.countNum));
                            $lineProgress.attr('data-pointcounter', Math.floor(this.countNum));
                        },
                    }
                );
            }, 2000);
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('pointsStatus'); */
    };

    var init = function (element) {
        if (!APP.global.isEditMode()) {
            // console.log('APP.pointsStatus');
            bindEventsToUI();
            //APP.global.resizeRouteList.push('pointsStatus');
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.masterpass = (function () {
	var MASTERPASS_ENDPOINT = '/bin/servlet/masterpass';
    var TRANSACTION_COOKIE_NAME = 'userTransaction';

    var handleCallbackFailure;
    var handleCallbackCancel;
    var handleCallbackSuccess;
    var $masterpass;
    
    var initializeMasterPassV7 = function(checkoutId, cartId, amount, currency, allowedCardTypes) {
    	window.masterpass.checkout({
            'checkoutId': checkoutId,						// Merchant checkout identifier received during when merchant onboarded for masterpass
            'allowedCardTypes': [allowedCardTypes],			// Card types accepted by merchant
            'amount': amount,								// Shopping cart subtotal
            'currency': currency,                           // Currency code for cart
            'shippingLocationProfile': 'US',                // Shipping locations supported by merchant - configured in merchant portal
            'suppress3Ds': false,                           // Set true when 3DS not mandatory for the specific country
            'suppressShippingAddress': true,               // Set true when cart items has digital goods only
            'cartId': cartId,								// Unique identifier for cart generated by merchant
            'callbackUrl': window.location.href				// The URL to which the browser must redirect when checkout is complete
        });
    };

    var isMPRedirectSuccess = function() {
        return APP.global.getURLParameter('mpstatus') === 'success';
    };

    var isMPRedirectFailure = function() {
        return APP.global.getURLParameter('mpstatus') === 'failure';
    };

    var isMPRedirectCancel = function() {
        return APP.global.getURLParameter('mpstatus') === 'cancel';
    };

    var getQueryParams = function() {
        var params = JSON.stringify({
            'oauth_token': APP.global.getURLParameter('oauth_token'),
            'oauth_verifier': APP.global.getURLParameter('oauth_verifier'),
            'checkout_resource_url': APP.global.getURLParameter('checkout_resource_url'),
            'checkoutId': APP.global.getURLParameter('checkoutId') //this isn't needed but in URL 
        });
        return params;
    };

    var setMasterPassJson = function (amount, requestType, transactionData) {
        var deferred = new $.Deferred();
        // Mock Data that needs to be stored in cookie when masterpass is initialized
        $.ajax({
            url: MASTERPASS_ENDPOINT,
            method: 'POST',
            dataType: 'json',
      contentType: 'application/json',
            data: JSON.stringify({
                service: 'setMasterPassJson',
                amount: amount,
                requestType: requestType,
                masterPassJson: JSON.stringify(transactionData)
            }),
            success: function (response) {
                deferred.resolve(response);
            },
            error: function (error) {
                setErrorMsg(error);
                deferred.reject(error);
            }
        });
        return deferred.promise();
    };
    
    var getCreditCardDetails = function (requestToken, verifierToken, checkoutResourceUrl) {
        var deferred = new $.Deferred();
        
        $.ajax({
            url: MASTERPASS_ENDPOINT,
            method: 'POST',
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({
                service: 'getCardDetails',
                requestToken: requestToken,
                verifierToken: verifierToken,
                checkoutResourceUrl: checkoutResourceUrl
            }),
            success: function (response) {
                deferred.resolve(response);
            },
            error: function (error) {
                setErrorMsg(error);
                deferred.reject(error);
            }
        });

        return deferred.promise();
    };

    var getTransactionDetails = function () {
        var deferred = new $.Deferred();
        
        $.ajax({
            url: MASTERPASS_ENDPOINT,
            method: 'POST',
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({
                service: 'getMasterPassJson'
            }),
            success: function (response) {
                deferred.resolve(response);
            },
            error: function (error) {
                setErrorMsg(error);
                deferred.reject(error);
            } 
        });

        return deferred.promise();
    };

    var setErrorMsg = function (error) {
        APP.global.hideLoader();
        $('.js-status-notes').remove();
        var response = error.responseJSON;
        var $msg = APP.formRegistration.getHTMLMsg('Error: ' + response.error.code + ' | ' + response.error.message);
        $masterpass.parent().after($msg);
    };

    var removeRedirectParams = function () {
        var windowURL = window.location.href;

        windowURL = APP.global.removeURLParameter('oauth_token', windowURL);
        windowURL = APP.global.removeURLParameter('oauth_verifier', windowURL);
        windowURL = APP.global.removeURLParameter('checkout_resource_url', windowURL);
        windowURL = APP.global.removeURLParameter('checkoutId', windowURL);
        windowURL = APP.global.removeURLParameter('mpstatus', windowURL);

        window.history.replaceState(null, null, windowURL);
    };

    var removeRedirectParamsOnCancelOrFailure = function () {
        if(isMPRedirectCancel() || isMPRedirectFailure()) {
            removeRedirectParams();
        }
    };

    var bindEventsToUI = function () {
        
    };

    var init = function (amount, requestType, transactionData, successCallback, cancelCallback, failureCallback) {
        // console.log('APP.masterpass');
        $masterpass = $('.js-masterpass');
        handleCallbackFailure = failureCallback;
        handleCallbackCancel = cancelCallback;
        handleCallbackSuccess = successCallback;
        
        setMasterPassJson(amount, requestType, transactionData)
        .then(function(response) {
        	initializeMasterPassV7($masterpass.data('checkout-id'), $masterpass.data('cart-id'), amount, 
            		$masterpass.data('currency'), $masterpass.data('allowed-card-types'));
        });
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        isMPRedirectSuccess : isMPRedirectSuccess,
        isMPRedirectCancel : isMPRedirectCancel,
        isMPRedirectFailure : isMPRedirectFailure,
        getCreditCardDetails : getCreditCardDetails,
        getQueryParams : getQueryParams,
        getTransactionDetails : getTransactionDetails,
        removeRedirectParams : removeRedirectParams,
        removeRedirectParamsOnCancelOrFailure : removeRedirectParamsOnCancelOrFailure
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.locationSearchFilter = (function () {
    var vueApp;
    var deferred = new $.Deferred();

    var elementRefs = {
        vueAppContainerElem: null,
        filterChkboxesElems: null,
        chkboxLabelElems: null,
        chkboxContainerElem: null,
        mobileCloseBtnTemplate: null,
        mobile_filter_overlay: null,
    };
    var selectors = {
        vueApp_container: '.location-search-filter',
        filter_chkboxes: '[name="location_filters"]',
        chkbox_container: '.location-search-filter__chkboxes .form-checkradio',
        chkbox_labels: '.location-search-filter__chkboxes .form-checkradio__item > label',
        mobile_close_btn_template: '#mobile_close_btn_template',
        mobile_filter_overlay: '.location-search-filter__mobile-overlay',
    };

    var getElementRefs = function () {
        elementRefs.vueAppContainerElem = $(selectors.vueApp_container);
        elementRefs.filterChkboxesElems = elementRefs.vueAppContainerElem.find(selectors.filter_chkboxes);
        elementRefs.chkboxLabelElems = elementRefs.vueAppContainerElem.find(selectors.chkbox_labels);
        elementRefs.chkboxContainerElem = elementRefs.vueAppContainerElem.find(selectors.chkbox_container);
        elementRefs.mobileCloseBtnTemplate = elementRefs.vueAppContainerElem.find(selectors.mobile_close_btn_template);
        elementRefs.mobile_filter_overlay = $(selectors.mobile_filter_overlay);
    };

    var registerEventHandlers = function () {
        elementRefs.filterChkboxesElems.attr({
            'v-model': 'selectedFilters',
            'v-on:change': 'filterStores',
        });
        elementRefs.chkboxLabelElems.attr('v-bind-amenity-icon', '');
        elementRefs.chkboxContainerElem.attr('v-add-mobile-close-btn', '');
        elementRefs.mobile_filter_overlay.on('click', function (event) {
            vueApp.closeDialog(event);
        });
    };

    var createVueApp = function () {
        Vue.directive('bind-amenity-icon', {
            bind: function (el, binding, vnode) {
                var $chkbox = $(el).find('input');
                var $inputLabel = $(el).find('.form-checkradio__input-label');
                var $icon_elem = $('<span>')
                    .addClass('amenity__icon amenity__icon--' + $chkbox.val())
                    .attr({
                        role: 'img',
                        'aria-label': $inputLabel.text() + ' logo',
                    });
                $inputLabel.prepend($icon_elem);
            },
        });

        Vue.directive('add-mobile-close-btn', {
            bind: function (el, binding, vnode) {
                var $buttonHtml = $(elementRefs.mobileCloseBtnTemplate.html());
                $buttonHtml.find('button').on('click', function (event) {
                    vueApp.closeDialog(event);
                });
                elementRefs.mobileCloseBtnTemplate.remove();
                $(el).append($buttonHtml);
            },
        });

        vueApp = new Vue({
            el: elementRefs.vueAppContainerElem.get(0),
            data: {
                appInitialized: false,
                dialogOpen: false,
                selectedFilters: getFiltersFromURL(),
            },
            methods: {
                filterStores: function () {
                    APP.storeSearchResults.applyAmenitiesFilterAndShowStores(null);
                },
                openDialog: function () {
                    if (this.dialogOpen) {
                        return false;
                    } else {
                        this.dialogOpen = true;
                        setTimeout(function () {
                            elementRefs.mobile_filter_overlay.show(300);
                        }, 200);
                    }
                },
                closeDialog: function (event) {
                    event.preventDefault();
                    this.dialogOpen = false;
                    elementRefs.mobile_filter_overlay.hide(300);
                },
            },
        });

        vueApp.appInitialized = true;
    };

    var isFilterApplied = function () {
        if (APP.storeItem.isStoreSearchResult()) {
            return vueApp.selectedFilters.length > 0;
        } else {
            return false;
        }
    };

    var getAppliedFilters = function () {
        return vueApp.selectedFilters;
    };

    var clearFilters = function () {
        isFilterApplied() && vueApp.selectedFilters.splice(0);
    };

    var getFiltersFromURL = function () {
        var amenities = APP.store.getAllAmenitiesForFiltering();
        var filters = [];
        $.each(amenities, function (key, value) {
            var searchParams = new URLSearchParams(location.search);
            if (searchParams.has(value)) {
                filters.push(value);
            }
        });
        return filters;
    };

    var isInitialized = function () {
        return deferred.promise();
    };

    var init = function () {
        getElementRefs();
        if (!APP.global.isEditMode()) {
            registerEventHandlers();
            createVueApp();
        } else {
            elementRefs.vueAppContainerElem.show();
        }
        deferred.resolve();
    };

    return {
        init: init,
        isFilterApplied: isFilterApplied,
        getAppliedFilters: getAppliedFilters,
        clearFilters: clearFilters,
        isInitialized: isInitialized,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.locationSearch = (function () {
    var locationForm = '.location-search__form';

    var bindEventsToUI = function () {
        $(locationForm)
            .find('#search-icon')
            .on('click', function (e) {
                $(locationForm).find('input[type="submit"]').trigger('click');
            });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('locationSearch'); */
    };

    var isDeliveryPage = function () {
        var url = location.href;
        return url.indexOf('dunkin-delivers') != -1 ? true : false;
    };

    var init = function (element) {
        // console.log('APP.locationSearch');
        bindEventsToUI();
        isDeliveryPage() ? APP.storeSearchResults.init() : null;
        //APP.global.resizeRouteList.push('locationSearch');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        isDeliveryPage: isDeliveryPage,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dltTier = (function () {
    var vueApp;

    var createVueApp = function (el) {
        vueApp = new Vue({
            el: el,
            data: {
                tierName: '',
                qualifiedVisits: null,
                tierExpirationDate: '',
                boostedTier: {},
                resetVisitsEvent: false,
            },
            computed: {
                isBoostedUser: function () {
                    return this.tierName == 'DLTBOOSTED';
                },
                isBase2User: function () {
                    return this.tierName == 'DLTBASE';
                },
                formattedExpieryDate: function () {
                    return this.tierExpirationDate ? new Date(this.tierExpirationDate).toLocaleDateString('en-US') : this.tierExpirationDate;
                },
                showTipBubble: function () {
                    return this.resetVisitsEvent;
                },
            },
            watch: {
                resetVisitsEvent: function (eventValue) {
                    if (eventValue) {
                        APP.loyaltyService.resetLoyaltyEventStatus();
                    }
                },
            },
            methods: {
                closeTipBubble: function () {
                    this.resetVisitsEvent = false;
                },
            },
            created: function () {
                var self = this;
                $.when(APP.loyaltyService.getLoyaltyProfile(), APP.loyaltyService.getProgramDetails()).done(function (
                    loyaltyProfile,
                    programDetails
                ) {
                    self.tierName = loyaltyProfile[0].data.tier;
                    self.qualifiedVisits = loyaltyProfile[0].data.qualifiedVisits;
                    self.resetVisitsEvent = loyaltyProfile[0].data.resetVisitsEvent;
                    self.tierExpirationDate = loyaltyProfile[0].data.tierExpirationDate;
                    self.boostedTier = programDetails[0].data.responseData.data.tiers.filter(function (obj) {
                        return obj.name == 'DLTBOOSTED';
                    })[0];
                });
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            createVueApp(el);
        }
    };

    var getVueApp = function () {
        return vueApp;
    };

    return {
        init: init,
        getVueApp: getVueApp,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.myRewards = (function () {
    var vueApp;
    var templates = {
        error: '' + "<div class='u-page-error'>{msg}</div>",
        emptyMsg: '' + "<div class='dlt-centerText'>{msg}</div>",
    };

    var get_free_bev_reward_img = function () {
        return '/etc/designs/dd/images/rewards/DD_Perks_Free_Beverage_Reward_New.svg';
    };

    var get_DNKN_reward_img = function () {
        return '/etc/designs/dd/images/rewards/DNKN_Reward.svg';
    };

    var createVueApp = function () {
        vueApp = new Vue({
            el: $('.my-rewards__container').get(0),
            data: {
                myRewardsList: {},
                selectedReward: {},
            },
            methods: {
                bindEventandData: function () {
                    $(this.$options.el).find('.my-rewards-image .responsive-image__img').attr('v-bind:src', 'item.images[0].url');
                },
                showModal: function (item) {
                    this.selectedReward = item;
                    APP.modal.showModal(null, $(this.$refs.modalRef));
                    $(this.$refs.modalRef).find('.modal__img img').attr('src', this.selectedReward.images[0].url);
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event' : 'view_modal',
                        'modal_type' : 'Earned Rewards',
                        'modal_name' : this.selectedReward.strCertificateName
                    });
                },
            },
            created: function () {
                var self = this;

                $.when(APP.loyaltyService.getAllCertificates(), APP.loyaltyService.getRewardsCatalog()).then(
                    function (certificates, rewardCatalog) {
                        if (certificates[0].data && certificates[0].data.certificateList && certificates[0].data.certificateList != null) {
                            self.myRewardsList = certificates[0].data.certificateList;
                            $.each(self.myRewardsList, function (index, obj1) {
                                var isMatchingReward = false;
                                $.each(rewardCatalog.data.rewardCategories, function (index, obj2) {
                                    if (obj1.rewardCode === obj2.categoryCode) {
                                        isMatchingReward = true;
                                        if (obj2.images.length > 0) {
                                            obj1.images = obj2.images;
                                        } else {
                                            obj1.images = [
                                                {
                                                    url: get_DNKN_reward_img(),
                                                },
                                            ];
                                        }
                                    }
                                });
                                if (!isMatchingReward) {
                                    if (obj1.rewardCode === 'DDCERT0001' || obj1.rewardCode === 'DDCERT0002') {
                                        obj1.images = [
                                            {
                                                url: get_free_bev_reward_img(),
                                            },
                                        ];
                                    } else {
                                        obj1.images = [
                                            {
                                                url: get_DNKN_reward_img(),
                                            },
                                        ];
                                    }
                                }
                            });
                        } else {
                            $(self.$refs.myRewardsRef).prepend(
                                APP.registration.generateMarkup(templates.emptyMsg, {
                                    msg: 'After you convert your points into free food or drink rewards, you will find them here!',
                                })
                            );
                        }
                    },

                    function (error) {
                        $(vueApp.$refs.myRewardsRef).prepend(
                            APP.registration.generateMarkup(templates.error, {
                                msg: error.message,
                            })
                        );
                    }
                );

                this.bindEventandData();
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            createVueApp();
        }
    };

    return {
        init: init,
        get_free_bev_reward_img: get_free_bev_reward_img,
        get_DNKN_reward_img: get_DNKN_reward_img,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.offersAndDeals = (function () {
  var vueApp;
  var templates = {
    error: '' + "<div class='u-page-error'>{msg}</div>",
    emptyMsg: '' + "<div class='dlt-centerText'>{msg}</div>",
  };

  var createVueApp = function () {
    vueApp = new Vue({
      el: $('.offers-deals__container').get(0),
      data: {
        offerList: [],
        selectedOffer: {},
      },
      methods: {
        viewDetails: function (item) {
          this.selectedOffer = item;
          APP.modal.showModal(null, $(this.$refs.modalRef));
          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({
            'event' : 'view_modal',
            'modal_type' : 'Offers & Deals',
            'modal_name' : this.selectedOffer.offerName
          });
        },
      },
      created: function () {
        var self = this;
        $.when(APP.loyaltyService.getAvailableOffers()).then(
          function (response) {
            if (response.offersAndDeals && response.offersAndDeals.length > 0) {
              self.offerList = response.offersAndDeals;
            }
            else {
              $(vueApp.$refs.offersDealsRef).prepend(
                APP.registration.generateMarkup(templates.emptyMsg, {
                  msg: 'Check back here for special offers & deals!'
                })
              );
            }
          },

          function (jqXHR) {
            var response = JSON.parse(jqXHR.responseText);
            $(vueApp.$refs.offersDealsRef).prepend(
              APP.registration.generateMarkup(templates.error, {
                msg: response.error.message,
              })
            );
          }
        );
      },
    });
  };

  var init = function (el) {
    if (!APP.global.isEditMode()) {
      createVueApp();
    }
  };

  return {
    init: init,
  };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dltMyAccount = (function () {
    var $rootElem;
    var selectors = {
        myAccountBtn: '.dltMyAccount__my-account-btn',
        dropdownList: '.dltMyAccount__list',
        dropdownListContainer: '.dltMyAccount__list-container',
        dltMyAccountNav: '.dltMyAccount__nav',
        logoutBtn: '.dltMyAccount__list-item--signout > button',
    };

    var bindEventHandlers = function () {
        $rootElem.find(selectors.logoutBtn).on('click', function () {
            APP.session.logout();
            toggleDropdown('close');
        });

        $rootElem.find(selectors.myAccountBtn).on('click', function () {
            toggleDropdown();
        });

        $('body').on('click', function (e) {
            var $target = $(e.target);
            if ($target.closest(selectors.dltMyAccountNav).length == 0) {
                toggleDropdown('close');
            }
        });

        $('.js-global-nav-link').on('click', function () {
            toggleDropdown('close');
        });
    };

    var toggleDropdown = function (action) {
        var isDesktopView = $(window).width() >= 1200;
        switch (action) {
            case 'close': {
                $rootElem.find(selectors.myAccountBtn).removeClass('is-active');
                $rootElem.find(selectors.dropdownListContainer).removeClass('is-active');
                isDesktopView ? $rootElem.find(selectors.dropdownList).slideUp() : $rootElem.find(selectors.dropdownList).show();
                break;
            }
            default: {
                $rootElem.find(selectors.myAccountBtn).toggleClass('is-active');
                $rootElem.find(selectors.dropdownListContainer).toggleClass('is-active');
                isDesktopView ? $rootElem.find(selectors.dropdownList).slideToggle() : $rootElem.find(selectors.dropdownList).show();
            }
        }
    };

    var hideTransferBalanceOption = function () {
        $rootElem.find("[href='/en/account/transfer-balance']").parent().hide();
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            $rootElem = $(el);
            bindEventHandlers();
        }
    };

    return {
        init: init,
        hideTransferBalanceOption: hideTransferBalanceOption,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.bonusPoints = (function () {
    var vueApp;
    var templates = {
        error: '' + "<div class='u-page-error'>{msg}</div>",
        emptyMsg: '' + "<div class='dlt-centerText'>{msg}</div>",
    };

    var createVueApp = function () {
        vueApp = new Vue({
            el: $('.bonus-points__container').get(0),
            data: {
                bonusPointsList: [],
                selectedBonusPoint: {},
            },
            methods: {
                viewDetails: function (item) {
                    this.selectedBonusPoint = item;
                    APP.modal.showModal(null, $(this.$refs.modalRef));
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event' : 'view_modal',
                        'modal_type' : 'Bonus Points',
                        'modal_name' : this.selectedBonusPoint.offerName
                    });

                },
            },
            created: function () {
                var self = this;

                $.when(APP.loyaltyService.getAvailableOffers()).then(
                    function (response) {
                        if (response.bonusPoints && response.bonusPoints.length > 0) {
                            self.bonusPointsList = response.bonusPoints;
                        } else {
                            $(vueApp.$refs.bonusPointsRef).prepend(
                                APP.registration.generateMarkup(templates.emptyMsg, {
                                    msg: 'Check back for upcoming bonus points!',
                                })
                            );
                        }
                    },

                    function (jqXHR) {
                        var response = JSON.parse(jqXHR.responseText);
                        $(vueApp.$refs.bonusPointsRef).prepend(
                            APP.registration.generateMarkup(templates.error, {
                                msg: response.error.message,
                            })
                        );
                    }
                );
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            createVueApp();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.contactUs = (function () {
    var selectors = {
        categoryDropdown: '#category',
        subCategoryDropdown: '#subCategory',
        secondaryQuestion: '#secondaryQuestion',
        productCategory: '#productCategory',
        productItem: '#productItem',
        otherProductItem: '#otherProductItem',
        searchStore: '#searchStore',
        storeNumber: '#storeNumber',
        areaOfService: '#areaOfService',
        productSelectionTeaser: '.product-selection__teaser',
        appOsInfoTeaser: '.app-os-info__teaser',
        webOrAppTeaser: '.web-or-app__teaser',
        serviceMemberTeaser: '.service-member__teaser',
    };

    var registerGlobalDirectives = function () {
        Vue.directive('toggle-dropdown-visibility', {
            componentUpdated: function (el, binding, vnode) {
                if (binding.value) {
                    $(el).parsley().reset();
                    $(el).closest('.form-select').show();
                } else {
                    $(el).closest('.form-select').hide();
                }
            },
        });

        Vue.directive('toggle-dropdown-disable', {
            bind: function (el, binding, vnode) {
                $(el).prop('disabled', true);
            },
            componentUpdated: function (el, binding, vnode) {
                if (binding.value) {
                    $(el).prop('disabled', false);
                } else {
                    $(el).prop('disabled', true);
                }
            },
        });
    };

    var registerVueComponents = function () {
        Vue.component('categoryselect', {
            props: ['categories'],
            data: function () {
                return {
                    selectedCategory: {},
                    selectedSubCategory: {},
                };
            },
            computed: {
                formData: function () {
                    return [
                        {
                            name: 'category',
                            value: this.selectedCategory.name,
                        },
                        {
                            name: 'subCategory',
                            value: this.selectedSubCategory.name,
                        },
                    ];
                },
            },
            methods: {
                categorySelect: function (event) {
                    this.selectedCategory = this.categories[event.target.selectedIndex - 1];
                    this.selectedSubCategory = {};
                },
                subCategorySelect: function (event) {
                    this.selectedSubCategory = this.selectedCategory.subCategories[event.target.selectedIndex - 1];
                },
            },
        });

        Vue.component('stepper', {
            props: ['subCategory'],
            data: function () {
                return {
                    triggerTransition: 1,
                    activeIndex: 0,
                    steps: [
                        {
                            displayName: 'QUESTIONS',
                            componentName: 'questions',
                        },
                        {
                            displayName: 'COMMENTS',
                            componentName: 'comments',
                        },
                    ],
                };
            },
            watch: {
                subCategory: function () {
                    if (this.subCategory.name) {
                        this.transitionBetweenSteps(function () {
                            this.resetFieldsAndSteps();
                        }, this.activeIndex != 0);
                    }
                },
            },
            methods: {
                iconClassName: function (componentName) {
                    return 'contact-us__stepper-step-icon--' + componentName;
                },
                transitionBetweenSteps: function (callback, enableTransition) {
                    var self = this;
                    if (enableTransition) {
                        if (self.triggerTransition) {
                            self.triggerTransition--;
                            setTimeout(function () {
                                callback.call(self);
                                self.triggerTransition++;
                            }, 300);
                        }
                    } else {
                        callback.call(self);
                    }
                },
                goToNextStep: function () {
                    this.$refs[this.steps[this.activeIndex].componentName].validateInputs();
                    if ($(this.$root.$el).find('.parsley-error:visible').length == 0) {
                        if (this.activeIndex == this.steps.length - 1) {
                            this.$root.contactUsSubmit();
                        } else {
                            this.transitionBetweenSteps(function () {
                                this.activeIndex++;
                            }, true);
                        }
                    }
                },
                goToPrevStep: function () {
                    this.transitionBetweenSteps(function () {
                        this.activeIndex--;
                    }, true);
                },
                resetFieldsAndSteps: function () {
                    this.activeIndex = 0;
                    this.removeStoreInfoStep();
                    $(this.$root.$el).parsley().reset();
                    $(this.$el).find('input, select, textarea').val('').filter('select').trigger('change');
                    this.$refs.questions.selectedProductCategory = {};
                    this.$refs.storeinfo.storeResults = [];
                },
                serializeCurrentStepFields: function (element) {
                    return $(element)
                        .find('input:visible, select ~ .select2-container:visible, textarea:visible')
                        .map(function (index, element) {
                            if ($(element).hasClass('select2-container')) {
                                return $(element).siblings('select').get(0);
                            } else {
                                return element;
                            }
                        })
                        .serializeArray();
                },
                addStoreInfoStep: function () {
                    if (this.steps.length < 3) {
                        var storeInfoStepObj = {
                            displayName: 'STORE INFO',
                            componentName: 'storeinfo',
                        };
                        this.steps.splice(1, 0, storeInfoStepObj);
                    }
                },
                removeStoreInfoStep: function () {
                    if (this.steps.length > 2) {
                        this.steps.splice(1, 1);
                    }
                },
            },
            directives: {
                'focus-step': {
                    componentUpdated: function (el, binding, vnode) {
                        if (binding.value != binding.oldValue) {
                            if (binding.value) {
                                $(el).focus();
                            }
                        }
                    },
                },
            },
        });

        Vue.component('questions', {
            props: ['question'],
            data: function () {
                return {
                    selectedAnswer: {},
                    productCategories: [],
                    selectedProductCategory: {},
                    isOtherProductItem: false,
                    formData: [],
                };
            },
            watch: {
                question: function (newVal, oldVal) {
                    this.selectedAnswer = {};
                    this.$parent.$refs.storeinfo.selectedAnswer = this.selectedAnswer;
                },
            },
            methods: {
                validateInputs: function () {
                    this.formData = this.$parent.serializeCurrentStepFields(this.$el);
                    this.formData = this.formData.map(function (obj) {
                        if (obj.name == 'productItem') {
                            obj.value = obj.value.replace(/'/g, '');
                        }
                        return obj;
                    });
                    $(this.$root.$el).parsley().validate({ group: 'questions', force: true });
                },
                answerSelect: function (event) {
                    this.selectedAnswer = this.question.answers[event.target.selectedIndex - 1];
                    this.selectedAnswer.isStoreInfoRequired ? this.$parent.addStoreInfoStep() : this.$parent.removeStoreInfoStep();
                    this.$parent.$refs.storeinfo.selectedAnswer = this.selectedAnswer;
                },
                productCategorySelect: function (event) {
                    this.selectedProductCategory = this.productCategories[event.target.selectedIndex - 1];
                    this.isOtherProductItem = false;
                },
                productItemSelect: function (event) {
                    this.isOtherProductItem = $(event.target).val() == 'other';
                    $(this.$el).find(selectors.otherProductItem).val('');
                },
                getMenuItems: function () {
                    var self = this;
                    APP.productMenu.getMenuItems().done(function (menuItems) {
                        self.productCategories = menuItems;
                    });
                },
            },
            created: function () {
                this.getMenuItems();
            },
        });

        Vue.component('storeinfo', {
            props: [],
            data: function () {
                return {
                    storeResults: [],
                    formData: [],
                    selectedAnswer: {},
                };
            },
            methods: {
                searchStore: function (searchTerm) {
                    var self = this;
                    if (searchTerm) {
                        APP.global.showLoader();
                        APP.store
                            .getStores(searchTerm)
                            .done(function (response) {
                                self.storeResults = $.map(APP.storeSearchResults.filterStores(response.storeAttributes), function (store) {
                                    var obj = {
                                        recordId: store.recordId,
                                        address: store.address,
                                        address2: store.address2,
                                        city: store.city,
                                        state: store.state,
                                        postal: store.postal,
                                        distance: store.distance,
                                    };
                                    return obj;
                                });
                                setTimeout(function () {
                                    $(self.$el).find(selectors.storeNumber).select2('open');
                                }, 0);
                            })
                            .fail(function (error) {
                                var errMsg = error.errorMessage
                                    ? error.errorMessage + '.'
                                    : 'Sorry, we are currently experiencing technical difficulty and are unable to process your request.';
                                self.storeResults = [];
                                var $input = $(self.$el).find(selectors.searchStore);
                                $input.parsley().removeError('storeSearchError');
                                $input.parsley().addError('storeSearchError', {
                                    message: errMsg,
                                });
                                setTimeout(function () {
                                    $input.parsley().removeError('storeSearchError');
                                }, 5000);
                            });
                    }
                },
                validateInputs: function () {
                    this.formData = this.$parent.serializeCurrentStepFields(this.$el);
                    $(this.$root.$el).parsley().validate({ group: 'storeinfo', force: true });
                },
            },
            directives: {
                'add-store-search-button': {
                    inserted: function (el, binding, vnode) {
                        var $btn = $('<button>')
                            .attr({
                                type: 'button',
                                'aria-label': 'Search Store',
                                'class': 'search-icon-btn',
                            })
                            .on('click', function (event) {
                                var searchTerm = $(event.target).siblings('input').val();
                                vnode.context.searchStore(searchTerm);
                            });
                        $(el).after($btn);
                    },
                },
            },
        });

        Vue.component('comments', {
            props: [],
            data: function () {
                return {
                    formData: [],
                };
            },
            methods: {
                validateInputs: function () {
                    this.formData = this.$parent.serializeCurrentStepFields(this.$el);
                    $(this.$root.$el).parsley().validate({ group: 'comments', force: true });
                },
            },
        });
    };

    var createVueInstance = function () {
        new Vue({
            el: $('.contact-us__form').get(0),
            data: {
                categories: [],
            },
            methods: {
                contactUsSubmit: function () {
                    var self = this;

                    var formData = [].concat(
                        this.$refs.categoryselect.formData,
                        this.$refs.categoryselect.$refs.stepper.$refs.questions.formData,
                        this.$refs.categoryselect.$refs.stepper.$refs.storeinfo.formData,
                        this.$refs.categoryselect.$refs.stepper.$refs.comments.formData
                    );

                    if (!APP.login.isLoggedIn()) {
                        $.each(APP.formContactUsGuestInfo.getGuestUserCookie(), function (key, value) {
                            formData.push({
                                name: key,
                                value: value,
                            });
                        });
                    } else {
                        APP.formContactUsGuestInfo.deleteGuestUserCookie();
                    }

                    APP.global.postFormData(
                        '/bin/servlet/contactus',
                        $.param(formData),
                        function (response) {
                            APP.formContactUsGuestInfo.deleteGuestUserCookie();
                            self.redirectToConfirmationPage();
                        },
                        function (jqXHR) {
                            APP.global.getErrorMsg(jqXHR, $(self.$el));
                        }
                    );
                },
                redirectToConfirmationPage: function () {
                    var pageURL = '/content/dd/en/about/contact-us/confirmation';
                    window.location.href = pageURL;
                },
                getJsonData: function () {
                    var self = this;
                    var $jsonFilePath = $(self.$options.el).find('[name="jsonFilePath"]');
                    $.get($jsonFilePath.val()).done(function (response) {
                        self.categories = response.categories;
                    });
                    $jsonFilePath.remove();
                },
                bindEventAndData: function () {
                    var $form = $(this.$options.el);
                    //category & sub-category fields
                    $form
                        .find(selectors.categoryDropdown)
                        .attr('v-on:change', 'categorySelect($event)')
                        .append(
                            "<option v-for='category in categories' v-bind:value='category.name' v-bind:key='category.name'>{{category.name}}</option>"
                        );
                    $form
                        .find(selectors.subCategoryDropdown)
                        .attr('v-on:change', 'subCategorySelect($event)')
                        .attr('v-toggle-dropdown-visibility', 'selectedCategory.subCategories')
                        .append(
                            "<option v-for='subCategory in selectedCategory.subCategories' v-bind:value='subCategory.name' v-bind:key='subCategory.name'>{{subCategory.name}}</option>"
                        );
                    //questions fields
                    $form
                        .find(selectors.secondaryQuestion)
                        .attr('v-on:change', 'answerSelect($event)')
                        .append(
                            "<option v-for='(answer, index) in question.answers' v-bind:value='answer.value' v-bind:key='answer.label'>{{answer.label}}</option>"
                        )
                        .prev()
                        .html("{{question.label}}<span class='req-indicator'>*</span>");
                    $form
                        .find(selectors.productCategory)
                        .attr('v-on:change', 'productCategorySelect($event)')
                        .append(
                            "<option v-for='category in productCategories' v-bind:value='category.pagetitle' v-bind:key='category.pagetitle'>{{category.pagetitle}}</option>"
                        );
                    $form
                        .find(selectors.productItem)
                        .attr('v-on:change', 'productItemSelect($event)')
                        .attr('v-toggle-dropdown-visibility', 'selectedProductCategory.sublist')
                        .append(
                            "<option v-for='item in selectedProductCategory.sublist' v-bind:value='item.pagetitle' v-bind:key='item.pagetitle'>{{item.pagetitle}}</option>"
                        )
                        .append("<option v-if='selectedProductCategory.sublist' value='other'>Other Menu Item</option>");
                    $form.find(selectors.otherProductItem).parent().attr('v-show', 'isOtherProductItem');
                    //storeinfo fields
                    $form.find(selectors.searchStore).attr({
                        'v-on:keyup.enter': 'searchStore($event.target.value)',
                        'v-add-store-search-button': '',
                    });
                    $form
                        .find(selectors.storeNumber)
                        .attr('v-toggle-dropdown-disable', 'storeResults.length')
                        .append(
                            "<option v-for='item in storeResults' v-bind:value='item.recordId + \"-DD\"' v-bind:data-storeattributes='JSON.stringify(item)' v-bind:key='item.recordId'></option>"
                        );
                    $form
                        .find(selectors.areaOfService)
                        .append("<option v-for='item in selectedAnswer.areaOfService' v-bind:value='item' v-bind:key='item'>{{item}}</option>");
                    //other information sections
                    $form.find(selectors.productSelectionTeaser).attr('v-show', 'selectedAnswer.isProductSelectionRequired');
                    $form.find(selectors.appOsInfoTeaser).attr('v-show', 'selectedAnswer.isAppOsInfoRequired');
                    $form.find(selectors.webOrAppTeaser).attr('v-show', 'selectedAnswer.isWebOrAppRequired');
                    $form.find(selectors.serviceMemberTeaser).attr('v-show', 'selectedAnswer.serviceMemberInfoRequired');
                    //parsley validation groups
                    $form.find('questions').find('[name]').attr('data-parsley-group', 'questions');
                    $form.find('storeinfo').find('[name]').attr('data-parsley-group', 'storeinfo');
                    $form.find('comments').find('[name]').attr('data-parsley-group', 'comments');
                },
            },
            mounted: function () {
                //Trigger native change event
                $(this.$el)
                    .find('select')
                    .on('select2:select', function (e) {
                        var evt = document.createEvent('HTMLEvents');
                        evt.initEvent('change', true, true);
                        this.dispatchEvent(evt);
                    });
            },
            updated: function () {
                if (location.href.indexOf('military-coffee-request') > -1) {
                    $(this.$el).find(selectors.categoryDropdown).val('Company Information').prop('disabled', true).trigger({
                        type: 'select2:select',
                    });

                    setTimeout(
                        function () {
                            $(this.$el).find(selectors.subCategoryDropdown).val('Military Coffee Request').prop('disabled', true).trigger({
                                type: 'select2:select',
                            });
                        }.bind(this),
                        0
                    );
                }
            },
            created: function () {
                this.getJsonData();
                this.bindEventAndData();
            },
        });
    };

    var redirectToContactUsPage = function () {
        window.location.href = '/content/dd/en/about/contact-us';
    };

    var redirectToMilitaryCoffeePage = function () {
        window.location.href = '/content/dd/en/about/contact-us/military-coffee-request';
    };

    var init = function () {
        if (!APP.global.isEditMode()) {
            registerGlobalDirectives();
            registerVueComponents();
            createVueInstance();
        }
    };

    return {
        init: init,
        redirectToContactUsPage: redirectToContactUsPage,
        redirectToMilitaryCoffeePage: redirectToMilitaryCoffeePage,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.chatbot = (function () {
    var userTokenKey = 'user_token';

    var options = {
        preChatEntities: null,
        token: null,
        autoOpen: false,
        showBot: false,
    };

    var selectors = {
        container: '.chatbot-container',
        chatbotScriptUrl: '#chatbotScriptUrl',
        showChatBtn: '#showChatBtn',
    };

    var getChatBotScriptUrl = function () {
        return $(selectors.chatbotScriptUrl).val();
    };

    var setUserTokenFromCookie = function () {
        if (APP.login.isLoggedIn()) {
            options.token = window.Cookies.get(userTokenKey);
        }
    };

    var setPreChatEntities = function (email) {
        options.preChatEntities = [
            {
                name: 'token',
                value: APP.global.getURLParameter('token'),
                transcriptField: 'SessionToken__c',
            },
            {
                name: 'email',
                value: email,
                transcriptField: 'Visitor_Email__c',
            },
            {
                name: 'topic',
                value: APP.global.getURLParameter('topic'),
                transcriptField: 'Chat_Topic__c',
            },
            {
                name: 'subTopic',
                value: APP.global.getURLParameter('subTopic'),
                transcriptField: 'Chat_SubTopic__c',
            },
        ];
    };

    var isChatBtnVisible = function () {
        var val = $(selectors.showChatBtn).val();
        if (val) {
            return JSON.parse(val);
        } else {
            return false;
        }
    };

    var isAutoOpenRequired = function () {
        var paramValue = APP.global.getURLParameter('autoOpenChatbot');
        if (paramValue && paramValue == 'true') {
            return true;
        } else {
            return false;
        }
    };

    var setOptionsObjValues = function () {
        setUserTokenFromCookie();
        options.autoOpen = isAutoOpenRequired();
        options.showBot = isChatBtnVisible();
    };

    var validateToken = function () {
        return APP.global.postFormData('/bin/servlet/checktoken', {
            token: APP.global.getURLParameter('token'),
        });
    };

    var initChatBot = function () {
        $.getScript(getChatBotScriptUrl(), function (data, textStatus, jqxhr) {
            if (APP.global.getURLParameter('token') && APP.global.getURLParameter('topic')) {
                validateToken().done(function (response) {
                    if (response.data.isSuccess) {
                        setPreChatEntities(response.data.email);
                        nfchat.init(options);
                    }
                });
            } else {
                nfchat.init(options);
            }
        });
    };

    var init = function () {
        setOptionsObjValues();
        initChatBot();
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.appleSSO = (function () {
    var selectors = {
        appleSsoFirstName: '#appleSsoFirstName',
        appleSsoLastName: '#appleSsoLastName',
        appleSsoEmail: '#appleSsoEmail',
        appleSsoZipCode: '#appleSsoZipCode',
        appleSsoAddPromoCode: '#appleSsoAddPromoCode',
        appleSsoPhoneNumber: '#appleSsoPhoneNumber',
    };

    var getRedirectionPageURL = function () {
        var obj = {
            originPage: location.pathname + location.search,
            destinationPage: '',
        };
        switch (location.pathname) {
            case '/en/sign-in': {
                if (APP.global.getURLParameter('action') == 'deleteAccount') {
                    obj.destinationPage = '/en/account/profile-management/delete-my-account';
                } else {
                    obj.destinationPage = '/en/account/dunkinrewards';
                }
                break;
            }
            case '/en/dunkinrewards/registration': {
                if (APP.global.getPageReferrer().indexOf('shell-offer') > -1) {
                    obj.originPage = '/en/menu/offers-promotions/shell-offer';
                    obj.destinationPage = '/en/menu/offers-promotions/shell-offer';
                } else {
                    obj.destinationPage = '/en/account/dunkinrewards';
                }
                break;
            }
            case '/en/menu/offers-promotions/shell-offer': {
                obj.destinationPage = '/en/menu/offers-promotions/shell-offer';
                break;
            }
            case '/en/about/contact-us/info': {
                switch (true) {
                    case location.href.indexOf('military-coffee-request') > -1: {
                        obj.destinationPage = '/en/about/contact-us/military-coffee-request';
                        break;
                    }
                    default: {
                        obj.destinationPage = '/en/about/contact-us';
                    }
                }
                break;
            }
            case '/en/consumer-rights/info': {
                switch (APP.formDoNotSellLoginRedirection.getPreviousPageInfo()) {
                    case 'consumer-rights': {
                        obj.destinationPage = '/en/consumer-rights/right-to-request';
                        break;
                    }
                    case 'do-not-sell': {
                        obj.destinationPage = '/en/do-not-sell/opt-out';
                        break;
                    }
                }
                break;
            }
        }

        return obj;
    };

    var serviceID = {
        dev: 'com.dunkindonuts.signin.dev',
        prod: 'com.dunkindonuts.signin.prod',
        get: function () {
            return APP.global.isProduction() ? this.prod : this.dev;
        },
    };

    var initAppleAuth = function () {
        APP.kountDataCollector.sessionId.done(function (sessionId) {
            AppleID.auth.init({
                clientId: serviceID.get(),
                scope: 'name email',
                state: JSON.stringify(
                    $.extend(getRedirectionPageURL(), {
                        kount_session_id: sessionId,
                        userAgent: window.navigator.userAgent,
                    })
                ),
                redirectURI: location.origin + '/bin/servlet/appleRedirect',
            });
        });
    };

    var createVueApp = function (el) {
        vueApp = new Vue({
            el: $(el).find('.apple-sso__form').get(0),
            data: {
                isNewUser: false,
                firstName: '',
                lastName: '',
                email: '',
            },
            computed: {
                buttonText: function () {
                    switch (true) {
                        case this.isNewUser: {
                            return 'CONTINUE WITH APPLE';
                        }
                        case location.href.indexOf('registration') > -1: {
                            return 'SIGN UP WITH APPLE';
                        }
                        default: {
                            return 'SIGN IN WITH APPLE';
                        }
                    }
                },
            },
            methods: {
                onFormSubmit: function () {
                    APP.global.removeError();
                    if (this.isNewUser) {
                        var $form = $(this.$el);
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'zip_code',
                            'has_zip' : $form.get(0).appleSsoZipCode.value ? true : false
                        });
                        APP.global
                            .postFormData($form.attr('action'), $form.serialize())
                            .done(function () {
                                APP.hiddenMessageJS.setCookie('registered_user', true);
                                location.href = getRedirectionPageURL().destinationPage;
                            })
                            .fail(function (jqXHR) {
                                APP.global.getErrorMsg(jqXHR, $form);
                            });
                    } else {
                        AppleID.auth.signIn();
                    }
                },
                bindVueDirectives: function () {
                    var $form = $(this.$options.el);
                    $form.find(selectors.appleSsoFirstName).attr('v-model', 'firstName');
                    $form.find(selectors.appleSsoLastName).attr('v-model', 'lastName');
                    $form.find(selectors.appleSsoEmail).attr('v-model', 'email');
                },
                getAppleUserData: function () {
                    var userData = APP.cookie.getAppleUserInfo();
                    if (userData) {
                        this.isNewUser = true;
                        this.firstName = userData.firstName;
                        this.lastName = userData.lastName;
                        this.email = userData.email;
                    }
                },
                showErrorMsg: function () {
                    var errorMsg = window.Cookies.get('appleError');
                    window.Cookies.remove('appleError');
                    if (errorMsg) {
                        APP.global.getErrorMsg(errorMsg, $(this.$options.el));
                    }
                },
            },
            mounted: function () {
                var self = this;
                $(self.$el)
                    .parsley()
                    .on('form:submit', function (e) {
                        self.onFormSubmit();
                        return false;
                    });
            },
            created: function () {
                this.bindVueDirectives();
                this.getAppleUserData();
                this.showErrorMsg();
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            initAppleAuth();
            createVueApp(el);
        }
    };

    return {
        init: init,
    };
})();

/*globals Vue:false */
'use strict';

var APP = (window.APP = window.APP || {});

APP.transferBalanceManagementForm = (function () {
    var confirmTranferBalanceVue;
    var allCardList = [];
    var selectedDDCard;

    var $formCardsSection;
    var $confirmSection;
    var $successSection;

    var transferBalanceJSON = {
        ddCard: {
            cardNumber: '',
            ddCards: [],
        },
        service: 'mergeBalanceDDCard',
        'g-recaptcha-response': '',
    };

    var getCardsData = function () {
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                service: 'getDdCardDetails',
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                allCardList = response.data;
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $('.js-form-transfer-balance'));
            },
        });
    };

    var submitTransferBalance = function (e) {
        if (APP.recaptcha.validateRecaptcha()) {
            return;
        }
    };

    var submitTransferBalanceRecaptchaCallback = function (e) {
        APP.global.showLoader();
        transferBalanceJSON.ddCard.cardNumber = selectedDDCard.cardNumber;

        transferBalanceJSON['g-recaptcha-response'] = $('#g-recaptcha-response').val();

        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: encodeURIComponent(JSON.stringify(transferBalanceJSON)),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                APP.global.hideLoader();

                if (response.data.failure.length > 0) {
                    APP.global.getErrorMsg(response.data.failure[0].errorMessage, $('.js-transfer-management-confirm'));
                } else {
                    submitTransferBalanceSuccess();
                    APP.cookie.decryptCookies().done(function () {
                        if (APP.cookie.isOneCardUser()) {
                            APP.dltMyAccount.hideTransferBalanceOption();
                        }
                    });
                }
            },
            error: function (jqXHR) {
                APP.global.hideLoader();
                APP.global.getErrorMsg(jqXHR, $confirmSection);
            },
        });
    };

    var getCardSelected = function (cardsSelected) {
        if (allCardList.length !== 0) {
            transferBalanceJSON.ddCard.ddCards.length = 0;
            confirmTranferBalanceVue.cardConfirmList = allCardList.filter(function (i) {
                for (var x = 0; x <= cardsSelected.length; x++) {
                    if (cardsSelected[x] === i.cardNumber) {
                        transferBalanceJSON.ddCard.ddCards.push(i.cardNumber);
                        return i;
                    }
                }
            });
            APP.global.hideLoader();
        }
    };

    var getAllCardList = function () {
        return allCardList;
    };

    var cardSelectorHandler = function () {
        if (allCardList.length !== 0) {
            var data = allCardList[$('#card-selector').val()];
            selectedDDCard = data;
            confirmTranferBalanceVue.ddCardData = data;
        }

        return selectedDDCard;
    };

    var formatBalance = function (bal) {
        var balString = parseFloat(bal).toFixed(2).toString();
        var decimalPlace = balString.indexOf('.');
        var dollars = balString.substring(0, decimalPlace);
        var cents = balString.substring(decimalPlace + 1);

        return {
            dollar: dollars,
            cents: cents,
        };
    };

    var getConfirmTotalAmount = function (amountTrasfered) {
        var previusAmount = selectedDDCard.balance.balance;
        var balance = formatBalance(previusAmount + amountTrasfered);
        confirmTranferBalanceVue.confirmAmounts = { amountTrasfered: amountTrasfered, balance: balance };
    };

    var submitTransferBalanceSuccess = function () {
        $successSection = $('.js-success-block');

        $confirmSection.hide();
        $successSection.show();
        $(window).scrollTop(0);
    };

    var submitReview = function () {
        confirmTranferBalanceVue.cardLength = confirmTranferBalanceVue.cardConfirmList.length;

        $formCardsSection = $('.js-transfer-balance-management-form .transfer-balance-grid');
        $confirmSection = $('.js-transfer-management-confirm');

        $formCardsSection.hide();
        $confirmSection.show();

        $(window).scrollTop(0);
    };

    var bindEventsToUI = function () {
        confirmTranferBalanceVue = new Vue({
            el: '.js-transfer-balance-management-form-grid-section',

            data: {
                cardConfirmList: [],
                ddCardData: [],
                confirmAmounts: [],
                cardLength: 0,
            },
        });

        Vue.directive('format-amount', function (el, binding, vnode) {
            var balance = formatBalance(binding.value);

            el.innerHTML = '$' + balance.dollar + '<sup class="form-transfer-balance__balance-cent">.' + balance.cents + '</sup>';
        });

        Vue.directive('auto-recharge', function (el, binding, vnode) {
            el.innerHTML = binding.value ? 'On' : 'Off';
        });

        $('.js-transfer-balance-management-form').on('click', '.js-toggle-dd-card', function (e) {
            e.preventDefault();

            $(this).parent().find('.js-dd-card, .js-dd-card-masked').toggle();
            $(this).find('.js-dd-card-masked-toggle-text, .js-dd-card-toggle-text').toggle();
        });

        $('.js-transfer-balance-management-form').on('change', '#card-selector', function () {
            var dropDownValue = $(this).val();
            APP.formTransferBalance.getListOnChangeCardList(dropDownValue, allCardList);
        });

        $('.js-transfer-balance-management-form').on('click', '.js-transfer-balance-management-form-btn', function (e) {
            e.preventDefault();

            $(window).scrollTop(0);

            submitTransferBalance();
        });

        $('.js-transfer-balance-management-form').on('click', '.js-transfer-balance-management-form-cancel', function (e) {
            e.preventDefault();

            $confirmSection.hide();
            $formCardsSection.show();

            $(window).scrollTop(0);
        });
    };

    var init = function (element) {
        //console.log('APP.transferBalanceManagementForm');
        if (window.Cookies.get('wcmmode') === 'edit') {
            return;
        }
        bindEventsToUI();
        getCardsData();
        APP.recaptcha.initRecaptcha(submitTransferBalanceRecaptchaCallback);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        getCardSelected: getCardSelected,
        getAllCardList: getAllCardList,
        formatBalance: formatBalance,
        cardSelectorHandler: cardSelectorHandler,
        getConfirmTotalAmount: getConfirmTotalAmount,
        submitReview: submitReview,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.mfa = (function () {
    var mfaApp;
    var $modeRadioBtns;
    var accessCodeInputElemID = '#accessCodeInput';
    var mfaFormElemID = '#mfaForm';
    var perksURL = null;
    var nonPerksURL = null;
    var logoutURL = null;
    var doNotSellURL = null;
    var consumerRightsURL = null;
    var shellOfferURL = null;
    var $mfaForm = null;
    var servletEnum = {
        SEND_VERIFY_TOKEN: '/bin/servlet/sendverifytoken',
        ACCOUNT_RECOVERY: '/bin/servlet/validateprofilephone',
    };
    var serviceEnum = {
        SEND_TOKEN: 'sendToken',
        VERIFY_TOKEN: 'verifyToken',
        SEND_EMAIL: 'sendEmail',
        VALIDATE_PHONE: 'validatePhone',
    };

    var PostData = function () {
        this.accessCode = null;
        this.primaryPhone = null;
        this.newPrimaryPhone = null;
        this.isPhoneUpdate = null;
        this.primaryPhoneType = null;
        this.service = null;
        this.mode = null;
        this.password = null;
        this.token = null;
        this.sessionId = null;
    };
    var getPagePaths = function () {
        perksURL = $('#perksDashboardPage').val();
        nonPerksURL = $('#nonPerksDashboardPage').val();
        logoutURL = $('#logoutURL').val();
        doNotSellURL = $('#doNotSellPath').val();
        consumerRightsURL = $('#consumerRightsPath').val();
        shellOfferURL = $('#shellOfferPath').val();
    };
    var getElemsReferrences = function () {
        $mfaForm = $(mfaFormElemID);
        $modeRadioBtns = $mfaForm.find("input[name='mode']");
    };
    var registerEventHandlers = function () {
        $(accessCodeInputElemID).attr('oninput', 'APP.formInput.otpValidation(event)').attr('onpaste', 'APP.formInput.preventPaste(event)');
        $modeRadioBtns.attr('v-model', 'selectedMode');
    };
    var chkCookiesAndRedirect = function () {
        var user_info_mfa = APP.cookie.getUserInfoMFA();
        var user_info = APP.cookie.getUserInfo();
        if (user_info) {
            window.location.href = perksURL;
            return true;
        } else if (!user_info_mfa && !APP.global.getEncodedURLParameter('token')) {
            window.location.href = logoutURL;
            return true;
        }
    };
    var readMfaCookie = function () {
        var user_info_mfa = APP.cookie.getUserInfoMFA();
        if (user_info_mfa) {
            mfaApp.primaryPhone = user_info_mfa.primaryPhone;
            mfaApp.phoneVerified = user_info_mfa.phoneVerified;
            mfaApp.primaryPhoneType = user_info_mfa.primaryPhoneType ? user_info_mfa.primaryPhoneType : 'WIRELESS';
            mfaApp.email = user_info_mfa.email;
        }
    };
    var setInitialView = function () {
        var token = APP.global.getEncodedURLParameter('token');
        if (token) {
            makeKountAjaxRequest();
            mfaApp.token = token;
            updateCurrentView(mfaApp.mfaViews.newPhoneNumberUpdate);
        } else if (mfaApp.primaryPhone != null && !mfaApp.phoneVerified) {
            updateCurrentView(mfaApp.mfaViews.phoneAvailable_phoneNotVerified);
        } else if (mfaApp.primaryPhone == null && !mfaApp.phoneVerified) {
            updateCurrentView(mfaApp.mfaViews.phoneNotAvailable_phoneNotVerified);
        } else if (mfaApp.primaryPhone != null && mfaApp.phoneVerified) {
            updateCurrentView(mfaApp.mfaViews.phoneAvailable_phoneVerified);
        }
    };
    var updateCurrentView = function (newView) {
        if (!newView.initialMfaPrompt && newView.previousView == null) {
            newView.previousView = mfaApp.currentView;
        }
        mfaApp.currentView = newView;
    };
    var makeRequestToServlet = function (servlet, objPostData) {
        function successHandler(response) {
            switch (objPostData.service) {
                case serviceEnum.SEND_TOKEN: {
                    if (objPostData.isPhoneUpdate) {
                        mfaApp.primaryPhone = objPostData.primaryPhone;
                    }
                    updateCurrentView(mfaApp.mfaViews.verifyToken);
                    mfaApp.makeResendCodeVisible();

                    break;
                }
                case serviceEnum.VERIFY_TOKEN: {
                    updateCurrentView(mfaApp.mfaViews.verificationSuccess);
                    mfaApp.isLoyaltyEnrollment = response.data.isLoyaltyEnrollment;
                    setTimeout(function () {
                        mfaApp.redirectTo();
                    }, 5000);

                    break;
                }
                case serviceEnum.SEND_EMAIL: {
                    updateCurrentView(mfaApp.mfaViews.emailSent);
                    break;
                }
                case serviceEnum.VALIDATE_PHONE: {
                    updateCurrentView(mfaApp.mfaViews.verifyToken);
                    mfaApp.makeResendCodeVisible();

                    break;
                }
            }
        }
        function errorHandler(jqXHR) {
            var accessCodeField = $mfaForm.find(accessCodeInputElemID);
            var errorCode = jqXHR.responseJSON.error.code;
            var errorMessage = jqXHR.responseJSON.error.message;
            if (errorCode == 'APP4317' && objPostData.isPhoneUpdate) {
                mfaApp.primaryPhone = objPostData.primaryPhone;
            }
            if (['APP4310', 'APP4311'].indexOf(errorCode) != -1) {
                accessCodeField.parsley().addError('accessCodeError', {
                    message: errorMessage,
                });
                setTimeout(function () {
                    accessCodeField.parsley().removeError('accessCodeError');
                }, 5000);
            } else {
                APP.global.getErrorMsg(jqXHR, $mfaForm);
            }
        }
        APP.global.postFormData(servlet, objPostData, successHandler, errorHandler);
    };
    var createVueApp = function () {
        mfaApp = new Vue({
            el: '#mfaForm',
            data: {
                primaryPhone: null,
                phoneVerified: false,
                isLoyaltyEnrollment: false,
                primaryPhoneType: 'WIRELESS',
                showResendCodeBtn: false,
                resendCodeTimer: null,
                selectedMode: 'SMS',
                codeSentToPhone: null,
                currentView: null,
                email: null,
                token: null,
                mfaViews: {
                    phoneAvailable_phoneNotVerified: {
                        name: 'phoneAvailable_phoneNotVerified',
                        initialMfaPrompt: true,
                        backButtonVisible: false,
                        previousView: null,
                        servlet: servletEnum.SEND_VERIFY_TOKEN,
                        service: serviceEnum.SEND_TOKEN,
                    },
                    phoneNotAvailable_phoneNotVerified: {
                        name: 'phoneNotAvailable_phoneNotVerified',
                        initialMfaPrompt: true,
                        backButtonVisible: false,
                        previousView: null,
                        servlet: servletEnum.SEND_VERIFY_TOKEN,
                        service: serviceEnum.SEND_TOKEN,
                    },
                    phoneAvailable_phoneVerified: {
                        name: 'phoneAvailable_phoneVerified',
                        initialMfaPrompt: true,
                        backButtonVisible: false,
                        previousView: null,
                        servlet: servletEnum.SEND_VERIFY_TOKEN,
                        service: serviceEnum.SEND_TOKEN,
                    },
                    editMobileNumber: {
                        name: 'editMobileNumber',
                        initialMfaPrompt: false,
                        backButtonVisible: true,
                        previousView: null,
                        servlet: servletEnum.SEND_VERIFY_TOKEN,
                        service: serviceEnum.SEND_TOKEN,
                    },
                    verifyToken: {
                        name: 'verifyToken',
                        initialMfaPrompt: false,
                        backButtonVisible: true,
                        previousView: null,
                        servlet: servletEnum.SEND_VERIFY_TOKEN,
                        service: serviceEnum.VERIFY_TOKEN,
                    },
                    verificationSuccess: {
                        name: 'verificationSuccess',
                        initialMfaPrompt: false,
                        backButtonVisible: false,
                        previousView: null,
                        servlet: null,
                        service: null,
                    },
                    newPhoneNumberUpdate: {
                        name: 'newPhoneNumberUpdate',
                        initialMfaPrompt: true,
                        backButtonVisible: false,
                        previousView: null,
                        servlet: servletEnum.ACCOUNT_RECOVERY,
                        service: serviceEnum.VALIDATE_PHONE,
                    },
                    emailSent: {
                        name: 'emailSent',
                        initialMfaPrompt: false,
                        backButtonVisible: false,
                        previousView: null,
                        servlet: null,
                        service: null,
                    },
                },
            },
            computed: {
                getMaskedEmail: function () {
                    if (this.email) {
                        var emailArr = this.email.split('@');
                        emailArr[0] = emailArr[0].replace(/./g, '');
                        return emailArr.join('@');
                    } else {
                        return '';
                    }
                },
            },
            methods: {
                mfaFormSubmit: function () {
                    APP.global.removeError();
                    var objPostData = new PostData();
                    objPostData.service = mfaApp.currentView.service;

                    switch (objPostData.service) {
                        case serviceEnum.VALIDATE_PHONE: {
                            objPostData.primaryPhone = $mfaForm.get(0).elements.prevPhoneNumber.value.replace(/\D/g, '');
                            objPostData.newPrimaryPhone = $mfaForm.get(0).elements.newPhoneNumber.value.replace(/\D/g, '');
                            objPostData.password = $mfaForm.get(0).elements.passwordForPhoneUpdate.value;
                            objPostData.sessionId = $mfaForm.get(0).elements.sessionId.value;
                            objPostData.token = mfaApp.token;

                            mfaApp.primaryPhone = null;
                            mfaApp.primaryPhoneType = null;
                            mfaApp.selectedMode = null;
                            mfaApp.codeSentToPhone = objPostData.newPrimaryPhone;

                            break;
                        }
                        case serviceEnum.SEND_TOKEN: {
                            var newPhoneNumber = $($mfaForm.get(0).elements.mobileInput).val();
                            newPhoneNumber = newPhoneNumber ? newPhoneNumber.replace(/\D/g, '') : null;
                            if (newPhoneNumber && newPhoneNumber != mfaApp.primaryPhone) {
                                objPostData.isPhoneUpdate = true;
                                objPostData.primaryPhone = newPhoneNumber;
                                mfaApp.codeSentToPhone = newPhoneNumber;
                            } else {
                                objPostData.isPhoneUpdate = false;
                                objPostData.primaryPhone = mfaApp.primaryPhone;
                                mfaApp.codeSentToPhone = mfaApp.primaryPhone;
                            }
                            objPostData.primaryPhoneType = mfaApp.primaryPhoneType;
                            objPostData.mode = mfaApp.selectedMode;

                            break;
                        }
                        case serviceEnum.VERIFY_TOKEN: {
                            objPostData.accessCode = $mfaForm.get(0).elements.accessCodeInput.value;
                            objPostData.primaryPhone = mfaApp.primaryPhone;
                            objPostData.primaryPhoneType = mfaApp.primaryPhoneType;
                            objPostData.mode = mfaApp.selectedMode;

                            break;
                        }
                    }
                    makeRequestToServlet(mfaApp.currentView.servlet, objPostData);
                },
                makeResendCodeVisible: function () {
                    mfaApp.resendCodeTimer ? clearTimeout(mfaApp.resendCodeTimer) : undefined;
                    mfaApp.showResendCodeBtn = false;
                    mfaApp.resendCodeTimer = setTimeout(function () {
                        mfaApp.showResendCodeBtn = true;
                    }, 300000);
                },
                sendEmailForRecovery: function () {
                    var objPostData = new PostData();
                    objPostData.service = serviceEnum.SEND_EMAIL;
                    makeRequestToServlet(servletEnum.ACCOUNT_RECOVERY, objPostData);
                },
                editMobileNumber: function () {
                    updateCurrentView(this.mfaViews.editMobileNumber);
                },
                backToPreviousView: function () {
                    updateCurrentView(this.currentView.previousView);
                    APP.global.removeError();
                },
                formatPhoneNumber: function (phoneNumber, isMasked) {
                    var cleaned = ('' + phoneNumber).replace(/\D/g, '');
                    var match = cleaned.match(/^(\d{3})(\d{3})(\d{4})$/);
                    if (match) {
                        if (isMasked) {
                            return '(' + match[1].replace(/./g, '') + ') ' + match[2].replace(/./g, '') + '-' + match[3];
                        } else {
                            return '(' + match[1] + ') ' + match[2] + '-' + match[3];
                        }
                    }
                    return null;
                },
                navigateToDashboardPage: function () {
                    if (window.Cookies.get('registered_user')) {
                        window.location.href = perksURL;
                    } else {
                        if (this.isLoyaltyEnrollment) {
                            window.location.href = perksURL;
                        } else {
                            window.location.href = nonPerksURL;
                        }
                    }
                },
                redirectTo: function () {
                    var params = APP.global.getURLParameter('from');
                    switch (params) {
                        case 'do-not-sell':
                            window.location.href = doNotSellURL;
                            break;
                        case 'consumer-rights':
                            window.location.href = consumerRightsURL;
                            break;
                        case 'shell-offer':
                            window.location.href = shellOfferURL;
                            break;
                        case 'military-coffee-request':
                            APP.contactUs.redirectToMilitaryCoffeePage();
                            break;
                        case 'contact-us':
                            APP.contactUs.redirectToContactUsPage();
                            break;
                        case 'deleteAccount':
                            APP.formDeleteMyAccount.redirectToDeleteAccountPage();
                            break;
                        default:
                            this.navigateToDashboardPage();
                            break;
                    }
                },
                resendVerificationCode: function () {
                    var objPostData = new PostData();
                    objPostData.service = serviceEnum.SEND_TOKEN;
                    objPostData.primaryPhoneType = mfaApp.primaryPhoneType;
                    objPostData.primaryPhone = mfaApp.primaryPhone;
                    objPostData.mode = mfaApp.selectedMode;

                    makeRequestToServlet(servletEnum.SEND_VERIFY_TOKEN, objPostData);
                },
            },
            mounted: function () {
                var self = this;
                $(self.$el)
                    .parsley()
                    .on('form:submit', function (e) {
                        self.mfaFormSubmit();
                        return false;
                    });
            },
        });

        $mfaForm = $(mfaApp.$refs.mfaForm);
    };

    // Request the sessionId to and register it to Kount
    var makeKountAjaxRequest = function () {
        $.ajax({
            type: 'GET',
            url: '/bin/servlet/kountsession',
            success: function (response) {
                if (response.enabled) {
                    createInput(response);
                }
            },
            error: function (jqXHR, response) {},
        });
    };

    // Create and add a input hidden field with Kount sessionId to the login form
    var createInput = function (data) {
        var src = '/bin/servlet/logo.htm?m=' + data.m + '&s=' + data.sessionid;
        var imgSrc = '/bin/servlet/logo.gif?m=' + data.m + '&s=' + data.sessionid;

        var $dataCollectorContainer = $('<div>').attr('class', 'js-data-collector');

        $('#main-content').append($dataCollectorContainer);

        var $iframe = $('<iframe>');
        $iframe.attr('width', 1).attr('height', 1).attr('frameborder', 0).attr('scrolling', 'no').attr('src', src);

        var $input = $('<input>').attr('type', 'hidden').attr('id', 'sid').val(data.sessionid);

        $('.js-data-collector').html($iframe).append($input);

        var $inputMfaForm = $input;
        $inputMfaForm.attr('id', 'sessionId').attr('name', 'sessionId').val(data.sessionid);

        $mfaForm.append($inputMfaForm);
    };

    var init = function () {
        if (!APP.global.isEditMode()) {
            getPagePaths();
            chkCookiesAndRedirect();
            if (!chkCookiesAndRedirect()) {
                getElemsReferrences();
                registerEventHandlers();
                createVueApp();
                readMfaCookie();
                setInitialView();
            }
        } else {
            $(mfaFormElemID).show();
        }

        if (APP.global.isDebugMode()) {
            console.log('MFA App::', mfaApp);
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formUpdatePassword = (function () {
    
    var $updatePasswordForm;
    
    var templates = {
        error: '' +
            '<div class=\'u-page-error\'>{msg}</div>'
    };
    
    var updatePasswordFormSuccess = function ( res ) {
        APP.global.hideLoader();
        $updatePasswordForm[0].reset();
        var msg;
        if( res.data ) {
            msg = 'Successfully Updated!';
        }
        else {
            msg = 'Failure! Can not be updated!';
        }
        APP.global.removeError();   
        $updatePasswordForm.append(APP.registration.generateMarkup(templates.error, {
            msg: msg
        })); 
    };
    
    var updatePasswordFormFailure = function ( jqXHR, textStatus ) {
        APP.global.hideLoader();
        $updatePasswordForm[0].reset();
        APP.global.getErrorMsg(jqXHR, $updatePasswordForm);       
    };
    
    var updatePasswordFormHandler = function(e) {
        e.preventDefault();
        // APP.global.removeError();   
        // var $this = $(this);
        // var actionURL = $this.attr('action');
        // var formData = $this.serialize();
        // if( $this.parsley().isValid() ) {
        //     APP.global.postFormData(
        //         actionURL,
        //         formData,
        //         APP.formUpdatePassword.updatePasswordFormSuccess,
        //         APP.formUpdatePassword.updatePasswordFormFailure
        //     );
        // }
        APP.manageProfile.updatePassword($(this), 
            updatePasswordFormSuccess,
            updatePasswordFormFailure
        );
    };

    var bindEventsToUI = function () {
        $updatePasswordForm.on('submit', updatePasswordFormHandler);
    };

    var init = function (element) {
        // console.log('APP.formUpdatePassword');
        
        $updatePasswordForm = $('.js-form-update-password');
        bindEventsToUI();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        updatePasswordFormSuccess: updatePasswordFormSuccess,
        updatePasswordFormFailure: updatePasswordFormFailure
    };

}());
/*globals Vue:false */

'use strict';
var APP = (window.APP = window.APP || {});
APP.formTransferBalance = (function () {
    var tranferBalanceVue;
    var allCardList = [];
    var totalAmount = 0,
        amountTransfer = 0;

    var getListOnChangeCardList = function (cardSelected, data) {
        tranferBalanceVue.cardListTransfer = data.filter(function (i) {
            return i !== data[cardSelected];
        });
        $('.js-total-amount').html('$0<sup class="form-transfer-balance__balance-cent">.00</sup>');
        $('.js-transfer-checkbox input:checked').prop('checked', false);
    };

    var setTotalBalance = function () {
        totalAmount = 0;
        amountTransfer = 0;

        $('.js-transfer-checkbox input:checked').each(function () {
            totalAmount += parseFloat($(this).attr('data-amount'));
        });

        amountTransfer = totalAmount;

        var ddCard = APP.transferBalanceManagementForm.cardSelectorHandler();
        totalAmount += ddCard.balance.balance;

        var balance = APP.transferBalanceManagementForm.formatBalance(totalAmount);
        var amount = '$' + balance.dollar + '<sup class="form-transfer-balance__balance-cent">.' + balance.cents + '</sup>';

        $('.js-total-amount').html(amount);
    };

    var errorMsg = function (msg) {
        var error = '<div class="u-page-error js-transfer-balance-error">' + msg + '</div>';

        if ($('.js-transfer-balance-error').length === 0) {
            $('.js-form-transfer-balance').prepend(error);
        } else {
            $('.js-transfer-balance-error').html(msg);
        }

        APP.global.focusError();
    };

    var checkboxValidation = function () {
        var result = false;
        var countChecked = $('.js-transfer-checkbox input:checked').length;

        if (countChecked === 0) {
            errorMsg('Please select a card to start Balance Transfer');
        } else if (countChecked > 3) {
            errorMsg("You can only transfer value from three Dunkin' Cards at a time, with a maximum of 10 per day");
        } else if (totalAmount > 125) {
            errorMsg("For your security, Dunkin' Cards cannot exceed $125. Please try this merge again with fewer Dunkin' Cards.");
        } else {
            $('.js-transfer-balance-error').remove();
            result = true;
        }

        return result;
    };

    var bindEventsToUI = function (element) {
        tranferBalanceVue = new Vue({
            el: element,

            data: {
                cardListTransfer: [],
            },

            methods: {
                totalBalance: setTotalBalance,
            },
        });

        if (APP.transferBalanceManagementForm && typeof APP.transferBalanceManagementForm.getAllCardList === 'function') {
            var cardsData = APP.transferBalanceManagementForm.getAllCardList();

            if (cardsData) {
                tranferBalanceVue.cardListTransfer = cardsData.filter(function (i) {
                    return i !== cardsData[0];
                });
            }
        }

        $('.js-form-transfer-balance').on('click', '.js-dd-card-masked-toggle', function (e) {
            e.preventDefault();

            $(this).parent().find('.js-dd-card, .js-dd-card-masked').toggle();
            $(this).find('.js-dd-card-masked-toggle-text, .js-dd-card-toggle-text').toggle();
        });

        //Click to Review Btn
        $('.js-form-transfer-balance').on('click', '.js-transfer-balance-btn', function (e) {
            e.preventDefault();
            var result = checkboxValidation();

            if (result === true) {
                APP.global.showLoader();
                var cardsSelected = [];

                $('.js-transfer-checkbox input:checked').each(function () {
                    cardsSelected.push($(this).val());
                });

                APP.transferBalanceManagementForm.getCardSelected(cardsSelected);
                APP.transferBalanceManagementForm.cardSelectorHandler();
                APP.transferBalanceManagementForm.getConfirmTotalAmount(amountTransfer);
                APP.transferBalanceManagementForm.submitReview();
            }
        });
    };

    var init = function (element) {
        // console.log('APP.formTransferBalance');
        if (window.Cookies.get('wcmmode') === 'edit') {
            return;
        }
        bindEventsToUI(element);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        getListOnChangeCardList: getListOnChangeCardList,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formSubmitResetPassword = (function () {
    var config;
    var cache;
    var defaults = {
        resetForm: '.js-resetform',
        successMesg: '.js-success',
        errorMesg: '.js-error',
    };

    var bindEventsToUI = function () {
        cache.$resetForm.on('submit', function (event) {
            event.preventDefault();
            if ($(this).parsley().isValid()) {
                APP.analytics.fireCategoryEvent(
                    APP.analytics.EventCategories.MANAGE_ACCOUNT,
                    APP.analytics.Events.CLICK,
                    $('.js-formSubmitResetPassword .js-send .u-cta').val().trim()
                );
                APP.global.showLoader();
                $.ajax({
                    type: 'POST',
                    url: '/bin/servlet/password',
                    data: $('.js-resetform').serialize(),
                    success: function (response) {
                        console.log(response);
                        cache.$successMesg.show();
                        cache.$resetForm.hide();
                        APP.global.hideLoader();
                    },
                    error: function (jqXHR) {
                        var response = JSON.parse(jqXHR.responseText);
                        cache.$resetForm.show();
                        cache.$resetForm.find('.js-status-notes, .u-page-error').remove();
                        APP.global.getErrorMsg(jqXHR, cache.$resetForm);
                        cache.$successMesg.hide();
                        APP.global.hideLoader();
                    },
                    dataType: 'html',
                });
            }
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formSubmitResetPassword');*/
    };

    var init = function (element, params) {
        config = $.extend(true, {}, defaults, params || {});

        //Set repetitive DOM lookups in cache
        cache = {
            $resetForm: $(config.resetForm),
            $successMesg: $(config.successMesg),
            $errorMesg: $(config.errorMesg),
        };

        console.log('APP.formSubmitResetPassword');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formSubmitResetPassword');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';
var APP = (window.APP = window.APP || {});
APP.formSimplifiedRegistration = (function () {
    var $registrationForm;
    var $address;
    var profile = {
        email: '',
        firstName: '',
        lastName: '',
        profileZip: '',
        birthday: '',
        registrationCode: '',
    };
    var mfaPageURL = '';
    var referrer = '';
    var shellOfferURL;

    var getHTMLMsg = function (msg) {
        var $msg = $(['<p class="form-notes js-status-notes">', msg, '</p>'].join('\n'));
        return $msg;
    };
    var updateProfileObject = function () {
        profile.email = $registrationForm.find('#email').val();
        profile.firstName = $registrationForm.find('#firstName').val();
        profile.lastName = $registrationForm.find('#lastName').val();
        profile.profileZip = $registrationForm.find('#profileZipCode').val();
        profile.registrationCode = $registrationForm.find('#promo').val();
        profile.birthday = $registrationForm.find('#birthdayDay').val() + '-' + $registrationForm.find('#birthdayMonth').val() + '-1904';
        return profile;
    };
    var registrationFormSuccessMT = function (response) {
        if (response.data.success) {
            APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.PERKS_REGISTRATION, APP.analytics.Events.CLICK, 'Continue - Info - Step 1');

            if (APP.login.isLoggedIn()) {
                // user is registered and logged in. Start logic to handle redirect timeout
                APP.timeout.initIdleTimeout();
            }

            updateProfileObject();
            // APP.registrationMT.updateRegistrationDetails({
            // profile: profile
            // });
            if (response.data.addressID) {
                APP.registrationMT.setProfileAddressId(response.data.addressID);
            }
            //APP.formDDNationRegistration.redirectDDNationRegistrationCallback();
            // Check which registration process should be followed if the registration is for DDNation
            // if (APP.formDDNationRegistration && APP.formDDNationRegistration.isDDNationRegistrationForm()) {
            // APP.formDDNationRegistration.redirectDDNationRegistrationCallback();
            // }
            //updateCookie();
            APP.hiddenMessageJS.setCookie('registered_user', true);
            window.onbeforeunload = function () {};
            if (response.data.isMFARequired) {
                // MFA Configuration redirection
                window.location.href = APP.redirectionComponent.addQueryParamInMfaUrl(mfaPageURL);
            } else if (APP.global.getPageReferrer().indexOf('shell-offer') != -1) {
                window.location.href = shellOfferURL;
            } else {
                window.location.href = $('#perksDashboardPage').val();
            }
        }
    };
    var registrationFormFailureMT = function (jqXHR, textStatus) {
        var response = JSON.parse(jqXHR.responseText);
        APP.registrationMT.showError(response.error.message);
        APP.recaptcha.renderRecaptcha();
    };
    var registrationFormHandler = function () {
        APP.registrationMT.removeErrors();
        if (APP.recaptcha.validateRecaptcha($registrationForm)) {
            return;
        }
    };
    // Callback function to be executed after recaptcha is succesfull
    var formSubmit = function () {
        var actionURL = $registrationForm.attr('action');
        var formData = $registrationForm.serialize();
        var zipCode = $registrationForm.get(0).profileZipCode.value;
        var hasZipCode = zipCode ? true : false;
        var isCaliforniaZipCode;
        
        APP.registrationMT.postData(
            actionURL,
            undefined,
            undefined,
            formData,
            function (response) {
                if(hasZipCode){
                    APP.googleMap.isCaliforniaZipCode(zipCode).done(function(){
                        isCaliforniaZipCode = true;
                    }).fail(function(){
                        isCaliforniaZipCode = false;
                    }).always(function(){
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'zip_code',
                            'has_zip' : hasZipCode,
                            'is_CA': isCaliforniaZipCode
                        });
                        APP.global.hideLoader();
                        registrationFormSuccessMT(response);
                    });
                }
                else{
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event' : 'zip_code',
                        'has_zip' : hasZipCode,
                    });
                    APP.global.hideLoader();
                    registrationFormSuccessMT(response);
                }
            },
            function (jqXHR, textStatus) {
                APP.global.hideLoader();
                registrationFormFailureMT(jqXHR, textStatus);
            }
        );
    };
    var bindProfileData = function (response) {
        var data = response.data;
        $registrationForm.find('#email').val(data.email);
        $registrationForm.find('#firstName').val(data.firstName);
        $registrationForm.find('#lastName').val(data.lastName);
        $registrationForm.find('#profileZipCode').val(data.profileZip);
        $registrationForm.find('#promo').val(data.registrationCode);
        var birthDate = new Date(data.dateOfBirth);
        if (!$.isEmptyObject(birthDate.dateOfBirth)) {
            var monthKey = APP.registrationMT.months[birthDate.getMonth()][0];
            APP.formSelect.changeSelection($registrationForm.find('#birthdayMonth'), monthKey);
            APP.formSelect.changeSelection($registrationForm.find('#birthdayDay'), birthDate.getDate());
        }
    };
    var populateUserData = function () {
        APP.registrationMT.postData(
            '/bin/servlet/profile',
            undefined,
            'application/json',
            JSON.stringify({
                service: 'getProfileInfo',
            }),
            function (response) {
                bindProfileData(response);
            },
            function (jqXHR, textStatus) {
                registrationFormFailureMT(jqXHR, textStatus);
            }
        );
    };
    var setCookie = function (name, value, expired) {
        if (!expired) {
            expired = 31;
        }
        var expireDate = new Date();
        expireDate.setDate(expireDate.getDate() + expired);
        document.cookie = name + '=' + escape(value) + '; expires=' + expireDate.toGMTString() + '; path=/';
    };
    var deleteCookie = function (name) {
        document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    };
    var updateCookie = function () {
        var flag = false;
        $registeredUserCookie = window.Cookies.get('registered_user');
        if ($registeredUserCookie) {
            deleteCookie('registered_user');
        } else {
            setCookie('registered_user', true);
            flag = true;
        }
        return flag;
    };
    var showMessage = function () {
        $registeredUserCookie = window.Cookies.get('registered_user');
        if ($registeredUserCookie) {
            deleteCookie('registered_user');
        } else {
            setCookie('registered_user', true);
        }
    };
    var disablePasswordFields = function () {
        $registrationForm.find('#password').removeAttr('required').parents('.grid__item').hide();
        $registrationForm.find('#confirmPassword').removeAttr('required').parents('.grid__item').hide();
    };
    var enablePasswordFields = function () {
        $registrationForm.find('#password').attr('required', 'required').parents('.grid__item').show();
        $registrationForm.find('#confirmPassword').attr('required', 'required').parents('.grid__item').show();
    };
    /* Automatically called when this component is displayed in registration flow */
    var onComponentShow = function (registrationDetailsObject) {
        enablePasswordFields();
        if (APP.login.isLoggedIn()) {
            if (APP.login.isDDPerksUser()) {
                window.onbeforeunload = function () {};
                window.location.href = $('#perksDashboardPage').val();
            } else {
                $registrationForm.find('#service').val('updateProfileInfo');
                disablePasswordFields();
                populateUserData();
            }
        }
    };
    var bindEventsToUI = function () {
        $registrationForm.parsley().on('form:submit', function (e) {
            registrationFormHandler();
            return false;
        });
        var fuelFlow = APP.cookie.getPartnerPromo() ? true : false;
        if (fuelFlow) {
            $('#promo').parents('.form-input').hide();
        }
    };
    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formRegistration'); */
    };

    var init = function (element) {
        $registrationForm = $('.js-form-simplified-registration');
        mfaPageURL = $('#mfaPage').val();
        shellOfferURL = $('#shellOfferPath').val();

        APP.kountDataCollector.init($registrationForm);

        var email = APP.registrationMT.getQueryParameter('email');
        if (email !== null && email !== '') {
            $registrationForm.find('#email').val(email);
        }
        bindEventsToUI();
        // Initialize the recaptcha with the given callback
        APP.recaptcha.initRecaptcha(formSubmit);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        getHTMLMsg: getHTMLMsg,
        onComponentShow: onComponentShow,
        setCookie: setCookie,
        deleteCookie: deleteCookie,
        showMessage: showMessage,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formResetPassword = (function () {
    var pageUrl = '';
    var queryParameter = '';

    var config;
    var cache;
    var defaults = {
        formResetPassword: '.js-form-reset-password',
        successMesg: '.js-success',
        errorMesg: '.js-error',
    };
    var bindEventsToUI = function () {
        if (queryParameter) {
            APP.global.showLoader();
            $.ajax({
                type: 'GET',
                url: '/bin/servlet/password',
                data: queryParameter,
                success: function (response) {
                    if (response.data) {
                        $('.js-form-reset-password fieldset').append(
                            '<input type="hidden" name="id" value=' + response.data + '>'
                        );
                        $('.js-form-reset-password').show();
                    }
                },
                error: function (jqXHR) {
                    var response = JSON.parse(jqXHR.responseText);
                    var $msg = APP.formRegistration.getHTMLMsg(response.error.message);
                    cache.$formResetPassword.find('.js-status-notes, .u-page-error').remove();
                    $msg.addClass('u-page-error');
                    $msg.insertAfter(cache.$formResetPassword);
                    cache.$formResetPassword.hide();
                    APP.global.hideLoader();
                },
            });
        } else {
            var tokenMissingMsg = 'Sorry, this page cannot be found. Please try/click the reset link you received again.';
            var $msg = APP.formRegistration.getHTMLMsg(tokenMissingMsg);
            cache.$formResetPassword.find('.js-status-notes, .u-page-error').remove();
            $msg.addClass('u-page-error');
            $msg.insertAfter(cache.$formResetPassword);
            cache.$formResetPassword.hide();
        }
        $('.js-form-reset-password').on('submit', function (event) {
            event.preventDefault();
            if ($(this).parsley().isValid()) {
                APP.global.showLoader();
                APP.global.removeError();
                $.ajax({
                    type: 'POST',
                    url: '/bin/servlet/password',
                    data: $('.js-form-reset-password').serialize(),
                    success: function (response) {
                        console.log(response);
                        cache.$formResetPassword.hide();
                        cache.$successMesg.show();
                        APP.global.hideLoader();
                    },
                    error: function (jqXHR) {
                        var response = JSON.parse(jqXHR.responseText);
                        var $msg = APP.formRegistration.getHTMLMsg(
                            'Error: ' + response.error.code + ' | ' + response.error.message
                        );
                        cache.$formResetPassword.find('.js-status-notes, .u-page-error').remove();
                        $msg.addClass('u-page-error');
                        $msg.insertAfter(cache.$formResetPassword);
                        cache.$formResetPassword.show();
                        APP.global.hideLoader();
                    },
                    dataType: 'html',
                });
            }
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formResetPassword'); */
    };

    var init = function (element, params) {
        config = $.extend(true, {}, defaults, params || {});

        //Set repetitive DOM lookups in cache
        cache = {
            $formResetPassword: $(config.formResetPassword),
            $successMesg: $(config.successMesg),
            $errorMesg: $(config.errorMesg),
        };
        pageUrl = $(location).attr('href');
        var token = new RegExp('token' + '=([^&#]*)').exec(pageUrl);
        if (token !== null) {
            queryParameter = token[0];
        }
        console.log('APP.formResetPassword');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formResetPassword');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formRegistration = (function () {
    var $registrationForm;
    var $address;
    var profile = {
        email: '',
        firstName: '',
        lastName: '',
        profileZip: '',
        birthday: '',
        registrationCode: '',
        address: {
            firstStreet: '',
            secondStreet: '',
            city: '',
            state: '',
            zipCode5: '',
        },
    };

    var getHTMLMsg = function (msg) {
        var $msg = $(['<p class="form-notes js-status-notes">', msg, '</p>'].join('\n'));
        return $msg;
    };

    var updateProfileObject = function () {
        profile.email = $registrationForm.find('#email').val();
        profile.firstName = $registrationForm.find('#firstName').val();
        profile.lastName = $registrationForm.find('#lastName').val();
        profile.profileZip = $registrationForm.find('#profileZipCode').val();
        profile.registrationCode = $registrationForm.find('#promo').val();
        profile.birthday =
            $registrationForm.find('#birthdayDay').val() + '-' + $registrationForm.find('#birthdayMonth').val() + '-1904';
        profile.address = {};
        if ($registrationForm.find('#streetAddressOne').val() !== '') {
            profile.address.firstStreet = $registrationForm.find('#streetAddressOne').val();
            profile.address.secondStreet = $registrationForm.find('#streetAddressTwo').val();
            profile.address.city = $registrationForm.find('#city').val();
            profile.address.state = $registrationForm.find('#state').val();
            profile.address.zipCode5 = $registrationForm.find('#zipCode').val();
        }
        return profile;
    };

    var registrationFormSuccess = function (response) {
        if (response.data.success) {
            APP.analytics.fireCategoryEvent(
                APP.analytics.EventCategories.PERKS_REGISTRATION,
                APP.analytics.Events.CLICK,
                'Continue - Info - Step 1'
            );

            if (APP.login.isLoggedIn()) {
                // user is registered and logged in. Start logic to handle redirect timeout
                APP.timeout.initIdleTimeout();
            }

            updateProfileObject();
            APP.registration.updateRegistrationDetails({
                profile: profile,
            });
            if (response.data.addressID) {
                APP.registration.setProfileAddressId(response.data.addressID);
            }

            // Check which registration process should be followed if the registration is for DDNation
            if (APP.formDDNationRegistration && APP.formDDNationRegistration.isDDNationRegistrationForm()) {
                APP.formDDNationRegistration.redirectDDNationRegistrationCallback();
            } else {
                APP.registration.nextState();
            }
        }
    };

    var registrationFormFailure = function (jqXHR, textStatus) {
        var response = JSON.parse(jqXHR.responseText);
        APP.registration.showError(response.error.message);
        APP.recaptcha.renderRecaptcha();
    };

    var registrationFormHandler = function (e) {
        e.preventDefault();
        var $this = $(this);
        var actionURL = $this.attr('action');
        var formData = $this.serialize();
        APP.registration.removeErrors();

        if ($this.parsley().isValid()) {
            if (APP.recaptcha.validateRecaptcha($registrationForm)) {
                return;
            }

            /*   APP.registration.postData(
                actionURL,
                undefined,
                undefined,
                formData,
                function (response) {
                    APP.global.hideLoader();
                    registrationFormSuccess(response);
                },
                function (jqXHR, textStatus) {
                    APP.global.hideLoader();
                    registrationFormFailure(jqXHR, textStatus);
                }
            ); */
        }
    };

    // Callback function to be executed after recaptcha is succesfull
    var formSubmit = function () {
        var actionURL = $registrationForm.attr('action');
        var formData = $registrationForm.serialize();

        APP.registration.postData(
            actionURL,
            undefined,
            undefined,
            formData,
            function (response) {
                APP.global.hideLoader();
                registrationFormSuccess(response);
            },
            function (jqXHR, textStatus) {
                APP.global.hideLoader();
                registrationFormFailure(jqXHR, textStatus);
            }
        );
    };

    var bindProfileData = function (response) {
        var data = response.data;
        $registrationForm.find('#email').val(data.email);
        $registrationForm.find('#firstName').val(data.firstName);
        $registrationForm.find('#lastName').val(data.lastName);
        $registrationForm.find('#profileZipCode').val(data.profileZip);
        $registrationForm.find('#promo').val(data.registrationCode);

        var birthDate = new Date(data.dateOfBirth);

        if (!$.isEmptyObject(birthDate.dateOfBirth)) {
            var monthKey = APP.registration.months[birthDate.getMonth()][0];
            APP.formSelect.changeSelection($registrationForm.find('#birthdayMonth'), monthKey);
            APP.formSelect.changeSelection($registrationForm.find('#birthdayDay'), birthDate.getDate());
        }

        if (data.addressList) {
            var addMoreButton = $registrationForm.find('.js-add-more-button-link');
            if (!addMoreButton.hasClass('is-active')) {
                addMoreButton.trigger('click');
            }
            var addressObject = data.addressList[0];
            $registrationForm.find('#streetAddressOne').val(addressObject.firstStreet);
            $registrationForm.find('#streetAddressTwo').val(addressObject.secondStreet);
            $registrationForm.find('#city').val(addressObject.city);
            $registrationForm.find('#zipCode').val(addressObject.zipCode5);
            APP.formSelect.changeSelection($registrationForm.find('#state'), addressObject.state);
            $registrationForm.find('#encryptedAddressId').val(addressObject.encryptedAddressId);
        }
    };

    var populateUserData = function () {
        APP.registration.postData(
            '/bin/servlet/profile',
            undefined,
            'application/json',
            JSON.stringify({
                service: 'getProfileInfo',
            }),
            function (response) {
                bindProfileData(response);
            },
            function (jqXHR, textStatus) {
                registrationFormFailure(jqXHR, textStatus);
            }
        );
    };

    var disablePasswordFields = function () {
        $registrationForm.find('#password').removeAttr('required').parents('.grid__item').hide();
        $registrationForm.find('#confirmPassword').removeAttr('required').parents('.grid__item').hide();
    };

    var enablePasswordFields = function () {
        $registrationForm.find('#password').attr('required', 'required').parents('.grid__item').show();
        $registrationForm.find('#confirmPassword').attr('required', 'required').parents('.grid__item').show();
    };

    /* Automatically called when this component is displayed in registration flow */
    var onComponentShow = function (registrationDetailsObject) {
        enablePasswordFields();
        if (APP.login.isLoggedIn()) {
            if (APP.login.isDDPerksUser()) {
                window.onbeforeunload = function () {};
                window.location.href = $('#perksDashboardPage').val();
            } else {
                $registrationForm.find('#service').val('updateProfileInfo');
                disablePasswordFields();
                populateUserData();
            }
        }
    };

    var addressValidationHandler = function (e) {
        if (
            $address.streetAddressOne.val() !== '' ||
            $address.streetAddressTwo.val() !== '' ||
            $address.city.val() !== '' ||
            $address.state.val() !== '' ||
            $address.zipCode.val() !== ''
        ) {
            if (!$address.streetAddressOne.prop('required')) {
                $address.streetAddressOne.prop('required', 'required');
                $address.city.prop('required', 'required');
                $address.state.prop('required', 'required');
                $address.zipCode.prop('required', 'required');
            }
        } else {
            if ($address.streetAddressOne.prop('required')) {
                $address.streetAddressOne.prop('required', false);
                $address.city.prop('required', false);
                $address.state.prop('required', false);
                $address.zipCode.prop('required', false);
            }
        }
    };

    var addAddressHandler = function (e) {
        e.preventDefault();

        $registrationForm.find('.add-more-button .form-select--default').attr('disabled', false);

        $(this).off('click');
        var idsToShow = $(this).data('toggle').split(',');
        $(this).removeAttr('data-toggle');
        var idToShow;
        for (var i = 0; i < idsToShow.length; i++) {
            idToShow = '#' + idsToShow[i].trim();
            $(idToShow).slideToggle();
        }
        $(this).on('click', function (e) {
            e.preventDefault();
        });
    };

    var bindEventsToUI = function () {
        $registrationForm.on('submit', registrationFormHandler);
        $registrationForm.find('.js-add-more-button-link').on('click', addAddressHandler);
        // $registrationForm.on('keyup', '#streetAddressOne, #streetAddressTwo, #city, #zipCode', addressValidationHandler);
        // $registrationForm.find('#state').on('change', addressValidationHandler);

        var fuelFlow = APP.cookie.getPartnerPromo() ? true : false;

        if (fuelFlow) {
            $('#promo').parents('.form-input').hide();
        }

        $registrationForm.find('.add-more-button .form-select--default').attr('disabled', true);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formRegistration'); */
    };

    var init = function (element) {
        // console.log('APP.formRegistration');
        $registrationForm = $('.js-form-registration');
        $address = {
            streetAddressOne: $registrationForm.find('#streetAddressOne'),
            streetAddressTwo: $registrationForm.find('#streetAddressTwo'),
            city: $registrationForm.find('#city'),
            state: $registrationForm.find('#state'),
            zipCode: $registrationForm.find('#zipCode'),
        };
        var email = APP.registration.getQueryParameter('email');
        if (email !== null && email !== '') {
            $registrationForm.find('#email').val(email);
        }
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formRegistration');

        // Initialize the recaptcha with the given callback
        APP.recaptcha.initRecaptcha(formSubmit);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        getHTMLMsg: getHTMLMsg,
        onComponentShow: onComponentShow,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formRegPayment = (function () {
    var $regPaymentForm;
    var regObject;
    var regPaymentObject = {
        creditcard: {
            cardNumber: '',
            type: 'VISA',
            cardSecurityCode: '',
            expMonth: '',
            expYear: '',
            address: {
                firstName: '',
                lastName: '',
                firstStreet: '',
                secondStreet: '',
                city: '',
                state: '',
                zipCode5: '',
            },
        },
    };

    var updateRegPaymentObject = function () {
        regPaymentObject.creditcard.cardNumber = $regPaymentForm.find('#creditCardNumber').val();
        var cardObject = APP.registration.getCardType(regPaymentObject.creditcard.cardNumber);
        var cardObjectProperty = 'card_type';
        regPaymentObject.creditcard.type = APP.registration.creditCardTypes[cardObject[cardObjectProperty].name][0];
        regPaymentObject.creditcard.cardSecurityCode = $regPaymentForm.find('#creditCardPin').val();
        regPaymentObject.creditcard.expMonth = APP.registration.months.indexOf($regPaymentForm.find('#creditCardMonth').val()) + 1;
        regPaymentObject.creditcard.expYear = $regPaymentForm.find('#creditCardYear').val();
        regPaymentObject.creditcard.address.firstName = $regPaymentForm.find('#firstName').val();
        regPaymentObject.creditcard.address.lastName = $regPaymentForm.find('#lastName').val();
        regPaymentObject.creditcard.address.firstStreet = $regPaymentForm.find('#streetAddressOne').val();
        regPaymentObject.creditcard.address.secondStreet = $regPaymentForm.find('#streetAddressTwo').val();
        regPaymentObject.creditcard.address.city = $regPaymentForm.find('#city').val();
        regPaymentObject.creditcard.address.state = $regPaymentForm.find('#state').val();
        regPaymentObject.creditcard.address.zipCode5 = $regPaymentForm.find('#zipCode').val();
        var $SameAsMailingAddressCheckbox = $regPaymentForm.find('.js-checkbox input');
        if ($SameAsMailingAddressCheckbox.prop('checked')) {
            regPaymentObject.creditcard.address.encryptedAddressId = APP.registration.getProfileAddressId();
        } else {
            delete regPaymentObject.creditcard.address.encryptedAddressId;
        }
    };

    var validateCCExpiry = function (expYear, expMonth) {
        expMonth = APP.registration.months.indexOf(expMonth);
        var expDate;
        var today, expiryDay;

        if (expMonth === 1) {
            expDate = 28;
        } else if ([0, 2, 4, 6, 7, 9, 11].indexOf(expMonth) >= 0) {
            expDate = 31;
        } else {
            expDate = 30;
        }

        today = new Date();
        expiryDay = new Date();
        expiryDay.setFullYear(expYear, expMonth, expDate);

        if (expiryDay >= today) {
            return true;
        } else {
            return false;
        }
    };

    var regPaymentFormHandler = function ($elem) {
        var $this = $elem;
        var cardObject = APP.registration.getCardType($regPaymentForm.find('#creditCardNumber').val());
        var cardObjectProperty = 'card_type';
        var isValidCard = cardObject[cardObjectProperty] !== null ? true : false;
        var ccExpiryMonth = $this.find('#creditCardMonth').val();
        var ccExpiryYear = $this.find('#creditCardYear').val();
        var isExpiryValid = validateCCExpiry(ccExpiryYear, ccExpiryMonth);
        APP.registration.removeErrors();
        if (isValidCard && isExpiryValid) {
            updateRegPaymentObject();
            APP.registration.updateRegistrationDetails(regPaymentObject);
            APP.registration.setVisaCheckout(false);
            APP.registration.nextState();

            // if registration page
            if (window.location.href.indexOf('registration') !== -1) {
                APP.analytics.fireCategoryEvent(
                    APP.analytics.EventCategories.PERKS_REGISTRATION,
                    APP.analytics.Events.CLICK,
                    $('.u-cta', $regPaymentForm).data('track')
                );
            }
        }
        if (!isValidCard) {
            APP.registration.showError(window.CQ.I18n.getMessage('registration.invalidCreditCard'));
        }
        if (!isExpiryValid) {
            APP.registration.showError(window.CQ.I18n.getMessage('registration.invalidCCExpiry'));
        }
    };

    var populateAddressData = function (userDetails) {
        $regPaymentForm.find('#firstName').val(userDetails.firstName).prop('disabled', true);
        $regPaymentForm.find('#lastName').val(userDetails.lastName).prop('disabled', true);
        $regPaymentForm.find('#streetAddressOne').val(userDetails.address.firstStreet).prop('disabled', true);
        $regPaymentForm.find('#streetAddressTwo').val(userDetails.address.secondStreet).prop('disabled', true);
        $regPaymentForm.find('#city').val(userDetails.address.city).prop('disabled', true);
        $regPaymentForm.find('#zipCode').val(userDetails.address.zipCode5).prop('disabled', true);

        APP.formSelect.changeSelection($regPaymentForm.find('#state'), userDetails.address.state);
        $regPaymentForm.find('#state').prop('disabled', true);
    };

    var removeAddressData = function () {
        $regPaymentForm.find('#firstName').val('').prop('disabled', false);
        $regPaymentForm.find('#lastName').val('').prop('disabled', false);
        $regPaymentForm.find('#streetAddressOne').val('').prop('disabled', false);
        $regPaymentForm.find('#streetAddressTwo').val('').prop('disabled', false);
        $regPaymentForm.find('#city').val('').prop('disabled', false);
        $regPaymentForm.find('#zipCode').val('').prop('disabled', false);

        APP.formSelect.changeSelection($regPaymentForm.find('#state'), null);
        $regPaymentForm.find('#state').prop('disabled', false);
    };

    /* Automatically called when this component is displayed in registration flow */
    var onComponentShow = function (registrationDetailsObject) {
        regObject = registrationDetailsObject;
        var userAddress = registrationDetailsObject.profile.address;
        var isAddressAvailable = userAddress && Object.keys(userAddress).length !== 0 ? true : false;
        if (isAddressAvailable) {
            $regPaymentForm.find('.js-checkbox').first().show().find('input').prop('checked', true);
            populateAddressData(registrationDetailsObject.profile);
        } else {
            $regPaymentForm.find('.js-checkbox').first().hide();
        }
        /* Clear sensitive information like credit card details */
        $regPaymentForm.find('#creditCardNumber').val('');
        $regPaymentForm.find('#creditCardPin').val('');

        APP.formSelect.changeSelection($regPaymentForm.find('#creditCardMonth, #creditCardYear'), 0);
    };

    var resetState = function () {
        APP.formSelect.changeSelection($regPaymentForm.find('#creditCardMonth, #creditCardYear, #state'), 0);
    };

    var toggleAddress = function (e) {
        var isChecked = $(this).prop('checked');
        if (isChecked) {
            populateAddressData(regObject.profile);
        } else {
            removeAddressData();
        }
    };

    var bindEventsToUI = function () {
        $regPaymentForm.parsley().on('form:submit', function (e) {
            regPaymentFormHandler(this.$element);
            return false;
        });
        $('body').on('click', '.v-button', function () {
            APP.global.showLoader();
        });
        $regPaymentForm.on('click', '.js-checkbox input', toggleAddress);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formRegPayment'); */
    };

    var init = function (element) {
        // console.log('APP.formRegPayment');
        $regPaymentForm = $('.js-reg-payment-form');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formRegPayment');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        onComponentShow: onComponentShow,
        resetState: resetState,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formRegAddAmount = (function () {
    var $regAddAmountForm;
    var registrationDetailsObject;
    var cardBalance = 0;
    var minBalance = 2;
    var addAmountObject = {
        recharge: {
            amount: 0,
        },
        autoRecharge: {
            amount: '',
            type: '',
            frequency: '',
        },
        skip: false,
    };

    var skipAddAmount = function (e) {
        e.preventDefault();
        if (cardBalance >= minBalance) {
            addAmountObject.recharge = {};
            addAmountObject.autoRecharge = {};
            addAmountObject.creditcard = {};
            addAmountObject.skip = true;
            APP.registration.updateRegistrationDetails(addAmountObject);
            APP.registration.nextState(true); // Skip payment screen as no value added for payment.
        } else {
            APP.registration.showError(window.CQ.I18n.getMessage('registration.lowCardBalance'));
        }
    };

    var regAddAmountFormHandler = function (e) {
        e.preventDefault();
        var $this = $(this);
        if ($this.parsley().isValid()) {
            APP.registration.removeErrors();
            var valueAdded = $regAddAmountForm.find('#amount').val();
            if ((valueAdded && valueAdded + cardBalance >= minBalance) || cardBalance >= minBalance) {
                var autoReload = $regAddAmountForm.find('input[name="auto-reload"]:checked').val();
                addAmountObject.recharge.amount = valueAdded;
                addAmountObject.skip = false;
                if (autoReload === 'yes') {
                    if ($regAddAmountForm.find('.js-navigation li.js-active').index() === 0) {
                        addAmountObject.autoRecharge.frequency = $regAddAmountForm.find('#auto-reload-balance-minimum').val();
                        addAmountObject.autoRecharge.type = 'THRESHOLD';
                        addAmountObject.autoRecharge.amount = $regAddAmountForm.find('#auto-reload-balance-reload-amount').val();
                    } else {
                        addAmountObject.autoRecharge.type = $regAddAmountForm.find('#auto-reload-schedule-frequency').val().toUpperCase();
                        if (addAmountObject.autoRecharge.type === 'MONTHLY') {
                            addAmountObject.autoRecharge.frequency = $regAddAmountForm.find('#schedule-monthly-frequency').val();
                            addAmountObject.autoRecharge.amount = $regAddAmountForm.find('#schedule-monthly-amount').val();
                        } else {
                            addAmountObject.autoRecharge.frequency = $regAddAmountForm.find('#schedule-weekly-frequency').val();
                            addAmountObject.autoRecharge.amount = $regAddAmountForm.find('#schedule-weekly-amount').val();
                        }
                    }
                    APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.PERKS_REGISTRATION, APP.analytics.Events.CLICK, 'yes');
                } else {
                    addAmountObject.autoRecharge = {};
                    APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.PERKS_REGISTRATION, APP.analytics.Events.CLICK, 'no');
                }

                APP.registration.updateRegistrationDetails(addAmountObject);

                if (
                    valueAdded > 0 &&
                    registrationDetailsObject.enrollmentType !== 'Physical' &&
                    registrationDetailsObject.enrollmentType !== 'Purchase'
                ) {
                    APP.registration.updateRegistrationDetails({
                        enrollmentType: 'MR',
                    });
                }

                APP.analytics.fireCategoryEvent(
                    APP.analytics.EventCategories.PERKS_REGISTRATION,
                    APP.analytics.Events.CLICK,
                    $('.u-cta', $regAddAmountForm).data('track')
                );

                APP.registration.nextState();
            } else {
                APP.registration.showError(window.CQ.I18n.getMessage('registration.lowCardBalance'));
            }
        }
    };

    var onComponentShow = function (registrationDetails) {
        registrationDetailsObject = registrationDetails;
        cardBalance = APP.registration.getCardBalance();
        if (cardBalance < minBalance) {
            $regAddAmountForm.find('.js-ddcard-available-balance').text("How much do you want to add to your Dunkin' Card?");
            $regAddAmountForm.find('a.u-cta').hide();
        } else {
            $regAddAmountForm.find('.js-ddcard-available-balance').text("Your Dunkin' Card currently has $" + cardBalance + '. Want to add more?');
            $regAddAmountForm.find('a.u-cta').show();
        }
    };

    var resetState = function () {
        $regAddAmountForm.find('#no').trigger('click');
        APP.formSelect.changeSelection(
            $regAddAmountForm.find(
                '#auto-reload-balance-minimum, #auto-reload-balance-reload-amount, #auto-reload-schedule-frequency, #schedule-weekly-frequency, #schedule-monthly-frequency'
            ),
            0
        );
    };

    var bindEventsToUI = function () {
        $regAddAmountForm.on('submit', regAddAmountFormHandler);
        $regAddAmountForm.on('click tap', 'a.u-cta', skipAddAmount);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formRegPayment'); */
    };

    var init = function (element) {
        // console.log('APP.formRegAddAmount');
        $regAddAmountForm = $('.js-reg-add-amount-form');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formRegPayment');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        onComponentShow: onComponentShow,
        resetState: resetState,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formPersonalInformation = (function () {
    var $personalInfoForm = '';
    var $updateDiv = '';
    var $updateCTA = '';
    var $msg = '';
    var $zipCodeInput = '';
    var animatedClass = 'u-cta--animated';
    var updateSuccessClass = 'u-cta--success';
    var updatedCTAText = 'UPDATED';
    var $emailInput;
    var $telephoneInput;
    var appleRegisteredMsg = $(
        '<p>You are registered with <img class="apple-logo" src="/etc/designs/dd/images/Apple_Logo.svg" alt="apple-logo"> Apple ID</p>'
    );

    var bindEventsToUI = function () {
        $updateCTA.on('click', updateProfile);
    };

    var updateProfile = function (e) {
        e.preventDefault();
        APP.global.removeError();
        //$msg.hide();

        if (APP.recaptcha.validateRecaptcha($personalInfoForm)) {
            return;
        }

        //        APP.manageProfile.updateProfile($personalInfoForm, $updateCTA, $msg);
    };

    // Callback function to be executed after recaptcha is successfull
    var formSubmit = function () {
        APP.global.removeError();
        $msg.hide();

        APP.manageProfile.updateProfile($personalInfoForm, $updateCTA, $msg);
    };

    var makeEmailIdReadOnly = function () {
        if (APP.cookie.getUserInfo().signinProvider === 'Apple') {
            $emailInput.attr('readonly', 'readonly').parent().addClass('readonly');
            $(appleRegisteredMsg).insertAfter($($emailInput));
        }
    };

    var hidePhoneNumberInputForAppleID = function () {
        if (APP.cookie.getUserInfo().signinProvider === 'Apple') {
            $telephoneInput.parent().remove();
        }
    };

    var init = function (element) {
        // console.log('APP.formPersonalInformation');

        $personalInfoForm = $('.js-form-personal-information');
        $updateDiv = $('.js-update:not(".disabled")');
        $updateCTA = $('.js-update .u-cta--primary');
        $msg = $('.js-updated-message-note');
        $zipCodeInput = $('#profileZipCode');
        $emailInput = $('#email');
        $telephoneInput = $('#telephone');

        makeEmailIdReadOnly();
        hidePhoneNumberInputForAppleID();
        bindEventsToUI();
        APP.manageProfile.loadProfile($personalInfoForm);
        $updateCTA.addClass(animatedClass);
        //APP.global.resizeRouteList.push('formPersonalInformation');

        // Initialize the recaptcha with the given callback
        APP.recaptcha.initRecaptcha(formSubmit);

        // to wait for page to load on teaser
        setTimeout(function () {
            APP.recaptcha.renderRecaptcha(true, formSubmit);
        }, 3000);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formPerksSignUp = (function () {
    
    var $perksSignUpForm;
    
    var perksSignUpFormSuccess = function ( msg ) {
        if( msg.data ) {
            window.location.href = $perksSignUpForm.data('registration-path') + '?email=' + $perksSignUpForm.find('#email').val();
        }
        else {
            window.location.href = $perksSignUpForm.data('signin-path');
        }
    };
    
    var perksSignUpFormFailure = function ( jqXHR, textStatus ) {
        var response = JSON.parse(jqXHR.responseText);
        var $msg = APP.formRegistration.getHTMLMsg('Error: ' + response.error.code + ' | ' + response.error.message);
        $perksSignUpForm.find('.js-status-notes').remove();
        $perksSignUpForm.append($msg);
    };
    
    var perksSignUpFormHandler = function(e) {
        e.preventDefault();
        var $this = $(this);
        var actionURL = $this.attr('action');
        var formData = $this.serialize();
        if( $this.parsley().isValid() ) {
            APP.global.postFormData(
                actionURL,
                formData,
                APP.formPerksSignUp.perksSignUpFormSuccess,
                APP.formPerksSignUp.perksSignUpFormFailure
            );
        }
    };

    var bindEventsToUI = function () {
        $perksSignUpForm.on('submit', perksSignUpFormHandler);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formPerksSignUp'); */
    };

    var init = function (element) {
        // console.log('APP.formPerksSignUp');
        $perksSignUpForm = $('.js-form-perks-sign-up');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formPerksSignUp');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        perksSignUpFormSuccess: perksSignUpFormSuccess,
        perksSignUpFormFailure: perksSignUpFormFailure
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formPatsWrapper = (function () {
    var $signInForm,
        $formWrapper,
        $confirmationWrapper,
        $confirmationButton,
        isUserLoggedIn,
        isDDPerksUser;
    var templates = {
        error: '' +
            '<div class=\'u-page-error\'>{msg}</div>'
    };

    var bindEventsToUI = function () {
        var $signInButton = $signInForm.find('input[type="submit"]');
        $confirmationButton = $confirmationWrapper.find('.u-cta.u-cta--primary');
        $signInButton.on('click', signInHandler);
        $confirmationButton.on('click', confirmationHandler);
        $signInForm.closest('.block-on-background').find('a').on('click', setPatsCookie);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formPatsWrapper'); */
    };

    var init = function (element) {
        // console.log('APP.formPatsWrapper');
        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;
        $signInForm = $('.js-pats365-signup-form');
        $formWrapper = $('.form-pats-wrapper__enroll');
        $confirmationWrapper = $('.form-pats-wrapper__confirmation');
        
        if (!isEditMode) {
            initializePatsPage();
        }
        bindEventsToUI();
        
        //APP.global.resizeRouteList.push('formPatsWrapper');
        
        // Initialize the recaptcha with the given callback 
		APP.recaptcha.initRecaptcha(formSubmit);
    };

    var initializePatsPage = function (e) {
        isDDPerksUser = APP.login.isDDPerksUser();
        isUserLoggedIn = APP.login.isLoggedIn();
        if ((isDDPerksUser && isUserLoggedIn)) {
            $formWrapper.hide();
            $confirmationWrapper.show();
            getConfirmation();
            $(window).scrollTop($('.form-pats-wrapper__confirmation').offset().top);
        }
        if (!isDDPerksUser && isUserLoggedIn) {
            showNonPerksUserMsg();
        }
    };

    var signInHandler = function (e) {
        e.preventDefault();
        setPatsCookie();
        var actionURL = $signInForm.attr('action'),
            formData = $signInForm.serialize();
        APP.global.removeError();
        $signInForm.parsley().validate();
        if ($signInForm.parsley().isValid()) {
            
            if(APP.recaptcha.validateRecaptcha($signInForm)){
                return;
            }
            
          /*  APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.PATS, APP.analytics.Events.CLICK, $('input.u-cta',$signInForm).val());
            
            APP.global.postFormData(
                actionURL,
                formData,
                signInSuccess,
                signInFailure
            );  */
        }
    };
    
    // Callback function to be executed after recaptcha is succesfull
    var formSubmit = function () {
        var actionURL = $signInForm.attr('action');
        var formData = $signInForm.serialize();
        
        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.PATS, APP.analytics.Events.CLICK, $('input.u-cta',$signInForm).val());
        
        APP.global.postFormData(
            actionURL,
            formData,
            signInSuccess,
            signInFailure
        );
    };

    var signInSuccess = function (response) {
        APP.session.initialize();
        isDDPerksUser = APP.login.isDDPerksUser();
        if (isDDPerksUser) { // perks user
            $formWrapper.hide();
            $confirmationWrapper.show();
            getConfirmation();
            $(window).scrollTop($('.form-pats-wrapper__confirmation').offset().top);
            
            // delete cookie so user won't be redirected again to pats page after sign in
            window.Cookies.remove('pats365');
        } else { // non perks user     
            showNonPerksUserMsg();
            APP.recaptcha.renderRecaptcha();
        }
    };

    var signInFailure = function (jqXHR, textStatus) {
        APP.global.getErrorMsg(jqXHR, $signInForm);
        APP.recaptcha.renderRecaptcha();
        
        // it would be set when trying to sign it again
        window.Cookies.remove('pats365');
    };

    var confirmationHandler = function (e) {
        if (!$confirmationWrapper.find('#accept').is(':checked')) {
            e.preventDefault();
            $confirmationWrapper.find('#accept').parsley().validate();
        } else {
            window.Cookies.remove('pats365');
        }
    };

    var getConfirmation = function () {
        var actionUrl = '/bin/servlet/loyalty',
            formData = JSON.stringify({
                service: 'getPatriotURL'
            });
        APP.global.showLoader();
        $.ajax({
            url: actionUrl,
            method: 'POST',
            dataType: 'json',
            contentType: 'application/json',
            data: formData,
            success: function (response) {
                APP.global.hideLoader();
                $confirmationButton.attr({
                    'href': response.data,
                    'target': '_blank'
                });
            },
            error: function (jqXHR, textStatus) {
                APP.global.getErrorMsg(jqXHR, $confirmationWrapper.find('.cta-group'));

            }
        });
    };

    var setPatsCookie = function () {
	    	var expireTime = new Date();
	    	var time = expireTime.getTime();
	    	time += 3600 * 1000;
	    	expireTime.setTime(time);
	    	
	    	// setting cookies if user interacts on pat365 page, expires in 1 hour
        window.Cookies.set('pats365', window.location.href, { expires: expireTime}); 
    };

    var showNonPerksUserMsg = function () {
        var msg = window.CQ.I18n.getMessage('pats365.nonperkserrormsg');
        $signInForm.closest('.block-on-background').find('hgroup').append(APP.registration.generateMarkup(templates.error, {
            msg: msg
        }));
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.formPartnerWrapper = (function () {
    var $signInForm, $formWrapper, $confirmationWrapper, $confirmationWrapperPerksUser, isUserLoggedIn, isDDPerksUser, $dynamicTeaser, mfaPageURL;
    var isPartnerPromoCookieCreated = new $.Deferred();
    var templates = {
        error: '' + "<div class='u-page-error'>{msg}</div>",
    };

    var bindEventsToUI = function () {
        $signInForm.find('input[type="submit"]').on('click', function () {
            window.Cookies.set('ddPerksUser', 'signIn');
        });

        $('.form-partner-wrapper').on('click', '.js-join-dd-perks', function () {
            window.Cookies.set('ddPerksUser', 'signUp');
        });

        $('.js-learnAboutDD').on('click', function (e) {
            e.preventDefault();

            window.scrollTo(0, document.body.scrollHeight);
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formPartnerWrapper'); */
    };

    var init = function (element) {
        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;
        $signInForm = $('.js-partner-promo-signup-form');
        $formWrapper = $('.form-partner-wrapper__enroll');
        $confirmationWrapper = $('.form-partner-wrapper__confirmation');
        $confirmationWrapperPerksUser = $('.form-partner-wrapper__confirmation-perksUser');
        $dynamicTeaser = $('.js-dynamic-data');
        createPartnerPromoCookie();
        dynamicData();

        if (window.Cookies('DDPerksJoined')) {
            $formWrapper.hide();
            $confirmationWrapper.hide();
            $confirmationWrapperPerksUser.show();
            $(window).scrollTop($('.form-partner-wrapper__confirmation-perksUser').offset().top);
        }

        if (!isEditMode) {
            initializePatnerPage();
        }
        bindEventsToUI();
    };

    var initializePatnerPage = function (e) {
        isDDPerksUser = APP.login.isDDPerksUser();
        isUserLoggedIn = APP.login.isLoggedIn();
        var isDDPerksJoined = window.Cookies('DDPerksJoined');
        if (isDDPerksUser && isUserLoggedIn) {
            $formWrapper.hide();
            if (!isDDPerksJoined) {
                $confirmationWrapper.show();
            }

            $(window).scrollTop($('.form-partner-wrapper__confirmation').offset().top);
        }
        if (!isDDPerksUser && isUserLoggedIn) {
            showNonPerksUserMsg();
        }
    };

    var createPartnerPromoCookie = function () {
        if (!APP.cookie.getPartnerPromo()) {
            $.ajax({
                url: '/bin/servlet/createpartnerpromocookie',
                method: 'POST',
            })
                .done(function () {
                    isPartnerPromoCookieCreated.resolve();
                })
                .fail(function () {
                    isPartnerPromoCookieCreated.reject();
                });
        } else {
            isPartnerPromoCookieCreated.resolve();
        }
    };

    var shellSignInFailure = function (jqXHR, textStatus) {
        if (window.location.href.indexOf('shell-offer') > -1) {
            var response = JSON.parse(jqXHR.responseText);

            // check if error is from addMemberSegment, redirecciono a error page
            var cookieError = window.Cookies('errorAddingMember');

            if (response.error.code === 'AM0001' || cookieError) {
                var cookie = APP.cookie.getPartnerPromo();

                if (cookie) {
                    var data = cookie;
                    if (data.errorPageURL && data.errorPageURL !== '') {
                        window.location(data.errorPageURL);
                        APP.cookie.deleteCookie('partnerPromo');
                        window.Cookies.remove('errorAddingMember');
                    }
                }
            }
        }
    };

    var showNonPerksUserMsg = function () {
        var msg = window.CQ.I18n.getMessage('partnerPromo.nonperkserrormsg');
        $signInForm
            .closest('.block-on-background')
            .find('hgroup')
            .append(
                APP.registration.generateMarkup(templates.error, {
                    msg: msg,
                })
            );
    };

    var dynamicData = function () {
        var cookie = null; //APP.cookie.getPartnerPromo();

        if (cookie) {
            var data = cookie;
            $dynamicTeaser.find('.responsive-image__img').attr('src', data.fullImageNameMedium);
            $dynamicTeaser.find('.teaser__title-01').html(data.offerCode);
            $dynamicTeaser.find('.teaser__text p').html(data.offerShortDescription);
        } else {
            var cookieError = window.Cookies('promoError');

            if (cookieError) {
                // disable login and join buttons
                if ($('.js-form-login input[type=submit]').length > 0) {
                    $('.js-form-login input[type=submit]').attr('disabled', 'disabled');
                }

                if ($('.js-join-dd-perks.u-cta--primary').length > 0) {
                    $('.js-join-dd-perks.u-cta--primary')
                        .addClass('disabled')
                        .removeAttr('href')
                        .click(function (e) {
                            e.preventDefault();
                        });
                }

                if ($('.u-page-error').length === 0) {
                    $signInForm
                        .closest('.block-on-background')
                        .find('hgroup')
                        .append(
                            APP.registration.generateMarkup(templates.error, {
                                msg: cookieError,
                            })
                        );
                }
            }
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        shellSignInFailure: shellSignInFailure,
        isPartnerPromoCookieCreated: isPartnerPromoCookieCreated.promise(),
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formMobileAppContactInfo = (function () {

    var $hiddenFields;

    var bindEventsToUI = function () {
        $hiddenFields.find('select, input').removeAttr('required');
        showHiddenFields();
        
        $('#ddperksgiftcardyes, #ddperksgiftcardno').change(function(){
            showHiddenFields(); 
        });

    };

    var showHiddenFields = function() {
        if($('#ddperksgiftcardyes').is(':checked')) {
            $hiddenFields.slideDown();
            $hiddenFields.find('select, input').attr('required','required');
        } else {
            $hiddenFields.slideUp();
            $hiddenFields.find('select, input').removeAttr('required');
        }
    };


    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formMobileAppContactInfo'); */
    };

    var init = function (element) {
        // console.log('APP.formMobileAppContactInfo');
        $hiddenFields = $('select, input').parents('.grid__item.grid__item--hide');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formMobileAppContactInfo');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formMobileAppComments = (function () {

    var $hiddenInputs;

    var bindEventsToUI = function () {
        showHiddenInputs();

        $('#mobile_onthego').change(function(){
            showHiddenInputs();
        });
    };

    var showHiddenInputs = function() {
        if($('#mobile_onthego').val() === 'In-Store Payments' || $('#mobile_onthego').val() === 'On-The-Go Ordering') {
            $hiddenInputs.slideDown();
        } else {
            $hiddenInputs.slideUp();
        }
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formMobileAppComments'); */
    };

    var init = function (element) {
        // console.log('APP.formMobileAppComments');
        $hiddenInputs = $('select, input').parents('.grid__item.grid__item--hide');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formMobileAppComments');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.formManagePerkPass = (function () {
    var $formManagePerkPass, $perkPassCardTile, memberCardNumber, cardType;

    var showFormManagePerkPass = function () {
        $perkPassCardTile.show();
    };

    var showReplaceManagePerkPass = function () {
        $perkPassCardTile.hide();
    };

    var successPerkPass = function () {
        var userInfoCookie = APP.cookie.getUserInfo();

        APP.modal.closeModal();
        showFormManagePerkPass();
        $('.js-form-link-pass').find('#perkPassNumber').val('');

        $formManagePerkPass.find('.js-manage-perk-pass__card-number').html(userInfoCookie.memberCardNumber + '****');

        $('.js-btn-pass-show').text('Show');
    };

    var showCardNumber = function (e) {
        e.preventDefault();

        var clicks = $(this).data('clicks');
        if (clicks) {
            $formManagePerkPass.find('.js-manage-perk-pass__card-number').html(memberCardNumber.substring(0, 12) + '****');
            $('.js-btn-pass-show').text('Show');
        } else {
            $formManagePerkPass.find('.js-manage-perk-pass__card-number').html(memberCardNumber);
            $('.js-btn-pass-show').text('Hide');
        }
        $(this).data('clicks', !clicks);
    };

    var showCardInfo = function () {
        if (cardType == 'VIRTUAL') {
            $virtualCard.show();
        } else if (cardType == 'PHYSICAL') {
            $physicalCard.show();
        }
    };

    var bindEventsToUI = function () {
        var userInfoCookie = APP.cookie.getUserInfo();
        memberCardNumber = userInfoCookie.memberCardNumber;
        cardType = userInfoCookie.cardType;
        showCardInfo();

        $formManagePerkPass.find('.js-manage-perk-pass__card-number').html(memberCardNumber.substring(0, 12) + '****');

        $('.js-btn-pass-show').on('click', showCardNumber);
    };

    var bindOnResize = function () {};

    var init = function (element) {
        $formManagePerkPass = $('.js-manage-perk-pass');
        $perkPassCardTile = $('.js-perk-pass-card-tile');

        $virtualCard = $('.virtual-card');
        $physicalCard = $('.physical-card');
        bindEventsToUI();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formLogin = (function () {
    var $loginForm;
    var perksURL = '/';
    var nonPerksURL = '/';
    var registrationURL = '';
    var mfaPageURL = '';
    var isDNation = false;

    var loginFormSuccess = function (msg) {
        APP.session.initialize();

        APP.recaptcha.validRecaptcha();

        APP.analytics.fireCategoryEvent(
            APP.analytics.EventCategories.MANAGE_ACCOUNT,
            APP.analytics.Events.CLICK,
            $('.js-form-login .u-cta').val().trim()
        );

        if (registrationURL && registrationURL !== '') {
            window.location.href = registrationURL;
        } else {
            if (msg.data.isMFARequried && !isDNation) {
                window.location.href = APP.redirectionComponent.addQueryParamInMfaUrl(mfaPageURL);
            } else {
                var currentPage = window.location.href;
                switch (true) {
                    case currentPage.indexOf('consumer-rights') > -1: {
                        APP.formDoNotSellLoginRedirection.updateSession(window.location.href);
                        APP.formDoNotSellLoginRedirection.redirectToNextCCPAPage();
                        break;
                    }
                    case currentPage.indexOf('military-coffee-request') > -1: {
                        APP.contactUs.redirectToMilitaryCoffeePage();
                        break;
                    }
                    case currentPage.indexOf('contact-us') > -1: {
                        APP.contactUs.redirectToContactUsPage();
                        break;
                    }
                    case currentPage.indexOf('shell-offer') > 1: {
                        window.location.reload();
                        break;
                    }
                    case APP.global.getURLParameter('action') == 'deleteAccount': {
                        APP.formDeleteMyAccount.redirectToDeleteAccountPage();
                        break;
                    }
                    default: {
                        if (msg.data.isLoyaltyEnrollment) {
                            window.location.href = perksURL;
                        } else {
                            window.location.href = nonPerksURL;
                        }
                    }
                }
            }
        }
    };

    var loginFormFailure = function (jqXHR, textStatus) {
        APP.formPartnerWrapper.shellSignInFailure(jqXHR);
        APP.global.getErrorMsg(jqXHR, $loginForm);
        APP.recaptcha.renderRecaptcha();
    };

    var loginFormHandler = function (e) {
        APP.global.removeError();
        if (APP.recaptcha.validateRecaptcha($loginForm)) {
            return;
        }
    };

    var bindEventsToUI = function () {
        $loginForm.parsley().on('form:submit', function (e) {
            loginFormHandler();
            return false;
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formLogin'); */
    };

    // Callback function to be executed after recaptcha is succesfull
    var formSubmit = function () {
        var actionURL = $loginForm.attr('action');
        var formData = $loginForm.serialize();

        isDNation = $loginForm.find('#isDNation').val() ? true : false;

        APP.global.postFormData(actionURL, formData, APP.formLogin.loginFormSuccess, APP.formLogin.loginFormFailure);
    };

    // Removes readonly attr only for password input types 'cause on ios
    // this attr doesnt unfold the virtual keyboard.
    var fixPasswordEvent = function () {
        var $pass = $loginForm.find('input[type=password]').each(function () {
            $(this).removeAttr('readonly');
        });
    };

    var init = function (element) {
        // console.log('APP.formLogin');
        $loginForm = $('.js-form-login');

        APP.kountDataCollector.init($loginForm);

        perksURL = $('#perksDashboardPage').val();
        mfaPageURL = $('#mfaPage').val();
        nonPerksURL = $('#nonPerksDashboardPage').val();
        registrationURL = $loginForm.data('dunkin-perkregistration-url');

        var isEditMode = window.Cookies.get('wcmmode') === 'edit' ? true : false;

        if (!isEditMode && APP.login.isLoggedIn()) {
            var currentPage = window.location.href;
            if (currentPage.indexOf('shell-offer') > -1) {
                return;
            } else if (currentPage.indexOf('consumer-rights') > -1) {
                APP.formDoNotSellLoginRedirection.redirectToNextCCPAPage();
            } else {
                if (APP.login.isDDPerksUser()) {
                    window.location.href = perksURL;
                } else {
                    window.location.href = nonPerksURL;
                }
            }
            return;
        }

        fixPasswordEvent();
        bindEventsToUI();

        // Initialize the recaptcha with the given callback
        APP.recaptcha.initRecaptcha(formSubmit);
        //APP.global.resizeRouteList.push('formLogin');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        loginFormSuccess: loginFormSuccess,
        loginFormFailure: loginFormFailure,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formFuelWrapper = (function () {
    var errorMessage;

    var templates = {
        error: '' + "<div class='u-page-error'>{msg}</div>",
    };

    var bindEventsToUI = function () {};

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formDoubleCheck'); */
    };

    var checkErrors = function () {
        var cookieError = errorMessage; //window.Cookies('promoError');

        if (cookieError) {
            if ($('.u-page-error').length === 0) {
                $('.js-form-fuel-wrapper').before(
                    APP.registration.generateMarkup(templates.error, {
                        msg: cookieError,
                    })
                );
            }
        }
    };

    var checkCtas = function () {
        // check if action is not set, then disable ctas
        var createAction = $('.js-form-fuel-wrapper .js-fuel-create').attr('action');
        if (!createAction || createAction == '#') {
            // urls no set yet on loading, try to get them
            APP.formPartnerWrapper.isPartnerPromoCookieCreated.done(function () {
                getSourceUrls();
            });
        }

        checkErrors();
    };

    var getSourceUrls = function () {
        // try to get urls by ajax
        console.log('Getting source Urls');
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/promotion',
            data: JSON.stringify({
                service: 'fuelUrls',
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                var fuelUrls = response.data;

                var validLogin = fuelUrls.login ? true : false;

                if (validLogin && fuelUrls.login != '#') {
                    $('.js-form-fuel-wrapper .js-fuel-create').attr('action', fuelUrls.registration);
                    $('.js-form-fuel-wrapper .js-fuel-login').attr('action', fuelUrls.login);
                } else {
                    errorMessage = 'There was an issue loading Fuel Rewards URLs.';
                    $('.js-form-fuel-wrapper .js-fuel-create').find('input[type="submit"]').prop('disabled', true);
                    $('.js-form-fuel-wrapper .js-fuel-login').find('input[type="submit"]').prop('disabled', true);

                    checkErrors();
                }
            },
            error: function (jqXHR) {
                errorMessage = 'There was an issue loading Fuel Rewards URLs.';
                $('.js-form-fuel-wrapper .js-fuel-create').find('input[type="submit"]').prop('disabled', true);
                $('.js-form-fuel-wrapper .js-fuel-login').find('input[type="submit"]').prop('disabled', true);
            },
        });
    };

    var init = function (element) {
        // console.log('APP.formDoubleCheck');
        bindEventsToUI();
        checkCtas();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        checkCtas: checkCtas,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formFuelRewardWrapper = (function () {
    var $perksReward,
        $fuelReward,
        $errorContent,
        $rewardContent;

    var templates = {
        error: '' +
            '<div class=\'u-page-error\'>{msg}</div>'
    };
    
    var dynamicData = function () {
        var cookieError = window.Cookies('promoError');

        var cookiePerksUser = window.Cookies('ddPerksUser');
        var cookiefuelReward = window.Cookies('fuelRewardUser');

        if(cookieError){
            $rewardContent.hide();
            $errorContent.show();

            if($('.u-page-error').length === 0) { 
                $('.js-reward-wrapper-error .cta-group').before(APP.registration.generateMarkup(templates.error, {
                    msg: cookieError
                }));
            }

        }else{
            $rewardContent.show();
            $($errorContent).hide();

            if(cookiePerksUser === 'signUp') {
                $perksReward.show();
            }else {
                $perksReward.hide();
            }

            if(cookiefuelReward === 'enroll') {
                $fuelReward.show();
            }else {
                $fuelReward.hide();
            }
        }
        
    };


    var bindEventsToUI = function () {

    };

    var init = function (element) {
        $perksReward = $('.js-reward-wrapper-perks');
        $fuelReward = $('.js-reward-wrapper-fuel');
        $rewardContent = $('.js-reward-wrapper-rewards');
        $errorContent = $('.js-reward-wrapper-error');

        bindEventsToUI();

        dynamicData();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.formDoubleCheck = (function () {
    var $doubleCheckForm;
    var signUpUserDetailsObject;
    var $transitionModal;
    var $successScreen;
    var isMP = false;
    var damPath = '/etc/designs/dd/images/credit-cards/';
    var targetURL = '/';
    var dayOfWeek = [
        'dayofweek_sunday',
        'dayofweek_monday',
        'dayofweek_tuesday',
        'dayofweek_wednesday',
        'dayofweek_thursday',
        'dayofweek_friday',
        'dayofweek_saturday',
    ];

    var populatePersonalInformation = function () {
        $doubleCheckForm.find('.js-email').html(signUpUserDetailsObject.profile.email);
        var birthDay = signUpUserDetailsObject.profile.birthday.slice(0, -5);
        var birthDate = APP.registration.ordinalSuffixOf(birthDay.split('-')[0]);
        var birthMonth = APP.registration.months[APP.registration.months.indexOf(birthDay.split('-')[1])][1];
        $doubleCheckForm.find('.js-bday').html(birthMonth + ' ' + birthDate);
        $doubleCheckForm
            .find('.js-name')
            .html(signUpUserDetailsObject.profile.firstName + ' ' + signUpUserDetailsObject.profile.lastName);
        if (signUpUserDetailsObject.profile.address && Object.keys(signUpUserDetailsObject.profile.address).length !== 0) {
            $doubleCheckForm.find('.js-mailing-add-1').html(signUpUserDetailsObject.profile.address.firstStreet);
            $doubleCheckForm.find('.js-mailing-add-2').html(signUpUserDetailsObject.profile.address.secondStreet);
            $doubleCheckForm
                .find('.js-mailing-add-city')
                .html(
                    signUpUserDetailsObject.profile.address.city +
                        ', ' +
                        signUpUserDetailsObject.profile.address.state +
                        ' ' +
                        signUpUserDetailsObject.profile.address.zipCode5
                );
        } else {
            $doubleCheckForm.find('.js-mailing-add-1').html('');
            $doubleCheckForm.find('.js-mailing-add-2').html('');
            $doubleCheckForm.find('.js-mailing-add-city').html('');
        }
        $doubleCheckForm.find('.js-zip').html(signUpUserDetailsObject.profile.profileZip);
        $doubleCheckForm.find('.js-promo').html(signUpUserDetailsObject.profile.registrationCode);
    };

    var populateBillingInformation = function () {
        if (signUpUserDetailsObject.creditcard && Object.keys(signUpUserDetailsObject.creditcard).length !== 0) {
            $doubleCheckForm.find('.review-billing').parents('.block-on-background').show();
            $doubleCheckForm.find('.js-credit-card').html(signUpUserDetailsObject.creditcard.cardNumber.slice(-4));
            var cardObject = APP.registration.getCardType(signUpUserDetailsObject.creditcard.cardNumber);
            var cardObjectProperty = 'card_type';
            $doubleCheckForm
                .find('.review-billing__visa')
                .attr('src', damPath + APP.registration.creditCardTypes[cardObject[cardObjectProperty].name][1])
                .attr('alt', signUpUserDetailsObject.creditcard.type);
            $doubleCheckForm
                .find('.js-billing-name')
                .html(
                    signUpUserDetailsObject.creditcard.address.firstName +
                        ' ' +
                        signUpUserDetailsObject.creditcard.address.lastName
                );
            $doubleCheckForm.find('.js-billing-add-street-1').html(signUpUserDetailsObject.creditcard.address.firstStreet);
            $doubleCheckForm.find('.js-billing-add-street-2').html(signUpUserDetailsObject.creditcard.address.secondStreet);
            $doubleCheckForm
                .find('.js-billing-add-city')
                .html(
                    signUpUserDetailsObject.creditcard.address.city +
                        ', ' +
                        signUpUserDetailsObject.creditcard.address.state +
                        ' ' +
                        signUpUserDetailsObject.creditcard.address.zipCode5
                );

            if (isMP) {
                $('.js-isMasterPass', $doubleCheckForm).show();
            } else {
                $('.js-isMasterPass').hide();
            }
        } else {
            $doubleCheckForm.find('.review-billing').parents('.block-on-background').hide();
        }
    };

    var populateDDCard = function () {
        $doubleCheckForm.find('.js-image').attr('src', '/etc/designs/dd/images/dd-card/dd-sample-card.svg');
        if (signUpUserDetailsObject.autoRecharge && Object.keys(signUpUserDetailsObject.autoRecharge).length !== 0) {
            $doubleCheckForm.find('.js-card-image-auto-reload').html('On');
        } else {
            $doubleCheckForm.find('.js-card-image-auto-reload').html('Off');
        }
    };

    var populateValueOnCard = function () {
        if (signUpUserDetailsObject.recharge.amount && signUpUserDetailsObject.recharge.amount !== '') {
            $doubleCheckForm.find('.review-card-value').parents('.grid__item').show();
            var rechargeAmount =
                signUpUserDetailsObject.recharge.amount === 0 ? 'None' : '$' + signUpUserDetailsObject.recharge.amount;
            $doubleCheckForm.find('.js-val').html(rechargeAmount);

            if (signUpUserDetailsObject.autoRecharge && Object.keys(signUpUserDetailsObject.autoRecharge).length !== 0) {
                if (signUpUserDetailsObject.autoRecharge.type === 'MONTHLY') {
                    $doubleCheckForm
                        .find('.js-card-value-auto-reload')
                        .html('Every month on the ' + signUpUserDetailsObject.autoRecharge.frequency + ', add');
                } else if (signUpUserDetailsObject.autoRecharge.type === 'WEEKLY') {
                    $doubleCheckForm
                        .find('.js-card-value-auto-reload')
                        .html(
                            'Every week on ' +
                                window.CQ.I18n.getMessage(dayOfWeek[signUpUserDetailsObject.autoRecharge.frequency]) +
                                ', add'
                        );
                } else {
                    $doubleCheckForm
                        .find('.js-card-value-auto-reload')
                        .html('When balance is $' + signUpUserDetailsObject.autoRecharge.frequency + ', add');
                }
                $doubleCheckForm
                    .find('.js-amt')
                    .html('$' + window.CQ.I18n.getMessage(signUpUserDetailsObject.autoRecharge.amount));
            } else {
                $doubleCheckForm.find('.js-card-value-auto-reload').html('Off');
                $doubleCheckForm.find('.js-amt').html('');
            }
        } else {
            $doubleCheckForm.find('.review-card-value').parents('.grid__item').hide();
        }
    };

    var onComponentShow = function (signUpUserDetails) {
        targetURL = $('#perksDashboardPage').val();
        APP.registration.removeErrors();
        $doubleCheckForm.find('.review-billing__security-pin-container input').val('');
        var isPurchaseFlow = signUpUserDetails.enrollmentType === 'Purchase' ? true : false;
        var $ddCardEditBtn = $doubleCheckForm.find('.js-review-image').parent('div').prev().find('.js-tile-edit a');
        var isVCO =
            signUpUserDetails.creditcard.hasOwnProperty('walletType') && signUpUserDetails.creditcard.walletType === 'VISA'
                ? true
                : false;
        isMP =
            signUpUserDetails.creditcard.hasOwnProperty('walletType') && signUpUserDetails.creditcard.walletType === 'MC'
                ? true
                : false;
        var isAR = !$.isEmptyObject(signUpUserDetails.autoRecharge);
        if (isPurchaseFlow) {
            $ddCardEditBtn.hide();
        } else {
            $ddCardEditBtn.show();
        }
        if ((isAR && isVCO) || (isAR && isMP)) {
            $doubleCheckForm.find('.review-billing__security-pin-container').show();
        } else {
            $doubleCheckForm.find('.review-billing__security-pin-container').hide();
        }
        signUpUserDetailsObject = signUpUserDetails;
        populatePersonalInformation();
        populateBillingInformation();
        populateDDCard();
        populateValueOnCard();
    };

    var disableFormControls = function () {
        $doubleCheckForm.find('.js-tile-edit a').remove();
        $('.js-signup-back').remove();
        $doubleCheckForm.find("input[type='submit']").attr('disabled', '').addClass('disabled');
    };

    var generateTokenSuccess = function (response) {
        var url = response.data;
        var $img = $('<img>');
        $img.attr('src', url);
        $doubleCheckForm.append($img);
        registrationSuccess();
    };

    var generateTokenFailure = function (jqXHR, textStatus) {
        var response = JSON.parse(jqXHR.responseText);
        APP.registration.showError(response.error.message);
        APP.modal.closeModal.apply($transitionModal.find('.js-modal-close'));
    };

    var registrationSuccess = function () {
        APP.modal.closeModal.apply($transitionModal.find('.js-modal-close'));
        $doubleCheckForm.parents('.js-registration-wrapper').hide();
        $('.js-signup-back').remove();
        $successScreen.show();
        //redirect user to the pats 365 page if cookies is present
        var patsUrl = window.Cookies.get('pats365'); // pats365 page url
        if (patsUrl !== undefined) {
            targetURL = patsUrl;
            // delete cookie so user won't be redirected again to pats page after login in
            window.Cookies.remove('pats365');
        } else {
            //no pats, check for partner promo page if cookies is present, then redirect to that page
            var parterPromoUrl = window.Cookies.get('partner_url');
            if (parterPromoUrl !== undefined) {
                targetURL = parterPromoUrl;
                window.Cookies.remove('partner_url');
            }
        }

        // if registration page
        if (window.location.href.indexOf('registration') !== -1) {
            APP.analytics.fireCategoryEvent(
                APP.analytics.EventCategories.PERKS_REGISTRATION,
                APP.analytics.Events.CLICK,
                $('.u-cta', $doubleCheckForm).data('track')
            );
        }

        window.setTimeout(function () {
            window.onbeforeunload = undefined;
            window.location.href = targetURL;
        }, 3000);
    };

    var doubleCheckFormSuccess = function (response) {
        if (response.data.success) {
            var transactionNumber = response.data.transactionNumber;
            if (transactionNumber && transactionNumber !== '') {
                // Token is required only for VCO. Transaction number is only available for VCO
                var requestObj = {
                    orderId: transactionNumber,
                    eventType: 'Confirm',
                    reason: 'Order Placed Successfully',
                    total: signUpUserDetailsObject.recharge.amount,
                };
                APP.visaCheckout.generateToken(requestObj, generateTokenSuccess, generateTokenFailure);
            } else {
                registrationSuccess();
            }
        }
    };

    var doubleCheckFormFailure = function (jqXHR, textStatus) {
        var response = JSON.parse(jqXHR.responseText);

        // check if error is from addMemberSegment
        if (response.error.code === 'AM0001') {
            var cookie = APP.cookie.getPartnerPromo();

            if (cookie) {
                var data = $.parseJSON(cookie);
                if (data.errorPageURL && data.errorPageURL !== '') {
                    window.location(data.errorPageURL);
                    APP.cookie.deleteCookie('partnerPromo');
                }
            }
        }

        APP.registration.showError(response.error.message);
        APP.modal.closeModal.apply($transitionModal.find('.js-modal-close'));
        if (response.error.code === 'GE0001') {
            disableFormControls();
        }
    };

    var doubleCheckPostData = function () {
        APP.registration.postData(
            '/bin/servlet/userregistrationservlet',
            undefined,
            'application/json',
            JSON.stringify(signUpUserDetailsObject),
            function (response) {
                doubleCheckFormSuccess(response);
            },
            function (jqXHR, textStatus) {
                doubleCheckFormFailure(jqXHR, textStatus);
            },
            true
        );
    };

    var centinalSuccess = function (centinalData, jwt) {
        centinalData = JSON.parse(centinalData);
        signUpUserDetailsObject.recharge.verification = {
            cavv: centinalData.Payment.ExtendedData.CAVV,
            eci: centinalData.Payment.ExtendedData.ECIFlag,
            enrolled: centinalData.Payment.ExtendedData.Enrolled,
            errorMsg: centinalData.ErrorDescription,
            errorNo: centinalData.ErrorNumber,
            jwt: jwt,
            paResStatus: centinalData.Payment.ExtendedData.PAResStatus,
            signatureVerification: centinalData.Payment.ExtendedData.SignatureVerification,
            statusCode: centinalData.ActionCode,
            transactionId: centinalData.Payment.ProcessorTransactionId,
            xid: centinalData.Payment.ExtendedData.XID,
        };
        doubleCheckPostData();
    };

    var centinalFailure = function (response, actionCode) {
        var msg = JSON.parse(response);
        if (actionCode === 'FAILURE') {
            APP.modal.closeModal.apply($transitionModal.find('.js-modal-close'));
            APP.registration.showError(window.CQ.I18n.getMessage('cardinal.authenticationFailed'));
            $doubleCheckForm.find('.u-page-error').attr('data-errorcode', msg.ErrorNumber);
        } else if (actionCode === 'ERROR') {
            var responseObj = JSON.parse(response);
            var errorNumber = responseObj.ErrorNumber;
            if (
                errorNumber === 10001 ||
                errorNumber === 10002 ||
                errorNumber === 10003 ||
                errorNumber === 10007 ||
                errorNumber === 10009
            ) {
                signUpUserDetailsObject.recharge.verification = {
                    errorMsg: responseObj.ErrorDescription,
                    errorNo: responseObj.ErrorNumber,
                    statusCode: responseObj.ActionCode,
                    statusMessage: responseObj.ErrorDescription,
                };
                doubleCheckPostData();
            } else {
                APP.modal.closeModal.apply($transitionModal.find('.js-modal-close'));
                APP.registration.showError(window.CQ.I18n.getMessage('cardinal.connectionError'));
                $doubleCheckForm.find('.u-page-error').attr('data-errorcode', msg.ErrorNumber);
            }
        }
    };

    var centinalNoAction = function (centinalData, jwt) {
        centinalData = JSON.parse(centinalData);
        signUpUserDetailsObject.recharge.verification = {
            eci: centinalData.Payment.ExtendedData.ECIFlag,
            enrolled: centinalData.Payment.ExtendedData.Enrolled,
            jwt: jwt,
            transactionId: centinalData.Payment.ProcessorTransactionId,
        };
        doubleCheckPostData();
    };

    var getCentinalOrderObject = function () {
        var logUser = APP.login.getUserInfo();
        var updatedOrderNumber = logUser.lastName || signUpUserDetailsObject.creditcard.address.lastName;
        updatedOrderNumber = updatedOrderNumber + new Date().getTime();

        return {
            OrderDetails: {
                OrderNumber: updatedOrderNumber || signUpUserDetailsObject.ddCard.cardNumber || APP.registration.getOrder(),
                Amount: signUpUserDetailsObject.recharge.amount * 100,
                CurrencyCode: '840',
            },
            Consumer: {
                Email1: '',
                BillingAddress: {
                    FirstName: signUpUserDetailsObject.creditcard.address.firstName,
                    MiddleName: '',
                    LastName: signUpUserDetailsObject.creditcard.address.lastName,
                    Address1: signUpUserDetailsObject.creditcard.address.firstStreet,
                    Address2: signUpUserDetailsObject.creditcard.address.secondStreet || '',
                    City: signUpUserDetailsObject.creditcard.address.city,
                    State: signUpUserDetailsObject.creditcard.address.state,
                    PostalCode: signUpUserDetailsObject.creditcard.address.zipCode5,
                    CountryCode: 'US',
                    Phone1: '',
                },
                Account: {
                    AccountNumber: signUpUserDetailsObject.creditcard.cardNumber,
                    ExpirationMonth: signUpUserDetailsObject.creditcard.expMonth,
                    ExpirationYear: signUpUserDetailsObject.creditcard.expYear,
                    NameOnAccount:
                        signUpUserDetailsObject.creditcard.address.firstName +
                        ' ' +
                        signUpUserDetailsObject.creditcard.address.lastName,
                    CardCode: signUpUserDetailsObject.creditcard.cardSecurityCode,
                },
            },
        };
    };

    var finalSubmit = function (e) {
        e.preventDefault();
        var $this = $('.js-form-double-check');
        var isPinVisible = $this.find('.review-billing__security-pin-container').is(':visible');
        APP.registration.removeErrors();
        if (isPinVisible && !$this.parsley().validate()) {
            return;
        }
        var pin = $doubleCheckForm.find('#review-info').val();
        if (pin !== '') {
            signUpUserDetailsObject.creditcard.cardSecurityCode = pin;
        }
        // Sending session Id
        signUpUserDetailsObject.recharge.sessionId = $('#sid').val();
        $transitionModal.show(0).addClass('modal--show');
        var cardType = signUpUserDetailsObject.creditcard.type;
        if (!APP.centinal.skipCentinalFlow() && (cardType === 'VISA' || cardType === 'MC')) {
            var order = getCentinalOrderObject();
            //	sending orderNumber
            if (order.OrderDetails.OrderNumber) {
                signUpUserDetailsObject.recharge.orderNumber = order.OrderDetails.OrderNumber;
            }

            APP.centinal.centinalFormHandler(
                order,
                function (centinalData, jwt) {
                    centinalSuccess(centinalData, jwt);
                },
                function (response, actionCode) {
                    centinalFailure(response, actionCode);
                },
                function (centinalData, jwt) {
                    centinalNoAction(centinalData, jwt);
                }
            );
        } else {
            if (APP.centinal.skipCentinalFlow()) {
                signUpUserDetailsObject.recharge.verification = APP.centinal.getVerificationError();
            }
            doubleCheckPostData();
        }
    };

    var bindEventsToUI = function () {
        $doubleCheckForm.on('click', "input[type='submit']:not('.disabled')", finalSubmit);
        $doubleCheckForm.on('click', "input[type='submit'].disabled", function (e) {
            e.preventDefault();
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formDoubleCheck'); */
    };

    var init = function (element) {
        // console.log('APP.formDoubleCheck');
        $doubleCheckForm = $('.js-form-double-check');
        $transitionModal = $('#registration-transition');
        $successScreen = $('#registration-success');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formDoubleCheck');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        onComponentShow: onComponentShow,
        generateTokenSuccess: generateTokenSuccess,
        generateTokenFailure: generateTokenFailure,
    };
})();

"use strict";
var APP = (window.APP = window.APP || {});
APP.formDoNotSellLoginRedirection = (function () {
  var doNotSellSession = {
    sessionKey: 'do-not-sell',
    path: []
  };

  var ccpaSession = {
    sessionKey: 'ccpaSession',
    path: []
  };

  var redirectionURL = {
    defaultStartingURL: null,
    consumerRight: null,
    doNotSell: null,
  };

  var getPagePaths = function () {
    redirectionURL.defaultStartingURL = $("#ccpaPath").val();
    redirectionURL.consumerRight = $("#consumerRightsPath").val();
    redirectionURL.doNotSell = $("#doNotSellPath").val();
  };

  var handleDirectVisit = function () {
    //If visited directly
    getPagePaths();
    if (!APP.global.isEditMode()) {
      if (!getPreviousPageInfo()) {
        window.location.href = redirectionURL.defaultStartingURL;
      }
    }
  };

  var createSession = function (currentPath) {
    currentPath = JSON.stringify([currentPath]);
    if (currentPath.indexOf('consumer-rights') > -1) {
      clearSessionByKey(doNotSellSession.sessionKey);
      window.sessionStorage.setItem(ccpaSession.sessionKey, currentPath);
    } else if (currentPath.indexOf('do-not-sell') > -1) {
      clearSessionByKey(ccpaSession.sessionKey);
      window.sessionStorage.setItem(doNotSellSession.sessionKey, currentPath);
    }
  };

  var clearSessionByKey = function (key) {
    window.sessionStorage.removeItem(key);
  };

  var clearAllCCPASessionKeys = function (key) {
    window.sessionStorage.removeItem(doNotSellSession.sessionKey);
    window.sessionStorage.removeItem(ccpaSession.sessionKey);
  };

  var updateSession = function (currentPath) {
    var key, path;
    if (window.sessionStorage.getItem(doNotSellSession.sessionKey)) {
      key = doNotSellSession.sessionKey;
    } else if (window.sessionStorage.getItem(ccpaSession.sessionKey)) {
      key = ccpaSession.sessionKey;
    }
    path = window.sessionStorage.getItem(key);
    if (!path) {
      path = [];
    } else {
      path = JSON.parse(path);
    }
    path.push(currentPath);
    window.sessionStorage.setItem(key, JSON.stringify(path));
  };

  var getSessionDetails = function (URL) {
    var key = URL.indexOf('consumer-rights') > -1 ? ccpaSession.sessionKey :
      (URL.indexOf('do-not-sell') > -1 ? doNotSellSession.sessionKey : '');
    var val = window.sessionStorage.getItem(key);
    if (!val) {
      val = [];
    } else {
      val = JSON.parse(val);
    }
    return val;
  };

  var getPreviousPageInfo = function () {
    var previousPage = '';
    var ccpaSession = getSessionDetails(redirectionURL.consumerRight);
    var doNotSellSession = getSessionDetails(redirectionURL.doNotSell);
    if (ccpaSession.length > 0) {
      previousPage = 'consumer-rights';
    }
    else if (doNotSellSession.length > 0) {
      previousPage = 'do-not-sell';
    }
    return previousPage;
  };

  var redirectToNextCCPAPage = function () {
    getPagePaths();
    var pageInfo = getPreviousPageInfo();
    switch (pageInfo) {
      case 'consumer-rights':
        window.location.href = redirectionURL.consumerRight;
        break;
      case 'do-not-sell':
        window.location.href = redirectionURL.doNotSell;
        break;
      default:
        window.location.href = redirectionURL.defaultStartingURL;
        break;
    }
  };

  return {
    createSession: createSession,
    clearSession: clearSessionByKey,
    updateSession: updateSession,
    getSessionDetails: getSessionDetails,
    redirectToNextCCPAPage: redirectToNextCCPAPage,
    getPreviousPageInfo: getPreviousPageInfo,
    handleDirectVisit: handleDirectVisit,
    clearAllCCPASessionKeys: clearAllCCPASessionKeys
  };
})();




'use strict';
var APP = (window.APP = window.APP || {});
APP.formDoNotSellLoginConfirmation = (function () {
    var redirectionURL = {
        defaultCCPALoginPage: null,
        consumerRight: null,
        doNotSell: null,
    };
    var $doNotSellConfirmationForm;
    var selectors = {
        doNotSellConfirmationForm: '.doNotSell_confirmation_form',
        selectedConfirmationState: '[name="login_confirmation_consumer_rights"]:checked'
    };

    var getElemsReferrences = function () {
        $doNotSellConfirmationForm = $(selectors.doNotSellConfirmationForm);
    };

    var getPagePaths = function () {
        redirectionURL.defaultCCPALoginPage = $('#ccpaLoginPath').val();
        redirectionURL.doNotSell = $('#doNotSellPath').val();
        redirectionURL.consumerRight = $('#consumerRightsPath').val();
    };

    var createVueApp = function () {
        var vueApp = new Vue({
            el: $doNotSellConfirmationForm.get(0),
            methods: {
                onFormSubmit: function ($elem) {
                    $doNotSellConfirmationForm = $elem;
                    APP.global.removeError();
                    if($doNotSellConfirmationForm.find(selectors.selectedConfirmationState).val()){
                        window.Cookies.set('ccpa_user_state', $doNotSellConfirmationForm.find(selectors.selectedConfirmationState).val());
                    }
                    APP.formDoNotSellLoginRedirection.createSession(window.location.href);
                    this.redirectToNextPage();
                },
                redirectToNextPage: function () {
                    var currentPage = window.location.href;
                    if (APP.login.isLoggedIn()) {
                        if (currentPage.indexOf('consumer-rights') > -1) {
                            window.location.href = redirectionURL.consumerRight;
                        } else if (currentPage.indexOf('do-not-sell') > -1) {
                            window.location.href = redirectionURL.doNotSell;
                        }
                    } else {
                        window.location.href = redirectionURL.defaultCCPALoginPage;
                    }
                },
            },
            mounted: function () {
                var self = this;
                $(self.$el)
                    .parsley()
                    .on('form:submit', function (e) {
                        self.onFormSubmit(this.$element);
                        return false;
                    });
            },
        });
    };

    var init = function () {
        if (!APP.global.isEditMode()) {
            getElemsReferrences();
            getPagePaths();
            createVueApp();
        }
    };

    return {
        init: init,
    };
})();

'use strict';
var APP = (window.APP = window.APP || {});
APP.formDoNotSellGuestForm = (function () {
    var vueApp;
    var $doNotSellGuestForm;
    var $formLogin;
    var selectors = {
        formLogin: '.js-form-login',
        doNotSellGuestForm: '.doNotSell__guest__form',
        firstNameInput: "input[name='guestUser_firstNameInput']",
        lastNameInput: "input[name='guestUser_lastNameInput']",
        emailInput: "input[name='guestUser_emailInput']",
        zipCodeInput: "input[name='guestUser_zipCodeInput']",
        existingUserError: '#existingUserError',
    };

    var guestUserCookie = {
        name: 'guest_user_data',
        expiry: 1, //1 Day
        security: APP.global.isSecureCookie(),
    };

    var getElemsReferrences = function () {
        $doNotSellGuestForm = $(selectors.doNotSellGuestForm);
        $formLogin = $(selectors.formLogin);
    };

    var registerEventHandlers = function () {
        $doNotSellGuestForm.find(selectors.firstNameInput).attr({
            'v-model': 'firstName',
            'v-on:change': 'onChangeValidation',
        });
        $doNotSellGuestForm.find(selectors.lastNameInput).attr({
            'v-model': 'lastName',
            'v-on:change': 'onChangeValidation',
        });
        $doNotSellGuestForm.find(selectors.emailInput).attr({
            'v-model': 'emailID',
            'v-on:change': 'onChangeValidation',
        });
        $doNotSellGuestForm.find(selectors.zipCodeInput).attr({
            'v-model': 'zipCode',
            'v-on:change': 'onChangeValidation',
        });
    };

    var createVueApp = function () {
        vueApp = new Vue({
            el: $doNotSellGuestForm.get(0),
            data: {
                emailID: '',
                firstName: '',
                lastName: '',
                zipCode: '',
                guestUserData: null,
            },
            methods: {
                onFormSubmit: function ($elem) {
                    $doNotSellGuestForm = $elem;
                    APP.global.removeError();
                    this.checkUsernameAvailability().done(function (response) {
                        if (response.data) {
                            vueApp.createGuestPayload();
                            vueApp.storeDataInCookie();
                            APP.formDoNotSellLoginRedirection.updateSession(window.location.href);
                            APP.formDoNotSellLoginRedirection.redirectToNextCCPAPage();
                        } else {
                            var errorMsg = $doNotSellGuestForm.find(selectors.existingUserError).val();
                            APP.global.getErrorMsg(errorMsg, $doNotSellGuestForm);
                            // $formLogin.find('#email').focus();
                            vueApp.clearFormFields();
                        }
                    });
                },
                clearFormFields: function () {
                    this.emailID = '';
                    this.firstName = '';
                    this.lastName = '';
                    this.zipCode = '';
                    this.guestUserData = null;
                },
                checkUsernameAvailability: function () {
                    var servlet = {
                        url: '/bin/servlet/profile',
                        serviceName: 'checkUsernameAvailability',
                    };

                    var payload = {
                        email: vueApp.emailID,
                        service: servlet.serviceName,
                    };

                    return APP.global.postFormData(servlet.url, payload).fail(function (jqXHR) {
                        APP.global.getErrorMsg(jqXHR, $doNotSellGuestForm);
                    });
                },
                createGuestPayload: function () {
                    this.guestUserData = {
                        email: vueApp.emailID,
                        firstName: vueApp.firstName,
                        lastName: vueApp.lastName,
                        zipCode: vueApp.zipCode,
                    };
                },
                storeDataInCookie: function () {
                    window.Cookies.set(guestUserCookie.name, JSON.stringify(this.guestUserData), {
                        expires: guestUserCookie.expiry,
                        secure: guestUserCookie.security,
                    });
                },
                onChangeValidation: function (event) {
                    APP.formInput.instantValidation($(event.target));
                },
            },
            mounted: function () {
                var self = this;
                $(self.$el)
                    .parsley()
                    .on('form:submit', function (e) {
                        self.onFormSubmit(this.$element);
                        return false;
                    });
            },
        });
    };

    var init = function () {
        //GUEST USER FORM
        if (!APP.global.isEditMode()) {
            APP.formDoNotSellLoginRedirection.handleDirectVisit();
            getElemsReferrences();
            registerEventHandlers();
            createVueApp();
        }
    };

    return {
        init: init,
    };
})();

'use strict';
var APP = (window.APP = window.APP || {});
APP.formDoNotSell = (function () {
    var vueApp;
    var $doNotSellform;
    var $rightToDeleteConfirmationModal;
    var servletURL = '/bin/servlet/saveConsumerCompliance';
    var serviceEnum = {
        SAVE_CONSUMER_COMPLIENCE: 'SAVE_CONSUMER_COMPLIENCE',
        VERIFY_CONSUMER_COMPLIENCE: 'VERIFY_CONSUMER_COMPLIENCE',
    };
    var selectors = {
        doNotSellForm: '.doNotSell__form',
        variantHdnInput: '#doNotSell__component_variant',
        emailInput: '#emailInput',
        formSubmitSuccessModal: '#formSubmitSuccessModal',
        verificationSuccessText: '.verificationSuccessText',
        verificationErrorText: '.verificationErrorText',
        RIGHT_TO_ACCESS_PARENT_1: "input[name='RIGHT_TO_ACCESS_PARENT_1']",
        RIGHT_TO_ACCESS_PARENT_1_OPTIONS: "input[name='RIGHT_TO_ACCESS_PARENT_1_OPTIONS']",
        RIGHT_TO_ACCESS_PARENT_2: "input[name='RIGHT_TO_ACCESS_PARENT_2']",
        RIGHT_TO_ACCESS_PARENT_2_OPTIONS: "input[name='RIGHT_TO_ACCESS_PARENT_2_OPTIONS']",
        RIGHT_TO_DELETE_OPTIONS: "input[name='RIGHT_TO_DELETE_OPTIONS']",
        RIGHT_TO_DELETE_CONFIRMATION: "input[name='RIGHT_TO_DELETE_CONFIRMATION']",
        RIGHT_TO_OPT_OUT_OPTIONS: "input[name='RIGHT_TO_OPT_OUT_OPTIONS']",
        rightToAccessSelection: '#rightToAccessSelection',
        categoriesSelection: '#categoriesSelection',
        verificationCodeEmpty: '#verificationCodeEmpty',
        rightToDeleteConfirmation: '#rightToDeleteConfirmation',
        otherRequestsSelection: '#otherRequestsSelection',
        recaptchaInput: '#g-recaptcha-response',
        rightToDeleteConfirmationModal: '#rightToDeleteConfirmationModal',
        rightToDeleteModalConfirmBtn: '.js-right-to-delete-modal-confirm-btn',
        ccpa_multiSelect: "input[name='ccpa_multiSelect']",
        OTHER_REQUESTS_OPTIONS: "input[name='OTHER_REQUESTS_OPTIONS']",
        correctInfoDescription: "#correctInfoDescription"
    };
    var privacyCookie = {
        name: 'usprivacy',
        template: '{version}{noticeProvided}{optOutSelected}{fourthCharacter}',
        expiry: 36500, //days
        security: true, //Change Security Value To true For PRODUCTION
        objModel: {
            version: '1',
            noticeProvided: 'Y',
            optOutSelected: 'N',
            fourthCharacter: 'N',
        },
    };
    var validationMessages = {
        rightToAccessSelection: '',
        categoriesSelection: '',
        verificationCodeEmpty: '',
        rightToDeleteConfirmation: '',
        ccpaMultiSelection: '',
        otherRequestsSelection: ''
    };

    var getElemsReferrences = function () {
        $doNotSellform = $(selectors.doNotSellForm);
        $rightToDeleteConfirmationModal = $(selectors.rightToDeleteConfirmationModal);
    };

    var registerEventHandlers = function () {
        $doNotSellform
            .find(selectors.RIGHT_TO_ACCESS_PARENT_1)
            .attr('v-model', 'RIGHT_TO_ACCESS.parent_1.checked')
            .next()
            .addClass('hideCheckBox')
            .parent()
            .attr('v-on:click', 'preventLabelClick($event)');
        $doNotSellform.find(selectors.RIGHT_TO_ACCESS_PARENT_1_OPTIONS).attr('v-model', 'RIGHT_TO_ACCESS.parent_1.options');
        $doNotSellform
            .find(selectors.RIGHT_TO_ACCESS_PARENT_2)
            .attr('v-model', 'RIGHT_TO_ACCESS.parent_2.checked')
            .next()
            .addClass('hideCheckBox')
            .parent()
            .attr('v-on:click', 'preventLabelClick($event)');
        $doNotSellform.find(selectors.RIGHT_TO_ACCESS_PARENT_2_OPTIONS).attr('v-model', 'RIGHT_TO_ACCESS.parent_2.options');
        $doNotSellform.find(selectors.RIGHT_TO_DELETE_OPTIONS).attr('v-model', 'RIGHT_TO_DELETE.options');
        $doNotSellform
            .find(selectors.RIGHT_TO_DELETE_CONFIRMATION)
            .attr('v-model', 'RIGHT_TO_DELETE.confirmation')
            .attr('v-bind:disabled', 'RIGHT_TO_DELETE.options.length == 0');
        $doNotSellform.find(selectors.RIGHT_TO_OPT_OUT_OPTIONS).attr('v-model', 'RIGHT_TO_OPT_OUT.options');
        $doNotSellform.find(selectors.emailInput).attr('v-model', 'emailID');

        $doNotSellform.find(selectors.OTHER_REQUESTS_OPTIONS).attr('v-model', 'OTHER_REQUESTS.options');
        $doNotSellform.find(selectors.OTHER_REQUESTS_OPTIONS).eq(0).next().append(
            $doNotSellform.find(selectors.correctInfoDescription)
                .attr('v-model', 'OTHER_REQUESTS.message')
                .closest('.form-textarea')
                .attr('v-if', "OTHER_REQUESTS.options == '" + $doNotSellform.find(selectors.OTHER_REQUESTS_OPTIONS).eq(0).val() + "'")
                .detach()
        );

        $doNotSellform.find(selectors.ccpa_multiSelect).attr('v-on:click', 'handleRadioSelection($event)');

        $rightToDeleteConfirmationModal.find(selectors.rightToDeleteModalConfirmBtn).on('click', function () {
            APP.modal.closeModal(null, $rightToDeleteConfirmationModal);
            if (APP.recaptcha.validateRecaptcha($doNotSellform)) {
                return false;
            }
        });
    };

    var componentVariant = {
        submit: 'submit',
        verify: 'verify',
    };

    var createVueApp = function () {
        vueApp = new Vue({
            el: $doNotSellform.get(0),
            data: {
                appInitialized: false,
                emailID: '',
                RIGHT_TO_ACCESS: {
                    type: 'RIGHT_TO_ACCESS',
                    parent_1: {
                        checked: false,
                        options: [],
                    },
                    parent_2: {
                        checked: false,
                        options: [],
                    },
                },
                RIGHT_TO_DELETE: {
                    type: 'RIGHT_TO_DELETE',
                    options: [],
                    confirmation: false,
                },
                RIGHT_TO_OPT_OUT: {
                    type: 'RIGHT_TO_OPT_OUT',
                    options: [],
                },
                OTHER_REQUESTS: {
                    type: 'OTHER_REQUESTS',
                    options: '',
                    message: ''
                },
                requestPayload: null,
            },
            methods: {
                onFormSubmit: function ($elem) {
                    $doNotSellform = $elem;
                    APP.global.removeError();
                    this.createRequestPayload();
                    this.setGuestUserDataInPayload();
                    if (
                        this.validateRightToAccessSelection($doNotSellform) &&
                        this.validateRightToDeleteCategoriesSelection($doNotSellform) &&
                        this.validateOtherRequestsSelection($doNotSellform) &&
                        this.validateCategoriesSelection($doNotSellform) &&
                        this.validateRightToDeleteConfirmation($doNotSellform)
                    ) {
                        if (this.RIGHT_TO_DELETE.confirmation) {
                            this.showRightToDeleteModal();
                        } else {
                            if (APP.recaptcha.validateRecaptcha($doNotSellform)) {
                                return false;
                            }
                        }
                    }
                },
                recaptchaSuccessCallback: function () {
                    APP.global.showLoader();

                    this.setRecaptchaResponseInPayload();

                    $.ajax({
                        url: servletURL,
                        method: 'POST',
                        data: JSON.stringify(this.requestPayload),
                        dataType: 'json',
                        contentType: 'application/json',
                    })
                        .done(function (response) {
                            vueApp.clearGuestUserDataCookie();
                            vueApp.clearStateConfirmationCookie();
                            APP.formDoNotSellLoginRedirection.clearAllCCPASessionKeys();
                            var $modal = $(selectors.formSubmitSuccessModal);
                            var redirectionUrl;
                            if (location.hostname == 'localhost') {
                                redirectionUrl = 'http://localhost:4502/content/dd/en.html?wcmmode=disabled';
                            } else {
                                redirectionUrl = '/';
                            }
                            $modal.on('modal-close', function () {
                                window.location.href = redirectionUrl;
                            });
                            var modalOpenDelay = vueApp.RIGHT_TO_DELETE.confirmation ? 1000 : 0;
                            setTimeout(function () {
                                APP.modal.showModal(null, $modal);
                            }, modalOpenDelay);
                        })
                        .fail(function (jqXHR) {
                            var response = JSON.parse(jqXHR.responseText);
                            APP.global.getErrorMsg(response.error.message, $doNotSellform);
                        })
                        .always(function () {
                            APP.global.hideLoader();
                            vueApp.createPrivacyCookie();
                        });
                },
                createRequestPayload: function () {
                    var payload = {
                        service: serviceEnum.SAVE_CONSUMER_COMPLIENCE,
                        categories: [],
                        email: '',
                        firstName: '',
                        lastName: '',
                        zipCode: '',
                    };
                    var CategoriesObj = {
                        type: '',
                        options: [],
                    };
                    var obj;

                    if (vueApp.RIGHT_TO_ACCESS.parent_1.options.length > 0 || vueApp.RIGHT_TO_ACCESS.parent_2.options.length > 0) {
                        obj = Object.create(CategoriesObj);
                        obj.type = vueApp.RIGHT_TO_ACCESS.type;
                        obj.options = $.merge(vueApp.RIGHT_TO_ACCESS.parent_1.options.slice(), vueApp.RIGHT_TO_ACCESS.parent_2.options);
                        payload.categories.push(obj);
                    }

                    if (vueApp.RIGHT_TO_DELETE.options.length > 0) {
                        obj = Object.create(CategoriesObj);
                        obj.type = vueApp.RIGHT_TO_DELETE.type;
                        obj.options = vueApp.RIGHT_TO_DELETE.options;
                        payload.categories.push(obj);
                    }

                    if (vueApp.RIGHT_TO_OPT_OUT.options.length > 0) {
                        obj = Object.create(CategoriesObj);
                        obj.type = vueApp.RIGHT_TO_OPT_OUT.type;
                        obj.options = vueApp.RIGHT_TO_OPT_OUT.options;
                        payload.categories.push(obj);
                    }

                    if (vueApp.OTHER_REQUESTS.options.length > 0) {
                        obj = Object.create(CategoriesObj);
                        obj.type = vueApp.OTHER_REQUESTS.type;
                        obj.options = [vueApp.OTHER_REQUESTS.options];
                        if($(selectors.OTHER_REQUESTS_OPTIONS).index(selectors.OTHER_REQUESTS_OPTIONS + ':checked') == 0){
                            obj.message = vueApp.OTHER_REQUESTS.message;
                        }
                        payload.categories.push(obj);
                    }

                    this.requestPayload = payload;
                },
                setRecaptchaResponseInPayload: function () {
                    this.requestPayload['g-recaptcha-response'] = $doNotSellform.find(selectors.recaptchaInput).val();
                },
                setGuestUserDataInPayload: function () {
                    if (!APP.login.isLoggedIn()) {
                        var guest_user_data = window.Cookies.get('guest_user_data');
                        guest_user_data = JSON.parse(guest_user_data.replace(/\\/g, ''));
                        this.requestPayload.email = guest_user_data.email;
                        this.requestPayload.firstName = guest_user_data.firstName;
                        this.requestPayload.lastName = guest_user_data.lastName;
                        this.requestPayload.zipCode = guest_user_data.zipCode;
                    }
                },
                validateRightToAccessSelection: function ($form) {
                    var returnVal = true;
                    if (vueApp.RIGHT_TO_ACCESS.parent_1.checked && vueApp.RIGHT_TO_ACCESS.parent_1.options.length == 0) {
                        returnVal = false;
                    } else if (vueApp.RIGHT_TO_ACCESS.parent_2.checked && vueApp.RIGHT_TO_ACCESS.parent_2.options.length == 0) {
                        returnVal = false;
                    }

                    if (!returnVal) {
                        APP.global.getErrorMsg(validationMessages.rightToAccessSelection, $form);
                    }

                    return returnVal;
                },
                validateRightToDeleteCategoriesSelection: function ($form) {
                    var returnVal = true;
                    if (
                        $form.get(0).elements.ccpa_multiSelect &&
                        $form.get(0).elements.ccpa_multiSelect.value == 'RightToDelete' &&
                        vueApp.RIGHT_TO_DELETE.options.length == 0
                    ) {
                        returnVal = false;
                        APP.global.getErrorMsg(validationMessages.rightToDeleteConfirmation, $form);
                    }

                    return returnVal;
                },
                validateCategoriesSelection: function ($form) {
                    var returnVal = true;
                    if (this.requestPayload.categories.length == 0) {
                        returnVal = false;
                        APP.global.getErrorMsg(validationMessages.categoriesSelection, $form);
                    }

                    return returnVal;
                },
                validateRightToDeleteConfirmation: function ($form) {
                    var returnVal = true;
                    if (vueApp.RIGHT_TO_DELETE.options.length > 0 && !this.RIGHT_TO_DELETE.confirmation) {
                        returnVal = false;
                        APP.global.getErrorMsg(validationMessages.rightToDeleteConfirmation, $form);
                    }
                    return returnVal;
                },
                validateOtherRequestsSelection: function ($form) {
                    var returnVal = true;
                    if (
                        $form.get(0).elements.ccpa_multiSelect &&
                        $form.get(0).elements.ccpa_multiSelect.value == 'OtherRequests' &&
                        vueApp.OTHER_REQUESTS.options.length == 0
                    ) {
                        returnVal = false;
                        APP.global.getErrorMsg(validationMessages.otherRequestsSelection, $form);
                    }

                    return returnVal;
                },
                preventRightToDeleteConfirmationCheck: function (event) {
                    if (vueApp.RIGHT_TO_DELETE.options.length == 0) {
                        event.preventDefault();
                        return false;
                    }
                },
                createPrivacyCookie: function () {
                    if (vueApp.RIGHT_TO_OPT_OUT.options.length > 0) {
                        privacyCookie.objModel.optOutSelected = 'Y';
                    } else {
                        privacyCookie.objModel.optOutSelected = 'N';
                    }
                    var cookieString = APP.global.generateMarkupForCookie(privacyCookie.template, privacyCookie.objModel);

                    window.Cookies.set(privacyCookie.name, cookieString, {
                        expires: privacyCookie.expiry,
                        secure: privacyCookie.security,
                    });
                },
                clearGuestUserDataCookie: function () {
                    window.Cookies.remove('guest_user_data');
                },
                clearStateConfirmationCookie: function () {
                    window.Cookies.remove('ccpa_user_state');
                },
                preventLabelClick: function (event) {
                    event.preventDefault();
                    return false;
                },
                showRightToDeleteModal: function () {
                    APP.modal.showModal(null, $rightToDeleteConfirmationModal);
                },
                handleRadioSelection: function (event) {
                    var name = event.target.value;
                    var rightToDeleteOptions = $(selectors.RIGHT_TO_DELETE_OPTIONS);
                    var rightToDeleteConfirmation = $(selectors.RIGHT_TO_DELETE_CONFIRMATION);
                    var rightToAccessParentOneOption = $(selectors.RIGHT_TO_ACCESS_PARENT_1_OPTIONS);
                    var rightToAccessParentTwoOption = $(selectors.RIGHT_TO_ACCESS_PARENT_2_OPTIONS);
                    var otherRequestsOptions = $(selectors.OTHER_REQUESTS_OPTIONS);
                    if (name == 'RightToKnow') {
                        /* Clear RIGHT TO DELETE selection */
                        this.RIGHT_TO_DELETE.options = [];
                        this.RIGHT_TO_DELETE.confirmation = false;
                        this.OTHER_REQUESTS.options = [];
                        makeCheckboxDisabled(rightToDeleteOptions, rightToDeleteConfirmation, otherRequestsOptions);
                        makeCheckboxEnabled(rightToAccessParentOneOption, rightToAccessParentTwoOption);
                    } else if (name == 'RightToDelete') {
                        /* Clear RIGHT TO ACCESS selection */
                        this.RIGHT_TO_ACCESS.parent_1.checked = false;
                        this.RIGHT_TO_ACCESS.parent_1.options = [];
                        this.RIGHT_TO_ACCESS.parent_2.checked = false;
                        this.RIGHT_TO_ACCESS.parent_2.options = [];
                        this.OTHER_REQUESTS.options = [];
                        makeCheckboxDisabled(rightToAccessParentOneOption, rightToAccessParentTwoOption, otherRequestsOptions);
                        makeCheckboxEnabled(rightToDeleteOptions, rightToDeleteConfirmation);
                    }
                    else if(name == 'OtherRequests'){
                        this.RIGHT_TO_DELETE.options = [];
                        this.RIGHT_TO_DELETE.confirmation = false;
                        this.RIGHT_TO_ACCESS.parent_1.checked = false;
                        this.RIGHT_TO_ACCESS.parent_1.options = [];
                        this.RIGHT_TO_ACCESS.parent_2.checked = false;
                        this.RIGHT_TO_ACCESS.parent_2.options = [];
                        makeCheckboxDisabled(rightToAccessParentOneOption, rightToAccessParentTwoOption, rightToDeleteOptions, rightToDeleteConfirmation);
                        makeCheckboxEnabled(otherRequestsOptions);
                    }
                },
            },
            mounted: function () {
                var self = this;
                $(self.$el)
                    .parsley()
                    .on('form:submit', function (e) {
                        self.onFormSubmit(this.$element);
                        return false;
                    });
            },
        });

        vueApp.$watch('RIGHT_TO_ACCESS.parent_1.checked', function (val) {
            if (!val) {
                this.RIGHT_TO_ACCESS.parent_1.options = [];
            }
        });
        vueApp.$watch('RIGHT_TO_ACCESS.parent_1.options', function (options) {
            if (options.length > 0) {
                this.RIGHT_TO_ACCESS.parent_1.checked = true;
            } else {
                this.RIGHT_TO_ACCESS.parent_1.checked = false;
            }
        });
        vueApp.$watch('RIGHT_TO_ACCESS.parent_2.checked', function (val) {
            if (!val) {
                this.RIGHT_TO_ACCESS.parent_2.options = [];
            }
        });
        vueApp.$watch('RIGHT_TO_ACCESS.parent_2.options', function (options) {
            if (options.length > 0) {
                this.RIGHT_TO_ACCESS.parent_2.checked = true;
            } else {
                this.RIGHT_TO_ACCESS.parent_2.checked = false;
            }
        });
        vueApp.$watch('RIGHT_TO_DELETE.options', function (options) {
            if (options.length == 0) {
                this.RIGHT_TO_DELETE.confirmation = false;
            }
        });

        vueApp.appInitialized = true;
    };

    var sendVerificationCode = function () {
        var code = APP.global.getEncodedURLParameter('code');
        if (!code) {
            APP.global.getErrorMsg(validationMessages.verificationCodeEmpty, $doNotSellform);
        } else {
            var payload = {
                service: serviceEnum.VERIFY_CONSUMER_COMPLIENCE,
                data: {
                    verificationCode: code,
                },
            };

            APP.global.showLoader();

            $.ajax({
                url: servletURL,
                method: 'POST',
                data: JSON.stringify(payload),
                dataType: 'json',
                contentType: 'application/json',
            })
                .done(function (response) {
                    $doNotSellform.find(selectors.verificationSuccessText).show();
                })
                .fail(function (jqXHR) {
                    $doNotSellform.find(selectors.verificationErrorText).show();
                })
                .always(function () {
                    APP.global.hideLoader();
                });
        }
    };

    var getErrorMessages = function () {
        validationMessages.rightToAccessSelection = $doNotSellform.find(selectors.rightToAccessSelection).val();
        validationMessages.categoriesSelection = $doNotSellform.find(selectors.categoriesSelection).val();
        validationMessages.verificationCodeEmpty = $doNotSellform.find(selectors.verificationCodeEmpty).val();
        validationMessages.rightToDeleteConfirmation = $doNotSellform.find(selectors.rightToDeleteConfirmation).val();
        validationMessages.otherRequestsSelection = $doNotSellform.find(selectors.otherRequestsSelection).val();
    };

    var checkVariantAndInitialize = function () {
        var val = $doNotSellform.find(selectors.variantHdnInput).val();
        if (val == componentVariant.submit) {
            registerEventHandlers();
            createVueApp();
            // Initialize the recaptcha with the given callback
            APP.recaptcha.initRecaptcha(vueApp.recaptchaSuccessCallback);
        } else if (val == componentVariant.verify) {
            sendVerificationCode();
            $doNotSellform.show();
        }
    };

    var getDefaultPageURL = function () {
        var defaultStartingPage = $('#ccpaPath').val();
        if (window.location.href.indexOf('do-not-sell') > -1) {
            defaultStartingPage = $('#doNotSellDefaultPath').val();
        }
        return defaultStartingPage;
    };

    var checkIfDirectlyVisited = function () {
        if (!APP.global.isEditMode()) {
            var sessionPath = APP.formDoNotSellLoginRedirection.getSessionDetails(window.location.href);
            var currentPath = window.location.href;

            if (currentPath.indexOf('confirmation') > -1) {
                return false;
            }
            if (!APP.login.isLoggedIn()) {
                if (sessionPath.length < 2) {
                    window.location.href = getDefaultPageURL();
                } else {
                    if (currentPath.indexOf('consumer-rights') > -1 && sessionPath[0].indexOf('consumer-rights') == -1) {
                        window.location.href = getDefaultPageURL();
                    } else if (currentPath.indexOf('do-not-sell') > -1 && sessionPath[0].indexOf('do-not-sell') == -1) {
                        window.location.href = getDefaultPageURL();
                    }
                }
            } else {
                if (sessionPath.length < 1) {
                    window.location.href = getDefaultPageURL();
                } else {
                    if (currentPath.indexOf('consumer-rights') > -1 && sessionPath[0].indexOf('consumer-rights') == -1) {
                        window.location.href = getDefaultPageURL();
                    } else if (currentPath.indexOf('do-not-sell') > -1 && sessionPath[0].indexOf('do-not-sell') == -1) {
                        window.location.href = getDefaultPageURL();
                    }
                }
            }
        }
    };

    var makeCheckboxDisabled = function () {
        for (var i = 0; i < arguments.length; i++) {
            arguments[i].attr('disabled', true);
            arguments[i].parent('label').children('span').addClass('ccpa__disabled-checkbox');
        }
    };

    var makeCheckboxEnabled = function () {
        for (var i = 0; i < arguments.length; i++) {
            arguments[i].removeAttr('disabled');
            arguments[i].parent('label').children('span').removeClass('ccpa__disabled-checkbox');
        }
    };

    var setInitialRadioCheck = function () {
        $('input[type=radio][value=RightToKnow]').trigger('click');
    };

    var init = function () {
        checkIfDirectlyVisited();
        getElemsReferrences();
        getErrorMessages();
        if (!APP.global.isEditMode()) {
            checkVariantAndInitialize();
            setInitialRadioCheck();
        }
        else{
            $doNotSellform.show();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formDeleteMyAccount = (function () {
    var selectors = {
        select_reason: '#select_reason',
        specify_other_reason: '#specify_other_reason',
        delete_my_account_user_confirmation_modal: '#delete-my-account-user-confirmation',
    };

    var createVueApp = function (el) {
        new Vue({
            el: $(el).find('form').get(0),
            data: {
                selectedReason: '',
                otherSpecificReason: '',
                views: {
                    select_reason: 'select_reason',
                    check_to_confirm: 'check_to_confirm',
                    value_on_card_msg: 'value_on_card_msg',
                    no_value_on_card_msg: 'no_value_on_card_msg',
                },
                currentView: null,
                triggerTransition: 1,
            },
            computed: {},
            methods: {
                onFormSubmit: function () {
                    var self = this;
                    this.toggleAreYouSureModal(false);
                    APP.global.removeError();
                    setTimeout(function () {
                        APP.global
                            .postFormData($(self.$el).attr('action'), $(self.$el).serialize())
                            .done(function (response) {
                                if (response.data.isAccountDeleted) {
                                    self.transitionBetweenSteps(function () {
                                        self.currentView = self.views.no_value_on_card_msg;
                                        setTimeout(function () {
                                            window.location.href = '/en/sign-in';
                                        }, 10000);
                                    }, true);
                                } else {
                                    self.transitionBetweenSteps(function () {
                                        self.currentView = self.views.value_on_card_msg;
                                    }, true);
                                }
                            })
                            .fail(function (jqXHR) {
                                APP.global.getErrorMsg(jqXHR, $(self.$el));
                            });
                    }, 800);
                    return false;
                },
                goToNextStep: function (event) {
                    event.preventDefault();
                    $(this.$el).parsley().validate({ group: this.currentView, force: true });
                    if ($(this.$el).find('.parsley-error:visible').length == 0) {
                        if (this.currentView == this.views.select_reason) {
                            this.transitionBetweenSteps(function () {
                                this.currentView = this.views.check_to_confirm;
                            }, true);
                        } else if (this.currentView == this.views.check_to_confirm) {
                            this.toggleAreYouSureModal(true);
                        }
                    }
                },
                transitionBetweenSteps: function (callback, enableTransition) {
                    var self = this;
                    if (enableTransition) {
                        if (self.triggerTransition) {
                            self.triggerTransition--;
                            setTimeout(function () {
                                callback.call(self);
                                self.triggerTransition++;
                            }, 300);
                        }
                    } else {
                        callback.call(self);
                    }
                },
                toggleAreYouSureModal: function (show) {
                    if (show) {
                        APP.modal.showModal(null, $(this.$el).find(selectors.delete_my_account_user_confirmation_modal));
                    } else {
                        APP.modal.closeModal(null, $(this.$el).find(selectors.delete_my_account_user_confirmation_modal));
                    }
                },
                bindVueDirectives: function () {
                    var $form = $(this.$options.el);

                    $form.find(selectors.select_reason).attr('v-model', 'selectedReason');
                    $form
                        .find(selectors.specify_other_reason)
                        .attr('v-model', 'otherSpecificReason')
                        .closest('.form-input')
                        .attr('v-if', 'selectedReason == "other"');

                    $form.find('[data-group="select_reason"]').find('[name]').attr('data-parsley-group', this.views.select_reason);
                    $form.find('[data-group="check_to_confirm"]').find('[name]').attr('data-parsley-group', this.views.check_to_confirm);

                    $form.find('[data-group="select_reason"]').find('.u-cta.u-cta--primary').attr('v-on:click', 'goToNextStep($event)');
                    $form.find('[data-group="check_to_confirm"]').find('.u-cta.u-cta--primary').attr('v-on:click', 'goToNextStep($event)');
                },
            },
            created: function () {
                this.bindVueDirectives();
            },
            mounted: function () {
                this.currentView = this.views.select_reason;
                APP.formSelect.triggerNativeChangeEvent($(this.$el).find('select'));
                $(this.$el).parsley().on('form:submit', this.onFormSubmit);
            },
        });
    };

    var redirectToDeleteAccountPage = function () {
        window.location.href = '/en/account/profile-management/delete-my-account';
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            createVueApp(el);
        }
    };

    return {
        init: init,
        redirectToDeleteAccountPage: redirectToDeleteAccountPage,
    };
})();

/*globals Vue:false */

'use strict';
var APP = (window.APP = window.APP || {});
APP.formDeledeDDCard = (function () {
    var deleteCardVue;
    var allCardList = [];

    var errorMsg = function (msg) {
        var error = '<div class="u-page-error js-transfer-balance-error">' + msg + '</div>';

        if ($('.js-transfer-balance-error').length === 0) {
            $('.js-form-transfer-balance').prepend(error);
        } else {
            $('.js-transfer-balance-error').html(msg);
        }

        APP.global.focusError();
    };

    var getCardsData = function () {
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                service: 'getDdCardDetails',
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                deleteCardVue.cardList = response.data;
            },
            error: function (jqXHR) {
                var noCardsFound = jqXHR.responseJSON.error.code === 'APP4238' ? true : false;

                if (noCardsFound) {
                    $('.js-delete-dd-card__container').hide();
                    $('.js-delete-dd-card__container-no-cards').show();
                } else {
                    $('.js-delete-dd-card__container').show();
                    $('.js-delete-dd-card__container-no-cards').hide();
                    APP.global.getErrorMsg(jqXHR, $('.js-form-delete-dd-card'));
                }
            },
        });
    };

    var formatBalance = function (bal) {
        var balString = parseFloat(bal).toFixed(2).toString();
        var decimalPlace = balString.indexOf('.');
        var dollars = balString.substring(0, decimalPlace);
        var cents = balString.substring(decimalPlace + 1);

        return {
            dollar: dollars,
            cents: cents,
        };
    };

    var confirmationModal = function (modal, cardNumber, balance) {
        $('#' + modal).attr('data-cardNumber', cardNumber);
        $('#' + modal).attr('data-balance', balance);
    };

    var deleteCard = function (e) {
        e.preventDefault();
        var cardNumberConfirmation = $(this).parents('.js-modal').attr('data-cardNumber');
        var balanceConfirmation = $(this).parents('.js-modal').attr('data-balance');
        var modalConfirmation = $('.form-delete-dd-card__modal-confirmation').attr('id');
        var modalError = $('.form-delete-dd-card__modal-error .js-modal');

        APP.modal.closeModal(null, '#' + modalConfirmation);

        if (balanceConfirmation === '0') {
            APP.global.showLoader();
            $.ajax({
                type: 'POST',
                url: '/bin/servlet/transaction',
                data: JSON.stringify({
                    'card-number': cardNumberConfirmation,
                    service: 'deleteDdCard',
                }),
                dataType: 'json',
                contentType: 'application/json',
                success: function (response) {
                    getCardsData();
                },
                error: function (jqXHR) {
                    APP.modal.closeModal(null, '#' + modalConfirmation);
                    APP.global.getErrorMsg(jqXHR, $('.js-form-delete-dd-card'));
                },
            });
        } else {
            console.log('Close Modal');
            APP.modal.closeModal(null, '#' + modalConfirmation);
            APP.modal.showModal(null, modalError, true);
        }
    };

    var bindEventsToUI = function (element) {
        deleteCardVue = new Vue({
            el: element,

            data: {
                cardList: [],
            },
            methods: {
                confirmationModalVue: confirmationModal,
            },
        });

        Vue.directive('auto-recharge', function (el, binding, vnode) {
            el.innerHTML = binding.value ? 'On' : 'Off';
        });

        Vue.directive('format-amount', function (el, binding, vnode) {
            var balance = formatBalance(binding.value);

            el.innerHTML = '$' + balance.dollar + '.' + balance.cents;
        });

        getCardsData();

        $('.form-delete-dd-card__modal-confirmation .u-cta--primary').on('click', deleteCard);
    };

    var init = function (element) {
        //console.log('APP.formDeledeDDCard');
        bindEventsToUI(element);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formDdAccount = (function () {
    var $ddAccountForm, $formWrapper, $congratsView, redirectionUrl, $address;

    var bindEventsToUI = function () {
        $ddAccountForm.parsley().on('form:submit', function (e) {
            createAccountFormHandler();
            return false;
        });
        $ddAccountForm.find('.js-add-more-button-link').on('click', addAddressHandler);
        // $ddAccountForm.on('keyup', '#streetAddressOne, #streetAddressTwo, #city, #zipCode', addressValidationHandler);
        // $ddAccountForm.find('.js-add-more-button-link').on('click', addressValidationHandler);

        $ddAccountForm.find('.add-more-button .form-select--default').attr('disabled', true);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formDdAccount'); */
    };

    // Request the sessionId to and register it to Kount
    var makeKountAjaxRequest = function () {
        $.ajax({
            type: 'GET',
            url: '/bin/servlet/kountsession',
            success: function (response) {
                if (response.enabled) {
                    createInput(response);
                }
            },
            error: function (jqXHR, response) {},
        });
    };
    // Create and add a input hidden field with Kount sessionId to the login form
    var createInput = function (data) {
        var src = '/bin/servlet/logo.htm?m=' + data.m + '&s=' + data.sessionid;
        var imgSrc = '/bin/servlet/logo.gif?m=' + data.m + '&s=' + data.sessionid;
        var $dataCollectorContainer = $('<div>').attr('class', 'js-data-collector');
        $('#main-content').append($dataCollectorContainer);
        var $iframe = $('<iframe>');
        $iframe.attr('width', 1).attr('height', 1).attr('frameborder', 0).attr('scrolling', 'no').attr('src', src);
        var $input = $('<input>').attr('type', 'hidden').attr('id', 'sid').val(data.sessionid);
        $('.js-data-collector').html($iframe).append($input);
        var $inputLoginForm = $input;
        $inputLoginForm.attr('id', 'sessionId').attr('name', 'sessionId').val(data.sessionid);
        $ddAccountForm.append($inputLoginForm);
        var $inputSkipMFA = $('<input>').attr('type', 'hidden').attr('id', 'skip_mfa').attr('name', 'skip_mfa').val(true);
        $ddAccountForm.append($inputSkipMFA);
    };

    var init = function (element) {
        // console.log('APP.formDdAccount');
        $ddAccountForm = $('.js-form-dd-account__create-account');
        $formWrapper = $('.form-dd-account__form-wrapper');
        $congratsView = $('.form-dd-account__congrats');
        redirectionUrl = $ddAccountForm.data('redirectionUrl');
        $address = {
            streetAddressOne: $formWrapper.find('#streetAddressOne'),
            streetAddressTwo: $formWrapper.find('#streetAddressTwo'),
            city: $formWrapper.find('#city'),
            state: $formWrapper.find('#state'),
            zipCode: $formWrapper.find('#zipCode'),
        };
        makeKountAjaxRequest();
        /*var checkBox = $ddAccountForm.find('input:checkbox').length ? $($ddAccountForm.find('input:checkbox')[0]).attr('checked', 'checked') : '';*/
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formDdAccount');

        // Initialize the recaptcha with the given callback
        APP.recaptcha.initRecaptcha(formSubmit);
    };

    var addressValidationHandler = function (e) {
        if (
            $address.streetAddressOne.val() !== '' ||
            $address.streetAddressTwo.val() !== '' ||
            $address.city.val() !== '' ||
            $address.state.val() !== null ||
            $address.zipCode.val() !== ''
        ) {
            if (!$address.streetAddressOne.prop('required')) {
                $address.streetAddressOne.prop('required', 'required');
                $address.city.prop('required', 'required');
                $address.state.prop('required', 'required');
                $address.zipCode.prop('required', 'required');
            }
        } else {
            if ($address.streetAddressOne.prop('required')) {
                $address.streetAddressOne.prop('required', false);
                $address.city.prop('required', false);
                $address.state.prop('required', false);
                $address.zipCode.prop('required', false);
            }
        }
    };

    var addAddressHandler = function (e) {
        e.preventDefault();

        $ddAccountForm.find('.add-more-button .form-select--default').attr('disabled', false);

        $(this).off('click');
        var idsToShow = $(this).data('toggle').split(',');
        $(this).removeAttr('data-toggle');
        var idToShow;
        for (var i = 0; i < idsToShow.length; i++) {
            idToShow = '#' + idsToShow[i].trim();
            $(idToShow).slideToggle();
        }
        $(this).on('click', function (e) {
            e.preventDefault();
        });
    };

    var createAccountFormHandler = function (e) {
        APP.global.removeError();

        if (APP.recaptcha.validateRecaptcha($ddAccountForm)) {
            return;
        }
    };

    // Callback function to be executed after recaptcha is succesfull
    var formSubmit = function () {
        var actionURL = $ddAccountForm.attr('action');
        var formData = $ddAccountForm.serialize();

        APP.registration.postData(
            actionURL,
            undefined,
            undefined,
            formData,
            function (response) {
                createAccountFormSuccess(response);
            },
            function (jqXHR, textStatus) {
                createAccountFormFailure(jqXHR, textStatus);
            }
        );
    };

    var createAccountFormSuccess = function () {
        //console.log('success');
        APP.recaptcha.validRecaptcha();

        $formWrapper.hide();
        $(window).scrollTop(0);
        $congratsView.show();
        setTimeout(function () {
            window.location = redirectionUrl;
        }, 3000);
    };

    var createAccountFormFailure = function (jqXHR, textStatus) {
        //console.log('fail');
        $congratsView.hide();
        APP.global.getErrorMsg(jqXHR, $ddAccountForm);
        APP.recaptcha.renderRecaptcha();
    };
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formContactUsInfo = (function () {

    var $hiddenFields;

    var bindEventsToUI = function () {
        $hiddenFields.find('select, input').removeAttr('required');
        showHiddenFields();
        
        $('#ddperksgiftcardyes, #ddperksgiftcardno').change(function(){
            showHiddenFields(); 
        });

    };

    var showHiddenFields = function() {
        if($('#ddperksgiftcardyes').is(':checked')) {
            $hiddenFields.slideDown();
            $hiddenFields.find('select, input').attr('required','required');
        } else {
            $hiddenFields.slideUp();
            $hiddenFields.find('select, input').removeAttr('required');
        }
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formContactUsInfo'); */
    };

    var init = function (element) {
        // console.log('APP.formContactUsInfo');
        $hiddenFields = $('select, input').parents('.grid__item.grid__item--hide');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formContactUsInfo');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';
var APP = (window.APP = window.APP || {});
APP.formContactUsGuestInfo = (function () {
    var vueApp;
    var $contactUsGuestForm;
    var $formLogin;
    var selectors = {
        formLogin: '.js-form-login',
        contactUsGuestInfoForm: '.contactUsGuestInfo__form',
        firstNameInput: "input[name='guestUser_firstNameInput']",
        lastNameInput: "input[name='guestUser_lastNameInput']",
        emailInput: "input[name='guestUser_emailInput']",
        zipCodeInput: "input[name='guestUser_zipCodeInput']",
        phoneNumberInput: "input[name='guestUser_phoneNumberInput']",
        existingUserError: '#existingUserError',
    };

    var guestUserCookie = {
        name: 'contact_us_guest_info',
        security: APP.global.isSecureCookie(),
    };

    var getElemsReferrences = function () {
        $contactUsGuestForm = $(selectors.contactUsGuestInfoForm);
        $formLogin = $(selectors.formLogin);
    };

    var registerEventHandlers = function () {
        $contactUsGuestForm.find(selectors.firstNameInput).attr({
            'v-model': 'firstName',
            'v-on:change': 'onChangeValidation',
        });
        $contactUsGuestForm.find(selectors.lastNameInput).attr({
            'v-model': 'lastName',
            'v-on:change': 'onChangeValidation',
        });
        $contactUsGuestForm.find(selectors.emailInput).attr({
            'v-model': 'emailID',
            'v-on:change': 'onChangeValidation',
        });
        $contactUsGuestForm.find(selectors.zipCodeInput).attr({
            'v-model': 'zipCode',
            'v-on:change': 'onChangeValidation',
        });
        $contactUsGuestForm.find(selectors.phoneNumberInput).attr({
            'v-model': 'phoneNumber',
            'v-on:change': 'onChangeValidation',
        });
    };

    var deleteGuestUserCookie = function () {
        window.Cookies.remove(guestUserCookie.name);
    };

    var getGuestUserCookie = function () {
        var data = window.Cookies.get(guestUserCookie.name);
        if (data) {
            return JSON.parse(data);
        } else {
            return null;
        }
    };

    var createVueApp = function () {
        vueApp = new Vue({
            el: $contactUsGuestForm.get(0),
            data: {
                emailID: '',
                firstName: '',
                lastName: '',
                zipCode: '',
                phoneNumber: '',
                guestUserData: null,
            },
            methods: {
                onFormSubmit: function (event) {
                    APP.global.removeError();
                    this.createGuestPayload();
                    this.storeDataInCookie();
                    this.redirectToNextPage();
                },
                createGuestPayload: function () {
                    this.guestUserData = {
                        email: vueApp.emailID,
                        firstName: vueApp.firstName,
                        lastName: vueApp.lastName,
                        zipCode: vueApp.zipCode,
                        phoneNumber: vueApp.phoneNumber.replace(/\D/g, ''),
                    };
                },
                storeDataInCookie: function () {
                    window.Cookies.set(guestUserCookie.name, JSON.stringify(this.guestUserData), {
                        expires: guestUserCookie.expiry,
                        secure: guestUserCookie.security,
                    });
                },
                onChangeValidation: function (event) {
                    APP.formInput.instantValidation($(event.target));
                },
                redirectToNextPage: function () {
                    var params = APP.global.getURLParameter('from');
                    switch (params) {
                        case 'military-coffee-request':
                            APP.contactUs.redirectToMilitaryCoffeePage();
                            break;
                        default:
                            APP.contactUs.redirectToContactUsPage();
                            break;
                    }
                },
            },
            mounted: function () {
                var self = this;
                $(self.$el)
                    .parsley()
                    .on('form:submit', function (e) {
                        self.onFormSubmit();
                        return false;
                    });
            },
        });
    };

    var init = function () {
        if (!APP.global.isEditMode()) {
            getElemsReferrences();
            registerEventHandlers();
            createVueApp();
        }
    };

    return {
        init: init,
        deleteGuestUserCookie: deleteGuestUserCookie,
        getGuestUserCookie: getGuestUserCookie,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formChooseCardDesign = (function () {
    
    var chooseCardDesignForm;
    var cardCarousel;
    var ddCardObject = {
        enrollmentType : '',
        ddCard : {}
    };
    
    var setSelectedCard = function(e) {
        e.preventDefault();
        var selectedImage = cardCarousel.find('li.slick-active.slick-current img').attr('src');
        chooseCardDesignForm.find('#selectedCard').val(selectedImage);
        ddCardObject.enrollmentType = 'Purchase';
        APP.registration.updateRegistrationDetails(ddCardObject);
        APP.registration.setCardBalance(0);
        APP.registration.nextState();
    };

    var bindEventsToUI = function () {
        chooseCardDesignForm.find('input[type="submit"]').on('click', setSelectedCard);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formChooseCardDesign'); */
    };

    var init = function (element) {
        // console.log('APP.formChooseCardDesign');
        chooseCardDesignForm = $('.js-form-choose-card-design');
        cardCarousel = chooseCardDesignForm.find('.js-carousel');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formChooseCardDesign');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formCateringOrderCancellation = (function () {


    var bindEventsToUI = function () {

    };


    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formCateringOrderCancellation'); */
    };

    var init = function (element) {
        // console.log('APP.formCateringOrderCancellation');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formCateringOrderCancellation');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formCateringFeedbackContactInfo = (function () {

    var bindEventsToUI = function () {

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formCateringFeedbackContactInfo'); */
    };

    var init = function (element) {
        // console.log('APP.formCateringFeedbackContactInfo');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formCateringFeedbackContactInfo');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formCateringFeedbackComments = (function () {

    var $hiddenInputs;

    var bindEventsToUI = function () {
        showHiddenInputs();

        $('#ontheordering').change(function(){
            showHiddenInputs();
        });
    };

    var showHiddenInputs = function() {
        if($('#ontheordering').val() === 'About an existing online order already placed') {
            $hiddenInputs.slideDown();
        } else {
            $hiddenInputs.slideUp();
        }
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formCateringFeedbackComments'); */
    };

    var init = function (element) {
        // console.log('APP.formCateringFeedbackComments');
        $hiddenInputs = $('select, input').parents('.grid__item.grid__item--hide');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formCateringFeedbackComments');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formCateringCancellationReason = (function () {

    var bindEventsToUI = function () {
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formCateringCancellationReason'); */
    };

    var init = function (element) {
        // console.log('APP.formCateringCancellationReason');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formCateringCancellationReason');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formAddZipcode = (function () {

    var $addZipcodeForm = '';
    var $msg = '';
    var $updateCTA = '';
    var animatedClass= 'u-cta--animated';
    var updateSuccessClass = 'u-cta--success';
    var updatedCTAText = 'UPDATED';
    var updateText = 'SUBMIT';
    var disabled_class = 'disabled';

    var bindEventsToUI = function () {
        $updateCTA.on('click', updateZipcodeFormHandler);
    };
    
    var updateZipcodeFormHandler = function (e) {
        e.preventDefault();
        if ($(this).hasClass('disabled')){
            return false;
        }
        else {
            APP.manageProfile.updateZipcode($addZipcodeForm, 
                 updateZipcodeFormSuccess,
                 updateZipcodeFormFailure
            );
        }
    };
    
    var updateZipcodeFormSuccess = function ( res ) {
        setTimeout(function() {
        APP.global.hideLoader();
        APP.global.removeError();
        $updateCTA.val(updatedCTAText);
        $updateCTA.addClass(updateSuccessClass);
        $updateCTA.addClass(disabled_class);
        }, (500));
        
        setTimeout(function() {
            $updateCTA.removeClass(updateSuccessClass);  
            $updateCTA.html(updatedCTAText);
        }, (2000));
        
        setTimeout(function() {
            window.location.reload();
        }, 2000);
    };
    
    var updateZipcodeFormFailure = function ( jqXHR, textStatus ) {
        APP.global.showLoader();
        APP.global.removeError();
        $addZipcodeForm[0].reset();
        setTimeout(function() {
            APP.global.hideLoader();
        }, 1000);
        
        APP.global.getErrorMsg(jqXHR, $addZipcodeForm);       
    };

    var init = function (element) {
        $msg = $('.js-updated-message-note');
        $addZipcodeForm = $('.js-form-add-zip-code');
        $updateCTA = $('.js-form-add-zip-code .u-cta--primary');
        bindEventsToUI();
        $updateCTA.addClass(animatedClass);
    };
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        updateZipcodeFormSuccess: updateZipcodeFormSuccess,
        updateZipcodeFormFailure: updateZipcodeFormFailure
    };

}());

/*globals Vue:false */
'use strict';

var APP = (window.APP = window.APP || {});

APP.formAddValueWrapper = (function () {
    var populateBillingInfoVue;
    var ajaxPostAlreadySubmitted = false;
    var $wrapperForm = '',
        $doubleCheckForm = '',
        $formAddValue = '',
        $amountToBeAdded = '',
        $addValueForm = '',
        $checkBalanceWrapper,
        $checkBalanceForm,
        isVisaCheckout = false,
        isCheckBalanceFlow = false,
        isMasterPassRedirect = false,
        isMasterPass = false,
        damPath = '/etc/designs/dd/images/credit-cards/',
        $selectedCreditCard = '',
        orderNo = '',
        $cardSlider = '',
        ddCardNo = '',
        ddCardPin = '',
        autoRecharge = '',
        $reviewButton,
        orderJSON,
        creditCardJSON = {
            creditcard: {
                cardNumber: '',
                encryptedCCId: '',
                type: '',
                expMonth: '',
                expYear: '',
                cardSecurityCode: '',
                walletType: '',
                vcoUserId: '',
                referenceCallId: '',
                address: {
                    encryptedAddressId: '',
                    firstStreet: '',
                    secondStreet: '',
                    city: '',
                    state: '',
                    zipCode5: '',
                    firstName: '',
                    lastName: '',
                },
            },
        },
        addValueJSON = {
            recharge: {
                email: '',
                amount: '',
                ddCard: {
                    cardNumber: '',
                    cardPin: '',
                },
                orderNumber: '',
                creditCard: {
                    cardNumber: '',
                    encryptedCCId: '',
                    cardSecurityCode: '',
                    type: '',
                    expMonth: '',
                    expYear: '',
                    address: {
                        encryptedAddressId: '',
                        firstStreet: '',
                        secondStreet: '',
                        city: '',
                        state: '',
                        zipCode5: '',
                        firstName: '',
                        lastName: '',
                    },
                },
                sessionId: '',
            },
            service: 'rechargeDdCard',
        };

    var loadJWTFromServerSuccess = function (jwt, jwtId) {
        orderNo = ddCardNo;
    };

    var loadJWTFromServerFailure = function (jqXHR) {
        APP.global.getErrorMsg(jqXHR, $reviewButton);
    };

    var resetSecurityCode = function (e) {
        var $creditCardCVVList = $wrapperForm.find('input[name="security-pin"]');
        $creditCardCVVList.each(function () {
            if ($(this).is(':hidden')) {
                $(this).val('');
            }
        });
    };

    var fetchDDCardDetails = function (e, data) {
        ddCardNo = data.cardNumber;
        ddCardPin = data.cardPin;
        autoRecharge = data.autorechargeActive;
        populateDDCard(ddCardNo, ddCardPin, autoRecharge);
        orderNo = ddCardNo;
        ddLastFourDigits = data.lastFourDigits;
        ddDefaultCard = data.defaultCard;
    };

    var visaCheckoutSuccess = function (data, payment) {
        //console.log('Visa checkout success:' + data);
        APP.global.removeError();
        updateCreditCardDetails({
            creditcard: {
                cardNumber: data.paymentInstrument.accountNumber,
                encryptedCCId: '',
                type: data.paymentInstrument.paymentType.cardBrand.toUpperCase(),
                expMonth: data.paymentInstrument.expirationDate.month,
                expYear: data.paymentInstrument.expirationDate.year,
                cardSecurityCode: '',
                walletType: 'VISA',
                vcoUserId: data.userData.encUserId,
                referenceCallId: payment.callid,
                address: {
                    encryptedAddressId: '',
                    firstStreet: data.paymentInstrument.billingAddress.line1,
                    secondStreet: '',
                    city: data.paymentInstrument.billingAddress.city,
                    state: data.paymentInstrument.billingAddress.stateProvinceCode,
                    zipCode5: data.paymentInstrument.billingAddress.postalCode,
                    firstName: data.paymentInstrument.billingAddress.firstName,
                    lastName: data.paymentInstrument.billingAddress.lastName,
                },
            },
        });

        isVisaCheckout = true;
        isMasterPass = false;
        onComponentShow(creditCardJSON);
        $addValueForm.hide();
        $checkBalanceWrapper.hide();
        $doubleCheckForm.show();
        APP.global.hideLoader();
        $(window).scrollTop(0);
    };

    var visaCheckoutFailure = function (payment, error) {
        APP.global.removeError();
        APP.global.getErrorMsg('Visa_Checkout_Failure', $reviewButton);
        APP.global.hideLoader();
    };

    var walletCancelHandler = function () {
        APP.global.removeError();
        isMasterPass = false;
        isVisaCheckout = false;
        APP.global.hideLoader();
    };

    var onComponentShow = function (creditCardJSON) {
        APP.global.removeError();
        populateBillingInformation();
        populateDDCard(ddCardNo, ddCardPin, autoRecharge, ddLastFourDigits, ddDefaultCard);
        setTotalAmount();
    };

    var updateCreditCardDetails = function (updateObj) {
        $.extend(creditCardJSON, updateObj);
        populateBillingInfoVue.creditcards = updateObj;
    };

    var populateBillingInformation = function () {
        if (creditCardJSON.creditcard && Object.keys(creditCardJSON.creditcard).length !== 0) {
            $doubleCheckForm.find('.review-billing').parents('.block-on-background').show();
            if (isVisaCheckout || isMasterPass || isCheckBalanceFlow) {
            } else {
                var $cardDetailsLink = $selectedCreditCard.find('.js-edit-credit-card');
                $doubleCheckForm.find('.js-credit-card').html($cardDetailsLink.attr('data-lastFourDigitsCardNo'));
            }
            var cardObject = APP.registration.getCardType(creditCardJSON.creditcard.cardNumber);
            var cardObjectProperty = 'card_type';

            if (cardObject[cardObjectProperty] !== null) {
                populateBillingInfoVue.cardIcon = damPath + APP.registration.creditCardTypes[cardObject[cardObjectProperty].name][1];
            } else {
                $doubleCheckForm.find('.js-icon-cc').remove();
                $doubleCheckForm.find('.review-billing__visa').hide();
                var image = '<span class="js-icon-cc ' + creditCardJSON.creditcard.type + '"></span>';
                $doubleCheckForm.find('.js-credit-card').before(image);
            }
            if (isMasterPass) {
                $('.js-isMasterPass', $doubleCheckForm).show();
            } else {
                $('.js-isMasterPass').hide();
            }
        } else {
            $doubleCheckForm.find('.review-billing').parents('.block-on-background').hide();
        }
    };

    var populateDDCard = function (ddCardNo, ddCardPin, autorecharge, ddLastFourDigits, ddDefaultCard) {
        $doubleCheckForm.find('.js-image').attr('src', '/etc/designs/dd/images/dd-card/dd-sample-card.svg');
        $doubleCheckForm.find('.js-dd-card-masked, .js-dd-num').html(ddCardNo);
        $doubleCheckForm.find('.js-dd-pin').html(ddCardPin);
        $doubleCheckForm.find('.js-dd-card-masked').html(ddLastFourDigits);

        if (autorecharge === true) {
            $doubleCheckForm.find('.js-card-image-auto-reload').html('On');
        } else {
            $doubleCheckForm.find('.js-card-image-auto-reload').html('Off');
        }
        
        if(ddDefaultCard){
            $('.js-card--primary').show();
        }else {
            $('.js-card--primary').hide();
        }
    };

    var setTotalAmount = function () {
        var rechargeAmount, previousBal, totalBal, previousBalDate;

        rechargeAmount = $('.form-dollar-input__input').val();
        previousBal = $('.js-balance-dollar').html() + $('.js-balance-cents').html();
        previousBalDate = $('.js-balance-date').html();
        //console.log(previousBal);
        totalBal = parseFloat(rechargeAmount) + parseFloat(previousBal.replace('$', ''));

        $doubleCheckForm.find('.js-prev-bal').html(previousBal);
        $doubleCheckForm.find('.js-prev-bal-date').html(previousBalDate);

        $('.js-add-bal').html('$' + parseFloat(rechargeAmount).toFixed(2));

        if (rechargeAmount !== '') {
            $('.js-total-bal').html('$' + parseFloat(totalBal).toFixed(2));
        }
    };

    var reviewAddValueForm = function (e) {
        e.preventDefault();
        //$('body').scrollTop(0);

        APP.global.removeError();
        var msg = '';
        var securityPin;

        if (isCheckBalanceFlow) {
            if ($addValueForm.find('form').parsley().validate()) {
                $checkBalanceWrapper.hide();
                updateCreditCardDetailsNotLoggedIn();
                showReviewScreen(creditCardJSON);
            }
        } else {
            $selectedCreditCard = $('.js-cc-list-item input[type="radio"]:checked').closest('.js-cc-list-item');
            if ($formAddValue.parsley().validate() && $selectedCreditCard.length > 0) {
                var $securityPin = $selectedCreditCard.find('input[name="security-pin"]');
                securityPin = $securityPin.val();
                if ($securityPin.parsley().validate() && securityPin !== '') {
                    updateCreditCardDetailsLoggedIn(securityPin);

                    var eventLabel = $(this).text().trim();
                    APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                    showReviewScreen(creditCardJSON);
                }
            }

            if ($selectedCreditCard.length === 0) {
                APP.global.getErrorMsg('paymentmethods.creditcards.noCardChosen', $('.js-form-choose-credit-card'));
            }

            $selectedCreditCard.find('input[name="security-pin"]').change(function () {
                APP.global.removeError();
            });
        }
    };

    var updateCreditCardDetailsLoggedIn = function (securityPin) {
        var $cardDetailsLink = $selectedCreditCard.find('.js-edit-credit-card');
        var addressId = $cardDetailsLink.attr('data-addressid');
        var $address = $('.js-cc-edit-section .js-address-list-item[data-id="' + addressId + '"]');

        updateCreditCardDetails({
            creditcard: {
                cardNumber: '',
                encryptedCCId: $cardDetailsLink.attr('data-creditcardid').replace('cc-', ''),
                type: $cardDetailsLink.attr('data-type'),
                expMonth: $cardDetailsLink.attr('data-month'),
                expYear: $cardDetailsLink.attr('data-year'),
                cardSecurityCode: securityPin,
                walletType: '',
                vcoUserId: '',
                referenceCallId: '',
                address: {
                    encryptedAddressId: addressId.replace('address-', ''),
                    firstStreet: $address.find('.js-address-1').html(),
                    secondStreet: $address.find('.js-address-2').html(),
                    city: $address.find('.js-city').html(),
                    state: $address.find('.js-state').html(),
                    zipCode5: $address.find('.js-zip').html(),
                    firstName: $cardDetailsLink.attr('data-firstname'),
                    lastName: $cardDetailsLink.attr('data-lastname'),
                },
            },
        });
    };

    var updateCreditCardDetailsNotLoggedIn = function () {
        updateCreditCardDetails({
            creditcard: {
                cardNumber: $addValueForm.find('#creditCardNumber').val(),
                encryptedCCId: '',
                type: '',
                expMonth: APP.dateUtils.getMonthNumber($addValueForm.find('#creditCardMonth').val()),
                expYear: $addValueForm.find('#creditCardYear').val(),
                cardSecurityCode: $addValueForm.find('#creditCardPin').val(),
                walletType: '',
                vcoUserId: '',
                referenceCallId: '',
                address: {
                    encryptedAddressId: '',
                    firstStreet: $addValueForm.find('#streetAddressOne').val(),
                    secondStreet: $addValueForm.find('#streetAddressTwo').val(),
                    city: $addValueForm.find('#city').val(),
                    state: $addValueForm.find('#state').val(),
                    zipCode5: $addValueForm.find('#zipCode').val(),
                    firstName: $addValueForm.find('#firstName').val(),
                    lastName: $addValueForm.find('#lastName').val(),
                },
            },
        });
    };

    var masterpassMark = function () {
        populateBillingInfoVue.masterpass = isMasterPass;
    };

    var showReviewScreen = function (details) {
        onComponentShow(details);
        $wrapperForm.show();
        $doubleCheckForm.show();
        $addValueForm.hide();
        $checkBalanceWrapper.hide();
        $('.hero').hide();
        $(window).scrollTop(0);
    };

    var submitAddValue = function (e) {
        e.preventDefault();
        APP.global.showLoader();
        APP.global.removeError();

        addValueJSON.recharge.amount = $amountToBeAdded.val();
        addValueJSON.recharge.email = $addValueForm.find('#email').val() || '';
        addValueJSON.recharge.creditCard.cardNumber = creditCardJSON.creditcard.cardNumber;
        addValueJSON.recharge.creditCard.encryptedCCId = creditCardJSON.creditcard.encryptedCCId;
        addValueJSON.recharge.creditCard.cardSecurityCode = creditCardJSON.creditcard.cardSecurityCode;
        addValueJSON.recharge.creditCard.expMonth = creditCardJSON.creditcard.expMonth;
        addValueJSON.recharge.creditCard.expYear = creditCardJSON.creditcard.expYear;
        if (isVisaCheckout || isMasterPass || isCheckBalanceFlow) {
            var cardObject = APP.registration.getCardType(creditCardJSON.creditcard.cardNumber);
            var cardObjectProperty = 'card_type';
            if (cardObject[cardObjectProperty] !== null) {
                addValueJSON.recharge.creditCard.type = APP.registration.creditCardTypes[cardObject[cardObjectProperty].name][0];
            }
        } else {
            addValueJSON.recharge.creditCard.type = creditCardJSON.creditcard.type.replace('icon-cc-', '').toUpperCase();
        }
        if (isVisaCheckout || isMasterPass) {
            var creditcardinfo = {
                referenceCallId: creditCardJSON.creditcard.referenceCallId,
                vcoUserId: creditCardJSON.creditcard.vcoUserId,
                walletType: creditCardJSON.creditcard.walletType,
            };
            $.extend(addValueJSON.recharge.creditCard, creditcardinfo);

            // Send walletId only for MC transactions
            if (isMasterPass) {
                addValueJSON.recharge.creditCard.walletId = creditCardJSON.creditcard.walletId;
            }
        } else {
            delete addValueJSON.recharge.creditCard.referenceCallId;
            delete addValueJSON.recharge.creditCard.vcoUserId;
            delete addValueJSON.recharge.creditCard.walletType;
            delete addValueJSON.recharge.creditCard.walletId;
        }
        addValueJSON.recharge.creditCard.address.firstName = creditCardJSON.creditcard.address.firstName;
        addValueJSON.recharge.creditCard.address.lastName = creditCardJSON.creditcard.address.lastName;
        addValueJSON.recharge.creditCard.address.firstStreet = creditCardJSON.creditcard.address.firstStreet;
        addValueJSON.recharge.creditCard.address.encryptedAddressId = creditCardJSON.creditcard.address.encryptedAddressId;
        addValueJSON.recharge.creditCard.address.city = creditCardJSON.creditcard.address.city;
        addValueJSON.recharge.creditCard.address.state = creditCardJSON.creditcard.address.state;
        addValueJSON.recharge.creditCard.address.zipCode5 = creditCardJSON.creditcard.address.zipCode5;
        addValueJSON.recharge.creditCard.address.secondStreet = creditCardJSON.creditcard.address.secondStret || '';
        addValueJSON.recharge.ddCard.cardNumber = ddCardNo || $checkBalanceForm.find('#card-number').val();
        addValueJSON.recharge.ddCard.cardPin = ddCardPin || $checkBalanceForm.find('#pin').val();
        addValueJSON.recharge.sessionId = $('#sid').val();
        var cardType = addValueJSON.recharge.creditCard.type;
        if (!APP.centinal.skipCentinalFlow() && (cardType === 'VISA' || cardType === 'MC')) {
            populateOrderDetails(addValueJSON);
        } else {
            delete addValueJSON.recharge.verification;
            if (APP.centinal.skipCentinalFlow()) {
                addValueJSON.recharge.verification = APP.centinal.getVerificationError();
            }

            submitAddValueAJAX(addValueJSON);
        }
        $('.js-add-selected-old-index').html('');
    };

    var populateOrderDetails = function (addValueJSON) {
        var logUser = APP.login.getUserInfo();
        var updatedOrderNumber = logUser.lastName || addValueJSON.recharge.creditCard.address.lastName;
        updatedOrderNumber = updatedOrderNumber + new Date().getTime();
        orderJSON = {
            OrderDetails: {
                OrderNumber: updatedOrderNumber || orderNo,
                Amount: addValueJSON.recharge.amount * 100,
                CurrencyCode: '840',
            },
            Consumer: {
                Email1: '',
                BillingAddress: {
                    FirstName: addValueJSON.recharge.creditCard.address.firstName,
                    MiddleName: '',
                    LastName: addValueJSON.recharge.creditCard.address.lastName,
                    Address1: addValueJSON.recharge.creditCard.address.firstStreet,
                    Address2: addValueJSON.recharge.creditCard.address.secondStreet || '',
                    City: addValueJSON.recharge.creditCard.address.city,
                    State: addValueJSON.recharge.creditCard.address.state,
                    PostalCode: addValueJSON.recharge.creditCard.address.zipCode5,
                    CountryCode: 'US',
                    Phone1: '',
                },
                Account: {
                    AccountNumber: '',
                    ExpirationMonth: addValueJSON.recharge.creditCard.expMonth,
                    ExpirationYear: addValueJSON.recharge.creditCard.expYear,
                    NameOnAccount: addValueJSON.recharge.creditCard.address.firstName + ' ' + addValueJSON.recharge.creditCard.address.lastName,
                    CardCode: addValueJSON.recharge.creditCard.cardSecurityCode,
                },
            },
        };

        if (orderJSON.OrderDetails.OrderNumber) {
            addValueJSON.recharge.orderNumber = orderJSON.OrderDetails.OrderNumber;
        }

        if (isVisaCheckout || isMasterPass || isCheckBalanceFlow) {
            orderJSON.Consumer.Account.AccountNumber = addValueJSON.recharge.creditCard.cardNumber;
            APP.centinal.centinalFormHandler(orderJSON, centinalSuccess, centinalFailure, centinalNoAction);
        } else {
            getCreditCardNumber(addValueJSON, orderJSON);
        }
    };

    var getCreditCardNumber = function (addValueJSON, orderJSON) {
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                creditcard: {
                    encryptedCCId: addValueJSON.recharge.creditCard.encryptedCCId,
                },
                service: 'getCreditCardNumber',
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                orderJSON.Consumer.Account.AccountNumber = response.data;
                addValueJSON.recharge.creditCard.cardNumber = response.data;
                APP.centinal.centinalFormHandler(orderJSON, centinalSuccess, centinalFailure, centinalNoAction);
            },
            error: function (jqXHR) {
                orderJSON.Consumer.Account.AccountNumber = '';
                APP.global.hideLoader();
                var response = JSON.parse(jqXHR.responseText);
                cancelFlow();
                resetAddCreditCardForm();
                APP.global.getErrorMsg(jqXHR, $reviewButton);
            },
        });
    };

    var centinalSuccess = function (centinalData, jwt) {
        APP.global.removeError();
        centinalData = JSON.parse(centinalData);
        var verification = {
            verification: {
                eci: centinalData.Payment.ExtendedData.ECIFlag,
                enrolled: centinalData.Payment.ExtendedData.Enrolled,
                errorMsg: centinalData.ErrorDescription,
                errorNo: centinalData.ErrorNumber === 0 ? null : centinalData.ErrorNumber,
                statusCode: centinalData.ActionCode,
                transactionId: centinalData.Payment.ProcessorTransactionId,
                xid: centinalData.Payment.ExtendedData.XID,
                cavv: centinalData.Payment.ExtendedData.CAVV,
                signatureVerification: centinalData.Payment.ExtendedData.SignatureVerification,
                paResStatus: centinalData.Payment.ExtendedData.PAResStatus,
                jwt: jwt,
            },
        };
        $.extend(addValueJSON.recharge, verification);

        APP.global.sendToLogger('info', verification, 'Centinal Response');

        submitAddValueAJAX(addValueJSON);
    };

    var centinalFailure = function (response, actionCode) {
        APP.global.removeError();
        var msg = JSON.parse(response);
        if (actionCode === 'FAILURE') {
            APP.global.getErrorMsg('cardinal.authenticationFailed', $reviewButton);
            $('.u-page-error').attr('data-errorcode', msg.ErrorNumber);
            cancelFlow();
            APP.global.hideLoader();
        } else if (actionCode === 'ERROR') {
            var responseObj = JSON.parse(response);
            var errorNumber = responseObj.ErrorNumber;
            if (errorNumber === 10001 || errorNumber === 10002 || errorNumber === 10003 || errorNumber === 10007 || errorNumber === 10009) {
                addValueJSON.recharge.verification = {
                    errorMsg: responseObj.ErrorDescription,
                    errorNo: responseObj.ErrorNumber,
                    statusCode: responseObj.ActionCode,
                    statusMessage: responseObj.ErrorDescription,
                };

                submitAddValueAJAX(addValueJSON);
            } else {
                APP.global.getErrorMsg('cardinal.connectionError', $reviewButton);
                $('.u-page-error').attr('data-errorcode', msg.ErrorNumber);
                cancelFlow();
                APP.global.hideLoader();
            }
        }
    };

    var centinalNoAction = function (centinalData, jwt) {
        APP.global.removeError();
        centinalData = JSON.parse(centinalData);
        addValueJSON.recharge.verification = {};
        addValueJSON.recharge.verification.eci = centinalData.Payment.ExtendedData.ECIFlag;
        addValueJSON.recharge.verification.enrolled = centinalData.Payment.ExtendedData.Enrolled;
        addValueJSON.recharge.verification.jwt = jwt;
        addValueJSON.recharge.verification.transactionId = centinalData.Payment.ProcessorTransactionId;

        APP.global.sendToLogger('info', addValueJSON.recharge.verification, 'Centinal Response');

        submitAddValueAJAX(addValueJSON);
    };

    var submitAddValueAJAX = function (addValueJSON) {
        //console.log(JSON.stringify(addValueJSON));
        if (!ajaxPostAlreadySubmitted) {
            ajaxPostAlreadySubmitted = true;
            $.ajax({
                type: 'POST',
                url: '/bin/servlet/transaction',
                data: JSON.stringify(addValueJSON),
                dataType: 'json',
                contentType: 'application/json',
                success: function (response) {
                    if (response.data) {
                        var transactionNumber = response.data.transactionNumber;
                        if (isVisaCheckout && transactionNumber && transactionNumber !== '') {
                            var requestObj = {
                                orderId: transactionNumber,
                                eventType: 'Confirm',
                                reason: 'Order Placed Successfully',
                                total: $amountToBeAdded.val(),
                            };
                            APP.visaCheckout.generateToken(requestObj, generateTokenSuccess, generateTokenFailure);
                            showConfirmationScreen(transactionNumber);
                        } else {
                            showConfirmationScreen(transactionNumber);
                        }
                    }
                    resetAddCreditCardForm();
                    ajaxPostAlreadySubmitted = true;
                },
                error: function (jqXHR) {
                    APP.global.hideLoader();
                    isVisaCheckout = false;
                    isMasterPass = false;
                    cancelFlow();
                    resetAddCreditCardForm();
                    APP.global.getErrorMsg(jqXHR, $reviewButton);
                    ajaxPostAlreadySubmitted = false;
                },
            });
        }
    };

    var generateTokenSuccess = function (response, transactionNumber) {
        //console.log(response);
        var url = response.data;
        var $img = $('<img>');
        $img.attr('src', url);
        $wrapperForm.append($img);
    };

    var generateTokenFailure = function (jqXHR, textStatus) {
        APP.global.getErrorMsg(jqXHR, $doubleCheckForm);
    };

    var showConfirmationScreen = function (transactionNumber) {
        $addValueForm.hide();
        $doubleCheckForm.hide();
        var lastFourDigits = '';

        if (isVisaCheckout || isMasterPass || isCheckBalanceFlow) {
            lastFourDigits = creditCardJSON.creditcard.cardNumber.slice(-4);
            isVisaCheckout = false;
            isMasterPass = false;
        } else {
            lastFourDigits = $selectedCreditCard.find('.js-edit-credit-card').attr('data-lastFourDigitsCardNo');
        }
        $('.js-success-block-desc').html(
            window.CQ.I18n.getMessage('addValue.success.amount') +
                $amountToBeAdded.val() +
                '. <br>' +
                window.CQ.I18n.getMessage('addValue.success.creditcard') +
                lastFourDigits +
                '.'
        );
        $wrapperForm.find('.js-success-block').show();
        $wrapperForm.find('.js-confirmation-no').html(transactionNumber);
        APP.global.hideLoader();
    };

    var cancelFlow = function (e) {
        if (e) {
            e.preventDefault();
        }
        $addValueForm.show();
        $checkBalanceWrapper.show();
        $doubleCheckForm.hide();
        $('.hero').show();
        $('input[name="security-pin"], input[name="creditCardPin"]').val('');
    };

    var resetAddCreditCardForm = function () {
        if (isCheckBalanceFlow) {
            $addValueForm.find('form')[0].reset();
            APP.formSelect.changeSelection($addValueForm.find('#creditCardMonth, #creditCardYear, #state'), null);
        } else {
            var $ccDetailsForm = $('.js-form-add-new-credit-card-logged-in .js-cc-details');
            var $addCCForm = $('.js-form-add-new-credit-card-logged-in');
            var $addressForm = $('.js-new-cc-add-address');
            var $addMoreButtonLink = $addCCForm.parents('.add-more-button').find('.js-add-more-button-link').first();
            $ccDetailsForm[0].reset();
            APP.formSelect.changeSelection($ccDetailsForm.find('#creditCardMonth, #creditCardYear'), null);
            $addressForm[0].reset();
            APP.formSelect.changeSelection($addressForm.find('#state'), null);
            if ($addMoreButtonLink.hasClass('is-active')) {
                $addMoreButtonLink.trigger('click');
            }
        }
    };

    var masterpassSuccessHandler = function (mpResponse) {
        //console.log(mpResponse);
        APP.masterpass
            .getCreditCardDetails(mpResponse.oauth_token, mpResponse.oauth_verifier, mpResponse.checkout_resource_url)
            .then(function (response) {
                var recipientNameArray = response.data.personalInfo.recipientName.split(' ');
                var firstName;
                var lastName;

                if (recipientNameArray.length === 2) {
                    firstName = recipientNameArray[0];
                    lastName = recipientNameArray[1];
                } else if (recipientNameArray.length === 3) {
                    firstName = recipientNameArray[0] + ' ' + recipientNameArray[1];
                    lastName = recipientNameArray[2];
                } else if (recipientNameArray.length === 4) {
                    firstName = recipientNameArray[0] + ' ' + recipientNameArray[1];
                    lastName = recipientNameArray[2] + ' ' + recipientNameArray[3];
                }

                //console.log(response);
                updateCreditCardDetails({
                    creditcard: {
                        cardNumber: response.data.card.accountNumber,
                        encryptedCCId: '',
                        type: response.data.card.brandId,
                        expMonth: response.data.card.expiryMonth,
                        expYear: response.data.card.expiryYear,
                        cardSecurityCode: '',
                        walletType: 'MC',
                        walletId: response.data.walletID,
                        vcoUserId: response.data.personalInfo.recipientEmailAddress,
                        referenceCallId: mpResponse.oauth_token,
                        address: {
                            encryptedAddressId: '',
                            firstStreet: response.data.card.billingAddress.line1,
                            secondStreet: '',
                            city: response.data.card.billingAddress.city,
                            state: response.data.card.billingAddress.subdivision.split('-')[1],
                            zipCode5: response.data.card.billingAddress.postalCode,
                            firstName: firstName,
                            lastName: lastName,
                        },
                    },
                });
                isMasterPass = true;
                showReviewScreen(creditCardJSON);
                APP.global.hideLoader();
                masterpassMark();
            });
    };

    var masterpassFailureHandler = function (response) {
        //console.log('Failure: ' + JSON.stringify(response));
        isMasterPass = false;
        APP.global.getErrorMsg('Masterpass_Failure', $reviewButton);
        APP.global.hideLoader();
    };

    var getCardIndex = function (index) {
        return index;
    };

    var setMPTransactionCookie = function () {
        var cardSelectedIndex = $('.js-add-selected-index').text().trim();
        var transactionData = {
            rechargeAmount: $amountToBeAdded.val(),
            previousBal: $('.js-balance-dollar').html() + $('.js-balance-cents').html(),
            cardNumber: ddCardNo || $checkBalanceForm.find('#card-number').val(),
            cardPin: ddCardPin || $checkBalanceForm.find('#pin').val(),
            autorechargeActive: autoRecharge,
            email: $addValueForm.find('#email').val() || '',
            cardSelectedIndex: cardSelectedIndex,
        };

        return transactionData;
    };

    // var test = function() {
    //     return 777;
    // };

    var init = function (element) {
        $wrapperForm = $('.js-form-add-value-wrapper');
        $addValueForm = $wrapperForm.find('.js-add-form');
        $doubleCheckForm = $wrapperForm.find('.js-add-value-double-check');
        $formAddValue = $wrapperForm.find('.js-form-add-value');
        $amountToBeAdded = $wrapperForm.find('.form-dollar-input__input');
        $cardSlider = $wrapperForm.find('.form-card-slider');
        $reviewButton = $wrapperForm.find('.js-review-button');
        $checkBalanceForm = $('.js-form-check-balance');
        $checkBalanceWrapper = $checkBalanceForm.parents('.aem-wrap--col-two');
        isCheckBalanceFlow = $checkBalanceForm.length > 0 ? true : false;

        bindEventsToUI();
        resetSecurityCode();

        //Set up for Vendors
        APP.centinal.loadJWTFromServer(loadJWTFromServerSuccess, loadJWTFromServerFailure);

        if ($wrapperForm.length > 0) {
            //if form exists
            //APP.visaCheckout.initialize($('.js-form-add-value input').val(), visaCheckoutSuccess, visaCheckoutFailure, walletCancelHandler);
        }

        if (APP.masterpass.isMPRedirectSuccess()) {
            isMasterPassRedirect = true;

            APP.masterpass.getTransactionDetails().then(function (response) {
                var transactionData = JSON.parse(response.data);
                fetchDDCardDetails(null, transactionData);
                $amountToBeAdded.val(transactionData.rechargeAmount);
                ddCardNo = transactionData.cardNumber;
                $('.js-balance-dollar').html(transactionData.previousBal.split('.')[0] + '.');
                $('.js-balance-cents').html(transactionData.previousBal.split('.')[1]);
                $('.js-add-selected-old-index').text(transactionData.cardSelectedIndex);
                ddCardPin = transactionData.cardPin;
                autoRecharge = transactionData.autorechargeActive;
                $addValueForm.find('#email').val(transactionData.email);
            });
            masterpassSuccessHandler(JSON.parse(APP.masterpass.getQueryParams()));
            APP.masterpass.removeRedirectParams();
        }

        APP.masterpass.removeRedirectParamsOnCancelOrFailure();
    };

    Vue.directive('hide-number-card', function (el, binding, vnode) {
        var card = binding.value;

        el.innerHTML = card.slice(-4);
    });

    var bindEventsToUI = function () {
        if (!populateBillingInfoVue) {
            populateBillingInfoVue = new Vue({
                el: '.js-review-billing',

                data: {
                    creditcards: creditCardJSON,
                    cardIcon: ['/etc/designs/dd/images/credit-cards/visa.png'],
                    masterpass: false,
                },
            });
        }

        $wrapperForm.on('click', '.js-cc-list-item', resetSecurityCode);
        $addValueForm.find('.js-review-button .u-cta--primary').on('click', reviewAddValueForm);
        $doubleCheckForm.find('.u-cta--tertiary, .form-tile-edit__edit').on('click', cancelFlow);
        $doubleCheckForm.find('.u-cta--primary').on('click', submitAddValue);
        $amountToBeAdded.on('keyup', function () {
            if ($formAddValue.parsley().validate()) {
                $('.js-visa-checkout-button').hide();
            } else {
                $('.js-visa-checkout-button').show();
            }
        });
        $cardSlider.on('changed', fetchDDCardDetails);
        $wrapperForm.on('click', '.v-button', function (e) {
            $('#VmeCheckout').hide();
            $('body').removeClass('rxo-open');
            if ($formAddValue.parsley().validate()) {
                APP.global.showLoader();
                $('body').addClass('rxo-open');
                $('#VmeCheckout').show();
            }
        });
        $wrapperForm.on('click', '.js-masterpass-btn', function (e) {
            e.preventDefault();
            if ($formAddValue.parsley().validate()) {
                APP.global.removeError();
                APP.global.showLoader();
                APP.masterpass.init(
                    $amountToBeAdded.val(),
                    'ManualReload',
                    setMPTransactionCookie(),
                    masterpassSuccessHandler,
                    walletCancelHandler,
                    masterpassFailureHandler
                );
            }
        });
    };

    var getVueApp = function () {
        return populateBillingInfoVue;
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        loadJWTFromServerSuccess: loadJWTFromServerSuccess,
        loadJWTFromServerFailure: loadJWTFromServerFailure,
        centinalSuccess: centinalSuccess,
        centinalFailure: centinalFailure,
        centinalNoAction: centinalNoAction,
        getCardIndex: getCardIndex,
        getVueApp: getVueApp,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formAddMemberCard = (function () {
    
  var $addMemberCardForm;
  var $addMoreButtonContainer;
  var $newSectionContainer;
  var $section;
  var $memberCard;
  var $memberCardConfirm;
  
  var bindEventsToUI = function () {
     $section = $addMoreButtonContainer.find("section"); 
     if ($section.length > 0){
       $section.prependTo($newSectionContainer);
     }
     setTimeout(function() {
         $newSectionContainer.show();
     }, 1500);
     
     AddExtraValidation();
  };
  
  var AddExtraValidation = function () {
     /* allow only numbers */
     $memberCard.on('input', function (e) {
      $(this).val($(this).val().replace(/[^0-9]/g, ''));
     });
     
     $memberCardConfirm.on('input', function (e) {
      $(this).val($(this).val().replace(/[^0-9]/g, ''));
     });
     
     $memberCard.focusout(function (e){
      $(this).parsley().validate();
     });
     
     $memberCardConfirm.focusout(function (e){
      $(this).parsley().validate();
     });
     
     $memberCardConfirm.bind("cut copy paste", function(e) {
        e.preventDefault();
        $memberCard.bind("contextmenu", function(e) {
          e.preventDefault();
        });
     });
  };

  var init = function (element) {
      $addMemberCardForm = $('.js-form-add-member-card');
      $addMoreButtonContainer = $('.js-add-member-card .add-more-button');
      $newSectionContainer = $('.js-add-member-card-section-info');
      $memberCard = $("input[name='memberCard']");
      $memberCardConfirm = $("input[name='memberCardConfirm']");
      bindEventsToUI();
  };

  /**
   * interfaces to public functions
   */
  return {
    init: init
  };

}());

'use strict';

var APP = (window.APP = window.APP || {});

APP.formAddExistingCard = (function () {
    var $addExistingCardForm;
    var ddCardObject = {
        enrollmentType: '',
        ddCard: {
            cardNumber: '',
            cardPin: '',
        },
    };

    var addExistingCardFormSuccess = function (response) {
        APP.analytics.fireCategoryEvent(
            APP.analytics.EventCategories.PERKS_REGISTRATION,
            APP.analytics.Events.CLICK,
            'Continue - Link Card - Step 1A'
        );
        var cardBalance = response.data.balance;
        var cardType = response.data.cardType;
        if (cardType === 'P') {
            ddCardObject.enrollmentType = 'Physical';
        } else {
            ddCardObject.enrollmentType = '';
        }
        ddCardObject.ddCard.cardNumber = $addExistingCardForm.find('#card-number').val();
        ddCardObject.ddCard.cardPin = $addExistingCardForm.find('#pin').val();
        APP.registration.setCardBalance(cardBalance);
        APP.registration.updateRegistrationDetails(ddCardObject);
        APP.registration.nextState();
    };

    var addExistingCardFormFailure = function (jqXHR, textStatus) {
        var response = JSON.parse(jqXHR.responseText);
        APP.registration.showError(response.error.message);
    };

    var addExistingCardFormHandler = function ($elem) {
        var actionURL = $elem.attr('action');
        var formData = $elem.serialize();
        APP.registration.removeErrors();
        APP.registration.postData(
            actionURL,
            undefined,
            undefined,
            formData,
            function (response) {
                addExistingCardFormSuccess(response);
            },
            function (jqXHR, textStatus) {
                addExistingCardFormFailure(jqXHR, textStatus);
            }
        );
    };

    var bindEventsToUI = function () {
        $addExistingCardForm.parsley().on('form:submit', function (e) {
            addExistingCardFormHandler(this.$element);
            return false;
        });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formAddExistingCard'); */
    };

    var init = function (element) {
        // console.log('APP.formAddExistingCard');
        $addExistingCardForm = $('.js-form-add-existing-card');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formAddExistingCard');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formAddCardLoggedIn = (function () {
    var $addCardForm, $addCardWrapper, $addCardSuccessView;

    var bindEventsToUI = function () {
        $addCardForm.find('input[type="submit"]').on('click', addCardHandler);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formAddCardLoggedIn'); */
    };

    var init = function (element) {
        // console.log('APP.formAddCardLoggedIn');
        $addCardForm = $('.js-form-add-card-logged-in');
        $addCardWrapper = $('.form-add-card-logged-in-wrapper__card-form');
        $addCardSuccessView = $('.form-add-card-logged-in-wrapper__success');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formAddCardLoggedIn');
    };

    var addCardHandler = function (e) {
        e.preventDefault();
        var actionURL = $addCardForm.attr('action'),
            formData = $addCardForm.serialize(),
            $this = $(this);
        APP.global.removeError();

        console.log($addCardForm.parsley());

        $addCardForm
            .parsley()
            .whenValidate()
            .done(function () {
                var eventLabel = $this.val().trim();
                APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                APP.global.postFormData(actionURL, formData, addCardSuccess, addCardFailure);
            });
    };

    var addCardSuccess = function (res) {
        $addCardWrapper.hide();
        var balance = res.data.balance.balance ? parseFloat(res.data.balance.balance).toFixed(2) : '0.00';
        $addCardSuccessView.find('.teaser__subtitle').append(balance);
        $addCardSuccessView.show();
    };
    var addCardFailure = function (jqXHR, textStatus) {
        APP.global.getErrorMsg(jqXHR, $addCardForm);
    };
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formAddCard = (function () {
    var $formAddCard;
    var skipOneStep = false;
    var ddCardObject = {
        enrollmentType: '',
        ddCard: {},
    };

    var addCardHandler = function (e) {
        e.preventDefault();
        var index = $(e.target).parents('.grid__item').index();
        skipOneStep = index === 1 ? true : false;
        if (skipOneStep) {
            ddCardObject.enrollmentType = 'Purchase';
            APP.registration.updateRegistrationDetails(ddCardObject);
            APP.registration.setCardBalance(0);
            APP.registration.nextState(skipOneStep);
        } else {
            APP.registration.nextState();
        }
    };

    var onComponentShow = function (registrationDetailsObj) {
        if (APP.registration.getOrder() === 0) {
            APP.centinal.loadJWTFromServer(
                function (jwt, jwtId) {
                    APP.registration.setOrder(jwtId);
                },
                function (jqXHR) {
                    var response = JSON.parse(jqXHR.responseText);
                    APP.registration.showError(response.error.message);
                }
            );
        }
    };

    var bindEventsToUI = function () {
        $formAddCard.on('click tap', 'a.teaser__link, a.u-cta', addCardHandler);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formAddCard'); */
    };

    var init = function (element) {
        // console.log('APP.formAddCard');
        $formAddCard = $('.js-form-add-card');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formAddCard');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        onComponentShow: onComponentShow,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.checkAndAddValue = (function () {

    var $checkBalanceForm,
        $balanceSection,
        $addBalanceForm,
        $doneButton,
        $addBalanceButton;


    var submitCheckBalance = function (e) {
        e.preventDefault();

        var ajax;

        if($(this).parsley().validate()) {

            if(APP.recaptcha.validateRecaptcha($checkBalanceForm)){
                return;
            }

/*            
            var submitEl = $(this).find('input:submit');
            if(submitEl) {
            	var eventLabel = (submitEl.data('track') || submitEl.attr('value'));

            	// check if current page is an account
            	var currentPage = window.location.pathname;
            	
            	if(currentPage.indexOf('account') !== -1) {
            		//APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);
            	} else {
            		APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.DD_CARDS, APP.analytics.Events.CLICK, eventLabel);	
            	}
            	
                	
            }
        	
            
            var cardNumber, pin;

            pin = $(this).find('#pin').val();
            cardNumber = $(this).find('#card-number').val();

            APP.global.showLoader();
            ajax = APP.cardManagement.setBalanceAjax(cardNumber, pin); 

            ajax.done(function(response) {
                var amount = JSON.parse(response);
                APP.cardManagement.setBalanceUI($balanceSection, amount.data);
                setCardInfo();
                $checkBalanceForm.hide();
                APP.global.hideLoader();
                $balanceSection.show();
            }); 

            ajax.fail(function(jqXHR) {
                APP.global.getErrorMsg(jqXHR, $checkBalanceForm);
                APP.global.hideLoader();
            }); */
        }
    };
    
    // Callback function to be executed after recaptcha is succesfull
    var formSubmit = function () {
        //console.log('-----------------   check add valuesubmit  ------------ ', window.grecaptcha.getResponse());
        var ajax;

        var submitEl = $checkBalanceForm.find('input:submit');
        if(submitEl) {
	        	var eventLabel = (submitEl.data('track') || submitEl.attr('value'));
	
	        	// check if current page is an account
	        	var currentPage = window.location.pathname;
	        	
	        	if(currentPage.indexOf('account') !== -1) {
	        		//APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);
	        	} else {
	        		APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.DD_CARDS, APP.analytics.Events.CLICK, eventLabel);	
	        	}
        }
    	
        
        var cardNumber, pin;

        pin = $checkBalanceForm.find('#pin').val();
        cardNumber = $checkBalanceForm.find('#card-number').val();

        APP.global.showLoader();
        ajax = APP.cardManagement.setBalanceAjax(cardNumber, pin); 

        ajax.done(function(response) {
            var amount = JSON.parse(response);
            APP.cardManagement.setBalanceUI($balanceSection, amount.data);
            setCardInfo();
            $checkBalanceForm.hide();
            APP.global.hideLoader();
            $balanceSection.show();
        }); 

        ajax.fail(function(jqXHR) {
            APP.global.getErrorMsg(jqXHR, $checkBalanceForm);
            APP.global.hideLoader();
        });
        if (APP.login.isLoggedIn()){
            $balanceSection.find('.join-link').hide();
        }
    };    

    var setCardInfo = function() {
        var cardNumber = $checkBalanceForm.find('#card-number').val();
        $balanceSection.find('.js-dd-card-masked').text(cardNumber.substr(12));
        $balanceSection.find('.js-dd-num').text(cardNumber);
        $balanceSection.find('.js-dd-pin').text($checkBalanceForm.find('#pin').val());
    };

    var resetForm = function (e) {
        $checkBalanceForm[0].reset();
        $balanceSection.hide();
        $addBalanceForm.hide();
        $checkBalanceForm.show();
    };

    var showAddBalanceForm = function(e) {
        e.preventDefault();
        $addBalanceForm.slideDown();
        $doneButton.hide();
        $addBalanceButton.hide();
    };

    var bindEventsToUI = function () {
        $checkBalanceForm.on('submit', submitCheckBalance);
        // $doneButton.on('click', resetForm);
        $addBalanceButton.on('click', showAddBalanceForm);
    };

    var init = function (element) {
        console.log('APP.checkAndAddValue');
        $checkBalanceForm = $('.js-form-check-balance');
        $balanceSection = $('.js-card-balance');
        $addBalanceForm = $('.js-form-add-value-wrapper');

        $doneButton = $balanceSection.find('.u-cta--primary');
        $addBalanceButton = $balanceSection.find('.u-cta--secondary');

        if(!APP.global.isEditMode()) {
            $balanceSection.hide();
            $addBalanceForm.hide();
        }

        bindEventsToUI();
        APP.formAddValueWrapper.init();
        
        // Initialize the recaptcha with the given callback 
		APP.recaptcha.initRecaptcha(formSubmit);
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.autoReloadCardManagementSlide = (function () {

    /*var bindEventsToUI = function () {
        //populateCardSliderDetails
    };*/

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('autoReloadCardManagementForm'); */
    };

    var init = function (element) {
        // console.log('APP.autoReloadCardManagementSlide');
        APP.autoReloadCardManagementForm.init();

    };


    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.autoReloadCardManagementForm = (function () {
    var $autoReloadCardMgmtForm,
        $reviewButton,
        $submitButton,
        $inputExistCard,
        $addNewCardSection,
        $autoReloadSubmitBtn,
        $visaCheckout,
        $masterpass,
        $addMore,
        $choosePayment,
        $divider,
        $disclaimer,
        $reviewForm,
        $autoReloadDetails,
        $cardDetailsLink,
        $reviewSecurityPin,
        $storedCredentialsDisclaimer,
        isVisaCheckoutFlow = false,
        isVisaCheckoutEdit = false,
        selectedDDCard,
        selectedDDcardPin,
        selectedDDcardAutorechargeId,
        encryptedDDCard,
        lastFourDigit,
        ddDefaultCard,
        isMasterPass = false,
        damPath = '/etc/designs/dd/images/credit-cards/',
        reviewDetails = {
            creditcard: {},
        },
        templates = {
            error: '' + "<div class='u-page-error'>{msg}</div>",
        },
        $cardSelector,
        $selectedCreditCard,
        securityPin,
        autoReloadJSON = {
            autoRecharge: {
                encryptedArId: '',
                frequency: '',
                type: '',
                amount: '',
                mobileOptIn: '',
                ddCard: {
                    cardPin: '',
                    cardNumber: '',
                },
                creditCard: {
                    encryptedCCId: '',
                    cardNumber: '',
                    cardSecurityCode: '',
                    type: '',
                    expMonth: '',
                    expYear: '',
                    walletType: '',
                    vcoUserId: '',
                    referenceCallId: '',
                    address: {
                        encryptedAddressId: '',
                        firstName: '',
                        lastName: '',
                        firstStreet: '',
                        secondStreet: '',
                        city: '',
                        state: '',
                        zipCode5: '',
                    },
                },
                sessionId: '',
            },
            service: 'autoRechargeDdCard',
        };

    var bindEventsToUI = function () {
        var reviewBtn = $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__review-btn .u-cta'),
            submitBtn = $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__submit-btn .u-cta'),
            doneBtn = $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__done-btn .u-cta'),
            cancelBtn = $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt--submit .u-cta--tertiary'),
            autoReloadEdit = $autoReloadCardMgmtForm.find('.form-auto-reload__edit'),
            autoReload = $autoReloadCardMgmtForm.find('input[name="auto-reload"]'),
            reviewEditButtons = $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__review .form-tile-edit__edit');
        $cardSelector = $autoReloadDetails.find('.form-card-slider');
        reviewBtn.on('click', reviewHandler);
        submitBtn.on('click', disableAutoReload);
        cancelBtn.on('click', cancelHandler);
        doneBtn.on('click', autoReloadUpdated);
        autoReload.on('click', autoReloadHandler);
        autoReloadEdit.on('click', showEditSection);
        reviewEditButtons.on('click', reviewEditHandler);
        $masterpass.find('.js-masterpass-btn').on('click', masterpassHandler);
        $autoReloadSubmitBtn.on('click', submitAutoReload);
        $cardSelector.on('changed', cardSelectorHandler);
        $reviewSecurityPin.find('input[name="security-pin"]').change(function () {
            APP.global.removeError();
        });

        $choosePayment.on('click', '.form-checkradio__input-label', selectExistCardHideNewCard);

        $addNewCardSection.on('click', addNewCardRemoveSelection);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('autoReloadCardManagementForm'); */
    };

    var init = function (element) {
        // console.log('APP.autoReloadCardManagementForm');
        if (window.Cookies.get('wcmmode') !== 'edit') {
            $autoReloadCardMgmtForm = $('.js-form-auto-reload-card-mgmt');
            $autoReloadDetails = $('.js-form-auto-reload-card-mgmt .form-auto-reload-card-mgmt__manage-card');
            $choosePayment = $('.js-form-choose-credit-card');
            $addMore = $choosePayment.siblings('.add-more-button');
            $divider = $addMore.next('.divider');
            $disclaimer = $autoReloadDetails.find('.disclaimer-text');
            $visaCheckout = $('.js-visa-checkout');
            $masterpass = $autoReloadCardMgmtForm.find('.js-masterpass');
            $reviewButton = $('.form-auto-reload-card-mgmt__review-btn');
            $submitButton = $('.form-auto-reload-card-mgmt__submit-btn');
            $reviewForm = $('.form-auto-reload-card-mgmt__review');
            $autoReloadSubmitBtn = $('.form-auto-reload-card-mgmt--submit .u-cta--primary');
            $reviewSecurityPin = $reviewForm.find('.review-billing .review-billing__security-pin-container');
            $addNewCardSection = $autoReloadCardMgmtForm.find('.js-add-more-button-link[data-toggle=addcreditcard]');
            $storedCredentialsDisclaimer = $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt_stored_credentials_disclaimer');

            bindEventsToUI();
            //APP.visaCheckout.initialize('', visaCheckoutSuccess, visaCheckoutFailure, walletCancelHandler);

            APP.masterpass.removeRedirectParamsOnCancelOrFailure();
            if (APP.masterpass.isMPRedirectSuccess()) {
                isMasterPass = true;
                APP.masterpass.getTransactionDetails().then(function (response) {
                    var transactionData = JSON.parse(response.data);
                    cardSelectorHandler(null, transactionData);
                });
                masterpassSuccessHandler(JSON.parse(APP.masterpass.getQueryParams()));
                APP.masterpass.removeRedirectParams();
            }
        }
    };

    var addNewCardRemoveSelection = function () {
        $autoReloadCardMgmtForm.find('input[name=credit-cards]').prop('checked', false);
    };

    //Don't use
    var selectExistCardHideNewCard = function () {
        if ($autoReloadCardMgmtForm.find('.js-add-more-button-link').hasClass('.is-active')) {
            $autoReloadCardMgmtForm.find('.js-add-more-button-link.is-active').trigger('click');
            $(this).trigger('click');
        }
    };

    var masterpassHandler = function (e) {
        e.preventDefault();
        APP.global.showLoader();
        APP.global.removeError();
        var arData = getSelectedARValues();
        arData.cardNumber = selectedDDCard;
        arData.cardPin = selectedDDcardPin;
        arData.lastFourDigits = selectDDCard.substr(4);
        arData.ddDefaultCard = selectDDCard.defaultCard;
        APP.masterpass.init('0', 'ManualReload', arData, masterpassSuccessHandler, walletCancelHandler, masterpassFailureHandler);
    };

    var cardSelectorHandler = function (e, data) {
        var $autoReloadTabs = $autoReloadDetails.find('.js-auto-reload-tabs');
        var fromMP = $autoReloadTabs.find('#auto-reload-balance-reload-amount').attr('from-mp');

        // if attribute form master pass is set, then it means it already loaded the autoreload data, so not need to reload it again
        if (!fromMP) {
            selectedDDCard = data.cardNumber;
            selectedDDcardPin = data.cardPin;
            selectedDDcardAutorechargeId = data.autorechargeId;
            lastFourDigit = data.lastFourDigits;
            ddDefaultCard = data.defaultCard;
        }

        hideEditSection();

        getAutoRechargeDetails(selectedDDCard);

        // if (data.autorechargeActive) {
        //     getAutoRechargeDetails(selectedDDCard);
        // } else {
        //     encryptedDDCard = '';
        //     setAutoReload(data, false);
        // }
    };

    var showEditSection = function (e) {
        //e.preventDefault();
        APP.global.removeError();
        $reviewButton.show();
        $visaCheckout.show();
        $masterpass.show();
        $addMore.show();
        $choosePayment.show();
        $divider.show();
        $disclaimer.show();
        $storedCredentialsDisclaimer.show();
        //$autoReloadCardMgmtForm.parsley().validate();
    };

    var showDisableAutoReloadSection = function () {
        $submitButton.show();
    };

    var hideEditSection = function (e) {
        APP.global.removeError();
        $reviewButton.hide();
        $visaCheckout.hide();
        $masterpass.hide();
        $addMore.hide();
        $choosePayment.hide();
        $divider.hide();
        $disclaimer.hide();
        $storedCredentialsDisclaimer.hide();
    };

    var hideDisableAutoReloadSection = function () {
        $submitButton.hide();
    };

    var reviewEditHandler = function (e) {
        e.preventDefault();
        APP.global.removeError();
        // if (isVisaCheckoutFlow) {
        //     isVisaCheckoutEdit = true;
        //     $('img.v-button').trigger('click');
        // } else {
        $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__review').hide();
        $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__manage-card').closest('.grid__items').show();
        $selectedCreditCard.find('input[name="security-pin"]').val('');
        //}
    };

    var cancelHandler = function () {
        APP.global.removeError();
        $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__review').hide();
        $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__manage-card').closest('.grid__items').show();
        $selectedCreditCard.find('input[name="security-pin"]').val('');
    };

    var getAutoRechargeDetails = function (cnum) {
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                ddCard: {
                    cardNumber: cnum,
                },
                service: 'getAutoRechargeDetails',
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                if (response.data.length) {
                    encryptedDDCard = response.data[0].encryptedArId || '';
                    setAutoReload(response.data[0], response.data[0].active);
                }
                APP.global.hideLoader();
            },
            error: function (jqXHR, response) {
                setAutoReload(response, false);
                APP.global.hideLoader();
            },
        });
    };

    var setAutoReload = function (data, active) {
        //set auto reload on of functionality
        var autoReload = active;
        var amountSet = false;
        if (data.arAmount) {
            amountSet = true;
        }
        resetARDropdownValues();
        $autoReloadCardMgmtForm.find('.js-auto-reload-information').find('.js-auto-reload-mobile-opt-in').val(data.mobileOptIn);
        if (autoReload || amountSet) {
            if (data && data.creditCard) {
                populateAutoReloadDetails(data);
                setAutoReloadTabs(data);
            } else if (amountSet) {
                setAutoReloadTabs(data);
            }
            $autoReloadCardMgmtForm.find('#no').prop('checked', false);
            $autoReloadCardMgmtForm.find('#yes').prop('checked', true);
            $autoReloadCardMgmtForm.find('.js-auto-reload-information').show();
            $autoReloadCardMgmtForm.find('.js-auto-reload-tabs').hide();
            hideDisableAutoReloadSection();
        } else {
            $autoReloadCardMgmtForm.find('#yes').prop('checked', false);
            $autoReloadCardMgmtForm.find('#no').prop('checked', true);
            $autoReloadCardMgmtForm.find('.js-auto-reload-tabs').hide();
            $autoReloadCardMgmtForm.find('.js-auto-reload-information').hide();
            showDisableAutoReloadSection();
        }
    };

    var autoReloadHandler = function (e) {
        // e.preventDefault();
        if ($(e.target).val() === 'no') {
            hideEditSection();
            showDisableAutoReloadSection();
        } else if ($(e.target).val() === 'yes') {
            showEditSection();
            hideDisableAutoReloadSection();
        }
    };

    var disableAutoReload = function (e) {
        e.preventDefault();
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify({
                ddCard: {
                    cardNumber: selectedDDCard,
                },
                service: 'turnOffAutoRecharge',
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                APP.global.hideLoader();
                $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__manage-card').closest('.grid__items').hide();
                $autoReloadCardMgmtForm.find('.js-updated-block').show();
                APP.global.hideLoader();
            },
            error: function (jqXHR) {
                APP.global.hideLoader();
            },
        });
    };

    var autoReloadUpdated = function (e) {
        e.preventDefault();
        APP.formCardSlider.getDDCardsList();
        $autoReloadCardMgmtForm.find('.js-updated-block').hide();
        $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__manage-card').closest('.grid__items').show();
    };

    var populateAutoReloadDetails = function (data) {
        //$autoReloadDetails.find()
        var $autoReloadCardDetails = $autoReloadDetails.find('.js-auto-reload-information'),
            displayText;

        //credit card details
        var cType = data.creditCard.type ? data.creditCard.type.toLowerCase() : 'visa';
        var image = '<span class="js-icon-cc icon-cc-' + cType + '"></span>';
        $autoReloadCardDetails.find('.js-icon-cc').remove();
        $autoReloadCardDetails.find('.js-auto-reload-credit-card-number').before(image);
        $autoReloadCardDetails.find('.js-auto-reload-credit-card-number').html(data.creditCard.lastFourDigitsCardNo);
        $autoReloadCardDetails.find('.js-auto-reload-credit-card-image').html(data.creditCard.lastFourDigitsCardNo);
        //Billing Information
        $autoReloadCardDetails.find('.js-auto-reload-name').html(data.creditCard.holderName);
        $autoReloadCardDetails.find('.js-auto-reload-address').html(data.creditCard.address.firstStreet);
        $autoReloadCardDetails
            .find('.js-auto-reload-city-state')
            .html(data.creditCard.address.city + ', ' + data.creditCard.address.state + ' ' + data.creditCard.address.zipCode5);
        displayText = getARdisplayText(data);
        $autoReloadCardDetails.find('.form-auto-reload__auto-reload-info .form-auto-reload__header').html(displayText.type);
        $autoReloadCardDetails.find('.js-auto-reload-amount').html(displayText.amountText);
        $autoReloadCardDetails.find('.js-auto-reload-frequency').html(displayText.frequencyText);
    };

    var setAutoReloadTabs = function (data) {
        var $autoReloadTabs = $autoReloadDetails.find('.js-auto-reload-tabs'),
            tabDetails = $autoReloadTabs.find('.js-tab-content'),
            tabs = $autoReloadTabs.find('.js-navigation li'),
            type = data.type || data.arType,
            frequency = Number.isInteger(data.frequency) ? data.frequency.toString() : data.frequency || data.arFrequency,
            amount = data.amount || data.arAmount;

        var fromMP = $autoReloadTabs.find('#auto-reload-balance-reload-amount').attr('from-mp');

        // if attribute form master pass is set, then it means it already loaded the autoreload data, so not need to reload it again
        if (!fromMP || data.arType) {
            tabs.removeClass('js-active');
            tabDetails.removeClass('js-active');

            if (type === 'THRESHOLD') {
                $(tabDetails[0]).addClass('js-active');
                $(tabs[0]).addClass('js-active');
                APP.formSelect.changeSelection($autoReloadTabs.find('#auto-reload-balance-minimum'), frequency);
            } else if (type === 'MONTHLY') {
                $(tabDetails[1]).addClass('js-active');
                $(tabs[1]).addClass('js-active');
                APP.formSelect.changeSelection($autoReloadTabs.find('#auto-reload-schedule-frequency'), 'Monthly');
                APP.formSelect.changeSelection($autoReloadTabs.find('#schedule-monthly-frequency'), frequency);
                APP.formSelect.changeSelection($autoReloadTabs.find('#schedule-monthly-amount'), amount);
            } else if (type === 'WEEKLY') {
                $(tabDetails[1]).addClass('js-active');
                $(tabs[1]).addClass('js-active');
                APP.formSelect.changeSelection($autoReloadTabs.find('#auto-reload-schedule-frequency'), 'Weekly');
                APP.formSelect.changeSelection($autoReloadTabs.find('#schedule-weekly-frequency'), frequency);
                APP.formSelect.changeSelection($autoReloadTabs.find('#schedule-weekly-amount'), amount);
            }
            APP.formSelect.changeSelection($autoReloadTabs.find('#auto-reload-balance-reload-amount'), amount);
        }

        // data is coming from cookie set after masterpass call, add an attribute as a flag
        if (data.arType) {
            $autoReloadTabs.find('#auto-reload-balance-reload-amount').attr('from-mp', true);
        } else {
            $autoReloadTabs.find('#auto-reload-balance-reload-amount').removeAttr('from-mp');
        }
    };

    var resetARDropdownValues = function () {
        var $autoReloadTabs = $autoReloadDetails.find('.js-auto-reload-tabs');
        APP.formSelect.resetSelection($autoReloadTabs.find('#auto-reload-balance-minimum'));
        APP.formSelect.resetSelection($autoReloadTabs.find('#auto-reload-schedule-frequency'));
        APP.formSelect.resetSelection($autoReloadTabs.find('#schedule-monthly-frequency'));
        APP.formSelect.resetSelection($autoReloadTabs.find('#schedule-monthly-amount'));
        APP.formSelect.resetSelection($autoReloadTabs.find('#schedule-weekly-frequency'));
        APP.formSelect.resetSelection($autoReloadTabs.find('#schedule-weekly-amount'));
        APP.formSelect.resetSelection($autoReloadTabs.find('#auto-reload-balance-reload-amount'));
    };

    var getSelectedARValues = function () {
        var $autoReloadTabs = $autoReloadDetails.find('.js-auto-reload-tabs'),
            activeTab = $autoReloadTabs.find('.js-tab-content.js-active').index(),
            ddCard = {
                arFrequency: '',
                arAmount: '',
                arType: '',
                arFrequencyDay: '',
                arMobileOptIn: '',
            };
        if (activeTab === 1) {
            ddCard.arType = 'THRESHOLD';
            ddCard.arFrequency = $autoReloadTabs.find('#auto-reload-balance-minimum').val();
            ddCard.arAmount = $autoReloadTabs.find('#auto-reload-balance-reload-amount').val();
        } else if (activeTab === 2) {
            ddCard.arType = $autoReloadTabs.find('#auto-reload-schedule-frequency').val().toUpperCase();
            if (ddCard.arType === 'WEEKLY') {
                ddCard.arFrequency = $autoReloadTabs.find('#schedule-weekly-frequency').val().trim(' ');
                ddCard.arAmount = $autoReloadTabs.find('#schedule-weekly-amount').val();
                ddCard.arFrequencyDay = $autoReloadTabs.find('#schedule-weekly-frequency option:selected').text().trim(' ');
            } else {
                ddCard.arFrequency = $autoReloadTabs.find('#schedule-monthly-frequency').val().trim(' ');
                ddCard.arAmount = $autoReloadTabs.find('#schedule-monthly-amount').val();
            }
        }
        ddCard.arMobileOptIn = $autoReloadCardMgmtForm.find('.js-auto-reload-information').find('.js-auto-reload-mobile-opt-in').val();

        return ddCard;
    };

    var getARdisplayText = function (data) {
        var frequency = Number.isInteger(data.frequency) ? data.frequency.toString() : data.frequency || data.arFrequency,
            frequencyDay = data.frequencyDay || data.arFrequencyDay,
            type = data.type || data.arType,
            amount = data.amount || data.arAmount,
            arDisplayText = {
                frequencyText: '',
                amountText: '',
                type: '',
            };
        if (type === 'THRESHOLD') {
            arDisplayText.frequencyText = window.CQ.I18n.getMessage('auto_recharge_freq_fallsbelow') + frequency;
            arDisplayText.amountText = '$' + amount + ' | ' + window.CQ.I18n.getMessage('auto_recharge_freq_automatically');
            arDisplayText.type = window.CQ.I18n.getMessage('auto_recharge.type.balance');
        } else if (type === 'WEEKLY') {
            if (!frequencyDay) {
                frequencyDay = window.CQ.I18n.getMessage('auto_recharge.day_of_week.' + frequency);
            }

            arDisplayText.frequencyText =
                window.CQ.I18n.getMessage('auto_recharge_freq_onthe') +
                frequencyDay +
                ' ' +
                window.CQ.I18n.getMessage('auto_recharge_freq_everyweek');
            arDisplayText.amountText = '$' + amount + ' | ' + window.CQ.I18n.getMessage('auto_recharge_freq_weekly');
            arDisplayText.type = window.CQ.I18n.getMessage('auto_recharge.type.schedule');
        } else if (type === 'MONTHLY') {
            arDisplayText.frequencyText =
                window.CQ.I18n.getMessage('auto_recharge_freq_onthe') +
                APP.dateUtils.ordinal_suffix_of(frequency) +
                ' ' +
                window.CQ.I18n.getMessage('auto_recharge_freq_everymonth');
            arDisplayText.amountText = '$' + amount + ' | ' + window.CQ.I18n.getMessage('auto_recharge_freq_monthly');
            arDisplayText.type = window.CQ.I18n.getMessage('auto_recharge.type.schedule');
        }
        return arDisplayText;
    };

    var reviewHandler = function (e) {
        e.preventDefault();
        APP.global.removeError();
        var $this = $(this);
        $reviewSecurityPin.hide();
        isVisaCheckoutFlow = false;
        isVisaCheckoutEdit = false;
        var msg = '';
        $selectedCreditCard = $('.js-cc-list-item input[type="radio"]:checked').closest('.js-cc-list-item');
        if ($selectedCreditCard.length > 0) {
            var $securityPin = $selectedCreditCard.find('input[name="security-pin"]');
            securityPin = $securityPin.val();
            $securityPin
                .parsley()
                .whenValidate()
                .done(function () {
                    if (securityPin !== '') {
                        var eventLabel = $this.text().trim();

                        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                        $cardDetailsLink = $selectedCreditCard.find('.js-edit-credit-card');
                        var addressId = $cardDetailsLink.attr('data-addressid'),
                            $address = $('.js-cc-edit-section .js-address-list-item[data-id="' + addressId + '"]'),
                            ddCardARValues = getSelectedARValues();
                        updateCreditCardDetails({
                            ddCard: {
                                type: ddCardARValues.arType,
                                frequency: ddCardARValues.arFrequency,
                                amount: ddCardARValues.arAmount,
                                frequencyDay: ddCardARValues.arFrequencyDay,
                                mobileOptIn: ddCardARValues.arMobileOptIn,
                            },
                            creditcard: {
                                cardNumber: '',
                                encryptedCCId: $cardDetailsLink.attr('data-creditcardid').replace('cc-', ''),
                                type: $cardDetailsLink.attr('data-type'),
                                expMonth: $cardDetailsLink.attr('data-month'),
                                expYear: $cardDetailsLink.attr('data-year'),
                                cardSecurityCode: securityPin,
                                walletType: '',
                                vcoUserId: '',
                                referenceCallId: '',
                                address: {
                                    encryptedAddressId: addressId.replace('address-', ''),
                                    firstStreet: $address.find('.js-address-1').html(),
                                    secondStreet: $address.find('.js-address-2').html(),
                                    city: $address.find('.js-city').html(),
                                    state: $address.find('.js-state').html(),
                                    zipCode5: $address.find('.js-zip').html(),
                                    firstName: $cardDetailsLink.attr('data-firstname'),
                                    lastName: $cardDetailsLink.attr('data-lastname'),
                                },
                            },
                        });
                        //populate review screen data
                        showReviewScreen();
                    }
                });
        }
        if ($selectedCreditCard.length === 0) {
            msg = 'Please select a payment method.';
            getErrorMesg(msg, $('.js-form-choose-credit-card'));
        }
        $selectedCreditCard.find('input[name="security-pin"]').change(function () {
            APP.global.removeError();
        });
        $(window).scrollTop(0);
    };

    var showReviewScreen = function () {
        populateReviewDetails();
        $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__review').show();
        $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__manage-card').closest('.grid__items').hide();
    };

    var populateReviewDetails = function () {
        populateBillingInformation();
        populateDDCard();
        populateARValues();
    };

    var populateBillingInformation = function () {
        if (reviewDetails.creditcard && Object.keys(reviewDetails.creditcard).length !== 0) {
            if (isVisaCheckoutFlow || isMasterPass) {
                $reviewForm.find('.js-credit-card').html(reviewDetails.creditcard.cardNumber.slice(-4));
            } else {
                $reviewForm.find('.js-credit-card').html($cardDetailsLink.attr('data-lastFourDigitsCardNo'));
            }
            var cardObject = APP.registration.getCardType(reviewDetails.creditcard.cardNumber);
            var cardObjectProperty = 'card_type';

            if (cardObject[cardObjectProperty] !== null) {
                $reviewForm.find('.js-icon-cc').hide();
                $reviewForm.find('.review-billing__visa').show();
                $reviewForm
                    .find('.review-billing__visa')
                    .attr('src', damPath + APP.registration.creditCardTypes[cardObject[cardObjectProperty].name][1])
                    .attr('alt', reviewDetails.creditcard.type);
            } else {
                $reviewForm.find('.review-billing__visa').hide();
                var image = '<span class="js-icon-cc ' + reviewDetails.creditcard.type + '"></span>';
                if ($reviewForm.find('.js-icon-cc').length === 0) {
                    $reviewForm.find('.js-credit-card').before(image);
                } else {
                    $reviewForm.find('.js-icon-cc').replaceWith(image);
                }
            }
            if (isVisaCheckoutFlow) {
                $reviewForm.find('.review-billing__security-pin-container').show();
            } else {
                $reviewForm.find('.review-billing__security-pin-container').hide();
            }
            $reviewForm.find('.js-billing-name').html(reviewDetails.creditcard.address.firstName + ' ' + reviewDetails.creditcard.address.lastName);
            $reviewForm.find('.js-billing-add-street-1').html(reviewDetails.creditcard.address.firstStreet);
            $reviewForm.find('.js-billing-add-street-2').html(reviewDetails.creditcard.address.secondStreet);
            $reviewForm
                .find('.js-billing-add-city')
                .html(
                    reviewDetails.creditcard.address.city +
                        ', ' +
                        reviewDetails.creditcard.address.state +
                        ' ' +
                        reviewDetails.creditcard.address.zipCode5
                );
        }
    };

    var populateDDCard = function () {
        $reviewForm.find('.js-image').attr('src', '/etc/designs/dd/images/dd-card/dd-sample-card.svg');
        $reviewForm.find('.js-card-image-auto-reload').html('On');
        $reviewForm.find('.js-dd-card-masked').html(lastFourDigit);
        $reviewForm.find('.js-dd-num').html(selectedDDCard);
        $reviewForm.find('.js-dd-pin').html(selectedDDcardPin);
        if (ddDefaultCard) {
            $('.js-card--primary').show();
        } else {
            $('.js-card--primary').hide();
        }
    };

    var populateARValues = function () {
        var autoReloadValue = $reviewForm.find('.review-card-value .js-card-value-auto-reload'),
            autoReloadtime = $reviewForm.find('.review-card-value .js-amt'),
            byLabel = $reviewForm.find('.review-card-value .label--review'),
            displayText;

        displayText = getARdisplayText(reviewDetails.ddCard);

        byLabel.html(displayText.type);
        autoReloadValue.html(displayText.amountText);
        autoReloadtime.html(displayText.frequencyText);
    };

    var visaCheckoutSuccess = function (data, payment) {
        APP.global.removeError();
        var ddCardARValues = getSelectedARValues();
        $reviewSecurityPin.show();
        $reviewSecurityPin.find('input[name="security-pin"]').val('');
        updateCreditCardDetails({
            ddCard: {
                type: ddCardARValues.arType,
                frequency: ddCardARValues.arFrequency,
                amount: ddCardARValues.arAmount,
                frequencyDay: ddCardARValues.arFrequencyDay,
            },
            creditcard: {
                cardNumber: data.paymentInstrument.accountNumber,
                encryptedCCId: '',
                type: data.paymentInstrument.paymentType.cardBrand,
                expMonth: data.paymentInstrument.expirationDate.month,
                expYear: data.paymentInstrument.expirationDate.year,
                cardSecurityCode: '',
                walletType: 'VISA',
                vcoUserId: data.userData.encUserId,
                referenceCallId: payment.callid,
                address: {
                    encryptedAddressId: '',
                    firstName: data.paymentInstrument.billingAddress.firstName,
                    lastName: data.paymentInstrument.billingAddress.lastName,
                    firstStreet: data.paymentInstrument.billingAddress.line1,
                    secondStreet: '',
                    city: data.paymentInstrument.billingAddress.city,
                    state: data.paymentInstrument.billingAddress.stateProvinceCode,
                    zipCode5: data.paymentInstrument.billingAddress.postalCode,
                },
            },
        });
        isVisaCheckoutFlow = true;
        visaCheckoutReview(reviewDetails);
    };

    var visaCheckoutFailure = function (payment, error) {
        //console.log('Visa checkout failure.');
        isVisaCheckoutEdit = false;
        var msg = window.CQ.I18n.getMessage('Visa_Checkout_Failure');
        getErrorMesg(msg, $reviewForm);
    };

    var walletCancelHandler = function () {
        //console.log('Visa checkout cancelled.');
        isVisaCheckoutEdit = false;
        isMasterPass = false;
    };

    var visaCheckoutReview = function (reviewDetails) {
        APP.global.removeError();
        populateReviewDetails();
        if (isVisaCheckoutEdit) {
            isVisaCheckoutEdit = false;
        } else {
            $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__review').show();
            $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__manage-card').closest('.grid__items').hide();
        }
    };

    var updateCreditCardDetails = function (updateObj) {
        $.extend(reviewDetails, updateObj);
    };

    var submitAutoReload = function (e) {
        e.preventDefault();
        APP.global.showLoader();
        if (isVisaCheckoutFlow || isMasterPass) {
            var securityPin = $reviewSecurityPin.find('input[name="security-pin"]').val(),
                msg;
            if (securityPin === '') {
                msg = 'Please enter security pin.';
                getErrorMesg(msg, $('.review-billing'));
                APP.global.hideLoader();
                $reviewSecurityPin.find('input[name="security-pin"]').change(function () {
                    APP.global.removeError();
                });
                return;
            }
            reviewDetails.creditcard.cardSecurityCode = securityPin;
        }
        autoReloadJSON.autoRecharge.encryptedArId = encryptedDDCard;
        autoReloadJSON.autoRecharge.amount = reviewDetails.ddCard.amount;
        autoReloadJSON.autoRecharge.frequency = reviewDetails.ddCard.frequency;
        autoReloadJSON.autoRecharge.type = reviewDetails.ddCard.type;
        autoReloadJSON.autoRecharge.mobileOptIn = reviewDetails.ddCard.mobileOptIn;
        autoReloadJSON.autoRecharge.creditCard.cardNumber = reviewDetails.creditcard.cardNumber;
        autoReloadJSON.autoRecharge.creditCard.encryptedCCId = reviewDetails.creditcard.encryptedCCId;
        autoReloadJSON.autoRecharge.creditCard.cardSecurityCode = reviewDetails.creditcard.cardSecurityCode;
        autoReloadJSON.autoRecharge.creditCard.expMonth = reviewDetails.creditcard.expMonth;
        autoReloadJSON.autoRecharge.creditCard.expYear = reviewDetails.creditcard.expYear;
        var cardObject = APP.registration.getCardType(reviewDetails.creditcard.cardNumber);
        var cardObjectProperty = 'card_type';
        if (cardObject[cardObjectProperty] !== null) {
            autoReloadJSON.autoRecharge.creditCard.type = APP.registration.creditCardTypes[cardObject[cardObjectProperty].name][0]; //cardObject[cardObjectProperty].name;
        } else {
            autoReloadJSON.autoRecharge.creditCard.type = reviewDetails.creditcard.type.replace('icon-cc-', '').toUpperCase();
        }
        autoReloadJSON.autoRecharge.creditCard.referenceCallId = reviewDetails.creditcard.referenceCallId;
        autoReloadJSON.autoRecharge.creditCard.vcoUserId = reviewDetails.creditcard.vcoUserId;
        autoReloadJSON.autoRecharge.creditCard.walletType = reviewDetails.creditcard.walletType;

        // Send walletId only for MC transactions
        if (isMasterPass) {
            autoReloadJSON.autoRecharge.creditCard.walletId = reviewDetails.creditcard.walletId;
        }

        if (!isVisaCheckoutFlow && !isMasterPass) {
            delete autoReloadJSON.autoRecharge.creditCard.referenceCallId;
            delete autoReloadJSON.autoRecharge.creditCard.vcoUserId;
            delete autoReloadJSON.autoRecharge.creditCard.walletType;
            delete autoReloadJSON.autoRecharge.creditCard.walletId;
        }
        autoReloadJSON.autoRecharge.creditCard.address.firstName = reviewDetails.creditcard.address.firstName;
        autoReloadJSON.autoRecharge.creditCard.address.lastName = reviewDetails.creditcard.address.lastName;
        autoReloadJSON.autoRecharge.creditCard.address.firstStreet = reviewDetails.creditcard.address.firstStreet;
        autoReloadJSON.autoRecharge.creditCard.address.encryptedAddressId = reviewDetails.creditcard.address.encryptedAddressId;
        autoReloadJSON.autoRecharge.creditCard.address.city = reviewDetails.creditcard.address.city;
        autoReloadJSON.autoRecharge.creditCard.address.state = reviewDetails.creditcard.address.state;
        autoReloadJSON.autoRecharge.creditCard.address.zipCode5 = reviewDetails.creditcard.address.zipCode5;
        autoReloadJSON.autoRecharge.creditCard.address.secondStreet = reviewDetails.creditcard.address.secondStreet;
        autoReloadJSON.autoRecharge.ddCard.cardNumber = selectedDDCard;
        autoReloadJSON.autoRecharge.ddCard.cardPin = selectedDDcardPin;
        autoReloadJSON.autoRecharge.ddCard.autorechargeId = selectedDDcardAutorechargeId;
        autoReloadJSON.autoRecharge.sessionId = $('#sid').val();

        //console.log(autoReloadJSON);
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify(autoReloadJSON),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                APP.global.hideLoader();
                submitAutoReloadSuccess(response);
            },
            error: function (jqXHR) {
                APP.global.hideLoader();
                APP.global.getErrorMsg(jqXHR, $autoReloadDetails);
                $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__review').hide();
                $autoReloadCardMgmtForm.find('.form-auto-reload-card-mgmt__manage-card').closest('.grid__items').show();
                if ($selectedCreditCard) {
                    $selectedCreditCard.find('input[name="security-pin"]').val('');
                }
            },
        });
    };

    var submitAutoReloadSuccess = function (response) {
        if (response.data) {
            var transactionNumber = response.data.transactionNumber;
            if (isVisaCheckoutFlow && transactionNumber && transactionNumber !== '') {
                var requestObj = {
                    orderId: transactionNumber,
                    eventType: 'Confirm',
                    reason: 'Order Placed Successfully',
                    total: reviewDetails.ddCard.amount,
                };
                APP.visaCheckout.generateToken(requestObj, generateTokenSuccess, generateTokenFailure);
            } else {
                autoReloadSuccess();
            }
        }
    };

    var generateTokenSuccess = function (response) {
        var url = response.data;
        var $img = $('<img>');
        $img.attr('src', url);
        $reviewForm.append($img);
        autoReloadSuccess();
    };

    var generateTokenFailure = function (jqXHR, textStatus) {
        var response = JSON.parse(jqXHR.responseText);
        getErrorMesg(response.error.message, $reviewForm);
        //APP.modal.closeModal.apply($transitionModal.find('.js-modal-close'));
    };

    var autoReloadSuccess = function () {
        $autoReloadDetails.hide();
        $reviewForm.hide();
        var lastFourDigits = '';
        if (isVisaCheckoutFlow || isMasterPass) {
            lastFourDigits = reviewDetails.creditcard.cardNumber.slice(-4);
        } else {
            lastFourDigits = $cardDetailsLink.attr('data-lastFourDigitsCardNo');
        }
        $('.js-success-block-desc').html(
            window.CQ.I18n.getMessage('auto_recharge.success.amount') +
                reviewDetails.ddCard.amount +
                window.CQ.I18n.getMessage('auto_recharge.success.creditcard') +
                lastFourDigits
        );
        $autoReloadCardMgmtForm.find('.js-success-block').show();
        $(window).scrollTop(0);
    };

    var getErrorMesg = function (msg, $form) {
        $form.append(
            APP.registration.generateMarkup(templates.error, {
                msg: msg,
            })
        );
    };

    var masterpassSuccessHandler = function (mpResponse) {
        APP.masterpass
            .getCreditCardDetails(mpResponse.oauth_token, mpResponse.oauth_verifier, mpResponse.checkout_resource_url)
            .then(function (response) {
                var creditCard = response.data;
                var transactionData = getSelectedARValues();
                var recipientNameArray = creditCard.personalInfo.recipientName.split(' ');
                var firstName;
                var lastName;

                if (recipientNameArray.length === 2) {
                    firstName = recipientNameArray[0];
                    lastName = recipientNameArray[1];
                } else if (recipientNameArray.length === 3) {
                    firstName = recipientNameArray[0] + ' ' + recipientNameArray[1];
                    lastName = recipientNameArray[2];
                } else if (recipientNameArray.length === 4) {
                    firstName = recipientNameArray[0] + ' ' + recipientNameArray[1];
                    lastName = recipientNameArray[2] + ' ' + recipientNameArray[3];
                }

                //console.log(creditCard);

                updateCreditCardDetails({
                    ddCard: {
                        type: transactionData.arType,
                        frequency: transactionData.arFrequency,
                        frequencyDay: transactionData.arFrequencyDay,
                        amount: transactionData.arAmount,
                    },
                    creditcard: {
                        cardNumber: creditCard.card.accountNumber,
                        encryptedCCId: '',
                        type: creditCard.card.brandId,
                        expMonth: creditCard.card.expiryMonth,
                        expYear: creditCard.card.expiryYear,
                        cardSecurityCode: '',
                        walletType: 'MC',
                        walletId: creditCard.walletID,
                        vcoUserId: response.data.personalInfo.recipientEmailAddress,
                        referenceCallId: mpResponse.oauth_token,
                        address: {
                            encryptedAddressId: '',
                            firstName: firstName,
                            lastName: lastName,
                            firstStreet: creditCard.card.billingAddress.line1,
                            secondStreet: '',
                            city: creditCard.card.billingAddress.city,
                            state: creditCard.card.billingAddress.subdivision.split('-')[1],
                            zipCode5: creditCard.card.billingAddress.postalCode,
                        },
                    },
                });

                isMasterPass = true;
                showReviewScreen();
                $reviewSecurityPin.show();
                $reviewSecurityPin.find('input[name="security-pin"]').val('');
                APP.global.hideLoader();
            });
    };

    var masterpassFailureHandler = function (response) {
        //console.log('Failure: ' + JSON.stringify(response));
        isMasterPass = false;
        var msg = window.CQ.I18n.getMessage('Masterpass_Failure');
        getErrorMesg(msg, $reviewButton);
        APP.global.hideLoader();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

"use strict";

var APP = (window.APP = window.APP || {});

APP.recaptcha = (function () {
    var siteAPIKey;
    var $currentForm;
    var loginKey = "incorrect-login";
    var templates = {
        error: "" + "<div class='u-page-error'>{msg}</div>",
    };
    var servletURL = "/bin/servlet/recaptcha";
    var isWhitelistedDeferred = new $.Deferred();

    var recaptchaCallback;

    var initRecaptcha = function (recaptchaCallbackParam) {
        recaptchaCallback = recaptchaCallbackParam;
    };

    var checkIfWhitelisted = function () {
        APP.global.postFormData(
            servletURL,
            {},
            function (response) {
                isWhitelistedDeferred.resolve(response.byPassRecaptchaFlag);
            },
            function (jqXHR) {
                isWhitelistedDeferred.resolve(false);
                console.log("Recaptcha - IP whitelisted check ERROR ::", jqXHR);
            }
        );
    };

    var renderRecaptcha = function (isInitial, afterCallback) {
        if (!isInitial) {
            window.grecaptcha.reset();
        } else {
            // APP.storage.set(loginKey, true);
            var timer = setInterval(function () {
                if (window.grecaptcha && window.grecaptcha.render) {
                    clearInterval(timer);
                    window.grecaptcha.render("recaptcha", {
                        callback: afterCallback,
                        badge: "bottomleft",
                    });
                }
            }, 500);
        }
    };

    var validateRecaptcha = function (pageForm) {
        isWhitelistedDeferred.done(function (isWhitelisted) {
            if (isWhitelisted) {
                recaptchaCallback();
            } else {
                if (window.grecaptcha.getResponse() !== "") {
                    window.grecaptcha.reset();
                }
                window.grecaptcha.execute();
            }
        });
    };

    var validRecaptcha = function () {
        if (APP.storage.get(loginKey)) {
            APP.storage.remove(loginKey);
        }
    };

    var bindEventsToUI = function () {};

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('recaptcha'); */
    };

    var init = function (element) {
        //console.log('APP.recaptcha');
        siteAPIKey = $("#recaptcha").data("sitekey");

        bindEventsToUI();

        checkIfWhitelisted();

        renderRecaptcha(true, recaptchaCallback);

        //APP.global.resizeRouteList.push('recaptcha');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        initRecaptcha: initRecaptcha,
        bindOnResize: bindOnResize,
        renderRecaptcha: renderRecaptcha,
        validateRecaptcha: validateRecaptcha,
        validRecaptcha: validRecaptcha,
    };
})();

'use strict';

/* global Parsley */

var APP = window.APP = window.APP || {};

APP.formTelephone = (function () {

    var $inputs;

    var bindEventsToUI = function () {
        $inputs.attr('data-parsley-errors-messages-disabled','true');

        $inputs.change(function(){
            var tempValue = 0; 

            $inputs.each(function(){
                if($(this).val() !== ''){
                    tempValue++;
                }
            });

            if(tempValue !== $inputs.length){
                $inputs.attr('required','true');
            } else {
                $inputs.each(function(){
                    $(this).removeAttr('required')
                        .removeClass('parsley-error');
                });
            }
        });

        validate();
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formTelephone'); */
    };

    var validate = function () {
        Parsley.addValidator('telephone', {
            messages: { en: $('.js-form-telephone').attr('data-error-message') },
            requirementType: 'integer',
            validate: function(_value, requirement, instance) {
                var tempValue = 0; 

                $inputs.each(function(){
                    if($(this).val() !== '') {
                        tempValue++;
                    }
                });

                if(tempValue !== $inputs.length){
                    return false;  
                } 

                if($('#telephoneAreaCode, #telephoneThreeDigits, #telephoneFourDigits').hasClass('parsley-error')){
                    return false;
                } 

                return true;
            }
        });
    };

    var init = function (element) {
        // console.log('APP.formTelephone');
        $inputs = $('.js-form-telephone input');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formTelephone');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.formChooseCreditCard = (function () {
    var $formEditCreditCard = '';
    var $formEditCreditCardCta = '';
    var $chooseCCCardCOntainer = '';
    var $addMoreButtonLink = '';
    var serviceJSON = { service: '' };
    var $sectionEditCreditCard = '';
    var $addAddressCCForm = '';
    var $ccAddressList = '';
    var $ccList = '';
    
    var cardListItem = '<li class="form-checkradio__item form-checkradio__item--radio form-checkradio__item--credit-card js-cc-list-item" data-action="formChooseCreditCard">' +
    '<label for="" class="js-input-label">' +
    '<input type="radio" name="credit-cards"/>' +
    '<div class="form-checkradio__input-label">' +
    '<div class="credit-card__card js-card"><span class="js-icon-cc"></span><div class="credit-card__card js-card-detail"><div><span class="js-credit-card-type"></span><span class="u-credit-card js-credit-card"></span></div><div class="credit-card__date js-date u-show-s"></div><div class="credit-card__edit js-edit"><a href="#" class="js-edit-credit-card" title="Edit Credit Card">Edit</a></div></div>' +
    '<div class="credit-card__date js-date u-hide-s"></div>' +
    '</div>' +
    '<div class="form-checkradio__security-code" >' +
    '<div class="form-checkradio__security-text">For your protection, each time you set up or edit an Reload profile and use a stored payment method, you must re-enter the Security Code for the payment method you selected above.</div>' +
    '<label for="security-pin">Security Code</label>' +
    '<input type="password" name="security-pin" required="required" maxlength="4" pattern="/^[0-9]{3,4}$/"/>' +
    '<a class="u-cta--tertiary js-security-code-cta">What\'s this</a>' +
    '</div>' +
    '</label>' +
    '</li>';

    var deleteTemplate = '<div class="credit-card__delete"><a href="#" class="js-delete-credit-card" title="Delete Credit Card"> Delete</a></div>';

    var autoReloadTemplate =
        '<div class="credit-card__auto-reload js-credit-card-auto-reload"><img src="/etc/designs/dd/images/auto-reload-icon-white.svg" alt="auto reload icon"></div>';

    var address =
        '<li class="form-checkradio__item js-address-list-item">' +
        '<label for="adresss-radio-1">' +
        '<input type="radio" name="credit-cards" value=""/>' +
        '<span class="form-checkradio__input-label">' +
        '<p>' +
        '<span class="form-checkradio__firstName js-firstName"></span>' +
        ' ' +
        '<span class="form-checkradio__lastName js-lastName"></span>' +
        '</p>' +
        '<span class="form-checkradio__address-1 js-address-1"></span>' +
        '<p class="form-checkradio__address-2 js-address-2"></p>' +
        '<p>' +
        '<span class="form-checkradio__city js-city"></span>, <span class="address-list__state js-state"></span>' +
        ' ' +
        '<span class="form-checkradio__zip js-zip"></span>' +
        '</p>' +
        '</span>' +
        '</label>' +
        '</li>';

    var addressData = {
        address: {
            encryptedAddressId: '',
            firstStreet: '',
            secondStreet: '',
            city: '',
            state: '',
            zipCode5: '',
            firstName: '',
            lastName: '',
        },
        service: '',
    };

    var modifyCCDataObj = {
        creditcard: {
            encryptedCCId: '',
            expMonth: '',
            expYear: '',
            cardSecurityCode: '',
            encryptedAddressId: '',
            autorecharge: '',
            address: {
                firstName: '',
                lastName: '',
                encryptedAddressId: '',
                firstStreet: '',
                secondStreet: '',
                city: '',
                state: '',
                zipCode5: '',
            },
        },
        service: 'modifyCreditCard',
    };

    var primaryCta = '.u-cta.u-cta--primary';
    var secondaryCta = '.u-cta.u-cta--link';
    var addMorePrimaryCta = '.js-form-choose-credit-card .add-more-button .u-cta.u-cta--primary';
    var addMoreSecondaryCta = '.js-form-choose-credit-card .add-more-button .u-cta.u-cta--link';
    var creditcardId = '';
    var modalid = '';
    var $creditCardToBeDeleted = '';
    var $creditCardToBeEdited = '';
    var $continueDeleteCC = '';
    var $addressToBeChecked = '';
    var continueModalId = '';
    var toggleSecurityModalId = '';
    var $addMoreButton = '';

    var init = function (element) {
        // console.log('APP.formChooseCreditCard');

        if (!APP.global.isEditMode()) {
            $formEditCreditCard = $('.js-form-choose-credit-card .js-cc-edit-container');
            $sectionEditCreditCard = $('.js-form-choose-credit-card .js-cc-edit-section');
            $formEditCreditCardCta = $('.js-form-choose-credit-card .js-add-cc-container .add-more-button+.cta-group');
            $chooseCCCardCOntainer = $('.js-form-choose-credit-card .js-choose-cc-container');
            $addMoreButton = $('.js-form-choose-credit-card .js-add-cc-container .add-more-button');
            $addMoreButtonLink = $('.js-form-choose-credit-card .js-add-cc-container .js-add-more-button-link');
            $ccAddressList = $('.js-form-choose-credit-card .js-credit-card-address-list');
            $addAddressCCForm = $('.js-add-cc-container');
            $ccList = $('.js-credit-card-list');
            modalid = $('.js-choose-cc-container .js-cc-label').attr('data-modalid');
            continueModalId = $('.js-choose-cc-container .js-cc-label').attr('data-modal-continue-delete');
            toggleSecurityModalId = $('.js-choose-cc-container .js-cc-label').attr('data-modal-security-code');
            $continueDeleteCC = $('#deleteCreditCard1.js-modal .u-cta.u-cta--primary');
            $creditCardDeletedConfirm = $('#creditCardDeleted1 .modal__content .u-cta--primary');
            bindEventsToUI();
            getAllCreditCards();
            //APP.global.resizeRouteList.push('formChooseCreditCard');
        }
    };

    var bindEventsToUI = function () {
        $ccList.on('click', '.js-edit-credit-card', openEditForm);

        $ccList.on('click', '.js-delete-credit-card', function (e) {
            APP.global.removeError();
            $creditCardToBeDeleted = $(this);
        });

        $continueDeleteCC.on('click', continueDelete);

        $formEditCreditCardCta.find(secondaryCta).on('click', cancelModifyCreditCardDetails);

        $formEditCreditCardCta.find(primaryCta).on('click', modifyCreditCardDetails);

        $addMoreButton.on('click', '.js-add-more-button-link', function (e) {
            APP.global.removeError();
            e.preventDefault();
            toggleCTAs($addMoreButtonLink, $formEditCreditCardCta);
            $addAddressCCForm.parsley().reset();
            APP.formSelect.changeSelection($('.js-cc-edit-section #cc_state'), null);
        });

        $(addMorePrimaryCta).on('click', addAddress);

        $(addMoreSecondaryCta).on('click', cancelAddAddress);

        if (modalid) {
            $('#' + modalid)
                .find('.u-cta.u-cta--secondary')
                .on('click', function (e) {
                    APP.modal.closeModal(e);
                });
        }

        if (continueModalId) {
            $('#' + continueModalId)
                .find('.u-cta.u-cta--secondary')
                .on('click', function (e) {
                    APP.modal.closeModal(e);
                });
        }

        if (toggleSecurityModalId) {
            $('#' + toggleSecurityModalId)
                .find('.u-cta.u-cta--secondary')
                .on('click', function (e) {
                    APP.modal.closeModal(e);
                });
        }

        $ccAddressList.on('click', '.js-address-list-item', function () {
            $ccAddressList.find('input[type="radio"]').removeProp('checked');
            $(this).find('input[type="radio"]').prop('checked', true);
        });

        $ccList.on('click', '.js-cc-list-item', function () {
            APP.global.removeError();
            $('.js-cc-list-item').find('input[type="radio"]').removeProp('checked');
            $(this).find('input[type="radio"]').prop('checked', true);
        });
        
        $creditCardDeletedConfirm.on('click', function(){
            $('#creditCardDeleted1').removeClass('modal--show');
        });
    };

    var openEditForm = function (e) {
        e.preventDefault();
        var $this = $(this);

        var eventLabel = $this.text().trim();

        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

        var addressid = $this.attr('data-addressid');
        APP.global.removeError();
        $('.js-form-choose-credit-card .js-address-list-item input[type="radio"]').removeProp('checked');
        creditcardId = $this.attr('data-creditcardid');
        $chooseCCCardCOntainer.hide();
        $sectionEditCreditCard.show();
        $('.js-edit-cc-type')
            .removeClass()
            .addClass('js-edit-cc-type ' + $this.attr('data-type'));
        $('.js-edit-cc-num').text($this.attr('data-num'));
        $('.js-credit-card-type').text($this.attr('data-cc-type'));
        $('.js-edit-cc-expiry').text('Exp. ' + $this.attr('data-month') + '/' + $this.attr('data-year'));
        APP.formSelect.changeSelection($('.js-cc-container #creditCardMonthNumeric'), $this.attr('data-month'));
        APP.formSelect.changeSelection($('.js-cc-container #creditCardYear'), $this.attr('data-year'));
        $('.js-form-choose-credit-card .js-address-list-item input[type="radio"][data-id="' + addressid + '"]').prop('checked', true);
        $creditCardToBeEdited = $this;
        e.stopPropagation();
    };

    var continueDelete = function (e) {
        e.preventDefault();
        APP.global.removeError();
        creditcardId = $creditCardToBeDeleted.attr('data-creditcardid');
        var modifyCCData = JSON.parse(JSON.stringify(modifyCCDataObj));
        modifyCCData.creditcard.encryptedCCId = creditcardId.replace('cc-', '');
        modifyCCData.service = 'deleteCreditCard';
        APP.modal.closeModal(e);
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/creditcard',
            data: JSON.stringify(modifyCCData),
            success: function (response) {
                $creditCardToBeDeleted.parents('.js-credit-card-list .js-cc-list-item').remove();
                $('#' + continueModalId)
                    .show(0)
                    .addClass('modal--show');
                APP.addressList.getAllAddresses();
            },
            error: function (jqXHR) {
                APP.global.hideLoader();
                APP.global.getErrorMsg(jqXHR, $chooseCCCardCOntainer);
                APP.modal.closeModal(e);
            },
            dataType: 'json',
            contentType: 'application/json',
        });
    };

    var modifyCreditCardDetails = function (e) {
        e.preventDefault();
        APP.global.removeError();
        $formEditCreditCard
            .parsley()
            .whenValidate()
            .done(function () {
                var $currentAdd = $('.js-cc-edit-container .js-address-list-item input[type="radio"]:checked').closest('.js-address-list-item');
                var modifyCCData = JSON.parse(JSON.stringify(modifyCCDataObj));
                modifyCCData.creditcard.encryptedCCId = creditcardId.replace('cc-', '');
                modifyCCData.creditcard.expMonth = $('.js-cc-container #creditCardMonthNumeric').val();
                modifyCCData.creditcard.expYear = $('.js-cc-container #creditCardYear').val();
                modifyCCData.creditcard.cardSecurityCode = $('.js-cc-container #creditCardPin').val();
                modifyCCData.creditcard.encryptedAddressId = $currentAdd.attr('data-id').replace('address-', '');
                // modifyCCData.creditcard.address.firstName = $creditCardFirstName.val();
                // modifyCCData.creditcard.address.lastName = $creditCardLastName.val();
                modifyCCData.creditcard.address.encryptedAddressId = $currentAdd.attr('data-id').replace('address-', '');
                modifyCCData.creditcard.address.firstName = $currentAdd.find('.js-firstName').html();
                modifyCCData.creditcard.address.lastName = $currentAdd.find('.js-lastName').html();
                modifyCCData.creditcard.address.firstStreet = $currentAdd.find('.js-address-1').html();
                modifyCCData.creditcard.address.secondStreet = $currentAdd.find('.js-address-2').html();
                modifyCCData.creditcard.address.city = $currentAdd.find('.js-city').html();
                modifyCCData.creditcard.address.state = $currentAdd.find('.js-state').html();
                modifyCCData.creditcard.address.zipCode5 = $currentAdd.find('.js-zip').html();
                modifyCCData.creditcard.autorecharge = $creditCardToBeEdited.attr('data-autorecharge');
                modifyCCData.service = 'modifyCreditCard';
                APP.global.showLoader();
                $.ajax({
                    type: 'POST',
                    url: '/bin/servlet/creditcard',
                    data: JSON.stringify(modifyCCData),
                    success: function (response) {
                        APP.global.removeError();
                        $chooseCCCardCOntainer.show();
                        $sectionEditCreditCard.hide();
                        $formEditCreditCard.find('#creditCardPin').val('');
                        $formEditCreditCard.parsley().reset();

                        var eventLabel = $formEditCreditCardCta.find(primaryCta).text().trim();
                        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                        $('.js-credit-card-list').empty();
                        getAllCreditCards();
                        APP.addressList.getAllAddresses();
                    },
                    error: function (jqXHR) {
                        APP.global.hideLoader();
                        APP.global.getErrorMsg(jqXHR, $sectionEditCreditCard);
                    },
                    dataType: 'json',
                    contentType: 'application/json',
                });
            });
    };

    var cancelModifyCreditCardDetails = function (e) {
        e.preventDefault();
        APP.global.removeError();
        $chooseCCCardCOntainer.show();
        $sectionEditCreditCard.hide();
        $formEditCreditCard.find('#creditCardPin').val('');
        $formEditCreditCard.parsley().reset();
    };

    var addAddress = function (e) {
        e.preventDefault();
        APP.global.removeError();
        var $addAddressFirstName = $('.js-cc-edit-section input#cc_firstName');
        var $addAddressLastName = $('.js-cc-edit-section input#cc_lastName');
        var $addAddressStreet1 = $('.js-cc-edit-section input#cc_streetAddressOne');
        var $addAddressStreet2 = $('.js-cc-edit-section input#cc_streetAddressTwo');
        var $addAddressCity = $('.js-cc-edit-section input#cc_city');
        var $addAddressZip = $('.js-cc-edit-section input#cc_zipCode');
        addressData.address.firstName = $addAddressFirstName.val();
        addressData.address.lastName = $addAddressLastName.val();
        addressData.address.firstStreet = $addAddressStreet1.val();
        addressData.address.secondStreet = $addAddressStreet2.val();
        addressData.address.city = $addAddressCity.val();
        addressData.address.state = $('.js-cc-edit-section .add-more-button #cc_state').val();
        addressData.address.zipCode5 = $addAddressZip.val();
        addressData.service = 'addNewAddress';
        $addAddressCCForm
            .parsley()
            .whenValidate()
            .done(function () {
                APP.global.showLoader();
                $.ajax({
                    type: 'POST',
                    url: '/bin/servlet/creditcard',
                    data: JSON.stringify(addressData),
                    success: function (response) {
                        var eventLabel = $addAddressCCForm.find('.js-add-more-button__content .u-cta--primary').text().trim();
                        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                        appendAddress(response.data.encryptedAddressId, addressData);
                        APP.addressList.appendNewAddedAddress(response.data, addressData);

                        //$(addMoreSecondaryCta).trigger('click');
                        cancelAddAddress(e);
                    },
                    error: function (jqXHR) {
                        APP.global.getErrorMsg(jqXHR, $sectionEditCreditCard);
                        APP.global.hideLoader();
                    },
                    dataType: 'json',
                    contentType: 'application/json',
                });
            });
    };

    var cancelAddAddress = function (e) {
        e.preventDefault();
        APP.global.removeError();
        $addAddressCCForm[0].reset();
        //$addMoreButtonLink.trigger('click');
        $addMoreButtonLink.toggleClass('is-active');
        // $('.add-more-button__content').slideUp();
        $(e.target).closest('.add-more-button__content').slideUp();

        toggleCTAs($addMoreButtonLink, $formEditCreditCardCta);
        $addAddressCCForm.parsley().reset();
        APP.formSelect.changeSelection($('.js-cc-edit-section #cc_state'), null);
    };

    var getAllCreditCards = function () {
        serviceJSON.service = 'getCreditCards';
        APP.global.showLoader();
        $('.js-no-cards-error').hide();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/creditcard',
            data: JSON.stringify(serviceJSON),
            contentType: 'application/json',
            dataType: 'json',
            success: function (response) {
                createCreditCardListTemplate(response.data);
            },
            error: function (jqXHR) {
                APP.global.getErrorMsg(jqXHR, $chooseCCCardCOntainer);
                $chooseCCCardCOntainer.hide();
                $('.js-no-cards-error').show();
                APP.global.hideLoader();
            },
        });
    };

    var getAllAddresses = function ($ccAddressList, $sectionEditCreditCard) {
        addressData.service = 'getAllAddresses';
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/address',
            data: JSON.stringify(addressData),
            success: function (response) {
                response = JSON.parse(response);
                $ccAddressList.empty();
                var data = response.data;
                createAddAddressTemplate(data, $ccAddressList);
            },
            error: function (jqXHR) {
                APP.global.hideLoader();
                APP.global.getErrorMsg(jqXHR, $sectionEditCreditCard);
            },
            dataType: 'html',
            contentType: 'application/json',
        });
    };

    var createCreditCardListTemplate = function (creditCardList) {
        $ccList.empty();
        $.each(creditCardList, function (i, item) {
            $ccList.append(cardListItem);
            var curCard = $('.js-credit-card-list').find('li')[i];
            var $editLink = $(curCard).find('.js-edit-credit-card');
            var $deleteLink = '';
            if ($('.js-profile-management-payment-method').length > 0) {
                $(curCard).find('.js-card').before(autoReloadTemplate);
                $(curCard).find('.js-edit').after(deleteTemplate);
                $deleteLink = $(curCard).find('.js-delete-credit-card');
                $deleteLink
                    .attr('data-creditcardid', 'cc-' + item.encryptedCCId)
                    .attr('data-modal', modalid)
                    .attr('data-modal-continue-delete', continueModalId);

                if (item.autorecharge === true) {
                    $(curCard).find('.js-input-label .js-credit-card-auto-reload img').show();
                    //$deleteLink.hide();
                }
            }

            if (item.expMonth.toString().length === 1) {
                item.expMonth = '0' + item.expMonth;
            }
            $(curCard)
                .find('input[name="credit-cards"]')
                .attr('data-id', 'cc-' + item.encryptedCCId);
            $(curCard).find('.js-choose-cc-container .js-input-label').attr('for', item.encryptedCCId);
            $(curCard)
                .find('.js-card .js-icon-cc')
                .addClass('icon-cc-' + item.type.toLowerCase());
            $(curCard).find('.js-card .js-credit-card-type').html(item.type);
            $(curCard).find('.js-card .js-credit-card').html(item.lastFourDigitsCardNo);
            $(curCard)
                .find('.js-date')
                .html("Exp. " + item.expMonth + '/' + item.expYear);
            $editLink
                .attr('data-type', 'icon-cc-' + item.type.toLowerCase())
                .attr('data-cc-type', item.type)
                .attr('data-num', item.lastFourDigitsCardNo)
                .attr('data-firstname', item.holderName.split(' ')[0])
                .attr('data-lastname', item.holderName.substring(item.holderName.split(' ')[0].length).trim())
                .attr('data-month', item.expMonth)
                .attr('data-year', item.expYear)
                .attr('data-addressid', 'address-' + item.encryptedAddressId)
                .attr('data-creditcardid', 'cc-' + item.encryptedCCId)
                .attr('data-lastFourDigitsCardNo', item.lastFourDigitsCardNo)
                .attr('data-autorecharge', item.autorechargeActive);
            $(curCard).find('.js-security-code-cta').attr('data-modal', toggleSecurityModalId);
        });
        if ($creditCardToBeEdited.length > 0) {
            $(
                '.js-form-choose-credit-card .js-credit-card-list input[type="radio"][data-id="' +
                    $creditCardToBeEdited.attr('data-creditcardid') +
                    '"]'
            ).prop('checked', true);
        }

        if (creditCardList.length > 0) {
            $chooseCCCardCOntainer.show();
        }

        getAllAddresses($ccAddressList, $sectionEditCreditCard);
    };

    var createAddAddressTemplate = function (data, $ccAddressList) {
        $.each(data, function (i, item) {
            $(address).appendTo($ccAddressList);
            var curAddress = $ccAddressList.find('li')[i];
            $(curAddress).attr('data-id', 'address-' + item.encryptedAddressId);
            $(curAddress)
                .find('input[type="radio"]')
                .attr('data-id', 'address-' + item.encryptedAddressId);
            $(curAddress).find('.js-firstName').html(item.firstName);
            $(curAddress).find('.js-lastName').html(item.lastName);
            $(curAddress).find('.js-address-1').html(item.firstStreet);
            if (item.secondStreet) {
                $(curAddress).find('.js-address-2').html(item.secondStreet);
            } else {
                $(curAddress).find('.js-address-2').hide();
            }
            $(curAddress).find('.js-city').html(item.city);
            $(curAddress).find('.js-state').html(item.state);
            $(curAddress).find('.js-zip').html(item.zipCode5);
        });
    };

    var appendAddress = function (addressid, addressData) {
        var $this = $(address);
        $this.appendTo($ccAddressList);
        $this.attr('data-id', 'address-' + addressid);
        $this.find('.js-firstName').html(addressData.address.firstName);
        $this.find('.js-lastName').html(addressData.address.lastName);
        $this.find('.js-address-1').html(addressData.address.firstStreet);
        $this.find('.js-address-2').html(addressData.address.secondStreet);
        $this.find('.js-city').html(addressData.address.city);
        $this.find('.js-zip').html(addressData.address.zipCode5);
        $this.find('.js-state').html(addressData.address.state);
        $addressToBeChecked = $this.find('input[type="radio"]');
    };

    var editAddress = function (addressId, firstName, lastName, street1Add, street2Add, city, selectedOption, zip) {
        var $this = $ccAddressList.find('li[data-id="' + addressId + '"]');
        $this.find('.js-firstName').html(firstName);
        $this.find('.js-lastName').html(lastName);
        $this.find('.js-address-1').html(street1Add);
        $this.find('.js-address-2').html(street2Add);
        $this.find('.js-city').html(city);
        $this.find('.js-state').html(selectedOption);
        $this.find('.js-zip').html(zip);
    };

    var deleteAddress = function (addressid) {
        $ccAddressList.find('li[data-id="' + addressid + '"]').remove();
    };

    var toggleCTAs = function ($addMoreButtonLink, $formEditCreditCardCta) {
        setTimeout(function () {
            if ($addMoreButtonLink.hasClass('is-active')) {
                $formEditCreditCardCta.hide();
                $addressToBeChecked = $('.js-address-list-item input[type="radio"]:checked');
                $addressToBeChecked.removeProp('checked');
            } else {
                $formEditCreditCardCta.show();
                $addressToBeChecked.prop('checked', true);
            }
        },0);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formChooseCreditCard'); */
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        deleteAddress: deleteAddress,
        appendAddress: appendAddress,
        editAddress: editAddress,
        toggleCTAs: toggleCTAs,
        getAllAddresses: getAllAddresses,
        getAllCreditCards: getAllCreditCards,
    };
})();

'use strict';

var APP = window.APP = window.APP || {};

APP.formBirthday = (function () {

    var bindEventsToUI = function () {

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formBirthday'); */

    };

    var init = function (element) {
        // console.log('APP.formBirthday');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formBirthday');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formAutoReload = (function () {

    var bindEventsToUI = function () {
        $('#auto-reload-balance-minimum').on('change', updateAmountSelect);

        $('.js-update-auto-reload-hidden').on('click tap',function(){
            $('input[id=type]').val('threshold');
        });
    };

    var updateAmountSelect = function(e) {
        var lowAmount = $(this).val();
        var highAmount = 100 - lowAmount;
        var $amountSelect = $('#auto-reload-balance-reload-amount');

        $amountSelect.find('option').each(function(e) {
            $(this).removeAttr('disabled');
            var value = $(this).val();

            if(value < lowAmount || value > highAmount) {
                $(this).attr('disabled', 'disabled');
            }  
        }); 

        // need to reset the select2 to update the disabled
        $amountSelect.select2(); 
       
        // need to update the amount select to the smallest amount
        APP.formSelect.changeSelection($amountSelect, lowAmount);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formAutoReload'); */
    };

    var init = function (element) {
        // console.log('APP.formAutoReload');
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formAutoReload');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = window.APP = window.APP || {};

APP.formAddValuePartial = (function () {

    var bindEventsToUI = function () {

    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formAddValueWrapper'); */
    };

    var init = function (element) {
        // console.log('APP.formAddValuePartial');
        bindEventsToUI();
        APP.formAddValueWrapper.init();
        //APP.global.resizeRouteList.push('formAddValueWrapper');
    };

    
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.formAddNewCreditCardLoggedIn = (function () {
    var $addCCForm = '',
        $addressForm = '',
        $formADDCreditCardCtas = '',
        $addMoreButtonLinkForAddress = '',
        $ccAddressList = '',
        $ccDetailsForm = '',
        $addressToBeChecked = '',
        address =
            '<li class="form-checkradio__item js-address-list-item">' +
            '<input type="radio" id="" name="credit-cards" value=""/>' +
            '<label for="adresss-radio-1" class="form-checkradio__input-label">' +
            '<p>' +
            '<span class="form-checkradio__firstName js-firstName"></span>' +
            ' ' +
            '<span class="form-checkradio__lastName js-lastName"></span>' +
            '</p>' +
            '<span class="form-checkradio__address-1 js-address-1"></span>' +
            '<p class="form-checkradio__adddress-2 js-address-2"></p>' +
            '<p>' +
            '<span class="form-checkradio__city js-city"></span>, <span class="address-list__state js-state"></span>' +
            ' ' +
            '<span class="form-checkradio__zip js-zip"></span>' +
            '</p>' +
            '</li>',
        addressData = {
            address: {
                encryptedAddressId: '',
                firstStreet: '',
                secondStreet: '',
                city: '',
                state: '',
                zipCode5: '',
                firstName: '',
                lastName: '',
            },
            service: '',
        },
        addNewCCJson = {
            creditcard: {
                encryptedCCId: '',
                cardNumber: '',
                cardSecurityCode: '',
                expMonth: '',
                expYear: '',
                type: '',
                encryptedAddressId: '',
                address: {
                    encryptedAddressId: '',
                    firstStreet: '',
                    secondStreet: '',
                    city: '',
                    state: '',
                    zipCode5: '',
                    firstName: '',
                    lastName: '',
                },
            },
            service: 'addCreditCard',
        };

    var bindEventsToUI = function () {
        $addressForm.find('.add-more-button .u-cta--link').on('click', cancelAddAddress);
        $addressForm.find('.add-more-button .u-cta--primary').on('click', addAddress);

        $formADDCreditCardCtas.find('.u-cta--link').on('click', cancelAddCC);
        $formADDCreditCardCtas.find('.u-cta--primary').on('click', addCC);

        $addCCForm.on('click', '.js-new-cc-add-address .js-add-more-button-link', function (e) {
            APP.global.removeError();
            toggleCTAs($addMoreButtonLinkForAddress, $formADDCreditCardCtas);
            $addressForm.parsley().reset();
            APP.formUtils.toggleRequiredAttrForm($addressForm, [
                'streetAddressTwo',
                'add_streetAddressTwo',
                'cc_streetAddressTwo',
                'cc_add_streetAddressTwo',
                'cc_add_zipCode',
            ]);
        });

        $ccAddressList.on('click', '.js-address-list-item', function () {
            $ccAddressList.find('input[type="radio"]').removeProp('checked');
            $(this).find('input[type="radio"]').prop('checked', true);
        });
        $addCCForm
            .parents('.add-more-button')
            .find('.js-add-more-button-link')
            .first()
            .on('click', function (e) {
                e.preventDefault();
                APP.global.removeError();
                $ccDetailsForm.parsley().reset();
                APP.formSelect.changeSelection($ccDetailsForm.find('#cCardMonth, #cCardYear'), null);
            });
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formAddNewCreditCardLoggedIn'); */
    };

    var init = function (element) {
        // console.log('APP.formAddNewCreditCardLoggedIn');
        $addCCForm = $('.js-form-add-new-credit-card-logged-in');
        $addressForm = $('.js-new-cc-add-address');
        $addMoreButtonLinkForAddress = $('.js-new-cc-add-address .js-add-more-button-link');
        $formADDCreditCardCtas = $('.js-new-cc-add-address .add-more-button+.cta-group');
        $ccAddressList = $('.js-add-new-cc .js-new-cc-address-list');
        $ccDetailsForm = $('.js-form-add-new-credit-card-logged-in .js-cc-details');
        $('#creditCardName').removeAttr('data-parsley-type');
        bindEventsToUI();
        APP.formChooseCreditCard.getAllAddresses($ccAddressList);
        //APP.global.resizeRouteList.push('formAddNewCreditCardLoggedIn');
    };

    var cancelAddAddress = function (e) {
        e.preventDefault();
        APP.global.removeError();
        //$addMoreButtonLinkForAddress.trigger('click');
        $addressForm[0].reset();
        APP.formSelect.changeSelection($addressForm.find('#cc_add_state'), null);

        $('.js-new-cc-add-address .js-add-more-button-link').removeClass('is-active');
        $('.js-new-cc-add-address .js-add-more-button__content')
            .slideToggle()
            .promise()
            .done(function () {
                if ($(window).width() < 1024) {
                    $('body, html').animate({ scrollTop: $('#addcreditcard').offset().top - $('.js-global-nav').height() }, 400);
                }
            });
        $('.js-new-cc-add-address > .cta-group').show();
        APP.global.removeError();
        $addressForm.parsley().reset();
        APP.formUtils.toggleRequiredAttrForm($addressForm, [
            'streetAddressTwo',
            'add_streetAddressTwo',
            'cc_streetAddressTwo',
            'cc_add_streetAddressTwo',
            'cc_add_zipCode',
        ]);
    };

    var cancelAddCC = function (e) {
        e.preventDefault();
        $addCCForm.find('.form-add-new-credit-card-logged-in__cc-details')[0].reset();
        APP.formSelect.changeSelection($addCCForm.find('select'), null);

        $(e.target).closest('.js-add-more-button__content:not("#addccaddress")').prev('.js-add-more-button-link').removeClass('is-active');
        $(e.target).closest('.js-add-more-button__content:not("#addccaddress")').slideToggle();

        APP.global.removeError();
        $ccDetailsForm.parsley().reset();
        APP.formSelect.changeSelection($ccDetailsForm.find('#cCardMonth, #cCardYear'), null);

        // $addCCForm
        //     .parents('.add-more-button')
        //     .find('.js-add-more-button-link')
        //     .first()
        //     .trigger('click');
    };

    var addAddress = function (e) {
        e.preventDefault();
        APP.global.removeError();
        var $this = $(this);
        var $addAddressFirstName = $addressForm.find('input#cc_add_firstName');
        var $addAddressLastName = $addressForm.find('input#cc_add_lastName');
        var $addAddressStreet1 = $addressForm.find('input#cc_add_streetAddressOne');
        var $addAddressStreet2 = $addressForm.find('input#cc_add_streetAddressTwo');
        var $addAddressCity = $addressForm.find('input#cc_add_city');
        var $addAddressZip = $addressForm.find('input#cc_add_zipCode');
        addressData.address.firstStreet = $addAddressStreet1.val();
        addressData.address.secondStreet = $addAddressStreet2.val();
        addressData.address.city = $addAddressCity.val();
        addressData.address.state = $addressForm.find('#cc_add_state').val();
        addressData.address.zipCode5 = $addAddressZip.val();
        addressData.address.firstName = $addAddressFirstName.val();
        addressData.address.lastName = $addAddressLastName.val();
        addressData.service = 'addNewAddress';
        $addressForm
            .parsley()
            .whenValidate()
            .done(function () {
                APP.global.showLoader();

                var eventLabel = $this.text().trim();
                APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                APP.addressList.addAddressAJAX(addressData, $addCCForm, null, $ccAddressList, address);
                cancelAddAddress(e);
                $ccAddressList.find('li input[type="radio"]').removeProp('checked');
                $ccAddressList.find('li:last-child input[type="radio"]').prop('checked', true);
            });
    };

    var addCC = function (e) {
        APP.global.removeError();
        e.preventDefault();
        var $this = $(this);
        var $selectedAddress = $ccAddressList.find('input[type="radio"]:checked').closest('li');

        if ($selectedAddress.length <= 0) {
            APP.global.getErrorMsg(window.CQ.I18n.getMessage('newpaymentmethod.error.billingAddress'), $addCCForm);
        } else {
            addNewCCJson.creditcard.cardSecurityCode = $ccDetailsForm.find('#cCardPin').val();
            addNewCCJson.creditcard.expMonth = $ccDetailsForm.find('#cCardMonth').val();
            addNewCCJson.creditcard.expYear = $ccDetailsForm.find('#cCardYear').val();
            addNewCCJson.creditcard.encryptedAddressId = $selectedAddress.attr('data-id').replace('address-', '');
            addNewCCJson.creditcard.address.encryptedAddressId = addNewCCJson.creditcard.encryptedAddressId;
            addNewCCJson.creditcard.address.firstStreet = $selectedAddress.find('.js-address-1').html();
            addNewCCJson.creditcard.address.secondStreet = $selectedAddress.find('.js-address-2').html();
            addNewCCJson.creditcard.address.city = $selectedAddress.find('.js-city').html();
            addNewCCJson.creditcard.address.state = $selectedAddress.find('.js-state').html();
            addNewCCJson.creditcard.address.zipCode5 = $selectedAddress.find('.js-zip').html();
            addNewCCJson.creditcard.address.firstName = $selectedAddress.find('.js-firstName').html();
            addNewCCJson.creditcard.address.lastName = $selectedAddress.find('.js-lastName').html();
            addNewCCJson.creditcard.cardNumber = $ccDetailsForm.find('#creditCardNumber').val();

            var cardObject = APP.registration.getCardType(addNewCCJson.creditcard.cardNumber);
            var cardObjectProperty = 'card_type';
            var isValidCard = cardObject[cardObjectProperty] !== null ? true : false;

            $ccDetailsForm
                .parsley()
                .whenValidate()
                .done(function () {
                    if (isValidCard) {
                        var eventLabel = $this.text().trim();
                        APP.analytics.fireCategoryEvent(APP.analytics.EventCategories.MANAGE_ACCOUNT, APP.analytics.Events.CLICK, eventLabel);

                        addNewCCJson.creditcard.type = APP.registration.creditCardTypes[cardObject[cardObjectProperty].name][0];
                        APP.global.showLoader();
                        $.ajax({
                            type: 'POST',
                            url: '/bin/servlet/creditcard',
                            data: JSON.stringify(addNewCCJson),
                            success: function (response) {
                                response = JSON.parse(response);
                                $('.js-credit-card-list').empty();
                                APP.formChooseCreditCard.getAllCreditCards();
                                APP.addressList.getAllAddresses();
                                $formADDCreditCardCtas.find('.u-cta--secondary').trigger('click');
                                $ccAddressList.find('input[type="radio"]').removeProp('checked');
                                cancelAddCC(e);
                            },
                            error: function (jqXHR) {
                                APP.global.getErrorMsg(jqXHR, $addCCForm);
                                APP.global.hideLoader();
                            },
                            dataType: 'html',
                            contentType: 'application/json',
                        });
                    }   

                    if (!isValidCard) {
                        var msg = window.CQ.I18n.getMessage('paymentmethods.creditcards.invalidCard');
                        APP.global.getErrorMsg(msg, $addCCForm);
                    }
                });
        }
    };

    var toggleCTAs = function ($addMoreButtonLink, $formEditCreditCardCta) {
        setTimeout(function () {
            if ($addMoreButtonLink.hasClass('is-active')) {
                $formEditCreditCardCta.hide();
                $addressToBeChecked = $ccAddressList.find('.js-address-list-item input[type="radio"]:checked');
                $addressToBeChecked.removeProp('checked');
            } else {
                $formEditCreditCardCta.show();
            }
        }, 0);
    };
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formTextarea = (function () {
    var bindEventsToUI = function () {
        $('textarea').filter('[data-track="contact-us-comment"]').attr('data-parsley-creditcard', '');
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('formTextarea'); */
    };

    var createValidators = function () {
        window.Parsley.addValidator('creditcard', {
            validateString: function (value, requirement, parsleyInstance) {
                var ccMatch = value.match(/(?:\d{4}[ -]?){3}(?=\d{4}\b)/g) || [];
                return ccMatch.length >= 1 ? false : true;
            },
            messages: {
                en: 'Please remove the Credit Card number from Comment and try submitting again.',
            },
            priority: 257,
        });
    };

    var init = function (element) {
        // console.log('APP.formTextarea');
        createValidators();
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formTextarea');
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formSelect = (function () {
    var bindEventsToUI = function () {
        toggleDaysByMonth();

        $('.select2').on('keypress', function (e) {
            var key = e.keyCode ? e.keyCode : e.which;

            if ($(this).hasClass('select2-container--open')) {
            } else {
                var id = $(this).parent().find('select').attr('id');

                //$('#' + id).select2('open');

                $('.select2-search__field').val(String.fromCharCode(key));

                $('#' + id).on('select2:select', function (e) {
                    $('#' + id)
                        .parent()
                        .find('label')
                        .trigger('click');
                });
            }
        });
    };

    var initSelectElements = function () {
        $('select').each(function () {
            initSelect2($(this));
        });
    };

    var initSelect2 = function ($select) {
        var placeholder = $select.attr('data-select-placeholder') || '';
        var dropdownCssClass = $select.attr('data-select-dropdownCssClass') || '';
        var hideSearch = $select.data('hide-search') ? Infinity : 0;
        dropdownCssClass = dropdownCssClass + (hideSearch ? ' hide-search-field' : '');
        switch (true) {
            case $select.parent().data('track') == 'store-select': {
                var isHeight40 = false;

                function createTemplate(storeAttributes, isTemplateSelection) {
                    storeAttributes.distance = parseFloat(storeAttributes.distance).toFixed(2);
                    var buttonTxt = isTemplateSelection ? 'CHANGE' : 'SELECT';
                    var addressMarkup =
                        '<div>' +
                        '<div class="store-item__address">' +
                        APP.store.generateMarkup(APP.storeItem.storeResultsTemplate.address, storeAttributes) +
                        '</div>' +
                        '<div class="store-item__distance">Distance: <span class="js-store-distance value">' +
                        APP.store.generateMarkup(APP.storeItem.storeResultsTemplate.distance, storeAttributes) +
                        '</span></div>' +
                        '</div>';
                    var $template = $(
                        '<div class="store-item store-item--results">' +
                            '<img class="store-item__icon" src="/etc/designs/dd/images/store-icon.svg">' +
                            addressMarkup +
                            '<button type="button" class="u-cta u-cta--primary">' +
                            buttonTxt +
                            '</button>' +
                            '</div>'
                    );

                    return $template;
                }

                $select.select2({
                    placeholder: placeholder,
                    dropdownCssClass: dropdownCssClass,
                    minimumResultsForSearch: hideSearch,
                    templateResult: function (item) {
                        if (item.disabled) {
                            return item.text;
                        } else {
                            return createTemplate($(item.element).data('storeattributes'), false);
                        }
                    },
                    templateSelection: function (item) {
                        if (item.id) {
                            return createTemplate($(item.element).data('storeattributes'), true);
                        } else {
                            return $('<div>').text(item.text);
                        }
                    },
                    matcher: function (params, data) {
                        if ($.trim(params.term) === '') {
                            return data;
                        } else {
                            var storeAttributes = $(data.element).data('storeattributes');
                            var term = params.term.toLowerCase();
                            if (
                                storeAttributes &&
                                (storeAttributes.address.toLowerCase().indexOf(term) > -1 ||
                                    storeAttributes.address2.toLowerCase().indexOf(term) > -1 ||
                                    storeAttributes.city.toLowerCase().indexOf(term) > -1 ||
                                    storeAttributes.state.toLowerCase().indexOf(term) > -1 ||
                                    storeAttributes.postal.toLowerCase().indexOf(term) > -1)
                            ) {
                                return data;
                            } else {
                                return null;
                            }
                        }
                    },
                });

                $select
                    .on('select2:opening', function (e) {
                        if (!isHeight40 && e.target.value) {
                            e.preventDefault();
                            $(e.target)
                                .siblings('.select2-container')
                                .find('.select2-selection')
                                .animate({ maxHeight: '40px' }, 500, function () {
                                    isHeight40 = true;
                                    setTimeout(function () {
                                        $(e.target).select2('open');
                                    }, 100);
                                })
                                .find('.select2-selection__rendered')
                                .animate({ opacity: 0 }, 300);
                        }
                    })
                    .on('select2:closing', function (e) {
                        $(e.target)
                            .siblings('.select2-container')
                            .find('.select2-selection')
                            .css('max-height', '40px')
                            .animate({ maxHeight: '200px' }, 500, function () {
                                isHeight40 = false;
                                $select.find('.select2-selection__rendered').animate({ opacity: 1 }, 300);
                            });
                    });
                break;
            }
            case placeholder !== '': {
                $select.select2({
                    placeholder: placeholder,
                    dropdownCssClass: dropdownCssClass,
                    minimumResultsForSearch: hideSearch,
                });

                $select.val(null).trigger('change');
                break;
            }
            default: {
                $select.select2({
                    dropdownCssClass: dropdownCssClass,
                    minimumResultsForSearch: hideSearch,
                });
            }
        }

        $select.on('select2:select', function (e) {
            $(e.target).parsley().validate();
        });
    };

    var toggleDaysByMonth = function () {
        $('select[data-day-toggle="birthdayMonth"]').on('change', function () {
            var monthVal = $(this).val();
            var $daySelect = $(this).parents('.form-birthday').find('#birthdayDay');

            switch (monthVal) {
                case 'jan':
                case 'mar':
                case 'may':
                case 'jul':
                case 'aug':
                case 'oct':
                case 'dec':
                    hideDayOptions($daySelect, 31);
                    break;
                case 'feb':
                    hideDayOptions($daySelect, 29);
                    break;
                case 'apr':
                case 'jun':
                case 'sep':
                case 'nov':
                    hideDayOptions($daySelect, 30);
                    break;
            }
        });
    };

    var hideDayOptions = function ($select, max) {
        $select.find('option').each(function (e) {
            $(this).removeAttr('disabled');
            if ($(this).val() > max) {
                $(this).attr('disabled', 'disabled');
            }
        });

        $select.select2(); //need to refresh the select2 to pick up the disabled
        $select.prop('selectedIndex', '0').trigger('change');
        $select
            .find('option')
            .filter(function () {
                return $.trim($(this).text()) == 'Select Day';
            })
            .remove();
    };

    var changeSelection = function ($selects, value) {
        $selects.each(function () {
            $(this).val(value).trigger('change');
        });
    };

    var resetSelection = function ($select) {
        $select.prop('selectedIndex', 0).trigger('change');
    };

    var triggerNativeChangeEvent = function ($selects) {
        $selects.on('select2:select', function (e) {
            var evt = document.createEvent('HTMLEvents');
            evt.initEvent('change', true, true);
            this.dispatchEvent(evt);
        });
    };

    var loadMonthDropdown = function ($monthDropDown) {
        var option,
            actualMonth,
            now = new Date(),
            curMonth = now.getMonth(),
            curYear = now.getFullYear(),
            month,
            monthsAgo = 16;

        for (var i = 0; i < monthsAgo; i++) {
            actualMonth = curMonth + 1;
            curMonth--;
            if (actualMonth > 0 && actualMonth < 10) {
                actualMonth = '0' + actualMonth;
            }
            month = parseInt(actualMonth, 10);
            option =
                '<option value="' +
                month +
                '-' +
                curYear +
                '">' +
                window.CQ.I18n.getMessage('common.date.month.' + actualMonth + '.text') +
                ' ' +
                curYear +
                '</option>';

            $(option).appendTo($monthDropDown);

            if (curMonth < 0) {
                curMonth = 11;
                curYear--;
            }
        }
        $monthDropDown.select2().trigger('change');
        setTimeout(function () {
            // $monthDropDown.next().attr({ style: 'width: 200px !important' });
        }, 0);
    };

    var init = function (element) {
        if (!APP.global.isEditMode()) {
            initSelectElements();
            bindEventsToUI();
        } else {
            $('select').select2({});
        }
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        changeSelection: changeSelection,
        resetSelection: resetSelection,
        triggerNativeChangeEvent: triggerNativeChangeEvent,
        loadMonthDropdown: loadMonthDropdown,
        initSelect2: initSelect2,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.formInput = (function () {
    var passwordComplexity = (function () {
        var validationObj = {
            minLength: {
                errClassName: '.min-length',
                isValid: function (value, parsleyInstance, $input) {
                    var isValid = value.length >= 8;
                    validationObj.updateMsg(isValid, parsleyInstance, $input, this);
                    return isValid;
                },
            },
            upperAndLowerCase: {
                errClassName: '.uppercase-lowercase',
                isValid: function (value, parsleyInstance, $input) {
                    var uppercases = value.match(/[A-Z]/g) || [];
                    var lowecases = value.match(/[a-z]/g) || [];
                    var isValid = uppercases.length >= 1 && lowecases.length >= 1;
                    validationObj.updateMsg(isValid, parsleyInstance, $input, this);
                    return isValid;
                },
            },
            specialCharacters: {
                errClassName: '.special-characters',
                isValid: function (value, parsleyInstance, $input) {
                    var specials = value.match(/[^a-zA-Z0-9]/g) || [];
                    var isValid = specials.length >= 1;
                    validationObj.updateMsg(isValid, parsleyInstance, $input, this);
                    return isValid;
                },
            },
            numbers: {
                errClassName: '.numbers',
                isValid: function (value, parsleyInstance, $input) {
                    var numbers = value.match(/[0-9]/g) || [];
                    var isValid = numbers.length >= 1;
                    validationObj.updateMsg(isValid, parsleyInstance, $input, this);
                    return isValid;
                },
            },
            updateMsg: function (isValid, parsleyInstance, $input, objContext) {
                if (!parsleyInstance) {
                    var $msgListSpan = $input.siblings('.passwordComplexityRequirements').find(objContext.errClassName).find('span');
                    isValid ? $msgListSpan.removeClass('fail').addClass('success') : $msgListSpan.removeClass('success').addClass('fail');
                }
            },
        };

        return function (value, parsleyInstance, $input) {
            var minLength = validationObj.minLength.isValid(value, parsleyInstance, $input);
            var numbers = validationObj.numbers.isValid(value, parsleyInstance, $input);
            var upperAndLowerCase = validationObj.upperAndLowerCase.isValid(value, parsleyInstance, $input);
            var specialCharacters = validationObj.specialCharacters.isValid(value, parsleyInstance, $input);

            return minLength && numbers && upperAndLowerCase && specialCharacters;
        };
    })();

    var shouldBeValidated = function (field) {
        return !(field.attr('disabled') || field.disabled) && (field.attr('pattern') || field.attr('required'));
    };

    var instantValidation = function (field) {
        if (shouldBeValidated(field)) {
            var invalid =
                (field.attr('required') && !field.val()) ||
                (field.attr('pattern') && field.val() && !new RegExp(field.attr('pattern')).test(field.val()));

            if (invalid) {
                field.parsley().validate();

                var haveConfrmation = field.attr('data-parsley-equalto') ? true : false;

                if (haveConfrmation === true) {
                    console.log('entro');
                    var confirmField = field.attr('data-parsley-equalto');
                    $(confirmField).parsley().validate();
                }
            }

            // if (invalid && !field.attr('aria-invalid')) {
            //     field.attr('aria-invalid', 'true');
            //     field.parsley().validate();
            // } else {
            //     field.removeAttr('aria-invalid');
            //     field.parsley().destroy();
            // };
        }
    };

    var showPromoCodeInput = function (elem) {
        $(elem).hide().siblings().show();
    };

    var formatMobileNoInput = function (e) {
        var elem = e.target;
        var curInputData = e.data;
        var prevValue = $(elem).attr('prev-value');
        prevValue = prevValue == undefined ? '' : prevValue;
        if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
            $(elem).val(prevValue);
            return false;
        }
        var prevChar = prevValue.length;
        if (curInputData) {
            if (prevChar == 3 && prevValue.indexOf('(') <= -1) {
                $(elem).val('(' + prevValue + ')' + ' ' + curInputData); // replaced character '-' to space ' '
            } else if (prevChar == 4 && prevValue.indexOf('(') > -1) {
                $(elem).val(prevValue + ')-' + curInputData);
            } else if (prevChar == 5 && prevValue.indexOf(')') > -1) {
                $(elem).val(prevValue + '-' + curInputData);
            } else if (prevChar == 9) {
                $(elem).val(prevValue + '-' + curInputData);
                $(elem).attr('maxlength', '14');
            }
        }
        $(elem).attr('prev-value', $(elem).val());
    };

    var otpValidation = function (e) {
        var regex = /^[0-9]*$/gm;
        var elem = e.target;
        var curInputData = e.data;
        var currVal = $(elem).val();
        var prevValue = $(elem).attr('prev-value');
        prevValue = prevValue == undefined ? '' : prevValue;
        if (curInputData) {
            if (prevValue.length == 6) {
                $(elem).val(prevValue);
            } else if (regex.exec(currVal) == null) {
                $(elem).val(prevValue);
            }
        }

        $(elem).attr('prev-value', $(elem).val());
    };

    var preventPaste = function (e) {
        e.preventDefault();
        return false;
    };

    var togglePasswordVisibility = function (e) {
        e.preventDefault();
        var target = e.target;
        $(target).toggleClass('hidden visible');
        if ($(target).hasClass('hidden')) {
            $(target).attr('aria-label', 'show password');
            $(target).siblings('input').attr('type', 'password');
        } else {
            $(target).attr('aria-label', 'hide password');
            $(target).siblings('input').attr('type', 'text');
        }
    };

    var bindEventsToUI = function () {
        window.Parsley.addValidator('passwordComplexity', {
            validateString: function (value, requirement, parsleyInstance) {
                return passwordComplexity(value, true);
            },
            messages: {
                en: 'Password must meet all criteria below',
            },
            priority: 258,
        });

        window.Parsley.addValidator('specialCharacters', {
            validateString: function (value, requirement, parsleyInstance) {
                var notAllowedChars = value.match(/[^a-zA-Z0-9!%&~@#$^*()_+={}|\,.?:<>-]/g) || [];
                return notAllowedChars.length >= 1 ? false : true;
            },
            messages: {
                en: 'Allowed special characters are !%&~@#$^*()_+={}|,.?:<>-',
            },
            priority: 257,
        });

        window.Parsley.addValidator('ccNumber', {
            validateString: function (value, requirement, parsleyInstance) {
                var cardObject = $('<input>')
                    .attr({
                        type: 'number',
                        value: value,
                    })
                    .validateCreditCard();
                var isValidCard = cardObject['card_type'] !== null ? true : false;
                return isValidCard;
            },
        });

        window.Parsley.addValidator('zip', {
            validateString: function (value, requirement, parsleyInstance) {
                return APP.googleMap.isValidZipCode(value);
            },
        });

        var $input = $('input');
        
        $('input[value=""]').addClass('empty');
        $('input').keyup(function(){
            if( $(this).val() == ""){
                $(this).addClass("empty");
            }else{
                $(this).removeClass("empty");
            }
        });

        $input
            .on('change', function (target) {
                instantValidation($(this));
            })
            .filter('[data-createpassword]')
            .attr('data-parsley-password-complexity', '')
            .attr('data-parsley-special-characters', '')
            .on('input', function (event) {
                passwordComplexity($(this).val(), false, $(this));
            });

        $input
            .filter('[type="date"]')
            .attr({
                type: 'text',
                readonly: 'readonly',
            })
            .datepicker({
                maxDate: 0,
                dateFormat: 'mm/dd/yy',
                beforeShow: function (input, inst) {
                    var calendar = inst.dpDiv;

                    setTimeout(function () {
                        calendar.position({
                            my: 'right top',
                            at: 'right bottom',
                            collision: 'none',
                            of: input,
                        });
                    }, 1);
                },
            });

        window.Parsley.on('field:error', function () {
            this.$element.get(0).setCustomValidity('parsley-error');
        });

        window.Parsley.on('field:success', function () {
            this.$element.get(0).setCustomValidity('');
        });
    };

    var init = function (element) {
        console.log('APP.formInput');
        bindEventsToUI();
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        formatMobileNoInput: formatMobileNoInput,
        otpValidation: otpValidation,
        preventPaste: preventPaste,
        instantValidation: instantValidation,
        togglePasswordVisibility: togglePasswordVisibility,
        showPromoCodeInput: showPromoCodeInput,
    };
})();

"use strict";
var APP = (window.APP = window.APP || {});
APP.formCardSlider = (function () {
    var $cardSlider;
    var cardList;
    var selectedCard;
    var populateCardDetails = function (cardObject) {
        //commented line#12 and added line#13 as requested in DDCOM-5055.
        //$cardSlider.find('.js-dd-card-masked').text(cardObject.firstTwelveDigits);
        $cardSlider.find(".js-card-image").attr("src", APP.managePaymentsStore.getDDCardImageMixin.methods.getDDCardImage(cardObject));
        $cardSlider.find(".js-dd-card-masked").text(cardObject.lastFourDigits);
        $cardSlider.find(".js-dd-num").text(cardObject.cardNumber);
        $cardSlider.find(".js-dd-pin").text(cardObject.cardPin);
        $cardSlider.find(".js-auto-reload-status").text(cardObject.autorechargeActive ? "On" : "Off");
        var balance = APP.cardManagement.formatBalance(cardObject.balance.balance);
        $cardSlider.find(".js-balance-dollar").text("$" + balance.dollars);
        $cardSlider.find(".js-balance-cents").text("." + balance.cents);
        $cardSlider.find(".js-balance-date").text(cardObject.balance.displayDate);
        if (cardObject.defaultCard) {
            $cardSlider.addClass("form-card-slider--primary");
        } else {
            $cardSlider.removeClass("form-card-slider--primary");
        }
    };
    var setCardIndex = function (index) {
        return index;
    };
    var cardChange = function () {
        var index = $(this).val();
        $(".js-add-selected-index").text(index);
        if ($(".js-add-selected-old-index").text().trim() > 0) {
            var index = $(this);
        }
        selectedCard = cardList[index];
        populateCardDetails(selectedCard);
        $cardSlider.trigger("changed", selectedCard);
    };
    var toggleCardDetails = function (e) {
        e.preventDefault();
        e.stopPropagation();
        $(this).prevAll(".js-dd-card, .js-dd-card-masked").toggle();
        $(this).find(".js-dd-card-masked-toggle-text, .js-dd-card-toggle-text").toggle();
    };
    var refreshBalance = function (e) {
        e.preventDefault();
        APP.global.showLoader();
        var cardNumber, pin;
        if (selectedCard) {
            cardNumber = selectedCard.cardNumber;
            pin = selectedCard.cardPin;
        } else if (!cardNumber || cardNumber === "") {
            cardNumber = $("#card-number").val();
            pin = $("#pin").val();
        }
        var request = APP.cardManagement.setBalanceLoggedInAjax(cardNumber, pin);
        request.done(function (response) {
            var balance = APP.cardManagement.formatBalance(response.data.balance);
            $cardSlider.find(".js-balance-dollar").text("$" + balance.dollars);
            $cardSlider.find(".js-balance-cents").text("." + balance.cents);
            $cardSlider.find(".js-balance-date").text(response.data.displayDate);
            APP.global.hideLoader();
        });
        request.fail(function (jqXHR) {
            APP.global.getErrorMsg(jqXHR, $cardSlider);
            APP.global.hideLoader();
        });
    };
    var populateDropdown = function (response) {
        var value = response.data;
        var $cardSelector = $cardSlider.find("#card-selector");
        var template = "",
            cnum;
        if (value.length) {
            $.each(value, function (index, item) {
                //commented line#90 and added line#91 as requested in DDCOM-5055.
                //cnum = item.firstTwelveDigits + '';
                cnum = "" + item.lastFourDigits;
                template += '<option value="' + index + '">' + cnum + "</option>";
            });
        }
        $cardSelector.html(template);
        $cardSelector.select2("destroy");
        $cardSelector.select2();
    };
    var bindEventsToUI = function () {
        $cardSlider.find("#card-selector").on("change", cardChange);
        $cardSlider.on("click", ".js-toggle-dd-card", toggleCardDetails);
        $cardSlider.on("click", ".js-check-balance", refreshBalance);
    };
    var getDDCardsList = function () {
        var request = APP.cardManagement.setDDCardsListAjax();
        request.done(function (response) {
            cardList = response.data;
            if (cardList.length === 1) {
                $cardSlider.find(".form-select").hide();
            }
            APP.managePaymentsStore.getAllDDCardsImages($cardSlider, function(){
                populateDropdown(response);
                $("#card-selector").trigger("change");
                APP.global.hideLoader();
            });
        });
        request.fail(function (jqXHR) {
            APP.global.getErrorMsg(jqXHR, $cardSlider);
            APP.global.hideLoader();
        });
    };
    var isCheckBalancePage = function () {
        var url = location.href;
        return url.indexOf("check-balance") != -1 ? true : false;
    };
    var init = function (element) {
        // console.log('APP.formCardSlider');
        if (window.Cookies.get("wcmmode") === "edit") {
            return;
        }
        $cardSlider = $(".js-form-card-slider");
        if (APP.login.isLoggedIn() && !isCheckBalancePage()) {
            getDDCardsList();
        }
        bindEventsToUI();
        //APP.global.resizeRouteList.push('formCardSlider');
    };
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        populateCardDetails: populateCardDetails,
        getDDCardsList: getDDCardsList,
        setCardIndex: setCardIndex,
    };
})();
'use strict';

var APP = window.APP = window.APP || {};

APP.windowTransactionHistoryWrapper = (function () {

    var bindEventsToUI = function () {
        
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('windowTransactionHistoryWrapper'); */
    };

    var init = function (element) {
        // console.log('APP.windowTransactionHistoryWrapper');
        if (!APP.global.isEditMode()) {
        bindEventsToUI();
        if(APP.login.isDDPerksUser()) {
            APP.accountHistory.init();
            APP.windowCardTransactionHistory.init();
        }
        else {
            $('.window-transaction-history-wrapper .js-tabs .js-tab-content').removeClass('js-active');
            var cardHistoryTab = $('.window-transaction-history-wrapper .js-card-history').parents('.js-tab-content');
            cardHistoryTab.addClass('js-active');
            APP.windowCardTransactionHistory.init();
            $('.window-transaction-history-wrapper .js-tabs .js-navigation').remove();
            $('.window-transaction-history-wrapper .js-tabs .js-tab-content:not(.js-active)').remove();
        }
      }
        //APP.global.resizeRouteList.push('windowTransactionHistoryWrapper');
    };

    var paginate = function ($transactionList, $transactionHistoryContainer) {
        var data = $transactionList.find('li');
        $transactionHistoryContainer.pagination({
            dataSource: function(done){
                var result = [];
                for (var i = 0; i < data.length; i++) {
                    result.push(data[i]);
                }
                done(result);
            },
            pageSize: 20,
            prevText: '<span class="icon-circle-arrow-pink--left"></span>',
            nextText: '<span class="icon-circle-arrow-pink--right"></span>',
            callback: function(data, pagination) {
                $transactionList.empty();
                for (var i = 0; i < data.length; i++) {
                    $transactionList.append(data[i]);
                }
            }
        });
    };
    
    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        paginate: paginate
    };

}());
'use strict';

var APP = (window.APP = window.APP || {});

APP.windowCardTransactionHistory = (function () {
    var $transactionList = '',
        $transactionHistoryContainer = '',
        $cardSlider = '',
        $monthDropDown = '',
        transactionHistoryTemplate = '',
        transactionHistoryJson = {
            startDate: '',
            endDate: '',
            ddCard: {
                cardNumber: '',
                cardPin: '',
            },
            service: 'getDDCardTransactions',
        },
        state = 0;

    var bindEventsToUI = function () {
        APP.formSelect.loadMonthDropdown($monthDropDown);
        $monthDropDown.on('change', loadTransactionHistory);
        $cardSlider.on('changed', loadTransactionHistory);
    };

    var bindOnResize = function () {
        /* Don't forget to uncomment APP.global.resizeRouteList.push('windowCardTransactionHistory'); */
    };

    var init = function (element) {
        // console.log('APP.windowCardTransactionHistory');
        $transactionList = $('.js-card-history .js-transaction-list');
        $transactionHistoryContainer = $('.js-card-history .js-transaction-history-container');
        $cardSlider = $('.form-card-slider');
        $monthDropDown = $('.js-card-history #month-dropdown-card-history');
        transactionHistoryTemplate = $('.js-card-history .js-list-item-template').html();
        bindEventsToUI();
        //APP.global.resizeRouteList.push('windowCardTransactionHistory');
    };

    var resetMonthSelection = function () {
        APP.formSelect.resetSelection($monthDropDown);
    };

    var setDDCardData = function (data) {
        transactionHistoryJson.ddCard.cardNumber = data.cardNumber;
        transactionHistoryJson.ddCard.cardPin = data.cardPin;
    };

    var loadTransactionHistory = function (e, data) {
        APP.global.removeError();

        var selectedDate = $monthDropDown.val().split('-');
        var month = selectedDate[0];
        var year = selectedDate[1];
        transactionHistoryJson.startDate = APP.dateUtils.getStartAndEndDateOfMonth(year, month).startDate;
        transactionHistoryJson.endDate = APP.dateUtils.getStartAndEndDateOfMonth(year, month).endDate;

        if (data) {
            transactionHistoryJson.ddCard.cardNumber = data.cardNumber;
            transactionHistoryJson.ddCard.cardPin = data.cardPin;
        }

        APP.global.showLoader();
        $transactionList.empty();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/transaction',
            data: JSON.stringify(transactionHistoryJson),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                var listItemCount = 0;
                $('.no-card-data-error-msg').remove();
                $transactionHistoryContainer.show();
                $.each(response.data, function (i, item) {
                    if (item.type == '2400') {
                        //Skip balance enquiry iteration
                        return true;
                    }
                    $(transactionHistoryTemplate).appendTo($transactionList);
                    var transactionListItem = $transactionList.find('li')[listItemCount];
                    var $transactionType = $(transactionListItem).find('.js-transaction-list-type');
                    var $transactionTimeStamp = $(transactionListItem).find('.js-transaction-list-timestamp');

                    switch (parseInt(item.type)) {
                        case 2200: {
                            $(transactionListItem).find('.js-transaction-list-icon').addClass('mobile_order');
                            break;
                        }
                        case 202:
                        case 2202: {
                            $(transactionListItem).find('.js-transaction-list-icon').addClass('scanpay_order');
                            break;
                        }
                        case 2300:
                        case 300: {
                            $(transactionListItem).find('.js-transaction-list-icon').addClass('reload');
                            break;
                        }
                        default: {
                            $(transactionListItem).find('.js-transaction-list-icon').addClass('default');
                        }
                    }
                    $transactionType.html(item.transactionDescription);
                    $transactionTimeStamp.html(item.date);

                    $(transactionListItem)
                        .find('.js-transaction-list-amt')
                        .html('$' + item.amount);
                    $(transactionListItem)
                        .find('.js-transaction-list-bal')
                        .html('$' + item.balance);

                    listItemCount += 1;
                });
                if ($transactionList.find('.js-transaction-list-item').length > 20) {
                    APP.windowTransactionHistoryWrapper.paginate($transactionList, $transactionHistoryContainer);
                }
                state = 1;
                if (state === 1 && APP.accountHistory.getState === 1) {
                    APP.global.hideLoader();
                }
            },
            error: function (jqXHR) {
                var response = JSON.parse(jqXHR.responseText);
                if (response.error.code == 'APP4226') {
                    var msg = '<div class="no-card-data-error-msg">No data is available for the selected month</div>';
                    if ($('.no-card-data-error-msg').length <= 0) {
                        $transactionHistoryContainer.hide();
                        $(msg).insertBefore($transactionHistoryContainer);
                    }
                } else {
                    APP.global.getErrorMsg(jqXHR, $transactionHistoryContainer);
                }
                state = 1;
                if (state === 1 && APP.accountHistory.getState === 1) {
                    APP.global.hideLoader();
                }
            },
        });
    };

    var getState = function () {
        return state;
    };

    /**
     * interfaces to public functions
     */
    return {
        init: init,
        bindOnResize: bindOnResize,
        getState: getState,
        setDDCardData: setDDCardData,
        resetMonthSelection: resetMonthSelection,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.otherPaymentsDetailsWrapper = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('other-payments-details-wrapper', {
            mixins: [APP.global.vueComponentTransitionMixin],
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                    showCreditCardDetailsScreen: false,
                };
            },
            watch: {
                'state.creditCards': function (newVal, oldVal) {
                    this.transitionBetweenScreens(function () {
                        if (newVal.length == 0 || newVal.length > 1) {
                            this.store.clearSelectedCreditCard();
                            this.showCreditCardDetailsScreen = false;
                        } else if (newVal.length == 1) {
                            this.store.setSelectedCreditCard(newVal[0]);
                            this.showCreditCardDetailsScreen = true;
                        }
                    }, true);
                },
                'state.selectedCreditCard': function (newVal, oldVal) {
                    if (newVal && !this.showCreditCardDetailsScreen) {
                        this.transitionBetweenScreens(function () {
                            this.showCreditCardDetailsScreen = true;
                        }, true);
                    }
                },
            },
            methods: {
                goBackToListView: function () {
                    this.transitionBetweenScreens(function () {
                        this.store.clearSelectedCreditCard();
                        this.showCreditCardDetailsScreen = false;
                    }, true);
                },
            },
            created: function () {
                this.store.getCreditCards();
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

/* Manage Payment Success Modal Wrapper Component JS */

'use strict';

var APP = (window.APP = window.APP || {});

APP.dunkinCardsList = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('dunkin-cards-list', {
            mixins: [APP.managePaymentsStore.getDDCardImageMixin],
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                };
            },
            methods: {
                setSelectedCard: function (card) {
                    this.store.setSelectedDDCard(card);
                },
                mergeToPrimary: function (fromCard) {
                    this.store.setCardsForMergeBalance(fromCard);
                    APP.global.removeError();
                    APP.modal.showModal(null, $(this.store.selectors.mergeBalanceModal));
                },
            },
            created: function () {
                this.store.getAllDDCards();
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dunkinCardsDetailsWrapper = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('dunkin-cards-details-wrapper', {
            mixins: [APP.global.vueComponentTransitionMixin],
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                    showDetailsScreen: false,
                };
            },
            watch: {
                'state.ddCards': function (newVal, oldVal) {
                    this.transitionBetweenScreens(function () {
                        if (newVal.length == 0 || newVal.length > 1) {
                            this.store.clearSelectedDDCard();
                            this.showDetailsScreen = false;
                        } else if (newVal.length == 1) {
                            this.store.setSelectedDDCard(newVal[0]);
                            this.showDetailsScreen = true;
                        }
                    }, true);
                },
                'state.selectedDDCard': function (newVal, oldVal) {
                    if (newVal && !this.showDetailsScreen) {
                        this.transitionBetweenScreens(function () {
                            this.showDetailsScreen = true;
                        }, true);
                    }
                },
            },
            methods: {
                addDunkinCard: function () {
                    APP.modal.showModal(null, $(this.store.selectors.addDunkinCardModal));
                },
                goBackToListView: function () {
                    this.transitionBetweenScreens(function () {
                        this.store.clearSelectedDDCard();
                        this.showDetailsScreen = false;
                    }, true);
                },
            },
            created: function () {
                this.store.getAllDDCardsImages($(this.$refs.errorElem));
                this.store.getAllDDCards($(this.$refs.errorElem));
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dunkinCardMergeBalance = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('dunkin-card-merge-balance', {
            mixins: [APP.managePaymentsStore.getDDCardImageMixin],
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                };
            },
            computed: {
                isSwapped: function () {
                    return this.state.mergeBalance.swapped;
                },
                initialFromCard: function () {
                    return this.state.mergeBalance.fromCard;
                },
                initialToCard: function () {
                    return this.state.mergeBalance.toCard;
                },
                swappedFromCard: function () {
                    return this.isSwapped ? this.state.mergeBalance.toCard : this.state.mergeBalance.fromCard;
                },
                swappedToCard: function () {
                    return this.isSwapped ? this.state.mergeBalance.fromCard : this.state.mergeBalance.toCard;
                },
                swapArrowImageURL: function () {
                    return this.isSwapped
                        ? '/etc/designs/dd/images/merge-balance/merge_balance_arrow_swapped.svg'
                        : '/etc/designs/dd/images/merge-balance/merge_balance_arrow.svg';
                },
            },
            methods: {
                swapCards: function () {
                    this.store.swapCardsForMergeBalance();
                },
                confirmMergeBalance: function () {
                    var self = this;
                    this.store.mergeBalanceDDCard(this.swappedFromCard, this.swappedToCard, '', $(this.$refs.errorElem)).done(function () {
                        APP.modal.closeModal(null, $(self.store.selectors.mergeBalanceModal));
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'wallet_update',
                            'card_type' : 'Dunkin Card',
                            'wallet_action' : 'Merge Card'
                        });
                        self.store.showSuccessModal('SUCCESS!', 'Youve merged the balance successfully!', true);
                    });
                },
                cancelMergeBalance: function (event) {
                    APP.modal.closeModal(null, $(this.store.selectors.mergeBalanceModal));
                },
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dunkinCardManageAutoReload = (function () {
    var bindEventAndData = function (el) {
        var $el = $(el);
        var $arStatusRadios = $el
            .find('.ar-status-radio-btns')
            .find('.form-checkradio__item')
            .find('input[type="radio"]')
            .attr('v-model', 'arStatusModel');
        $arStatusRadios.filter('#ar_true_radio').attr('v-bind:value', 'true');
        $arStatusRadios.filter('#ar_false_radio').attr('v-bind:value', 'false');

        var $arTypeRadios = $el.find('.ar-type-radio-btns').find('.form-checkradio__item').find('input[type="radio"]').attr('v-model', 'arTypeModel');
        $arTypeRadios.filter('#ar_by_balance_radio').next().append($el.find('#ar_by_balance_template').html());
        $arTypeRadios.filter('#ar_by_schedule_radio').next().append($el.find('#ar_by_schedule_template').html());

        $el.find('#ar_by_balance_add_amount').append(
            "<option v-for='option in addAmountOptions' v-bind:value='option'>${{option.toFixed(2)}}</option>"
        );
        $el.find('#ar_by_balance_threshold_amount')
            .attr('v-model', 'balanceThresholdModel')
            .append("<option v-for='option in balanceThresholdOptions' v-bind:value='option'>${{option.toFixed(2)}}</option>");
        $el.find('#ar_by_schedule_add_amount').append(
            "<option v-for='option in balanceOptions' v-bind:value='option'>${{option.toFixed(2)}}</option>"
        );

        $el.find('#ar_by_schedule_timing').attr('v-model', 'scheduleTypeModel');
        $el.find('#ar_by_schedule_timing_weekly').closest('.aem-wrap--form-select').attr('v-show', 'scheduleTypeModel == "WEEKLY"');
        $el.find('#ar_by_schedule_timing_monthly').closest('.aem-wrap--form-select').attr('v-show', 'scheduleTypeModel == "MONTHLY"');

        $el.find('select').attr('v-init-select2', '');
    };

    var registerVueComponent = function () {
        Vue.component('dunkin-card-manage-auto-reload', {
            mixins: [APP.managePaymentsStore.getDDCardImageMixin],
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                    balanceOptions: [10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100],
                    arStatusModel: false,
                    arTypeModel: 'balance',
                    autoRechargeDetails: null,
                    balanceThresholdModel: 10,
                    scheduleTypeModel: 'WEEKLY',
                };
            },
            directives: {
                initSelect2: {
                    inserted: function (el) {
                        APP.formSelect.initSelect2($(el));
                        $(el).on('select2:select', function (e) {
                            var evt = document.createEvent('HTMLEvents');
                            evt.initEvent('change', true, true);
                            this.dispatchEvent(evt);
                        });
                    },
                },
            },
            computed: {
                lastFourDigits: function () {
                    return this.state.selectedDDCard ? this.state.selectedDDCard.lastFourDigits : '';
                },
                balanceThresholdOptions: function () {
                    var end = this.balanceOptions.indexOf(50) + 1;
                    return this.balanceOptions.slice(0, end);
                },
                addAmountOptions: function () {
                    var diff = this.balanceThresholdModel > 25 ? this.balanceThresholdModel - 25 : 0;
                    var start = this.balanceOptions.indexOf(this.balanceThresholdModel);
                    var end = this.balanceOptions.indexOf(100 - diff) + 1;
                    return this.balanceOptions.slice(start, end);
                },
                isFundingSourceCC: function () {
                    if (this.autoRechargeDetails && this.autoRechargeDetails.active) {
                        return this.autoRechargeDetails.fundingSource.type == 'CREDIT' ? true : false;
                    } else {
                        return false;
                    }
                },
                fundingSourceApGpDisplayText: function () {
                    if (this.autoRechargeDetails && this.autoRechargeDetails.active && !this.isFundingSourceCC) {
                        if (this.autoRechargeDetails.fundingSource.type == 'GOOGLEPAY') {
                            return 'Google Pay';
                        } else if (this.autoRechargeDetails.fundingSource.type == 'APPLEPAY') {
                            return 'Apple Pay';
                        }
                    }
                },
            },
            watch: {
                'state.selectedDDCard': function (newVal, oldVal) {
                    if (newVal == null) {
                        this.reset();
                    }
                },
                autoRechargeDetails: function (newVal, oldVal) {
                    if (newVal) {
                        this.arStatusModel = this.autoRechargeDetails.active;
                        if (this.arStatusModel) {
                            this.arTypeModel = this.autoRechargeDetails.type == 'THRESHOLD' ? 'balance' : 'schedule';
                            this.$nextTick(function () {
                                this.$refs.choosePaymentMethod.selectedEncryptedCCId = this.autoRechargeDetails.creditCard.encryptedCCId;
                                if (this.arTypeModel == 'balance') {
                                    this.$refs.form.ar_by_balance_add_amount.value = this.autoRechargeDetails.amount;
                                    this.$refs.form.ar_by_balance_threshold_amount.value = this.autoRechargeDetails.frequency;
                                } else {
                                    this.$refs.form.ar_by_schedule_add_amount.value = this.autoRechargeDetails.amount;
                                    this.$refs.form.ar_by_schedule_timing.value = this.autoRechargeDetails.type;
                                    if (this.autoRechargeDetails.type == 'WEEKLY') {
                                        this.$refs.form.ar_by_schedule_timing_weekly.value = this.autoRechargeDetails.frequency;
                                    } else {
                                        this.$refs.form.ar_by_schedule_timing_monthly.value = this.autoRechargeDetails.frequency;
                                    }
                                }
                                $(this.$refs.form).find('select').select2('destroy').select2();
                            });
                        }
                    } else {
                        this.arStatusModel = false;
                        this.arTypeModel = 'balance';
                    }
                },
                balanceThresholdModel: function (newVal, oldVal) {
                    this.$nextTick(function () {
                        $(this.$refs.form.ar_by_balance_add_amount).select2('destroy').val(newVal).select2();
                    });
                },
            },
            methods: {
                onFormSubmit: function () {
                    var self = this;
                    if (this.arStatusModel) {
                        if (!this.$refs.choosePaymentMethod.selectedCC) {
                            APP.global.getErrorMsg('Please select a payment method.', $(this.$refs.errorElem));
                            return false;
                        }
                        var autoRechargeObj = {
                            amount:
                                this.arTypeModel == 'balance'
                                    ? this.$refs.form.ar_by_balance_add_amount.value
                                    : this.$refs.form.ar_by_schedule_add_amount.value,
                            encryptedArId: this.autoRechargeDetails.encryptedArId,
                            frequency:
                                this.arTypeModel == 'balance'
                                    ? this.$refs.form.ar_by_balance_threshold_amount.value
                                    : this.$refs.form.ar_by_schedule_timing.value == 'WEEKLY'
                                    ? this.$refs.form.ar_by_schedule_timing_weekly.value
                                    : this.$refs.form.ar_by_schedule_timing_monthly.value,
                            mobileOptIn: this.autoRechargeDetails.mobileOptIn,
                            type: this.arTypeModel == 'balance' ? 'THRESHOLD' : this.$refs.form.ar_by_schedule_timing.value,
                            creditCard: this.$refs.choosePaymentMethod.selectedCC,
                            ddCard: this.state.selectedDDCard,
                        };
                        this.store.turnOnAutoRecharge(autoRechargeObj, $(this.$refs.errorElem)).done(function (response) {
                            window.dataLayer = window.dataLayer || [];
                            window.dataLayer.push({
                                'event' : 'wallet_update',
                                'card_type' : 'Dunkin Card',
                                'wallet_action' : 'Reload'
                            });
                            self.$refs.choosePaymentMethod.reset();
                            self.getAutoReloadDetails();
                            self.store.showSuccessModal('SUCCESS!', 'Your Auto Reload preferences have been updated.');
                            $(window).scrollTop(0);
                        });
                    } else {
                        APP.modal.showModal(null, $(this.store.selectors.turnOffArConfirmationModal));
                    }
                    return false;
                },
                confirmDisableAutoReload: function () {
                    var self = this;
                    this.store
                        .turnOffAutoRecharge(this.state.selectedDDCard.cardNumber, $(this.$refs.errorElem))
                        .done(function () {
                            APP.modal.closeModal(null, $(self.store.selectors.turnOffArConfirmationModal));
                            self.store.showSuccessModal('SUCCESS!', 'Auto Reload has been disabled.', true);
                        })
                        .fail(function () {
                            APP.modal.closeModal(null, $(self.store.selectors.turnOffArConfirmationModal));
                        });
                },
                getAddressByEncryptedID: function (encryptedAddressId) {
                    return this.state.allAddresses.find(function (address) {
                        return (address.encryptedAddressId = encryptedAddressId);
                    });
                },
                getAutoReloadDetails: function () {
                    var self = this;
                    this.store.getAutoReloadDetails(this.state.selectedDDCard.cardNumber, $(this.$refs.errorElem)).done(function (response) {
                        if (response.data.length) {
                            self.autoRechargeDetails = response.data[0];
                        }
                    });
                },
                collapsePanel: function () {
                    APP.addMoreButton.collapsePanel($(this.$el).closest('.add-more-button'));
                },
                reset: function () {
                    this.collapsePanel();
                    this.$refs.choosePaymentMethod && this.$refs.choosePaymentMethod.reset();
                    this.$refs.form.reset();
                    $(this.$refs.form).parsley().reset();
                    APP.global.removeError($(this.$refs.errorElem));
                    this.autoRechargeDetails = null;
                },
            },
            mounted: function () {
                var self = this;
                $(self.$refs.form).parsley().on('form:submit', self.onFormSubmit);
                $(self.$el).closest('.add-more-button').on('addMoreButton:expanded', self.getAutoReloadDetails);
                $(self.store.selectors.turnOffArConfirmationModal).find('.cta-confirm').on('click', self.confirmDisableAutoReload);
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dunkinCardHistory = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('dunkin-card-history', {
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                };
            },
            watch: {
                'state.selectedDDCard': function (newVal, oldVal) {
                    if (newVal == null) {
                        this.reset();
                    }
                },
            },
            methods: {
                collapsePanel: function () {
                    APP.addMoreButton.collapsePanel($(this.$el).closest('.add-more-button'));
                },
                reset: function () {
                    this.collapsePanel();
                },
            },
            mounted: function () {
                var self = this;
                APP.windowCardTransactionHistory.init();
                $(self.$el)
                    .closest('.add-more-button')
                    .on('addMoreButton:expanded', function () {
                        APP.windowCardTransactionHistory.setDDCardData(self.state.selectedDDCard);
                        APP.windowCardTransactionHistory.resetMonthSelection();
                    });
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dunkinCardDetails = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('dunkin-card-details', {
            mixins: [APP.managePaymentsStore.getDDCardImageMixin],
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                };
            },
            computed: {
                balance: function () {
                    return this.state.selectedDDCard ? this.state.selectedDDCard.balance.balance.toFixed(2) : '';
                },
                displayDate: function () {
                    return this.state.selectedDDCard ? this.state.selectedDDCard.balance.displayDate : '';
                },
                defaultCard: function () {
                    return this.state.selectedDDCard ? this.state.selectedDDCard.defaultCard : false;
                },
                lastFourDigits: function () {
                    return this.state.selectedDDCard ? this.state.selectedDDCard.lastFourDigits : '';
                },
                autorechargeActive: function () {
                    return this.state.selectedDDCard ? this.state.selectedDDCard.autorechargeActive : false;
                },
                isZeroBalance: function () {
                    return this.state.selectedDDCard ? parseFloat(this.state.selectedDDCard.balance.balance) == 0 : false;
                },
            },
            methods: {
                setPrimaryDDCard: function () {
                    var self = this;
                    this.store.setPrimaryDDCard($(this.$refs.errorElem)).done(function () {
                        self.store.showSuccessModal('SUCCESS!', 'This card is now your Primary Dunkin Card.');
                    });
                },
                deleteDDCard: function () {
                    APP.modal.showModal(null, $(this.store.selectors.deleteDDCardConfirmationModal));
                },
                deleteDDCardConfirmation: function () {
                    var self = this;
                    var lastFourDigits = this.state.selectedDDCard.lastFourDigits;
                    this.store
                        .deleteDDCard($(this.$refs.errorElem))
                        .done(function () {
                            window.dataLayer = window.dataLayer || [];
                            window.dataLayer.push({
                                'event' : 'wallet_update',
                                'card_type' : 'Dunkin Card',
                                'wallet_action' : 'Remove'
                            });
                            APP.modal.closeModal(null, $(self.store.selectors.deleteDDCardConfirmationModal));
                            self.store.showSuccessModal(
                                'SUCCESS!',
                                'The Dunkin Card ' + lastFourDigits + ' has now been deleted from your account.',
                                true
                            );
                        })
                        .fail(function () {
                            APP.modal.closeModal(null, $(self.store.selectors.deleteDDCardConfirmationModal));
                        });
                },
                getDDCardBalance: function () {
                    this.store.getDDCardBalance($(this.$refs.errorElem));
                },
            },
            mounted: function () {
                var self = this;
                $(self.store.selectors.deleteDDCardConfirmationModal).find('.cta-confirm').on('click', self.deleteDDCardConfirmation);
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.dunkinCardAddFunds = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('dunkin-card-add-funds', {
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                };
            },
            watch: {
                'state.selectedDDCard': function (newVal, oldVal) {
                    if (newVal == null) {
                        this.reset();
                        this.collapsePanel();
                    }
                },
            },
            methods: {
                onFormSubmit: function () {
                    var self = this;
                    var actionURL = $(this.$refs.form).attr('action');
                    var service = this.$refs.form.service.value;
                    var amount = this.$refs.form.add_value_input.value;
                    var selectedCC = this.$refs.choosePaymentMethod.selectedCC;
                    var cvv = this.$refs.choosePaymentMethod.cvv;
                    if (!selectedCC) {
                        APP.global.getErrorMsg('Please select a payment method.', $(this.$refs.errorElem));
                    } else {
                        var payload = {
                            recharge: {
                                amount: amount,
                                ddCard: {
                                    cardNumber: this.state.selectedDDCard.cardNumber,
                                    cardPin: this.state.selectedDDCard.cardPin,
                                },
                                creditCard: {
                                    encryptedCCId: selectedCC.encryptedCCId,
                                    cardSecurityCode: cvv,
                                    type: selectedCC.type,
                                    expMonth: selectedCC.expMonth,
                                    expYear: selectedCC.expYear,
                                    address: this.getAddressByEncryptedID(selectedCC.encryptedAddressId),
                                },
                            },
                            service: service,
                        };

                        this.store.rechargeDDCard(actionURL, payload, $(this.$refs.errorElem)).done(function () {
                            var cardNum = self.state.selectedDDCard.lastFourDigits;
                            var amount = parseInt(payload.recharge.amount).toFixed(2);
                            self.reset();
                            window.dataLayer = window.dataLayer || [];
                            window.dataLayer.push({
                                'event' : 'wallet_update',
                                'card_type' : 'Dunkin Card',
                                'wallet_action' : 'Add Funds'
                            });
                            self.store.showSuccessModal('$' + amount + ' ADDED!', '$' + amount + ' was added to Dunkin Card ' + cardNum + '.');
                        });
                    }

                    return false;
                },
                cancelAddFunds: function () {
                    this.reset();
                    this.collapsePanel();
                },
                getAddressByEncryptedID: function (encryptedAddressId) {
                    return this.state.allAddresses.find(function (address) {
                        return address.encryptedAddressId == encryptedAddressId;
                    });
                },
                collapsePanel: function () {
                    APP.addMoreButton.collapsePanel($(this.$el).closest('.add-more-button'));
                },
                reset: function () {
                    this.$refs.choosePaymentMethod.reset();
                    this.$refs.form.reset();
                    $(this.$refs.form).parsley().reset();
                    APP.global.removeError($(this.$refs.errorElem));
                },
            },
            mounted: function () {
                $(this.$refs.form).parsley().on('form:submit', this.onFormSubmit);
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

/* Credit & Debit Cards List Component JS */
'use strict';

var APP = (window.APP = window.APP || {});

APP.creditDebitCardsList = (function () {

        var registerVueComponent = function(){
            Vue.component('credit-debit-cards-list', {
                data: function(){
                    return{
                        state: APP.managePaymentsStore.state,
                        store: APP.managePaymentsStore,
                    };
                },
                methods:{
                    setSelectedCard: function (card) {
                        this.store.setSelectedCreditCard(card);
                    },
                    getCardImg: function (type) {
                        return '/etc/designs/dd/images/credit-cards/' + type.toLowerCase() + '.svg';
                    },
                },
                created: function () {
                    this.store.getCreditCards();
                    this.store.getAllAddresses();
                },
            });
        };

        var init = function () {
            if (!APP.global.isEditMode()) {
                registerVueComponent();
            }
        };

        return {
            init: init
        };
})();
/* Credit & Debit Card Details Component JS */

'use strict';

var APP = (window.APP = window.APP || {});

APP.creditDebitCardDetails = (function () {
    var registerVueComponent = function () {
        Vue.component('credit-debit-card-details', {
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                };
            },
            computed: {
                lastFourDigits: function () {
                    return this.state.selectedCreditCard ? this.state.selectedCreditCard.lastFourDigitsCardNo : '';
                },
                holderName: function () {
                    return this.state.selectedCreditCard ? this.state.selectedCreditCard.holderName : '';
                },
                cardType: function () {
                    return this.state.selectedCreditCard ? this.state.selectedCreditCard.type : '';
                },
                selectedAddress: function () {
                    if (this.state.selectedCreditCard) {
                        return this.state.allAddresses.find(function (address) {
                            return address.encryptedAddressId == this.state.selectedCreditCard.encryptedAddressId;
                        }, this);
                    } else {
                        return '';
                    }
                },
            },
            methods: {
                getCardImg: function (type) {
                    return '/etc/designs/dd/images/credit-cards/' + type.toLowerCase() + '.svg';
                },
                deleteCreditCardFn: function () {
                    APP.modal.showModal(null, $(this.store.selectors.deleteCreditCardConfirmationModal));
                },
                deleteConfirm: function () {
                    var self = this;
                    this.store.deleteCreditCard(this.state.selectedCreditCard.encryptedCCId, $(this.$refs.errorElem)).done(function () {
                        APP.modal.closeModal(null, $(self.store.selectors.deleteCreditCardConfirmationModal));
                        self.store.showSuccessModal(
                            'SUCCESS!',
                            'The Credit/Debit Card ' +
                                self.state.selectedCreditCard.lastFourDigitsCardNo +
                                ' has now been deleted from your account.',
                            true
                        );
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'wallet_update',
                            'card_type' : 'Credit Card',
                            'wallet_action' : 'Remove'
                        });

                    });
                },
            },
            mounted: function () {
                var self = this;
                $(self.store.selectors.deleteCreditCardConfirmationModal).find('.cta-confirm').on('click', self.deleteConfirm);
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.choosePaymentMethod = (function () {
    var bindEventAndData = function (el) {
        $(el).find('.form-checkradio__item').attr('v-for', '(cc, index) in state.creditCards');
        $(el).find('.form-checkradio__input-label').html($(el).find('#credit-card-template').html());
        $(el).find('.form-checkradio__item').find('label').attr('v-bind:for', 'getID(index)');
        $(el).find('.form-checkradio__item').find('input[type="radio"]').attr({
            'v-model': 'selectedEncryptedCCId',
            'v-bind:value': 'cc.encryptedCCId',
            'v-bind:id': 'getID(index)',
        });
        $(el).find('.form-checkradio__item').find('#cvv_input').attr('v-model', 'cvv');
    };

    var registerVueComponent = function () {
        Vue.component('choose-payment-method', {
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                    selectedEncryptedCCId: '',
                    cvv: '',
                };
            },
            computed: {
                selectedCC: function () {
                    var cc = this.state.creditCards.find(function (cc) {
                        return cc.encryptedCCId == this.selectedEncryptedCCId;
                    }, this);

                    if (cc) {
                        cc.address = this.state.allAddresses.find(function (address) {
                            return address.encryptedAddressId == cc.encryptedAddressId;
                        }, this);
                    }

                    return cc;
                },
            },
            watch: {
                selectedEncryptedCCId: function (newVal, oldVal) {
                    this.cvv = '';
                },
            },
            methods: {
                getID: function (index) {
                    return this.$attrs['data-resid'] + '_' + index;
                },
                getCardImg: function (type) {
                    return '/etc/designs/dd/images/credit-cards/' + type.toLowerCase() + '.svg';
                },
                addPaymentType: function () {
                    APP.addEditPaymentType.add();
                },
                reset: function () {
                    this.selectedEncryptedCCId = '';
                    this.cvv = '';
                },
            },
            mounted: function () {
                if (!this.state.creditCards.length) {
                    this.store.getCreditCards($(this.$refs.errorElem));
                }
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.addEditPaymentType = (function () {
    var component;
    var bindEventAndData = function (el) {
        $(el).find('#add_address').attr('v-bind:class', '{"show-address-section": !isAddressPresent}').prev().attr('v-show', 'isAddressPresent');
        var $addressList = $(el).find('.address-list');
        $addressList.find('.form-checkradio__input-label').html($(el).find('#address-item-template').html());
        $addressList.find('.form-checkradio__item').attr('v-for', '(address, index) in state.allAddresses');
        $addressList.find('.form-checkradio__item').find('label').attr('v-bind:for', 'getID(index)');
        $addressList.find('.form-checkradio__item').find('input[type="radio"]').attr({
            'v-model': 'selectedEncryptedAddressId',
            'v-bind:value': 'address.encryptedAddressId',
            'v-bind:id': 'getID(index)',
        });
        $(el).find('#cc_year').append("<option v-for='year in yearOptions' v-bind:value='year'>{{year}}</option>");
        $(el).find('#cc_number').attr('v-bind:readonly', 'isEditAction');
        $(el).find('.add-more-button__text-container').text("{{isEditAction ? 'EDIT' : 'ADD'}} ADDRESS");
    };

    var registerVueComponent = function () {
        Vue.component('add-edit-payment-type', {
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                    selectedEncryptedAddressId: '',
                    isAddressSectionOpen: false,
                    isEditAction: false,
                };
            },
            computed: {
                isAddressPresent: function () {
                    return this.state.allAddresses.length ? true : false;
                },
                validateCardForm: function () {
                    if (!this.isAddressPresent) {
                        return true;
                    } else {
                        return this.isAddressSectionOpen ? false : true;
                    }
                },
                validateAddressForm: function () {
                    if (!this.isAddressPresent) {
                        return true;
                    } else {
                        return this.isAddressSectionOpen ? true : false;
                    }
                },
                submitBtnText: function () {
                    if (this.validateCardForm && this.validateAddressForm) {
                        return 'SAVE';
                    } else if (this.validateCardForm && !this.validateAddressForm) {
                        return 'SAVE';
                    } else if (!this.validateCardForm && this.validateAddressForm) {
                        return this.isEditAction ? 'SAVE ADDRESS' : 'ADD ADDRESS';
                    }
                },
                selectedAddress: function () {
                    return this.state.allAddresses.find(function (address) {
                        return address.encryptedAddressId == this.selectedEncryptedAddressId;
                    }, this);
                },
                yearOptions: function () {
                    var currentYear = new Date().getFullYear();
                    var options = [];
                    for (var i = 0; i <= 20; i++) {
                        options.push(currentYear + i);
                    }
                    return options;
                },
            },
            watch: {
                isEditAction: function (newVal, oldVal) {
                    if (newVal) {
                        this.$refs.ccForm.cc_number.value = '   ' + this.state.selectedCreditCard.lastFourDigitsCardNo;
                        this.$refs.ccForm.cc_month.value =
                            this.state.selectedCreditCard.expMonth < 10
                                ? '0' + this.state.selectedCreditCard.expMonth
                                : this.state.selectedCreditCard.expMonth;
                        this.$refs.ccForm.cc_year.value = this.state.selectedCreditCard.expYear;
                        this.selectedEncryptedAddressId = this.state.selectedCreditCard.encryptedAddressId;
                        $(this.$el).find('select').trigger('change');
                    }
                },
                selectedEncryptedAddressId: function (newVal, oldVal) {
                    if (newVal && this.isEditAction && this.selectedAddress) {
                        this.$refs.addressForm.cc_address_1.value = this.selectedAddress.firstStreet;
                        this.$refs.addressForm.cc_address_2.value = this.selectedAddress.secondStreet ? this.selectedAddress.secondStreet : '';
                        this.$refs.addressForm.cc_address_city.value = this.selectedAddress.city;
                        this.$refs.addressForm.cc_address_state.value = this.selectedAddress.state;
                        this.$refs.addressForm.cc_address_zipCode.value = this.selectedAddress.zipCode5;
                        this.$refs.addressForm.cc_address_firstName.value = this.selectedAddress.firstName;
                        this.$refs.addressForm.cc_address_lastName.value = this.selectedAddress.lastName;
                        $(this.$el).find('select').trigger('change');
                        $(this.$refs.addressForm).parsley().reset();
                    }
                },
            },
            methods: {
                getID: function (index) {
                    return 'address-item' + '_' + index;
                },
                addPaymentType: function () {
                    this.isEditAction = false;
                    APP.modal.showModal(null, $(this.store.selectors.addEditPaymentTypeModal));
                },
                editPaymentType: function () {
                    this.isEditAction = true;
                    APP.modal.showModal(null, $(this.store.selectors.addEditPaymentTypeModal));
                },
                getCardTypeByNumber: function (cc_number) {
                    var creditCardTypes = {
                        amex: 'AMEX',
                        discover: 'DISC',
                        jcb: 'JCB',
                        mastercard: 'MC',
                        visa: 'VISA',
                    };
                    var cardObject = $('<input>')
                        .attr({
                            type: 'number',
                            value: cc_number,
                        })
                        .validateCreditCard();
                    return {
                        full: cardObject['card_type'].name.toUpperCase(),
                        short: creditCardTypes[cardObject['card_type'].name],
                    };
                },
                getCardTypeFullName: function (type) {
                    var creditCardTypes = {
                        AMEX: 'AMEX',
                        DISC: 'DISCOVER',
                        JCB: 'JCB',
                        MC: 'MASTERCARD',
                        VISA: 'VISA',
                    };

                    return creditCardTypes[type];
                },
                saveAddress: function () {
                    var self = this;
                    var addressObj = {
                        encryptedAddressId: this.selectedEncryptedAddressId ? this.selectedEncryptedAddressId : '',
                        firstStreet: this.$refs.addressForm.cc_address_1.value,
                        secondStreet: this.$refs.addressForm.cc_address_2.value,
                        city: this.$refs.addressForm.cc_address_city.value,
                        state: this.$refs.addressForm.cc_address_state.value,
                        zipCode5: this.$refs.addressForm.cc_address_zipCode.value,
                        firstName: this.$refs.addressForm.cc_address_firstName.value,
                        lastName: this.$refs.addressForm.cc_address_lastName.value,
                    };

                    if (this.isEditAction) {
                        return this.store.updateAddress(addressObj, this.selectedAddress, $(this.$refs.errorElem)).done(function () {
                            self.collapseAddressPanel();
                        });
                    } else {
                        return this.store.addNewAddress(addressObj, $(this.$refs.errorElem)).done(function (response) {
                            self.selectedEncryptedAddressId = response.data.encryptedAddressId;
                            self.collapseAddressPanel();
                            self.resetAddressForm();
                        });
                    }
                },
                saveCreditCard: function (newAddress) {
                    var self = this;
                    if (this.isEditAction) {
                        var ccObj = {
                            address: this.selectedAddress,
                            cardSecurityCode: this.$refs.ccForm.cc_cvv.value,
                            encryptedAddressId: this.selectedAddress.encryptedAddressId,
                            encryptedCCId: this.state.selectedCreditCard.encryptedCCId,
                            expMonth: this.$refs.ccForm.cc_month.value,
                            expYear: this.$refs.ccForm.cc_year.value,
                        };
                        return this.store.modifyCreditCard(ccObj, $(this.$refs.errorElem)).done(function (response) {
                            self.closeModal();
                            self.showSuccessModal();
                        });
                    } else {
                        var cardType = this.getCardTypeByNumber(this.$refs.ccForm.cc_number.value);
                        var ccObj = {
                            address: this.selectedAddress ? this.selectedAddress : newAddress,
                            cardNumber: this.$refs.ccForm.cc_number.value,
                            cardSecurityCode: this.$refs.ccForm.cc_cvv.value,
                            encryptedAddressId: this.selectedAddress ? this.selectedAddress.encryptedAddressId : newAddress.encryptedAddressId,
                            encryptedCCId: '',
                            expMonth: this.$refs.ccForm.cc_month.value,
                            expYear: this.$refs.ccForm.cc_year.value,
                            type: cardType.short,
                        };
                        return this.store.addCreditCard(ccObj, $(this.$refs.errorElem)).done(function (response) {
                            self.closeModal();
                            self.showSuccessModal(response.data.lastFourDigitsCardNo, self.getCardTypeFullName(response.data.type));
                        });
                    }
                },
                formSubmit: function () {
                    var self = this;
                    if (this.isAddressPresent) {
                        if (this.validateCardForm) {
                            $.when($(this.$refs.ccForm).parsley().whenValidate(), $(this.$refs.confirmationForm).parsley().whenValidate()).done(
                                function () {
                                    self.saveCreditCard();
                                }
                            );
                        } else if (this.validateAddressForm) {
                            $.when($(this.$refs.addressForm).parsley().whenValidate()).done(function () {
                                self.saveAddress();
                            });
                        }
                    } else {
                        $.when(
                            $(this.$refs.ccForm).parsley().whenValidate(),
                            $(this.$refs.addressForm).parsley().whenValidate(),
                            $(this.$refs.confirmationForm).parsley().whenValidate()
                        ).done(function () {
                            self.saveAddress().done(function (response) {
                                self.saveCreditCard(response.data);
                            });
                        });
                    }
                },
                collapseAddressPanel: function () {
                    APP.addMoreButton.collapsePanel($(this.$el).find('.add-more-button'));
                },
                closeModal: function () {
                    APP.modal.closeModal(null, $(this.store.selectors.addEditPaymentTypeModal));
                },
                showSuccessModal: function (cardLastFourDigits, cardType) {
                    if (this.isEditAction) {
                        this.store.showSuccessModal('SUCCESS!', 'Your Card Information has been updated.', true);
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'wallet_update',
                            'card_type' : 'Credit Card',
                            'wallet_action' : 'Edit'
                        });

                    } else {
                        this.store.showSuccessModal(
                            'SUCCESS!',
                            'The ' + cardType + ' ' + cardLastFourDigits + ' has been added as another payment method.',
                            true
                        );
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'wallet_update',
                            'card_type' : 'Credit Card',
                            'wallet_action' : 'Add'
                        });

                    }
                    $(window).scrollTop(0);
                },
                reset: function () {
                    this.isEditAction = false;
                    this.selectedEncryptedAddressId = '';
                    this.resetCCForm();
                    this.resetAddressForm();
                    this.resetConfirmationForm();
                    APP.global.removeError($(this.$refs.errorElem));
                    this.collapseAddressPanel();
                    $(this.$el).find('select').trigger('change');
                },
                resetAddressForm: function () {
                    this.$refs.addressForm.reset();
                    $(this.$refs.addressForm).parsley().reset();
                },
                resetCCForm: function () {
                    this.$refs.ccForm.reset();
                    $(this.$refs.ccForm).parsley().reset();
                },
                resetConfirmationForm: function () {
                    this.$refs.confirmationForm.reset();
                    $(this.$refs.confirmationForm).parsley().reset();
                },
            },
            mounted: function () {
                var self = this;
                self.store.getAllAddresses($(self.$refs.errorElem));
                $(self.$el)
                    .find('.add-more-button')
                    .on('addMoreButton:expanded', function () {
                        self.isAddressSectionOpen = true;
                    })
                    .on('addMoreButton:collapsed', function () {
                        self.isAddressSectionOpen = false;
                    });

                $(self.store.selectors.addEditPaymentTypeModal).on('modal-close', self.reset);
            },
            created: function () {
                component = this;
            },
        });
    };

    var add = function () {
        component.addPaymentType();
    };

    var edit = function () {
        component.editPaymentType();
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
        add: add,
        edit: edit,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.addDunkinCard = (function () {
    var bindEventAndData = function (el) {};

    var registerVueComponent = function () {
        Vue.component('add-dunkin-card', {
            data: function () {
                return {
                    state: APP.managePaymentsStore.state,
                    store: APP.managePaymentsStore,
                };
            },
            methods: {
                onFormSubmit: function () {
                    var self = this;
                    var $form = $(this.$refs.form);
                    var $modal = $(this.store.selectors.addDunkinCardModal);
                    var actionURL = $form.attr('action');
                    var formData = $form.serialize();
                    this.store.addDDCard(actionURL, formData, $(this.$refs.errorElem)).done(function (response) {
                        window.dataLayer = window.dataLayer || [];
                        window.dataLayer.push({
                            'event' : 'wallet_update',
                            'card_type' : 'Dunkin Card',
                            'wallet_action' : 'Add'
                        });
                        APP.modal.closeModal(null, $modal);
                        self.store.showSuccessModal(
                            'SUCCESS!',
                            'The Dunkin Card ' + response.data.lastFourDigits + ' has now been added to your account.',
                            true
                        );
                    });
                    return false;
                },
                reset: function () {
                    this.$refs.form.reset();
                    $(this.$refs.form).parsley().reset();
                    APP.global.removeError($(this.$refs.errorElem));
                },
            },
            mounted: function () {
                var self = this;
                $(self.$refs.form).parsley().on('form:submit', self.onFormSubmit);
                $(self.store.selectors.addDunkinCardModal).on('modal-close', self.reset);
            },
        });
    };

    var init = function (el) {
        if (!APP.global.isEditMode()) {
            bindEventAndData(el);
            registerVueComponent();
        }
    };

    return {
        init: init,
    };
})();

'use strict';

var APP = (window.APP = window.APP || {});

APP.accountHistory = (function () {
    var vueApp,
        transactionHistoryJson = {
            month: '',
            year: '',
            service: 'getAccountTransactions',
        },
        getEachTransactionJson = {
            transactionDate: '',
            storeCode: '',
            transactionNumber: '',
            service: 'getTransaction',
        },
        $monthDropDown,
        selectedDate,
        state = 0;

    var templates = {
        error: '' + "<div class='transaction-page-error'>{msg}</div>",
    };

    var loadTransactionHistory = function (e) {
        $('.transaction-page-error').remove();
        selectedDate = $(this).val().split('-');
        transactionHistoryJson.month = selectedDate[0];
        transactionHistoryJson.year = selectedDate[1];
        APP.global.showLoader();
        $.ajax({
            type: 'POST',
            url: '/bin/servlet/loyalty',
            data: JSON.stringify(transactionHistoryJson),
            dataType: 'json',
            contentType: 'application/json',
            success: function (response) {
                if (response.data && response.data.transactionList && response.data.transactionList.length > 0) {
                    $('.no-data-error-msg').remove();
                    vueApp.isViewDetails = false;
                    vueApp.accountHistoryData = response.data.transactionList;
                } else {
                    vueApp.accountHistoryData = [];
                    var msg = '<div class="no-data-error-msg">No data is available for the selected month.</div>';
                    if ($('.no-data-error-msg').length <= 0) {
                        $(vueApp.$refs.transactionHistoryRef).prepend(msg);
                    }
                }
            },
            error: function (jqXHR) {
                vueApp.accountHistoryData = [];
                $('.no-data-error-msg').remove();
                var response = JSON.parse(jqXHR.responseText);
                $(vueApp.$refs.transactionHistoryRef).prepend(
                    APP.registration.generateMarkup(templates.error, {
                        msg: response.error.message,
                    })
                );
            },
        });
    };

    var createVueApp = function () {
        vueApp = new Vue({
            el: $('.transaction-history').get(0),
            data: {
                accountHistoryData: [],
                selectedTransaction: {},
                isViewDetails: false,
                viewDetailsData: {},
                viewDetailsErrorMsg: '',
            },
            methods: {
                viewTransactionDetails: function (obj) {
                    this.isViewDetails = true;
                    this.selectedTransaction = obj;
                    $('.account-history .form-select').hide();
                },
                goToPreviousPage: function () {
                    $('.account-history .form-select').show();
                    this.isViewDetails = false;
                },
                generateID: function (index) {
                    return index + '_' + Math.floor(Math.random() * Date.now());
                },
                getTitle: function (item) {
                    switch (item.transactiontype) {
                        case 'Purchase':
                            var arr = ['9', '10', '11', '15', '1000107', '1000108', '1000111'];
                            if (arr.indexOf(item.requestorId) != -1) {
                                item.title =
                                    'Mobile Order' +
                                    ' ' +
                                    '#' +
                                    (item.transactionNumber.length > 3
                                        ? item.transactionNumber.slice(item.transactionNumber.length - 3)
                                        : item.transactionNumber);
                            } else {
                                item.title =
                                    'In-Store Order' +
                                    ' ' +
                                    '#' +
                                    (item.transactionNumber.length > 3
                                        ? item.transactionNumber.slice(item.transactionNumber.length - 3)
                                        : item.transactionNumber);
                            }
                            break;

                        case 'Reward Earned':
                            item.title = 'Converted points for' + ' ' + item.rewardName;
                            break;

                        case 'CSR Adjustment':
                        case 'Non Transactional Bonus':
                        case 'Reward Cancelled':
                            item.title = 'Points Adjustment';
                            break;

                        case 'Forfeited Points.':
                            item.title = 'Reward Expired';
                            break;
                    }
                    return item.title;
                },
                getAddress: function (item) {
                    return item.description ? item.description.split('Purchase -').join('') : '';
                },
                getDestination: function (item) {
                    switch (item.requestorId) {
                        case '9':
                        case '1000107':
                            item.destination = 'Walk In Pickup';
                            break;

                        case '10':
                        case '1000108':
                            item.destination = 'Drive Thru Pickup';
                            break;

                        case '11':
                        case '1000111':
                            item.destination = 'Curbside Pickup';
                            break;

                        case '15':
                            item.destination = 'Delivery';
                            break;

                        default:
                            item.destination = 'In-Store Pickup';
                    }

                    return item.destination;
                },
            },
            created: function () {
                $monthDropDown.on('change', loadTransactionHistory);
                APP.formSelect.loadMonthDropdown($monthDropDown);
            },
        });

        Vue.directive('transaction-details', {
            bind: function (el, binding, vnode) {
                if (binding.value.item.transactiontype === 'Purchase' && !binding.value.item.viewDetailsData) {
                    var date = binding.value.item.transactionDateTime.split('', 8).join('');
                    var formatDate = new Date(date);
                    var formatDateString;
                    formatDateString =
                        formatDate.getFullYear() + '-' + ('0' + (formatDate.getMonth() + 1)).slice(-2) + '-' + ('0' + formatDate.getDate()).slice(-2);
                    getEachTransactionJson.transactionDate = formatDateString;
                    getEachTransactionJson.storeCode = binding.value.item.storeNumber;
                    getEachTransactionJson.transactionNumber = binding.value.item.transactionNumber;

                    $.ajax({
                        type: 'POST',
                        url: '/bin/servlet/loyalty',
                        data: JSON.stringify(getEachTransactionJson),
                        dataType: 'json',
                        contentType: 'application/json',
                        success: function (response) {
                            if (response && response.data) {
                                var detailsData = response.data;
                                var filteredTransactionDetail = detailsData.transactionDetail.filter(function (item) {
                                    return item.dollarValueGross > 0;
                                });
                                detailsData.orderItemCount = filteredTransactionDetail.reduce(function (prev, cur) {
                                    return prev + cur.quantity;
                                }, 0);
                                vnode.context.accountHistoryData[binding.value.index].viewDetailsData = detailsData;
                                $(el).find('.order-quantity').text(detailsData.orderItemCount);
                            }
                        },
                        error: function (jqXHR) {
                            var response = JSON.parse(jqXHR.responseText);
                            vueApp.viewDetailsErrorMsg = response.error.message;
                        },
                    });
                } else if (binding.value.item.transactiontype === 'Reward Earned') {
                    (function () {
                        APP.loyaltyService.getRewardsCatalog().done(function (response) {
                            if (response.data && response.data.rewardCategories && response.data.rewardCategories.length > 0) {
                                var isMatchingReward = false;
                                var rewardImg;
                                $.each(response.data.rewardCategories, function (index, obj) {
                                    if (binding.value.item.rewardCode === obj.categoryCode) {
                                        isMatchingReward = true;
                                        rewardImg = obj.images.length ? obj.images[0].url : APP.myRewards.get_DNKN_reward_img();
                                        $(el)
                                            .find('.account-history__icon')
                                            .css('background', 'url(' + rewardImg + ')');
                                    }
                                });
                                if (!isMatchingReward) {
                                    $(el)
                                        .find('.account-history__icon')
                                        .css('background', 'url(' + APP.myRewards.get_free_bev_reward_img() + ')');
                                    $(el).find('.account-history__icon').css('height', '34px');
                                }
                            }
                        });
                    })(el, binding);
                }
            },
        });
    };

    var getState = function () {
        return state;
    };

    var init = function (element) {
        $monthDropDown = $('.account-history #month-dropdown');
        if (!APP.global.isEditMode()) {
            createVueApp();
        }
    };

    return {
        init: init,
        getState: getState,
    };
})();

